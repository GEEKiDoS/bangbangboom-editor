/*! For license information please see main.f3c7930b.chunk.js.LICENSE.txt */
(this["webpackJsonpbangbangboom-editor"]=this["webpackJsonpbangbangboom-editor"]||[]).push([[0],{140:function(t,e,n){window,t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=62)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1);e.METADATA_KEY=r;var i=n(27);e.Container=i.Container;var o=n(5);e.BindingScopeEnum=o.BindingScopeEnum,e.BindingTypeEnum=o.BindingTypeEnum,e.TargetTypeEnum=o.TargetTypeEnum;var a=n(43);e.AsyncContainerModule=a.AsyncContainerModule,e.ContainerModule=a.ContainerModule;var s=n(44);e.injectable=s.injectable;var u=n(45);e.tagged=u.tagged;var c=n(46);e.named=c.named;var l=n(17);e.inject=l.inject,e.LazyServiceIdentifer=l.LazyServiceIdentifer;var h=n(47);e.optional=h.optional;var d=n(48);e.unmanaged=d.unmanaged;var f=n(49);e.multiInject=f.multiInject;var p=n(50);e.targetName=p.targetName;var m=n(51);e.postConstruct=m.postConstruct;var y=n(15);e.MetadataReader=y.MetadataReader;var g=n(8);e.id=g.id;var v=n(6);e.decorate=v.decorate;var _=n(20);e.traverseAncerstors=_.traverseAncerstors,e.taggedConstraint=_.taggedConstraint,e.namedConstraint=_.namedConstraint,e.typeConstraint=_.typeConstraint;var b=n(9);e.getServiceIdentifierAsString=b.getServiceIdentifierAsString;var x=n(52);e.multiBindToService=x.multiBindToService},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NAMED_TAG="named",e.NAME_TAG="name",e.UNMANAGED_TAG="unmanaged",e.OPTIONAL_TAG="optional",e.INJECT_TAG="inject",e.MULTI_INJECT_TAG="multi_inject",e.TAGGED="inversify:tagged",e.TAGGED_PROP="inversify:tagged_props",e.PARAM_TYPES="inversify:paramtypes",e.DESIGN_PARAM_TYPES="design:paramtypes",e.POST_CONSTRUCT="post_construct"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",e.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",e.NULL_ARGUMENT="NULL argument",e.KEY_NOT_FOUND="Key Not Found",e.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",e.CANNOT_UNBIND="Could not unbind serviceIdentifier:",e.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",e.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",e.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",e.UNDEFINED_INJECT_ANNOTATION=function(t){return"@inject called with undefined this could mean that the class "+t+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},e.CIRCULAR_DEPENDENCY="Circular dependency found:",e.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",e.INVALID_BINDING_TYPE="Invalid binding type:",e.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",e.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",e.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",e.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",e.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",e.ARGUMENTS_LENGTH_MISMATCH=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."},e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",e.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",e.POST_CONSTRUCT_ERROR=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"@postConstruct error in class "+t[0]+": "+t[1]},e.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"It looks like there is a circular dependency in one of the '"+t[0]+"' bindings. Please investigate bindings withservice identifier '"+t[1]+"'."},e.STACK_OVERFLOW="Maximum call stack size exceeded"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}();e.Metadata=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e,n,r){void 0===n&&(n=!1),i(this,t),this._fn=e,this._once=n,this._thisArg=r,this._next=this._prev=this._owner=null}return r(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}();function a(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var s=function(){function t(){i(this,t),this._head=this._tail=void 0}return r(t,[{key:"handlers",value:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],e=this._head;if(t)return!!e;for(var n=[];e;)n.push(e),e=e._next;return n}},{key:"has",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,arguments),t=t._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return a(this,new o(t,!1,e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return a(this,new o(t,!0,e))}},{key:"detach",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this?this:(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null,this)}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();s.MiniSignalBinding=o,e.default=s,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"},e.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},e.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(1);function o(t,e,n,i,o){var a={},s="number"==typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(t,e)&&(a=Reflect.getMetadata(t,e));var c=a[u];if(Array.isArray(c))for(var l=0,h=c;l<h.length;l++){var d=h[l];if(d.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+d.key.toString())}else c=[];c.push(i),a[u]=c,Reflect.defineMetadata(t,a,e)}function a(t,e){Reflect.decorate(t,e)}function s(t,e){return function(n,r){e(n,r,t)}}e.tagParameter=function(t,e,n,r){o(i.TAGGED,t,e,r,n)},e.tagProperty=function(t,e,n){o(i.TAGGED_PROP,t.constructor,e,n)},e.decorate=function(t,e,n){"number"==typeof n?a([s(n,t)],e):"string"==typeof n?Reflect.decorate([t],e,n):a([t],e)}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=0;e.id=function(){return r++}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2);function i(t){return"function"==typeof t?t.name:"symbol"==typeof t?t.toString():t}function o(t){if(t.name)return t.name;var e=t.toString(),n=e.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+e}e.getServiceIdentifierAsString=i,e.listRegisteredBindingsForServiceIdentifier=function(t,e,n){var r="",i=n(t,e);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(t){var e="Object";null!==t.implementationType&&(e=o(t.implementationType)),r=r+"\n "+e,t.constraint.metaData&&(r=r+" - "+t.constraint.metaData)}))),r},e.circularDependencyToException=function t(e){e.childRequests.forEach((function(e){if(function t(e,n){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===n||t(e.parentRequest,n))}(e,e.serviceIdentifier)){var n=function(t){return function t(e,n){void 0===n&&(n=[]);var r=i(e.serviceIdentifier);return n.push(r),null!==e.parentRequest?t(e.parentRequest,n):n}(t).reverse().join(" --\x3e ")}(e);throw new Error(r.CIRCULAR_DEPENDENCY+" "+n)}t(e)}))},e.listMetadataForTarget=function(t,e){if(e.isTagged()||e.isNamed()){var n="",r=e.getNamedTag(),i=e.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(t){n+=t.toString()+"\n"}))," "+t+"\n "+t+" - "+n}return" "+t},e.getFunctionName=o},function(t,e,n){"use strict";var r=n(56),i=n(58);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=_,e.resolve=function(t,e){return _(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?_(t,!1,!0).resolveObject(e):e},e.format=function(t){return i.isString(t)&&(t=_(t)),t instanceof o?t.format():o.prototype.format.call(t)},e.Url=o;var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),h=["%","/","?",";","#"].concat(l),d=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},y={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=n(59);function _(t,e,n){if(t&&i.isObject(t)&&t instanceof o)return t;var r=new o;return r.parse(t,e,n),r}o.prototype.parse=function(t,e,n){if(!i.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),s=-1!==o&&o<t.indexOf("#")?"?":"#",c=t.split(s);c[0]=c[0].replace(/\\/g,"/");var _=t=c.join(s);if(_=_.trim(),!n&&1===t.split("#").length){var b=u.exec(_);if(b)return this.path=_,this.href=_,this.pathname=b[1],b[2]?(this.search=b[2],this.query=e?v.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var x=a.exec(_);if(x){var w=(x=x[0]).toLowerCase();this.protocol=w,_=_.substr(x.length)}if(n||x||_.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===_.substr(0,2);!E||x&&y[x]||(_=_.substr(2),this.slashes=!0)}if(!y[x]&&(E||x&&!g[x])){for(var T,O,A=-1,S=0;S<d.length;S++)-1!==(I=_.indexOf(d[S]))&&(-1===A||I<A)&&(A=I);for(-1!==(O=-1===A?_.lastIndexOf("@"):_.lastIndexOf("@",A))&&(T=_.slice(0,O),_=_.slice(O+1),this.auth=decodeURIComponent(T)),A=-1,S=0;S<h.length;S++){var I;-1!==(I=_.indexOf(h[S]))&&(-1===A||I<A)&&(A=I)}-1===A&&(A=_.length),this.host=_.slice(0,A),_=_.slice(A),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var C=this.hostname.split(/\./),R=(S=0,C.length);S<R;S++){var M=C[S];if(M&&!M.match(f)){for(var D="",k=0,j=M.length;k<j;k++)M.charCodeAt(k)>127?D+="x":D+=M[k];if(!D.match(f)){var N=C.slice(0,S),L=C.slice(S+1),B=M.match(p);B&&(N.push(B[1]),L.unshift(B[2])),L.length&&(_="/"+L.join(".")+_),this.hostname=N.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=r.toASCII(this.hostname));var F=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+F,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!m[w])for(S=0,R=l.length;S<R;S++){var G=l[S];if(-1!==_.indexOf(G)){var H=encodeURIComponent(G);H===G&&(H=escape(G)),_=_.split(G).join(H)}}var z=_.indexOf("#");-1!==z&&(this.hash=_.substr(z),_=_.slice(0,z));var X=_.indexOf("?");if(-1!==X?(this.search=_.substr(X),this.query=_.substr(X+1),e&&(this.query=v.parse(this.query)),_=_.slice(0,X)):e&&(this.search="",this.query={}),_&&(this.pathname=_),g[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){F=this.pathname||"";var V=this.search||"";this.path=F+V}return this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,a="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(a=v.stringify(this.query));var s=this.search||a&&"?"+a||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),e+o+(n=n.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(s=s.replace("#","%23"))+r},o.prototype.resolve=function(t){return this.resolveObject(_(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(i.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var n=new o,r=Object.keys(this),a=0;a<r.length;a++){var s=r[a];n[s]=this[s]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var u=Object.keys(t),c=0;c<u.length;c++){var l=u[c];"protocol"!==l&&(n[l]=t[l])}return g[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!g[t.protocol]){for(var h=Object.keys(t),d=0;d<h.length;d++){var f=h[d];n[f]=t[f]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||y[t.protocol])n.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var m=n.pathname||"",v=n.search||"";n.path=m+v}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var _=n.pathname&&"/"===n.pathname.charAt(0),b=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=b||_||n.host&&t.pathname,w=x,E=n.pathname&&n.pathname.split("/")||[],T=(p=t.pathname&&t.pathname.split("/")||[],n.protocol&&!g[n.protocol]);if(T&&(n.hostname="",n.port=null,n.host&&(""===E[0]?E[0]=n.host:E.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),x=x&&(""===p[0]||""===E[0])),b)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,E=p;else if(p.length)E||(E=[]),E.pop(),E=E.concat(p),n.search=t.search,n.query=t.query;else if(!i.isNullOrUndefined(t.search))return T&&(n.hostname=n.host=E.shift(),(P=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=P.shift(),n.host=n.hostname=P.shift())),n.search=t.search,n.query=t.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!E.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var O=E.slice(-1)[0],A=(n.host||t.host||E.length>1)&&("."===O||".."===O)||""===O,S=0,I=E.length;I>=0;I--)"."===(O=E[I])?E.splice(I,1):".."===O?(E.splice(I,1),S++):S&&(E.splice(I,1),S--);if(!x&&!w)for(;S--;S)E.unshift("..");!x||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),A&&"/"!==E.join("/").substr(-1)&&E.push("");var P,C=""===E[0]||E[0]&&"/"===E[0].charAt(0);return T&&(n.hostname=n.host=C?"":E.length?E.shift():"",(P=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=P.shift(),n.host=n.hostname=P.shift())),(x=x||n.host&&E.length)&&!C&&E.unshift(""),E.length?n.pathname=E.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var t=this.host,e=s.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(12),i=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new r.BindingWhenSyntax(this._binding)},t}();e.BindingOnSyntax=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(11),i=n(20),o=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=i.namedConstraint(t),new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){return null!==t.target&&!t.target.isNamed()&&!t.target.isTagged()},new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=i.taggedConstraint(t)(e),new r.BindingOnSyntax(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return i.typeConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return i.namedConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(n){return i.taggedConstraint(t)(e)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t}();e.BindingWhenSyntax=o},function(t,e,n){"use strict";t.exports=function(t,e){e=e||{};for(var n={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=n.parser[e.strictMode?"strict":"loose"].exec(t),i={},o=14;o--;)i[n.key[o]]=r[o]||"";return i[n.q.name]={},i[n.key[12]].replace(n.q.parser,(function(t,e,r){e&&(i[n.q.name][e]=r)})),i}},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var u,c=[],l=!1,h=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&f())}function f(){if(!l){var t=s(d);l=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new p(t,e)),1!==c.length||l||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,t),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,t)||{}}},t.prototype.getPropertiesMetadata=function(t){return Reflect.getMetadata(r.TAGGED_PROP,t)||[]},t}();e.MetadataReader=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2);e.isStackOverflowExeption=function(t){return t instanceof RangeError||t.message===r.STACK_OVERFLOW}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(1),o=n(3),a=n(6),s=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}();e.LazyServiceIdentifer=s,e.inject=function(t){return function(e,n,s){if(void 0===t)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(e.name));var u=new o.Metadata(i.INJECT_TAG,t);"number"==typeof s?a.tagParameter(e,n,s,u):a.tagProperty(e,n,u)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(8),o=n(3),a=n(34),s=function(){function t(t,e,n,s){this.id=i.id(),this.type=t,this.serviceIdentifier=n,this.name=new a.QueryableString(e||""),this.metadata=new Array;var u=null;"string"==typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return t.prototype.hasTag=function(t){for(var e=0,n=this.metadata;e<n.length;e++)if(n[e].key===t)return!0;return!1},t.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},t.prototype.matchesArray=function(t){return this.matchesTag(r.MULTI_INJECT_TAG)(t)},t.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},t.prototype.isTagged=function(){return this.metadata.some((function(t){return t.key!==r.INJECT_TAG&&t.key!==r.MULTI_INJECT_TAG&&t.key!==r.NAME_TAG&&t.key!==r.UNMANAGED_TAG&&t.key!==r.NAMED_TAG}))},t.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},t.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(t){return t.key===r.NAMED_TAG}))[0]:null},t.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(t){return t.key!==r.INJECT_TAG&&t.key!==r.MULTI_INJECT_TAG&&t.key!==r.NAME_TAG&&t.key!==r.UNMANAGED_TAG&&t.key!==r.NAMED_TAG})):null},t.prototype.matchesNamedTag=function(t){return this.matchesTag(r.NAMED_TAG)(t)},t.prototype.matchesTag=function(t){var e=this;return function(n){for(var r=0,i=e.metadata;r<i.length;r++){var o=i[r];if(o.key===t&&o.value===n)return!0}return!1}},t}();e.Target=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(11),i=n(12),o=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingWhenOnSyntax=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(3),o=function(t,e){var n=t.parentRequest;return null!==n&&(!!e(n)||o(n,e))};e.traverseAncerstors=o;var a=function(t){return function(e){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(t)(e)};return n.metaData=new i.Metadata(t,e),n}};e.taggedConstraint=a;var s=a(r.NAMED_TAG);e.namedConstraint=s,e.typeConstraint=function(t){return function(e){var n=null;if(null!==e){if(n=e.bindings[0],"string"==typeof t)return n.serviceIdentifier===t;var r=e.bindings[0].implementationType;return t===r}return!1}}},function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||t,o),u=i?i+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),c.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},c.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},c.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},c.prototype.emit=function(t,e,n,r,o,a){var s=i?i+t:t;if(!this._events[s])return!1;var u,c,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,r),!0;case 5:return l.fn.call(l.context,e,n,r,o),!0;case 6:return l.fn.call(l.context,e,n,r,o,a),!0}for(c=1,u=new Array(h-1);c<h;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var d,f=l.length;for(c=0;c<f;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,n);break;case 4:l[c].fn.call(l[c].context,e,n,r);break;default:if(!u)for(d=1,u=new Array(h-1);d<h;d++)u[d-1]=arguments[d];l[c].fn.apply(l[c].context,u)}}return!0},c.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,n,r){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return u(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||r&&!a.once||n&&a.context!==n||u(this,o);else{for(var s=0,c=[],l=a.length;s<l;s++)(a[s].fn!==e||r&&!a[s].once||n&&a[s].context!==n)&&c.push(a[s]);c.length?this._events[o]=1===c.length?c[0]:c:u(this,o)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&u(this,e)):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=i,c.EventEmitter=c,t.exports=c},function(t,e,n){"use strict";function r(t,e,n){n=n||2;var r,s,u,c,l,f,p,y=e&&e.length,g=y?e[0]*n:t.length,v=i(t,0,g,n,!0),_=[];if(!v||v.next===v.prev)return _;if(y&&(v=function(t,e,n,r){var a,s,u,c=[];for(a=0,s=e.length;a<s;a++)(u=i(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r,!1))===u.next&&(u.steiner=!0),c.push(m(u));for(c.sort(h),a=0;a<c.length;a++)d(c[a],n),n=o(n,n.next);return n}(t,e,v,n)),t.length>80*n){r=u=t[0],s=c=t[1];for(var b=n;b<g;b+=n)(l=t[b])<r&&(r=l),(f=t[b+1])<s&&(s=f),l>u&&(u=l),f>c&&(c=f);p=0!==(p=Math.max(u-r,c-s))?1/p:0}return a(v,_,n,r,s,p),_}function i(t,e,n,r,i){var o,a;if(i===I(t,e,n,r)>0)for(o=e;o<n;o+=r)a=O(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=O(o,t[o],t[o+1],a);return a&&_(a,a.next)&&(A(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!_(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(A(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function a(t,e,n,r,i,h,d){if(t){!d&&h&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=p(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<c&&(s++,r=r.nextZ);e++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(t,r,i,h);for(var f,m,y=t;t.prev!==t.next;)if(f=t.prev,m=t.next,h?u(t,r,i,h):s(t))e.push(f.i/n),e.push(t.i/n),e.push(m.i/n),A(t),t=m.next,y=m.next;else if((t=m)===y){d?1===d?a(t=c(o(t),e,n),e,n,r,i,h,2):2===d&&l(t,e,n,r,i,h):a(o(t),e,n,r,i,h,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(y(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&v(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(t,e,n,r){var i=t.prev,o=t,a=t.next;if(v(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=p(s,u,e,n,r),d=p(c,l,e,n,r),f=t.prevZ,m=t.nextZ;f&&f.z>=h&&m&&m.z<=d;){if(f!==t.prev&&f!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,m!==t.prev&&m!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,m.x,m.y)&&v(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;m&&m.z<=d;){if(m!==t.prev&&m!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,m.x,m.y)&&v(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function c(t,e,n){var r=t;do{var i=r.prev,a=r.next.next;!_(i,a)&&b(i,r,r.next,a)&&E(i,a)&&E(a,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(a.i/n),A(r),A(r.next),r=t=a),r=r.next}while(r!==t);return o(r)}function l(t,e,n,r,i,s){var u=t;do{for(var c=u.next.next;c!==u.prev;){if(u.i!==c.i&&g(u,c)){var l=T(u,c);return u=o(u,u.next),l=o(l,l.next),a(u,e,n,r,i,s),void a(l,e,n,r,i,s)}c=c.next}u=u.next}while(u!==t)}function h(t,e){return t.x-e.x}function d(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,c=n,l=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&y(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),E(r,t)&&(u<d||u===d&&(r.x>n.x||r.x===n.x&&f(n,r)))&&(n=r,d=u)),r=r.next}while(r!==c);return n}(t,e)){var n=T(e,t);o(e,e.next),o(n,n.next)}}function f(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function p(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function m(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function y(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function g(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(E(t,e)&&E(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||_(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){var i=w(v(t,e,n)),o=w(v(t,e,r)),a=w(v(n,r,t)),s=w(v(n,r,e));return i!==o&&a!==s||!(0!==i||!x(t,n,e))||!(0!==o||!x(t,r,e))||!(0!==a||!x(n,t,r))||!(0!==s||!x(n,e,r))}function x(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function w(t){return t>0?1:t<0?-1:0}function E(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function T(t,e){var n=new S(t.i,t.x,t.y),r=new S(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function O(t,e,n,r){var i=new S(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=r,t.exports.default=r,r.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(I(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var c=e[s]*n,l=s<u-1?e[s+1]*n:t.length;a-=Math.abs(I(t,c,l,n))}var h=0;for(s=0;s<r.length;s+=3){var d=r[s]*n,f=r[s+1]*n,p=r[s+2]*n;h+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},function(t,e,n){(function(n){var r;!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var t=this||o;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||o;if(t=parseFloat(t),e.ctx||f(),void 0!==t&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,o.ctx.currentTime);for(var n=0;n<e._howls.length;n++)if(!e._howls[n]._webAudio)for(var r=e._howls[n]._getSoundIds(),i=0;i<r.length;i++){var a=e._howls[n]._soundById(r[i]);a&&a._node&&(a._node.volume=a._volume*t)}return e}return e._volume},mute:function(t){var e=this||o;e.ctx||f(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,o.ctx.currentTime);for(var n=0;n<e._howls.length;n++)if(!e._howls[n]._webAudio)for(var r=e._howls[n]._getSoundIds(),i=0;i<r.length;i++){var a=e._howls[n]._soundById(r[i]);a&&a._node&&(a._node.muted=!!t||a._muted)}return e},unload:function(){for(var t=this||o,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&void 0!==t.ctx.close&&(t.ctx.close(),t.ctx=null,f()),t},codecs:function(t){return(this||o)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||o;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||o,e=null;try{e="undefined"!=typeof Audio?new Audio:null}catch(e){return t}if(!e||"function"!=typeof e.canPlayType)return t;var n=e.canPlayType("audio/mpeg;").replace(/^no$/,""),r=t._navigator&&t._navigator.userAgent.match(/OPR\/([0-6].)/g),i=r&&parseInt(r[0].split("/")[1],10)<33;return t._codecs={mp3:!(i||!n&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||o;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(n){for(var r=0;r<t.html5PoolSize;r++)try{var i=new Audio;i._unlocked=!0,t._releaseHtml5Audio(i)}catch(n){t.noAudio=!0}for(r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var o=t._howls[r]._getSoundIds(),a=0;a<o.length;a++){var s=t._howls[r]._soundById(o[a]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}t._autoResume();var u=t.ctx.createBufferSource();u.buffer=t._scratchBuffer,u.connect(t.ctx.destination),void 0===u.start?u.noteOn(0):u.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),u.onended=function(){u.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0);for(var n=0;n<t._howls.length;n++)t._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),t}},_obtainHtml5Audio:function(){var t=this||o;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=(new Audio).play();return e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(t){var e=this||o;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&o.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var n=0;n<t._howls[e]._sounds.length;n++)if(!t._howls[e]._sounds[n]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout((function(){t.autoSuspend&&(t._suspendTimer=null,t.state="suspending",t.ctx.suspend().then((function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())})))}),3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&o.usingWebAudio)return"running"===t.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state?(t.ctx.resume().then((function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")})),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var o=new i,a=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};a.prototype={init:function(t){var e=this;return o.ctx||f(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._xhrWithCredentials=t.xhrWithCredentials||!1,e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=o.usingWebAudio&&!e._html5,void 0!==o.ctx&&o.ctx&&o.autoUnlock&&o._unlockAudio(),o._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&e.load(),e},load:function(){var t=null;if(o.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var e=0;e<this._src.length;e++){var n,r;if(this._format&&this._format[e])n=this._format[e];else{if("string"!=typeof(r=this._src[e])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(r))||(n=/\.([^.]+)$/.exec(r.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&o.codecs(n)){t=this._src[e];break}}if(t)return this._src=t,this._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new s(this),this._webAudio&&c(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,e){var n=this,r=null;if("number"==typeof t)r=t,t=null;else{if("string"==typeof t&&"loaded"===n._state&&!n._sprite[t])return null;if(void 0===t&&(t="__default",!n._playLock)){for(var i=0,a=0;a<n._sounds.length;a++)n._sounds[a]._paused&&!n._sounds[a]._ended&&(i++,r=n._sounds[a]._id);1===i?t=null:r=null}}var s=r?n._soundById(r):n._inactiveSound();if(!s)return null;if(r&&!t&&(t=s._sprite||"__default"),"loaded"!==n._state){s._sprite=t,s._ended=!1;var u=s._id;return n._queue.push({event:"play",action:function(){n.play(u)}}),u}if(r&&!s._paused)return e||n._loadQueue("play"),s._id;n._webAudio&&o._autoResume();var c=Math.max(0,s._seek>0?s._seek:n._sprite[t][0]/1e3),l=Math.max(0,(n._sprite[t][0]+n._sprite[t][1])/1e3-c),h=1e3*l/Math.abs(s._rate),d=n._sprite[t][0]/1e3,f=(n._sprite[t][0]+n._sprite[t][1])/1e3;s._sprite=t,s._ended=!1;var p=function(){s._paused=!1,s._seek=c,s._start=d,s._stop=f,s._loop=!(!s._loop&&!n._sprite[t][2])};if(!(c>=f)){var m=s._node;if(n._webAudio){var y=function(){n._playLock=!1,p(),n._refreshBuffer(s);var t=s._muted||n._muted?0:s._volume;m.gain.setValueAtTime(t,o.ctx.currentTime),s._playStart=o.ctx.currentTime,void 0===m.bufferSource.start?s._loop?m.bufferSource.noteGrainOn(0,c,86400):m.bufferSource.noteGrainOn(0,c,l):s._loop?m.bufferSource.start(0,c,86400):m.bufferSource.start(0,c,l),h!==1/0&&(n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),h)),e||setTimeout((function(){n._emit("play",s._id),n._loadQueue()}),0)};"running"===o.state?y():(n._playLock=!0,n.once("resume",y),n._clearTimer(s._id))}else{var g=function(){m.currentTime=c,m.muted=s._muted||n._muted||o._muted||m.muted,m.volume=s._volume*o.volume(),m.playbackRate=s._rate;try{var r=m.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(n._playLock=!0,p(),r.then((function(){n._playLock=!1,m._unlocked=!0,e||(n._emit("play",s._id),n._loadQueue())})).catch((function(){n._playLock=!1,n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0}))):e||(n._playLock=!1,p(),n._emit("play",s._id),n._loadQueue()),m.playbackRate=s._rate,m.paused)return void n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||s._loop?n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),h):(n._endTimers[s._id]=function(){n._ended(s),m.removeEventListener("ended",n._endTimers[s._id],!1)},m.addEventListener("ended",n._endTimers[s._id],!1))}catch(t){n._emit("playerror",s._id,t)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===m.src&&(m.src=n._src,m.load());var v=window&&window.ejecta||!m.readyState&&o._navigator.isCocoonJS;if(m.readyState>=3||v)g();else{n._playLock=!0;var _=function(){g(),m.removeEventListener(o._canPlayEvent,_,!1)};m.addEventListener(o._canPlayEvent,_,!1),n._clearTimer(s._id)}}return s._id}n._ended(s)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var n=e._getSoundIds(t),r=0;r<n.length;r++){e._clearTimer(n[r]);var i=e._soundById(n[r]);if(i&&!i._paused&&(i._seek=e.seek(n[r]),i._rateSeek=0,i._paused=!0,e._stopFade(n[r]),i._node))if(e._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),e._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||e._emit("pause",i?i._id:null)}return e},stop:function(t,e){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(t)}}),n;for(var r=n._getSoundIds(t),i=0;i<r.length;i++){n._clearTimer(r[i]);var o=n._soundById(r[i]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,n._stopFade(r[i]),o._node&&(n._webAudio?o._node.bufferSource&&(void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),n._cleanBuffer(o._node)):isNaN(o._node.duration)&&o._node.duration!==1/0||(o._node.currentTime=o._start||0,o._node.pause(),o._node.duration===1/0&&n._clearSound(o._node))),e||n._emit("stop",o._id))}return n},mute:function(t,e){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(t,e)}}),n;if(void 0===e){if("boolean"!=typeof t)return n._muted;n._muted=t}for(var r=n._getSoundIds(e),i=0;i<r.length;i++){var a=n._soundById(r[i]);a&&(a._muted=t,a._interval&&n._stopFade(a._id),n._webAudio&&a._node?a._node.gain.setValueAtTime(t?0:a._volume,o.ctx.currentTime):a._node&&(a._node.muted=!!o._muted||t),n._emit("mute",a._id))}return n},volume:function(){var t,e,n,r=this,i=arguments;if(0===i.length)return r._volume;if(1===i.length||2===i.length&&void 0===i[1]){var a=r._getSoundIds(),s=a.indexOf(i[0]);s>=0?e=parseInt(i[0],10):t=parseFloat(i[0])}else i.length>=2&&(t=parseFloat(i[0]),e=parseInt(i[1],10));if(!(void 0!==t&&t>=0&&t<=1))return(n=e?r._soundById(e):r._sounds[0])?n._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,i)}}),r;void 0===e&&(r._volume=t),e=r._getSoundIds(e);for(var u=0;u<e.length;u++)(n=r._soundById(e[u]))&&(n._volume=t,i[2]||r._stopFade(e[u]),r._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(t,o.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=t*o.volume()),r._emit("volume",n._id));return r},fade:function(t,e,n,r){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(t,e,n,r)}}),i;t=parseFloat(t),e=parseFloat(e),n=parseFloat(n),i.volume(t,r);for(var a=i._getSoundIds(r),s=0;s<a.length;s++){var u=i._soundById(a[s]);if(u){if(r||i._stopFade(a[s]),i._webAudio&&!u._muted){var c=o.ctx.currentTime,l=c+n/1e3;u._volume=t,u._node.gain.setValueAtTime(t,c),u._node.gain.linearRampToValueAtTime(e,l)}i._startFadeInterval(u,t,e,n,a[s],void 0===r)}}return i},_startFadeInterval:function(t,e,n,r,i,o){var a=this,s=e,u=n-e,c=Math.abs(u/.01),l=Math.max(4,c>0?r/c:r),h=Date.now();t._fadeTo=n,t._interval=setInterval((function(){var i=(Date.now()-h)/r;h=Date.now(),s+=u*i,s=Math.max(0,s),s=Math.min(1,s),s=Math.round(100*s)/100,a._webAudio?t._volume=s:a.volume(s,t._id,!0),o&&(a._volume=s),(n<e&&s<=n||n>e&&s>=n)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,a.volume(n,t._id),a._emit("fade",t._id))}),l)},_stopFade:function(t){var e=this._soundById(t);return e&&e._interval&&(this._webAudio&&e._node.gain.cancelScheduledValues(o.ctx.currentTime),clearInterval(e._interval),e._interval=null,this.volume(e._fadeTo,t),e._fadeTo=null,this._emit("fade",t)),this},loop:function(){var t,e,n,r=this,i=arguments;if(0===i.length)return r._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(n=r._soundById(parseInt(i[0],10)))&&n._loop;t=i[0],r._loop=t}else 2===i.length&&(t=i[0],e=parseInt(i[1],10));for(var o=r._getSoundIds(e),a=0;a<o.length;a++)(n=r._soundById(o[a]))&&(n._loop=t,r._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=t,t&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop)));return r},rate:function(){var t,e,n,r=this,i=arguments;if(0===i.length)e=r._sounds[0]._id;else if(1===i.length){var a=r._getSoundIds(),s=a.indexOf(i[0]);s>=0?e=parseInt(i[0],10):t=parseFloat(i[0])}else 2===i.length&&(t=parseFloat(i[0]),e=parseInt(i[1],10));if("number"!=typeof t)return(n=r._soundById(e))?n._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,i)}}),r;void 0===e&&(r._rate=t),e=r._getSoundIds(e);for(var u=0;u<e.length;u++)if(n=r._soundById(e[u])){r.playing(e[u])&&(n._rateSeek=r.seek(e[u]),n._playStart=r._webAudio?o.ctx.currentTime:n._playStart),n._rate=t,r._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(t,o.ctx.currentTime):n._node&&(n._node.playbackRate=t);var c=r.seek(e[u]),l=(r._sprite[n._sprite][0]+r._sprite[n._sprite][1])/1e3-c,h=1e3*l/Math.abs(n._rate);!r._endTimers[e[u]]&&n._paused||(r._clearTimer(e[u]),r._endTimers[e[u]]=setTimeout(r._ended.bind(r,n),h)),r._emit("rate",n._id)}return r},seek:function(){var t,e,n=this,r=arguments;if(0===r.length)e=n._sounds[0]._id;else if(1===r.length){var i=n._getSoundIds(),a=i.indexOf(r[0]);a>=0?e=parseInt(r[0],10):n._sounds.length&&(e=n._sounds[0]._id,t=parseFloat(r[0]))}else 2===r.length&&(t=parseFloat(r[0]),e=parseInt(r[1],10));if(void 0===e)return n;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"seek",action:function(){n.seek.apply(n,r)}}),n;var s=n._soundById(e);if(s){if(!("number"==typeof t&&t>=0)){if(n._webAudio){var u=n.playing(e)?o.ctx.currentTime-s._playStart:0,c=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(c+u*Math.abs(s._rate))}return s._node.currentTime}var l=n.playing(e);l&&n.pause(e,!0),s._seek=t,s._ended=!1,n._clearTimer(e),n._webAudio||!s._node||isNaN(s._node.duration)||(s._node.currentTime=t);var h=function(){n._emit("seek",e),l&&n.play(e,!0)};if(l&&!n._webAudio){var d=function(){n._playLock?setTimeout(d,0):h()};setTimeout(d,0)}else h()}return n},playing:function(t){if("number"==typeof t){var e=this._soundById(t);return!!e&&!e._paused}for(var n=0;n<this._sounds.length;n++)if(!this._sounds[n]._paused)return!0;return!1},duration:function(t){var e=this._duration,n=this._soundById(t);return n&&(e=this._sprite[n._sprite][1]/1e3),e},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,n=0;n<e.length;n++)e[n]._paused||t.stop(e[n]._id),t._webAudio||(t._clearSound(e[n]._node),e[n]._node.removeEventListener("error",e[n]._errorFn,!1),e[n]._node.removeEventListener(o._canPlayEvent,e[n]._loadFn,!1),o._releaseHtml5Audio(e[n]._node)),delete e[n]._node,t._clearTimer(e[n]._id);var r=o._howls.indexOf(t);r>=0&&o._howls.splice(r,1);var i=!0;for(n=0;n<o._howls.length;n++)if(o._howls[n]._src===t._src||t._src.indexOf(o._howls[n]._src)>=0){i=!1;break}return u&&i&&delete u[t._src],o.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,n,r){var i=this["_on"+t];return"function"==typeof e&&i.push(r?{id:n,fn:e,once:r}:{id:n,fn:e}),this},off:function(t,e,n){var r=this["_on"+t],i=0;if("number"==typeof e&&(n=e,e=null),e||n)for(i=0;i<r.length;i++){var o=n===r[i].id;if(e===r[i].fn&&o||!e&&o){r.splice(i,1);break}}else if(t)this["_on"+t]=[];else{var a=Object.keys(this);for(i=0;i<a.length;i++)0===a[i].indexOf("_on")&&Array.isArray(this[a[i]])&&(this[a[i]]=[])}return this},once:function(t,e,n){return this.on(t,e,n,1),this},_emit:function(t,e,n){for(var r=this["_on"+t],i=r.length-1;i>=0;i--)r[i].id&&r[i].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,n)}.bind(this,r[i].fn),0),r[i].once&&this.off(t,r[i].fn,r[i].id));return this._loadQueue(t),this},_loadQueue:function(t){if(this._queue.length>0){var e=this._queue[0];e.event===t&&(this._queue.shift(),this._loadQueue()),t||e.action()}return this},_ended:function(t){var e=t._sprite;if(!this._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(this._ended.bind(this,t),100),this;var n=!(!t._loop&&!this._sprite[e][2]);if(this._emit("end",t._id),!this._webAudio&&n&&this.stop(t._id,!0).play(t._id),this._webAudio&&n){this._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=o.ctx.currentTime;var r=1e3*(t._stop-t._start)/Math.abs(t._rate);this._endTimers[t._id]=setTimeout(this._ended.bind(this,t),r)}return this._webAudio&&!n&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,this._clearTimer(t._id),this._cleanBuffer(t._node),o._autoSuspend()),this._webAudio||n||this.stop(t._id,!0),this},_clearTimer:function(t){if(this._endTimers[t]){if("function"!=typeof this._endTimers[t])clearTimeout(this._endTimers[t]);else{var e=this._soundById(t);e&&e._node&&e._node.removeEventListener("ended",this._endTimers[t],!1)}delete this._endTimers[t]}return this},_soundById:function(t){for(var e=0;e<this._sounds.length;e++)if(t===this._sounds[e]._id)return this._sounds[e];return null},_inactiveSound:function(){this._drain();for(var t=0;t<this._sounds.length;t++)if(this._sounds[t]._ended)return this._sounds[t].reset();return new s(this)},_drain:function(){var t=this._pool,e=0,n=0;if(!(this._sounds.length<t)){for(n=0;n<this._sounds.length;n++)this._sounds[n]._ended&&e++;for(n=this._sounds.length-1;n>=0;n--){if(e<=t)return;this._sounds[n]._ended&&(this._webAudio&&this._sounds[n]._node&&this._sounds[n]._node.disconnect(0),this._sounds.splice(n,1),e--)}}},_getSoundIds:function(t){if(void 0===t){for(var e=[],n=0;n<this._sounds.length;n++)e.push(this._sounds[n]._id);return e}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=o.ctx.createBufferSource(),t._node.bufferSource.buffer=u[this._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,o.ctx.currentTime),this},_cleanBuffer:function(t){var e=o._navigator&&o._navigator.vendor.indexOf("Apple")>=0;if(o._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),e))try{t.bufferSource.buffer=o._scratchBuffer}catch(t){}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(o._navigator&&o._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(t){this._parent=t,this.init()};s.prototype={init:function(){var t=this._parent;return this._muted=t._muted,this._loop=t._loop,this._volume=t._volume,this._rate=t._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++o._counter,t._sounds.push(this),this.create(),this},create:function(){var t=this._parent,e=o._muted||this._muted||this._parent._muted?0:this._volume;return t._webAudio?(this._node=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),this._node.gain.setValueAtTime(e,o.ctx.currentTime),this._node.paused=!0,this._node.connect(o.masterGain)):o.noAudio||(this._node=o._obtainHtml5Audio(),this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(o._canPlayEvent,this._loadFn,!1),this._node.src=t._src,this._node.preload="auto",this._node.volume=e*o.volume(),this._node.load()),this},reset:function(){var t=this._parent;return this._muted=t._muted,this._loop=t._loop,this._volume=t._volume,this._rate=t._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++o._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var t=this._parent;t._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),this._node.removeEventListener(o._canPlayEvent,this._loadFn,!1)}};var u={},c=function(t){var e=t._src;if(u[e])return t._duration=u[e].duration,void d(t);if(/^data:[^;]+;base64,/.test(e)){for(var n=atob(e.split(",")[1]),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);h(r.buffer,t)}else{var o=new XMLHttpRequest;o.open("GET",e,!0),o.withCredentials=t._xhrWithCredentials,o.responseType="arraybuffer",o.onload=function(){var e=(o.status+"")[0];"0"===e||"2"===e||"3"===e?h(o.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+o.status+".")},o.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete u[e],t.load())},l(o)}},l=function(t){try{t.send()}catch(e){t.onerror()}},h=function(t,e){var n=function(){e._emit("loaderror",null,"Decoding audio data failed.")},r=function(t){t&&e._sounds.length>0?(u[e._src]=t,d(e,t)):n()};"undefined"!=typeof Promise&&1===o.ctx.decodeAudioData.length?o.ctx.decodeAudioData(t).then(r).catch(n):o.ctx.decodeAudioData(t,r,n)},d=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},f=function(){if(o.usingWebAudio){try{"undefined"!=typeof AudioContext?o.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?o.ctx=new webkitAudioContext:o.usingWebAudio=!1}catch(t){o.usingWebAudio=!1}o.ctx||(o.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(o._navigator&&o._navigator.platform),e=o._navigator&&o._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=e?parseInt(e[1],10):null;if(t&&n&&n<9){var r=/safari/.test(o._navigator&&o._navigator.userAgent.toLowerCase());(o._navigator&&o._navigator.standalone&&!r||o._navigator&&!o._navigator.standalone&&!r)&&(o.usingWebAudio=!1)}o.usingWebAudio&&(o.masterGain=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),o.masterGain.gain.setValueAtTime(o._muted?0:o._volume,o.ctx.currentTime),o.masterGain.connect(o.ctx.destination)),o._setup()}};void 0===(r=function(){return{Howler:o,Howl:a}}.apply(e,[]))||(t.exports=r),e.Howler=o,e.Howl=a,"undefined"!=typeof window?(window.HowlerGlobal=i,window.Howler=o,window.Howl=a,window.Sound=s):void 0!==n&&(n.HowlerGlobal=i,n.Howler=o,n.Howl=a,n.Sound=s)}(),function(){"use strict";var t;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){if(!this.ctx||!this.ctx.listener)return this;for(var e=this._howls.length-1;e>=0;e--)this._howls[e].stereo(t);return this},HowlerGlobal.prototype.pos=function(t,e,n){return this.ctx&&this.ctx.listener?(e="number"!=typeof e?this._pos[1]:e,n="number"!=typeof n?this._pos[2]:n,"number"!=typeof t?this._pos:(this._pos=[t,e,n],void 0!==this.ctx.listener.positionX?(this.ctx.listener.positionX.setTargetAtTime(this._pos[0],Howler.ctx.currentTime,.1),this.ctx.listener.positionY.setTargetAtTime(this._pos[1],Howler.ctx.currentTime,.1),this.ctx.listener.positionZ.setTargetAtTime(this._pos[2],Howler.ctx.currentTime,.1)):this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]),this)):this},HowlerGlobal.prototype.orientation=function(t,e,n,r,i,o){if(!this.ctx||!this.ctx.listener)return this;var a=this._orientation;return e="number"!=typeof e?a[1]:e,n="number"!=typeof n?a[2]:n,r="number"!=typeof r?a[3]:r,i="number"!=typeof i?a[4]:i,o="number"!=typeof o?a[5]:o,"number"!=typeof t?a:(this._orientation=[t,e,n,r,i,o],void 0!==this.ctx.listener.forwardX?(this.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),this.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),this.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),this.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),this.ctx.listener.upY.setTargetAtTime(i,Howler.ctx.currentTime,.1),this.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):this.ctx.listener.setOrientation(t,e,n,r,i,o),this)},Howl.prototype.init=(t=Howl.prototype.init,function(e){return this._orientation=e.orientation||[1,0,0],this._stereo=e.stereo||null,this._pos=e.pos||null,this._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},this._onstereo=e.onstereo?[{fn:e.onstereo}]:[],this._onpos=e.onpos?[{fn:e.onpos}]:[],this._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}),Howl.prototype.stereo=function(t,n){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(t,n)}}),r;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof t)return r._stereo;r._stereo=t,r._pos=[t,0,0]}for(var o=r._getSoundIds(n),a=0;a<o.length;a++){var s=r._soundById(o[a]);if(s){if("number"!=typeof t)return s._stereo;s._stereo=t,s._pos=[t,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||e(s,i),"spatial"===i?void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(t,0,0):s._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),r._emit("stereo",s._id)}}return r},Howl.prototype.pos=function(t,n,r,i){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"pos",action:function(){o.pos(t,n,r,i)}}),o;if(n="number"!=typeof n?0:n,r="number"!=typeof r?-.5:r,void 0===i){if("number"!=typeof t)return o._pos;o._pos=[t,n,r]}for(var a=o._getSoundIds(i),s=0;s<a.length;s++){var u=o._soundById(a[s]);if(u){if("number"!=typeof t)return u._pos;u._pos=[t,n,r],u._node&&(u._panner&&!u._panner.pan||e(u,"spatial"),void 0!==u._panner.positionX?(u._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):u._panner.setPosition(t,n,r)),o._emit("pos",u._id)}}return o},Howl.prototype.orientation=function(t,n,r,i){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"orientation",action:function(){o.orientation(t,n,r,i)}}),o;if(n="number"!=typeof n?o._orientation[1]:n,r="number"!=typeof r?o._orientation[2]:r,void 0===i){if("number"!=typeof t)return o._orientation;o._orientation=[t,n,r]}for(var a=o._getSoundIds(i),s=0;s<a.length;s++){var u=o._soundById(a[s]);if(u){if("number"!=typeof t)return u._orientation;u._orientation=[t,n,r],u._node&&(u._panner||(u._pos||(u._pos=o._pos||[0,0,-.5]),e(u,"spatial")),void 0!==u._panner.orientationX?(u._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),u._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):u._panner.setOrientation(t,n,r)),o._emit("orientation",u._id)}}return o},Howl.prototype.pannerAttr=function(){var t,n,r,i=this,o=arguments;if(!i._webAudio)return i;if(0===o.length)return i._pannerAttr;if(1===o.length){if("object"!=typeof o[0])return(r=i._soundById(parseInt(o[0],10)))?r._pannerAttr:i._pannerAttr;t=o[0],void 0===n&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==t.pannerAttr.refDistance?t.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==t.pannerAttr.panningModel?t.pannerAttr.panningModel:i._panningModel})}else 2===o.length&&(t=o[0],n=parseInt(o[1],10));for(var a=i._getSoundIds(n),s=0;s<a.length;s++)if(r=i._soundById(a[s])){var u=r._pannerAttr;u={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:u.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:u.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:u.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:u.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:u.maxDistance,refDistance:void 0!==t.refDistance?t.refDistance:u.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:u.rolloffFactor,panningModel:void 0!==t.panningModel?t.panningModel:u.panningModel};var c=r._panner;c?(c.coneInnerAngle=u.coneInnerAngle,c.coneOuterAngle=u.coneOuterAngle,c.coneOuterGain=u.coneOuterGain,c.distanceModel=u.distanceModel,c.maxDistance=u.maxDistance,c.refDistance=u.refDistance,c.rolloffFactor=u.rolloffFactor,c.panningModel=u.panningModel):(r._pos||(r._pos=i._pos||[0,0,-.5]),e(r,"spatial"))}return i},Sound.prototype.init=function(t){return function(){var e=this._parent;this._orientation=e._orientation,this._stereo=e._stereo,this._pos=e._pos,this._pannerAttr=e._pannerAttr,t.call(this),this._stereo?e.stereo(this._stereo):this._pos&&e.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this._parent;return this._orientation=e._orientation,this._stereo=e._stereo,this._pos=e._pos,this._pannerAttr=e._pannerAttr,this._stereo?e.stereo(this._stereo):this._pos?e.pos(this._pos[0],this._pos[1],this._pos[2],this._id):this._panner&&(this._panner.disconnect(0),this._panner=void 0,e._refreshBuffer(this)),t.call(this)}}(Sound.prototype.reset);var e=function(t,e){"spatial"===(e=e||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,void 0!==t._panner.positionX?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),void 0!==t._panner.orientationX?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}()}).call(this,n(7))},function(t,e,n){(function(r,i){var o;!function(r){var a=r.Promise,s=a&&"resolve"in a&&"reject"in a&&"all"in a&&"race"in a&&function(){var t;return new a((function(e){t=e})),"function"==typeof t}();e?(e.Promise=s?a:E,e.Polyfill=E):void 0===(o=function(){return s?a:E}.call(e,n,e,t))||(t.exports=o);var u=function(){};function c(t){return"[object Array]"===Object.prototype.toString.call(t)}var l,h=void 0!==i?i:setTimeout,d=[];function f(){for(var t=0;t<d.length;t++)d[t][0](d[t][1]);d=[],l=!1}function p(t,e){d.push([t,e]),l||(l=!0,h(f,0))}function m(t){var e=t.owner,n=e.state_,r=e.data_,i=t[n],o=t.then;if("function"==typeof i){n="fulfilled";try{r=i(r)}catch(t){_(o,t)}}y(o,r)||("fulfilled"===n&&g(o,r),"rejected"===n&&_(o,r))}function y(t,e){var n;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&("function"==typeof e||"object"==typeof e)){var r=e.then;if("function"==typeof r)return r.call(e,(function(r){n||(n=!0,e!==r?g(t,r):v(t,r))}),(function(e){n||(n=!0,_(t,e))})),!0}}catch(e){return n||_(t,e),!0}return!1}function g(t,e){t!==e&&y(t,e)||v(t,e)}function v(t,e){"pending"===t.state_&&(t.state_="sealed",t.data_=e,p(x,t))}function _(t,e){"pending"===t.state_&&(t.state_="sealed",t.data_=e,p(w,t))}function b(t){var e=t.then_;t.then_=void 0;for(var n=0;n<e.length;n++)m(e[n])}function x(t){t.state_="fulfilled",b(t)}function w(t){t.state_="rejected",b(t)}function E(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof E==0)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],function(t,e){function n(t){_(e,t)}try{t((function(t){g(e,t)}),n)}catch(t){n(t)}}(t,this)}E.prototype={constructor:E,state_:"pending",then_:null,data_:void 0,then:function(t,e){var n={owner:this,then:new this.constructor(u),fulfilled:t,rejected:e};return"fulfilled"===this.state_||"rejected"===this.state_?p(m,n):this.then_.push(n),n.then},catch:function(t){return this.then(null,t)}},E.all=function(t){if(!c(t))throw new TypeError("You must pass an array to Promise.all().");return new this((function(e,n){var r=[],i=0;function o(t){return i++,function(n){r[t]=n,--i||e(r)}}for(var a,s=0;s<t.length;s++)(a=t[s])&&"function"==typeof a.then?a.then(o(s),n):r[s]=a;i||e(r)}))},E.race=function(t){if(!c(t))throw new TypeError("You must pass an array to Promise.race().");return new this((function(e,n){for(var r,i=0;i<t.length;i++)(r=t[i])&&"function"==typeof r.then?r.then(e,n):e(r)}))},E.resolve=function(t){return t&&"object"==typeof t&&t.constructor===this?t:new this((function(e){e(t)}))},E.reject=function(t){return new this((function(e,n){n(t)}))}}("undefined"!=typeof window?window:void 0!==r?r:"undefined"!=typeof self?self:this)}).call(this,n(7),n(54).setImmediate)},function(t,e,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,s,u=a(t),c=1;c<arguments.length;c++){for(var l in n=Object(arguments[c]))i.call(n,l)&&(u[l]=n[l]);if(r){s=r(n);for(var h=0;h<s.length;h++)o.call(n,s[h])&&(u[s[h]]=n[s[h]])}}return u}},function(t,e,n){(function(t,e){var n;!function(n){!function(r){var i="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=a(n);function a(t,e){return function(n,r){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0===i.Reflect?i.Reflect=n:o=a(i.Reflect,o),function(e){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,i=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,s={__proto__:[]}instanceof Array,u=!a&&!s,c={create:a?function(){return M(Object.create(null))}:s?function(){return M({__proto__:null})}:function(){return M({})},has:u?function(t,e){return n.call(t,e)}:function(t,e){return e in t},get:u?function(t,e){return n.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),h="object"==typeof t&&t.env&&"true"===t.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[o]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,i)},e.prototype.entries=function(){return new n(this._keys,this._values,a)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[o]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function i(t,e){return e}function a(t,e){return[t,e]}}():Map,f=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new d}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[o]=function(){return this.keys()},t}():Set,p=new(h||"function"!=typeof WeakMap?function(){var t=c.create(),e=r();return function(){function t(){this._key=r()}return t.prototype.has=function(t){var e=i(t,!1);return void 0!==e&&c.has(e,this._key)},t.prototype.get=function(t){var e=i(t,!1);return void 0!==e?c.get(e,this._key):void 0},t.prototype.set=function(t,e){return i(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=i(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=r()},t}();function r(){var e;do{e="@@WeakMap@@"+a()}while(c.has(t,e));return t[e]=!0,e}function i(t,r){if(!n.call(t,e)){if(!r)return;Object.defineProperty(t,e,{value:c.create()})}return t[e]}function o(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function a(){var t,e=(t=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):o(new Uint8Array(t),t):o(new Array(t),t));e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",r=0;r<16;++r){var i=e[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function m(t,e,n){var r=p.get(t);if(x(r)){if(!n)return;r=new d,p.set(t,r)}var i=r.get(e);if(x(i)){if(!n)return;i=new d,r.set(e,i)}return i}function y(t,e,n){var r=m(e,n,!1);return!x(r)&&!!r.has(t)}function g(t,e,n){var r=m(e,n,!1);if(!x(r))return r.get(t)}function v(t,e,n,r){m(n,r,!0).set(t,e)}function _(t,e){var n=[],r=m(t,e,!1);if(x(r))return n;for(var i=function(t){var e=I(t,o);if(!A(e))throw new TypeError;var n=e.call(t);if(!E(n))throw new TypeError;return n}(r.keys()),a=0;;){var s=P(i);if(!s)return n.length=a,n;var u=s.value;try{n[a]=u}catch(t){try{C(i)}finally{throw t}}a++}}function b(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function x(t){return void 0===t}function w(t){return null===t}function E(t){return"object"==typeof t?null!==t:"function"==typeof t}function T(t){var e=function(t,e){switch(b(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",r=I(t,i);if(void 0!==r){var o=r.call(t,n);if(E(o))throw new TypeError;return o}return function(t,e){if("string"===e){var n=t.toString;if(A(n)&&!E(i=n.call(t)))return i;if(A(r=t.valueOf)&&!E(i=r.call(t)))return i}else{var r;if(A(r=t.valueOf)&&!E(i=r.call(t)))return i;var i,o=t.toString;if(A(o)&&!E(i=o.call(t)))return i}throw new TypeError}(t,"default"===n?"number":n)}(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function O(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function A(t){return"function"==typeof t}function S(t){return"function"==typeof t}function I(t,e){var n=t[e];if(null!=n){if(!A(n))throw new TypeError;return n}}function P(t){var e=t.next();return!e.done&&e}function C(t){var e=t.return;e&&e.call(t)}function R(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===l)return e;if(e!==l)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i?e:i===t?e:i}function M(t){return t.__=void 0,delete t.__,t}e("decorate",(function(t,e,n,r){if(x(n)){if(!O(t))throw new TypeError;if(!S(e))throw new TypeError;return function(t,e){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e);if(!x(r)&&!w(r)){if(!S(r))throw new TypeError;e=r}}return e}(t,e)}if(!O(t))throw new TypeError;if(!E(e))throw new TypeError;if(!E(r)&&!x(r)&&!w(r))throw new TypeError;return w(r)&&(r=void 0),function(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=(0,t[i])(e,n,r);if(!x(o)&&!w(o)){if(!E(o))throw new TypeError;r=o}}return r}(t,e,n=T(n),r)})),e("metadata",(function(t,e){return function(n,r){if(!E(n))throw new TypeError;if(!x(r)&&!function(t){switch(b(t)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;v(t,e,n,r)}})),e("defineMetadata",(function(t,e,n,r){if(!E(n))throw new TypeError;return x(r)||(r=T(r)),v(t,e,n,r)})),e("hasMetadata",(function(t,e,n){if(!E(e))throw new TypeError;return x(n)||(n=T(n)),function t(e,n,r){if(y(e,n,r))return!0;var i=R(n);return!w(i)&&t(e,i,r)}(t,e,n)})),e("hasOwnMetadata",(function(t,e,n){if(!E(e))throw new TypeError;return x(n)||(n=T(n)),y(t,e,n)})),e("getMetadata",(function(t,e,n){if(!E(e))throw new TypeError;return x(n)||(n=T(n)),function t(e,n,r){if(y(e,n,r))return g(e,n,r);var i=R(n);return w(i)?void 0:t(e,i,r)}(t,e,n)})),e("getOwnMetadata",(function(t,e,n){if(!E(e))throw new TypeError;return x(n)||(n=T(n)),g(t,e,n)})),e("getMetadataKeys",(function(t,e){if(!E(t))throw new TypeError;return x(e)||(e=T(e)),function t(e,n){var r=_(e,n),i=R(e);if(null===i)return r;var o=t(i,n);if(o.length<=0)return r;if(r.length<=0)return o;for(var a=new f,s=[],u=0,c=r;u<c.length;u++){var l=c[u];a.has(l)||(a.add(l),s.push(l))}for(var h=0,d=o;h<d.length;h++)l=d[h],a.has(l)||(a.add(l),s.push(l));return s}(t,e)})),e("getOwnMetadataKeys",(function(t,e){if(!E(t))throw new TypeError;return x(e)||(e=T(e)),_(t,e)})),e("deleteMetadata",(function(t,e,n){if(!E(e))throw new TypeError;x(n)||(n=T(n));var r=m(e,n,!1);if(x(r))return!1;if(!r.delete(t))return!1;if(r.size>0)return!0;var i=p.get(e);return i.delete(n),i.size>0||(p.delete(e),!0)}))}(o)}()}(n||(n={}))}).call(this,n(14),n(7))},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(28),a=n(2),s=n(5),u=n(1),c=n(15),l=n(29),h=n(36),d=n(38),f=n(8),p=n(9),m=n(41),y=n(42),g=function(){function t(t){var e=t||{};if("object"!=typeof e)throw new Error(""+a.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===e.defaultScope)e.defaultScope=s.BindingScopeEnum.Transient;else if(e.defaultScope!==s.BindingScopeEnum.Singleton&&e.defaultScope!==s.BindingScopeEnum.Transient&&e.defaultScope!==s.BindingScopeEnum.Request)throw new Error(""+a.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===e.autoBindInjectable)e.autoBindInjectable=!1;else if("boolean"!=typeof e.autoBindInjectable)throw new Error(""+a.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===e.skipBaseClassChecks)e.skipBaseClassChecks=!1;else if("boolean"!=typeof e.skipBaseClassChecks)throw new Error(""+a.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:e.autoBindInjectable,defaultScope:e.defaultScope,skipBaseClassChecks:e.skipBaseClassChecks},this.id=f.id(),this._bindingDictionary=new y.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new c.MetadataReader}return t.merge=function(e,n){var r=new t,i=l.getBindingDictionary(r),o=l.getBindingDictionary(e),a=l.getBindingDictionary(n);function s(t,e){t.traverse((function(t,n){n.forEach((function(t){e.add(t.serviceIdentifier,t.clone())}))}))}return s(o,i),s(a,i),r},t.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=t;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},t.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(this,void 0,void 0,(function(){var e,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:e=this._getContainerModuleHelpersFactory(),n=0,r=t,i.label=1;case 1:return n<r.length?(o=r[n],a=e(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.prototype.unload=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(t){return function(e){return e.moduleId===t}};e.forEach((function(e){var n=r(e.id);t._bindingDictionary.removeByCondition(n)}))},t.prototype.bind=function(t){var e=this.options.defaultScope||s.BindingScopeEnum.Transient,n=new o.Binding(t,e);return this._bindingDictionary.add(t,n),new d.BindingToSyntax(n)},t.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},t.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw new Error(a.CANNOT_UNBIND+" "+p.getServiceIdentifierAsString(t))}},t.prototype.unbindAll=function(){this._bindingDictionary=new y.Lookup},t.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},t.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,u.NAMED_TAG,e)},t.prototype.isBoundTagged=function(t,e,n){var r=!1;if(this._bindingDictionary.hasKey(t)){var i=this._bindingDictionary.get(t),o=l.createMockRequest(this,t,e,n);r=i.some((function(t){return t.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(t,e,n)),r},t.prototype.snapshot=function(){this._snapshots.push(m.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},t.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw new Error(a.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=t.bindings,this._middleware=t.middleware},t.prototype.createChild=function(e){var n=new t(e||this.options);return n.parent=this,n},t.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce((function(t,e){return e(t)}),n)},t.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},t.prototype.get=function(t){return this._get(!1,!1,s.TargetTypeEnum.Variable,t)},t.prototype.getTagged=function(t,e,n){return this._get(!1,!1,s.TargetTypeEnum.Variable,t,e,n)},t.prototype.getNamed=function(t,e){return this.getTagged(t,u.NAMED_TAG,e)},t.prototype.getAll=function(t){return this._get(!0,!0,s.TargetTypeEnum.Variable,t)},t.prototype.getAllTagged=function(t,e,n){return this._get(!1,!0,s.TargetTypeEnum.Variable,t,e,n)},t.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,u.NAMED_TAG,e)},t.prototype.resolve=function(t){var e=this.createChild();return e.bind(t).toSelf(),e.get(t)},t.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e},n=function(n){return function(r){var i=t.rebind.bind(t)(r);return e(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=t.bind.bind(t)(n);return e(r,i),r}),isboundFunction:function(e){return t.isBound.bind(t)(e)},rebindFunction:n(r),unbindFunction:function(e){t.unbind.bind(t)(e)}};var i}},t.prototype._get=function(t,e,n,r,i,o){var s=null,u={avoidConstraints:t,contextInterceptor:function(t){return t},isMultiInject:e,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(s=this._middleware(u)))throw new Error(a.INVALID_MIDDLEWARE_RETURN)}else s=this._planAndResolve()(u);return s},t.prototype._planAndResolve=function(){var t=this;return function(e){var n=l.plan(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);return n=e.contextInterceptor(n),h.resolve(n)}},t}();e.Container=g},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(5),i=n(8),o=function(){function t(t,e){this.id=i.id(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(t){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope);return e.activated=!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},t}();e.Binding=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(30),i=n(2),o=n(5),a=n(1),s=n(16),u=n(9),c=n(31),l=n(3),h=n(32),d=n(33),f=n(35),p=n(18);function m(t){return t._bindingDictionary}function y(t,e,n,o,a){var s,c=g(n.container,a.serviceIdentifier);return c.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&t.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),c=g(n.container,a.serviceIdentifier)),s=e?c:c.filter((function(t){var e=new f.Request(t.serviceIdentifier,n,o,t,a);return t.constraint(e)})),function(t,e,n,o){switch(e.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return e;var a=u.getServiceIdentifierAsString(t),s=i.NOT_REGISTERED;throw s+=u.listMetadataForTarget(a,n),s+=u.listRegisteredBindingsForServiceIdentifier(o,a,g),new Error(s);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return e;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return e;throw a=u.getServiceIdentifierAsString(t),s=i.AMBIGUOUS_MATCH+" "+a,s+=u.listRegisteredBindingsForServiceIdentifier(o,a,g),new Error(s)}}(a.serviceIdentifier,s,a,n.container),s}function g(t,e){var n=[],r=m(t);return r.hasKey(e)?n=r.get(e):null!==t.parent&&(n=g(t.parent,e)),n}e.getBindingDictionary=m,e.plan=function(t,e,n,r,m,g,v,_){void 0===_&&(_=!1);var b=new c.Context(e),x=function(t,e,n,r,i,o){var s=t?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new l.Metadata(s,n),c=new p.Target(e,"",n,u);if(void 0!==i){var h=new l.Metadata(i,o);c.metadata.push(h)}return c}(n,r,m,0,g,v);try{return function t(e,n,r,a,s,u){var c,l;if(null===s){c=y(e,n,a,null,u),l=new f.Request(r,a,null,c,u);var p=new h.Plan(a,l);a.addPlan(p)}else c=y(e,n,a,s,u),l=s.addChildRequest(u.serviceIdentifier,c,u);c.forEach((function(n){var r=null;if(u.isArray())r=l.addChildRequest(n.serviceIdentifier,n,u);else{if(n.cache)return;r=l}if(n.type===o.BindingTypeEnum.Instance&&null!==n.implementationType){var s=d.getDependencies(e,n.implementationType);if(!a.container.options.skipBaseClassChecks){var c=d.getBaseClassDependencyCount(e,n.implementationType);if(s.length<c){var h=i.ARGUMENTS_LENGTH_MISMATCH(d.getFunctionName(n.implementationType));throw new Error(h)}}s.forEach((function(n){t(e,!1,n.serviceIdentifier,a,r,n)}))}}))}(t,_,m,b,null,x),b}catch(t){throw s.isStackOverflowExeption(t)&&b.plan&&u.circularDependencyToException(b.plan.rootRequest),t}},e.createMockRequest=function(t,e,n,r){var i=new p.Target(o.TargetTypeEnum.Variable,"",e,new l.Metadata(n,r)),a=new c.Context(t);return new f.Request(e,a,null,[],i)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(8),i=function(){function t(t){this.id=r.id(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}();e.Context=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Plan=function(t,e){this.parentContext=t,this.rootRequest=e}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(17),i=n(2),o=n(5),a=n(1),s=n(9);e.getFunctionName=s.getFunctionName;var u=n(18);function c(t,e,n,r){var a=t.getConstructorMetadata(n),s=a.compilerGeneratedMetadata;if(void 0===s){var c=i.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(c)}var d=a.userGeneratedMetadata,f=Object.keys(d),p=function(t,e,n,r,i){for(var o=[],a=0;a<i;a++){var s=l(a,t,e,n,r);null!==s&&o.push(s)}return o}(r,e,s,d,0===n.length&&f.length>0?f.length:n.length),m=function t(e,n){for(var r=e.getPropertiesMetadata(n),i=[],a=0,s=Object.keys(r);a<s.length;a++){var c=s[a],l=r[c],d=h(r[c]),f=d.targetName||c,p=d.inject||d.multiInject,m=new u.Target(o.TargetTypeEnum.ClassProperty,f,p);m.metadata=l,i.push(m)}var y=Object.getPrototypeOf(n.prototype).constructor;if(y!==Object){var g=t(e,y);i=i.concat(g)}return i}(t,n);return p.concat(m)}function l(t,e,n,a,s){var c=s[t.toString()]||[],l=h(c),d=!0!==l.unmanaged,f=a[t];if((f=l.inject||l.multiInject||f)instanceof r.LazyServiceIdentifer&&(f=f.unwrap()),d){if(!e&&(f===Object||f===Function||void 0===f)){var p=i.MISSING_INJECT_ANNOTATION+" argument "+t+" in class "+n+".";throw new Error(p)}var m=new u.Target(o.TargetTypeEnum.ConstructorArgument,l.targetName,f);return m.metadata=c,m}return null}function h(t){var e={};return t.forEach((function(t){e[t.key.toString()]=t.value})),{inject:e[a.INJECT_TAG],multiInject:e[a.MULTI_INJECT_TAG],targetName:e[a.NAME_TAG],unmanaged:e[a.UNMANAGED_TAG]}}e.getDependencies=function(t,e){return c(t,s.getFunctionName(e),e,!1)},e.getBaseClassDependencyCount=function t(e,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=c(e,s.getFunctionName(r),r,!0),o=i.map((function(t){return t.metadata.filter((function(t){return t.key===a.UNMANAGED_TAG}))})),u=[].concat.apply([],o).length,l=i.length-u;return l>0?l:t(e,r)}return 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e,n=t.split("").reverse().join("");return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},n)},t.prototype.contains=function(t){return-1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}();e.QueryableString=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(8),i=function(){function t(t,e,n,i,o){this.id=r.id(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return t.prototype.addChildRequest=function(e,n,r){var i=new t(e,this.parentContext,this,n,r);return this.childRequests.push(i),i},t}();e.Request=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(5),o=n(16),a=n(9),s=n(37),u=function(t,e,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(t,e.toString())):n}},c=function(t){return function(e){e.parentContext.setCurrentRequest(e);var n=e.bindings,o=e.childRequests,l=e.target&&e.target.isArray(),h=!(e.parentRequest&&e.parentRequest.target&&e.target&&e.parentRequest.target.matchesArray(e.target.serviceIdentifier));if(l&&h)return o.map((function(e){return c(t)(e)}));var d=null;if(!e.target.isOptional()||0!==n.length){var f=n[0],p=f.scope===i.BindingScopeEnum.Singleton,m=f.scope===i.BindingScopeEnum.Request;if(p&&f.activated)return f.cache;if(m&&null!==t&&t.has(f.id))return t.get(f.id);if(f.type===i.BindingTypeEnum.ConstantValue)d=f.cache;else if(f.type===i.BindingTypeEnum.Function)d=f.cache;else if(f.type===i.BindingTypeEnum.Constructor)d=f.implementationType;else if(f.type===i.BindingTypeEnum.DynamicValue&&null!==f.dynamicValue)d=u("toDynamicValue",f.serviceIdentifier,(function(){return f.dynamicValue(e.parentContext)}));else if(f.type===i.BindingTypeEnum.Factory&&null!==f.factory)d=u("toFactory",f.serviceIdentifier,(function(){return f.factory(e.parentContext)}));else if(f.type===i.BindingTypeEnum.Provider&&null!==f.provider)d=u("toProvider",f.serviceIdentifier,(function(){return f.provider(e.parentContext)}));else{if(f.type!==i.BindingTypeEnum.Instance||null===f.implementationType){var y=a.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+y)}d=s.resolveInstance(f.implementationType,o,c(t))}return"function"==typeof f.onActivation&&(d=f.onActivation(e.parentContext,d)),p&&(f.cache=d,f.activated=!0),m&&null!==t&&!t.has(f.id)&&t.set(f.id,d),d}}};e.resolve=function(t){return c(t.plan.rootRequest.requestScope)(t.plan.rootRequest)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(5),o=n(1);e.resolveInstance=function(t,e,n){var a,s,u=null;return e.length>0?(s=e.filter((function(t){return null!==t.target&&t.target.type===i.TargetTypeEnum.ConstructorArgument})).map(n),u=function(t,e,n){var r=e.filter((function(t){return null!==t.target&&t.target.type===i.TargetTypeEnum.ClassProperty})),o=r.map(n);return r.forEach((function(e,n){var r;r=e.target.name.value();var i=o[n];t[r]=i})),t}(u=new((a=t).bind.apply(a,[void 0].concat(s))),e,n)):u=new t,function(t,e){if(Reflect.hasMetadata(o.POST_CONSTRUCT,t)){var n=Reflect.getMetadata(o.POST_CONSTRUCT,t);try{e[n.value]()}catch(e){throw new Error(r.POST_CONSTRUCT_ERROR(t.name,e.message))}}}(t,u),u}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(5),o=n(39),a=n(19),s=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=t,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toDynamicValue=function(t){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=t,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=t,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFunction=function(t){if("function"!=typeof t)throw new Error(r.INVALID_FUNCTION_BINDING);var e=this.toConstantValue(t);return this._binding.type=i.BindingTypeEnum.Function,e},t.prototype.toAutoFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(e){return function(){return e.container.get(t)}},new a.BindingWhenOnSyntax(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=t,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toService=function(t){this.toDynamicValue((function(e){return e.container.get(t)}))},t}();e.BindingToSyntax=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(40),i=n(11),o=n(12),a=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingInWhenOnSyntax=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(5),i=n(19),o=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},t}();e.BindingInSyntax=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.of=function(e,n){var r=new t;return r.bindings=e,r.middleware=n,r},t}();e.ContainerSnapshot=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=function(){function t(){this._map=new Map}return t.prototype.getMap=function(){return this._map},t.prototype.add=function(t,e){if(null==t)throw new Error(r.NULL_ARGUMENT);if(null==e)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(t);void 0!==n?(n.push(e),this._map.set(t,n)):this._map.set(t,[e])},t.prototype.get=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);var e=this._map.get(t);if(void 0!==e)return e;throw new Error(r.KEY_NOT_FOUND)},t.prototype.remove=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(t))throw new Error(r.KEY_NOT_FOUND)},t.prototype.removeByCondition=function(t){var e=this;this._map.forEach((function(n,r){var i=n.filter((function(e){return!t(e)}));i.length>0?e._map.set(r,i):e._map.delete(r)}))},t.prototype.hasKey=function(t){if(null==t)throw new Error(r.NULL_ARGUMENT);return this._map.has(t)},t.prototype.clone=function(){var e=new t;return this._map.forEach((function(t,n){t.forEach((function(t){return e.add(n,t.clone())}))})),e},t.prototype.traverse=function(t){this._map.forEach((function(e,n){t(n,e)}))},t}();e.Lookup=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(8);e.ContainerModule=function(t){this.id=r.id(),this.registry=t},e.AsyncContainerModule=function(t){this.id=r.id(),this.registry=t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(1);e.injectable=function(){return function(t){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,t))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,t)||[];return Reflect.defineMetadata(i.PARAM_TYPES,e,t),t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(6);e.tagged=function(t,e){return function(n,o,a){var s=new r.Metadata(t,e);"number"==typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(3),o=n(6);e.named=function(t){return function(e,n,a){var s=new i.Metadata(r.NAMED_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(3),o=n(6);e.optional=function(){return function(t,e,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(t,e,n,a):o.tagProperty(t,e,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(3),o=n(6);e.unmanaged=function(){return function(t,e,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(t,e,n,a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(3),o=n(6);e.multiInject=function(t){return function(e,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,t);"number"==typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(3),o=n(6);e.targetName=function(t){return function(e,n,a){var s=new i.Metadata(r.NAME_TAG,t);o.tagParameter(e,n,a,s)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=n(1),o=n(3);e.postConstruct=function(){return function(t,e,n){var a=new o.Metadata(i.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,t.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,t.constructor)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=function(t){return function(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return t.bind(n).toService(e)}))}}}},function(t,e,n){"use strict";(function(t){var e=n(24),r=n(25),i=n.n(r);window.Promise||(window.Promise=e.Polyfill),Object.assign||(Object.assign=i.a);var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!o.performance||!o.performance.now){var a=Date.now();o.performance||(o.performance={}),o.performance.now=function(){return Date.now()-a}}for(var s=Date.now(),u=["ms","moz","webkit","o"],c=0;c<u.length&&!o.requestAnimationFrame;++c){var l=u[c];o.requestAnimationFrame=o[l+"RequestAnimationFrame"],o.cancelAnimationFrame=o[l+"CancelAnimationFrame"]||o[l+"CancelRequestAnimationFrame"]}o.requestAnimationFrame||(o.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),n=16+s-e;return n<0&&(n=0),s=e,setTimeout((function(){s=Date.now(),t(performance.now())}),n)}),o.cancelAnimationFrame||(o.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array),window.Uint8Array||(window.Uint8Array=Array),window.Int32Array||(window.Int32Array=Array)}).call(this,n(7))},function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n(55),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(7))},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i,o,a,s,u=1,c={},l=!1,h=t.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(t);d=d&&d.setTimeout?d:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick((function(){p(t)}))}:function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&p(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),r=function(e){t.postMessage(a+e,"*")}):t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){p(t.data)},r=function(t){o.port2.postMessage(t)}):h&&"onreadystatechange"in h.createElement("script")?(i=h.documentElement,r=function(t){var e=h.createElement("script");e.onreadystatechange=function(){p(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):r=function(t){setTimeout(p,0,t)},d.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[u]=i,r(u),u++},d.clearImmediate=f}function f(t){delete c[t]}function p(t){if(l)setTimeout(p,0,t);else{var e=c[t];if(e){l=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(void 0,n)}}(e)}finally{f(t),l=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(7),n(14))},function(t,e,n){(function(t,r){var i;!function(o){e&&e.nodeType,t&&t.nodeType;var a="object"==typeof r&&r;a.global!==a&&a.window!==a&&a.self;var s,u=2147483647,c=/^xn--/,l=/[^\x20-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,p=String.fromCharCode;function m(t){throw new RangeError(d[t])}function y(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function g(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+y((t=t.replace(h,".")).split("."),e).join(".")}function v(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function _(t){return y(t,(function(t){var e="";return t>65535&&(e+=p((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+p(t)})).join("")}function b(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function x(t,e,n){var r=0;for(t=n?f(t/700):t>>1,t+=f(t/e);t>455;r+=36)t=f(t/35);return f(r+36*t/(t+38))}function w(t){var e,n,r,i,o,a,s,c,l,h,d,p=[],y=t.length,g=0,v=128,b=72;for((n=t.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&m("not-basic"),p.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<y;){for(o=g,a=1,s=36;i>=y&&m("invalid-input"),((c=(d=t.charCodeAt(i++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:36)>=36||c>f((u-g)/a))&&m("overflow"),g+=c*a,!(c<(l=s<=b?1:s>=b+26?26:s-b));s+=36)a>f(u/(h=36-l))&&m("overflow"),a*=h;b=x(g-o,e=p.length+1,0==o),f(g/e)>u-v&&m("overflow"),v+=f(g/e),g%=e,p.splice(g++,0,v)}return _(p)}function E(t){var e,n,r,i,o,a,s,c,l,h,d,y,g,_,w,E=[];for(y=(t=v(t)).length,e=128,n=0,o=72,a=0;a<y;++a)(d=t[a])<128&&E.push(p(d));for(r=i=E.length,i&&E.push("-");r<y;){for(s=u,a=0;a<y;++a)(d=t[a])>=e&&d<s&&(s=d);for(s-e>f((u-n)/(g=r+1))&&m("overflow"),n+=(s-e)*g,e=s,a=0;a<y;++a)if((d=t[a])<e&&++n>u&&m("overflow"),d==e){for(c=n,l=36;!(c<(h=l<=o?1:l>=o+26?26:l-o));l+=36)w=c-h,_=36-h,E.push(p(b(h+w%_,0))),c=f(w/_);E.push(p(b(c,0))),o=x(n,g,r==i),n=0,++r}++n,++e}return E.join("")}s={version:"1.4.1",ucs2:{decode:v,encode:_},decode:w,encode:E,toASCII:function(t){return g(t,(function(t){return l.test(t)?"xn--"+E(t):t}))},toUnicode:function(t){return g(t,(function(t){return c.test(t)?w(t.slice(4).toLowerCase()):t}))}},void 0===(i=function(){return s}.call(e,n,e,t))||(t.exports=i)}()}).call(this,n(57)(t),n(7))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,e,n){"use strict";e.decode=e.parse=n(60),e.encode=e.stringify=n(61)},function(t,e,n){"use strict";function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,n,o){e=e||"&",n=n||"=";var a={};if("string"!=typeof t||0===t.length)return a;var s=/\+/g;t=t.split(e);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var c=t.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var h,d,f,p,m=t[l].replace(s,"%20"),y=m.indexOf(n);y>=0?(h=m.substr(0,y),d=m.substr(y+1)):(h=m,d=""),f=decodeURIComponent(h),p=decodeURIComponent(d),r(a,f)?i(a[f])?a[f].push(p):a[f]=[a[f],p]:a[f]=p}return a};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,e,n){"use strict";var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,n,s){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?o(a(t),(function(a){var s=encodeURIComponent(r(a))+n;return i(t[a])?o(t[a],(function(t){return s+encodeURIComponent(r(t))})).join(e):s+encodeURIComponent(r(t[a]))})).join(e):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(t)):""};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function o(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var a=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"isMobile",(function(){return G})),n.d(r,"EventEmitter",(function(){return X.a})),n.d(r,"earcut",(function(){return Y.a})),n.d(r,"url",(function(){return q.a})),n.d(r,"BaseTextureCache",(function(){return Tt})),n.d(r,"CanvasRenderTarget",(function(){return St})),n.d(r,"DATA_URI",(function(){return Ct})),n.d(r,"ProgramCache",(function(){return wt})),n.d(r,"TextureCache",(function(){return Et})),n.d(r,"clearTextureCache",(function(){return At})),n.d(r,"correctBlendMode",(function(){return ot})),n.d(r,"createIndicesForQuads",(function(){return ct})),n.d(r,"decomposeDataUri",(function(){return Rt})),n.d(r,"deprecation",(function(){return xt})),n.d(r,"destroyTextureCache",(function(){return Ot})),n.d(r,"determineCrossOrigin",(function(){return Mt})),n.d(r,"getBufferType",(function(){return lt})),n.d(r,"getResolutionOfUrl",(function(){return Dt})),n.d(r,"hex2rgb",(function(){return tt})),n.d(r,"hex2string",(function(){return et})),n.d(r,"interleaveTypedArrays",(function(){return dt})),n.d(r,"isPow2",(function(){return pt})),n.d(r,"isWebGLSupported",(function(){return $})),n.d(r,"log2",(function(){return mt})),n.d(r,"nextPow2",(function(){return ft})),n.d(r,"premultiplyBlendMode",(function(){return it})),n.d(r,"premultiplyRgba",(function(){return at})),n.d(r,"premultiplyTint",(function(){return st})),n.d(r,"premultiplyTintToRgba",(function(){return ut})),n.d(r,"removeItems",(function(){return yt})),n.d(r,"rgb2hex",(function(){return rt})),n.d(r,"sayHello",(function(){return Q})),n.d(r,"sign",(function(){return gt})),n.d(r,"skipHello",(function(){return Z})),n.d(r,"string2hex",(function(){return nt})),n.d(r,"trimCanvas",(function(){return It})),n.d(r,"uid",(function(){return _t})),n(26);var i=function(){return performance.now()/1e3},o=function(){function t(){this.Tick=new Set,this.lasttime=0,this.StopFlag=!0,this.EndFlag=!0,this.SkipFrame=0}return t.prototype.Start=function(){var t=this;if(this.EndFlag){this.StopFlag=!1;var e=0,n=function(){var r,o;if(t.EndFlag=!1,t.StopFlag)t.EndFlag=!0;else if(requestAnimationFrame(n),e>0)e--;else{e=t.SkipFrame;var a=i();if(t.Tick)try{for(var s=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t.Tick),u=s.next();!u.done;u=s.next())(0,u.value)(a-t.lasttime,a)}catch(t){r={error:t}}finally{try{u&&!u.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}t.lasttime=a}};this.lasttime=i(),n()}},t.prototype.Stop=function(){this.StopFlag=!0},t}(),a=function(){this.judgeOffset=0,this.visualOffset=0,this.speed=10,this.resolution=2,this.noteScale=1,this.barOpacity=.7,this.backgroundDim=.7,this.effectVolume=1,this.showSimLine=!0,this.laneEffect=!0,this.mirror=!1,this.beatNote=!0,this.autoplay=!1,this.debug=!1},s=function(){this.musicSrc="",this.mapContent=function(){return null},this.backgroundSrc="",this.coverSrc="",this.skin="",this.songName=""},u={effect:"effect.json",game:"game.json",ui:"ui.json"},c={flick:"flick.mp3",button:"game_button.mp3",good:"good.mp3",great:"great.mp3",long:"long.mp3",perfect:"perfect.mp3"},l=n(0),h=n(23);n(53);const d=/iPhone/i,f=/iPod/i,p=/iPad/i,m=/\bAndroid(?:.+)Mobile\b/i,y=/Android/i,g=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,v=/Silk/i,_=/Windows Phone/i,b=/\bWindows(?:.+)ARM\b/i,x=/BlackBerry/i,w=/BB10/i,E=/Opera Mini/i,T=/\b(CriOS|Chrome)(?:.+)Mobile/i,O=/Mobile(?:.+)Firefox\b/i;function A(t,e){return t.test(e)}var S,I,P,C,R,M,D,k,j,N,L,B,F,U,G=function(t){let e=(t=t||("undefined"!=typeof navigator?navigator.userAgent:"")).split("[FBAN");void 0!==e[1]&&(t=e[0]),e=t.split("Twitter"),void 0!==e[1]&&(t=e[0]);const n={apple:{phone:A(d,t)&&!A(_,t),ipod:A(f,t),tablet:!A(d,t)&&A(p,t)&&!A(_,t),device:(A(d,t)||A(f,t)||A(p,t))&&!A(_,t)},amazon:{phone:A(g,t),tablet:!A(g,t)&&A(v,t),device:A(g,t)||A(v,t)},android:{phone:!A(_,t)&&A(g,t)||!A(_,t)&&A(m,t),tablet:!A(_,t)&&!A(g,t)&&!A(m,t)&&(A(v,t)||A(y,t)),device:!A(_,t)&&(A(g,t)||A(v,t)||A(m,t)||A(y,t))||A(/\bokhttp\b/i,t)},windows:{phone:A(_,t),tablet:A(b,t),device:A(_,t)||A(b,t)},other:{blackberry:A(x,t),blackberry10:A(w,t),opera:A(E,t),firefox:A(O,t),chrome:A(T,t),device:A(x,t)||A(w,t)||A(E,t)||A(O,t)||A(T,t)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}(),H={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:function(t){var e=!0;if(G.tablet||G.phone){if(e=!1,G.apple.device){var n=navigator.userAgent.match(/OS (\d+)_(\d+)?/);n&&parseInt(n[1],10)>=11&&(e=!0)}if(G.android.device){var r=navigator.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)>=7&&(e=!0)}}return e?32:4}(),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:G.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:!G.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},z=n(21),X=n.n(z),V=n(22),Y=n.n(V),W=n(10),q=n.n(W);!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(S||(S={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(I||(I={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(P||(P={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(C||(C={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(R||(R={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(M||(M={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(D||(D={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(k||(k={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(j||(j={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON"}(N||(N={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(L||(L={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(B||(B={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(F||(F={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(U||(U={})),H.RETINA_PREFIX=/@([0-9\.]+)x/,H.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0;var J,K=!1;function Z(){K=!0}function Q(t){var e;if(!K){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var n=["\n %c %c %c PixiJS 5.2.1 - \u2730 "+t+" \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=window.console).log.apply(e,n)}else window.console&&window.console.log("PixiJS 5.2.1 - "+t+" - http://www.pixijs.com/");K=!0}}function $(){return void 0===J&&(J=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:H.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r=!(!n||!n.getContextAttributes().stencil);if(n){var i=n.getExtension("WEBGL_lose_context");i&&i.loseContext()}return n=null,r}catch(t){return!1}}()),J}function tt(t,e){return(e=e||[])[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function et(t){var e=t.toString(16);return"#"+("000000".substr(0,6-e.length)+e)}function nt(t){return"string"==typeof t&&"#"===t[0]&&(t=t.substr(1)),parseInt(t,16)}function rt(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)}var it=function(){for(var t=[],e=[],n=0;n<32;n++)t[n]=n,e[n]=n;t[P.NORMAL_NPM]=P.NORMAL,t[P.ADD_NPM]=P.ADD,t[P.SCREEN_NPM]=P.SCREEN,e[P.NORMAL]=P.NORMAL_NPM,e[P.ADD]=P.ADD_NPM,e[P.SCREEN]=P.SCREEN_NPM;var r=[];return r.push(e),r.push(t),r}();function ot(t,e){return it[e?1:0][t]}function at(t,e,n,r){return n=n||new Float32Array(4),r||void 0===r?(n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e):(n[0]=t[0],n[1]=t[1],n[2]=t[2]),n[3]=e,n}function st(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var n=t>>16&255,r=t>>8&255,i=255&t;return(255*e<<24)+((n=n*e+.5|0)<<16)+((r=r*e+.5|0)<<8)+(i*e+.5|0)}function ut(t,e,n,r){return(n=n||new Float32Array(4))[0]=(t>>16&255)/255,n[1]=(t>>8&255)/255,n[2]=(255&t)/255,(r||void 0===r)&&(n[0]*=e,n[1]*=e,n[2]*=e),n[3]=e,n}function ct(t,e){void 0===e&&(e=null);var n=6*t;if((e=e||new Uint16Array(n)).length!==n)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+n);for(var r=0,i=0;r<n;r+=6,i+=4)e[r+0]=i+0,e[r+1]=i+1,e[r+2]=i+2,e[r+3]=i+0,e[r+4]=i+2,e[r+5]=i+3;return e}function lt(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var ht={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function dt(t,e){for(var n=0,r=0,i={},o=0;o<t.length;o++)r+=e[o],n+=t[o].length;var a=new ArrayBuffer(4*n),s=null,u=0;for(o=0;o<t.length;o++){var c=e[o],l=t[o],h=lt(l);i[h]||(i[h]=new ht[h](a)),s=i[h];for(var d=0;d<l.length;d++)s[(d/c|0)*r+u+d%c]=l[d];u+=c}return new Float32Array(a)}function ft(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}function pt(t){return!(t&t-1||!t)}function mt(t){var e=(t>65535?1:0)<<4,n=((t>>>=e)>255?1:0)<<3;return e|=n,e|=n=((t>>>=n)>15?1:0)<<2,(e|=n=((t>>>=n)>3?1:0)<<1)|(t>>>=n)>>1}function yt(t,e,n){var r,i=t.length;if(!(e>=i||0===n)){var o=i-(n=e+n>i?i-e:n);for(r=e;r<o;++r)t[r]=t[r+n];t.length=o}}function gt(t){return 0===t?0:t<0?-1:1}var vt=0;function _t(){return++vt}var bt={};function xt(t,e,n){if(void 0===n&&(n=3),!bt[e]){var r=(new Error).stack;void 0===r?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(r=r.split("\n").splice(n).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(r))),bt[e]=!0}}var wt={},Et=Object.create(null),Tt=Object.create(null);function Ot(){var t;for(t in Et)Et[t].destroy();for(t in Tt)Tt[t].destroy()}function At(){var t;for(t in Et)delete Et[t];for(t in Tt)delete Tt[t]}var St=function(){function t(t,e,n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=n||H.RESOLUTION,this.resize(t,e)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t},enumerable:!0,configurable:!0}),t}();function It(t){var e,n,r,i=t.width,o=t.height,a=t.getContext("2d"),s=a.getImageData(0,0,i,o).data,u=s.length,c={top:null,left:null,right:null,bottom:null},l=null;for(e=0;e<u;e+=4)0!==s[e+3]&&(n=e/4%i,r=~~(e/4/i),null===c.top&&(c.top=r),null===c.left?c.left=n:n<c.left&&(c.left=n),null===c.right?c.right=n+1:c.right<n&&(c.right=n+1),null===c.bottom?c.bottom=r:c.bottom<r&&(c.bottom=r));return null!==c.top&&(i=c.right-c.left,o=c.bottom-c.top+1,l=a.getImageData(c.left,c.top,i,o)),{height:o,width:i,data:l}}var Pt,Ct=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function Rt(t){var e=Ct.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}function Mt(t,e){if(void 0===e&&(e=window.location),0===t.indexOf("data:"))return"";e=e||window.location,Pt||(Pt=document.createElement("a")),Pt.href=t;var n=Object(W.parse)(Pt.href),r=!n.port&&""===e.port||n.port===e.port;return n.hostname===e.hostname&&r&&n.protocol===e.protocol?"":"anonymous"}function Dt(t,e){var n=H.RETINA_PREFIX.exec(t);return n?parseFloat(n[1]):void 0!==e?e:1}var kt,jt=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},t.prototype.copyTo=function(t){return t.set(this.x,this.y),t},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},t}(),Nt=function(){function t(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0),this._x=n,this._y=r,this.cb=t,this.scope=e}return t.prototype.clone=function(e,n){return void 0===e&&(e=this.cb),void 0===n&&(n=this.scope),new t(e,n,this._x,this._y)},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(t){return t.set(this._x,this._y),t},t.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),t}(),Lt=2*Math.PI,Bt=180/Math.PI,Ft=Math.PI/180;!function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"}(kt||(kt={}));var Ut=function(){function t(t,e,n,r,i,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===i&&(i=0),void 0===o&&(o=0),this.array=null,this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=o}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,n,r,i,o){return this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=o,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n},t.prototype.apply=function(t,e){e=e||new jt;var n=t.x,r=t.y;return e.x=this.a*n+this.c*r+this.tx,e.y=this.b*n+this.d*r+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new jt;var n=1/(this.a*this.d+this.c*-this.b),r=t.x,i=t.y;return e.x=this.d*n*r+-this.c*n*i+(this.ty*this.c-this.tx*this.d)*n,e.y=this.a*n*i+-this.b*n*r+(-this.ty*this.a+this.tx*this.b)*n,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.a,i=this.c,o=this.tx;return this.a=r*e-this.b*n,this.b=r*n+this.b*e,this.c=i*e-this.d*n,this.d=i*n+this.d*e,this.tx=o*e-this.ty*n,this.ty=o*n+this.ty*e,this},t.prototype.append=function(t){var e=this.a,n=this.b,r=this.c,i=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*n+t.b*i,this.c=t.c*e+t.d*r,this.d=t.c*n+t.d*i,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*n+t.ty*i+this.ty,this},t.prototype.setTransform=function(t,e,n,r,i,o,a,s,u){return this.a=Math.cos(a+u)*i,this.b=Math.sin(a+u)*i,this.c=-Math.sin(a-s)*o,this.d=Math.cos(a-s)*o,this.tx=t-(n*this.a+r*this.c),this.ty=e-(n*this.b+r*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var n=this.a,r=this.c;this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,n=this.b,r=this.c,i=this.d,o=-Math.atan2(-r,i),a=Math.atan2(n,e),s=Math.abs(o+a);return s<1e-5||Math.abs(Lt-s)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(r*r+i*i),t.position.x=this.tx,t.position.y=this.ty,t},t.prototype.invert=function(){var t=this.a,e=this.b,n=this.c,r=this.d,i=this.tx,o=t*r-e*n;return this.a=r/o,this.b=-e/o,this.c=-n/o,this.d=t/o,this.tx=(n*this.ty-r*i)/o,this.ty=-(t*this.ty-e*i)/o,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!0,configurable:!0}),t}(),Gt=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ht=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],zt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Xt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Vt=[],Yt=[],Wt=Math.sign;!function(){for(var t=0;t<16;t++){var e=[];Vt.push(e);for(var n=0;n<16;n++)for(var r=Wt(Gt[t]*Gt[n]+zt[t]*Ht[n]),i=Wt(Ht[t]*Gt[n]+Xt[t]*Ht[n]),o=Wt(Gt[t]*zt[n]+zt[t]*Xt[n]),a=Wt(Ht[t]*zt[n]+Xt[t]*Xt[n]),s=0;s<16;s++)if(Gt[s]===r&&Ht[s]===i&&zt[s]===o&&Xt[s]===a){e.push(s);break}}for(t=0;t<16;t++){var u=new Ut;u.set(Gt[t],Ht[t],zt[t],Xt[t],0,0),Yt.push(u)}}();var qt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return Gt[t]},uY:function(t){return Ht[t]},vX:function(t){return zt[t]},vY:function(t){return Xt[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return Vt[t][e]},sub:function(t,e){return Vt[t][qt.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?qt.S:qt.N:2*Math.abs(e)<=Math.abs(t)?t>0?qt.E:qt.W:e>0?t>0?qt.SE:qt.SW:t>0?qt.NE:qt.NW},matrixAppendRotationInv:function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=Yt[qt.inv(e)];i.tx=n,i.ty=r,t.append(i)}},Jt=function(){function t(){this.worldTransform=new Ut,this.localTransform=new Ut,this.position=new Nt(this.onChange,this,0,0),this.scale=new Nt(this.onChange,this,1,1),this.pivot=new Nt(this.onChange,this,0,0),this.skew=new Nt(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var n=t.worldTransform,r=this.worldTransform;r.a=e.a*n.a+e.b*n.c,r.b=e.a*n.b+e.b*n.d,r.c=e.c*n.a+e.d*n.c,r.d=e.c*n.b+e.d*n.d,r.tx=e.tx*n.a+e.ty*n.c+n.tx,r.ty=e.tx*n.b+e.ty*n.d+n.ty,this._parentID=t._worldID,this._worldID++}},t.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!0,configurable:!0}),t.IDENTITY=new t,t}(),Kt=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=Number(t),this.y=Number(e),this.width=Number(n),this.height=Number(r),this.type=kt.RECT}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t,"EMPTY",{get:function(){return new t(0,0,0,0)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},t.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},t.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},t.prototype.fit=function(t){var e=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),i=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(n-e,0),this.y=r,this.height=Math.max(i-r,0),this},t.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var n=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=n-this.x,this.height=r-this.y,this},t.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=n-e,this.y=r,this.height=i-r,this},t}(),Zt=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.radius=n,this.type=kt.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(t,e){if(this.radius<=0)return!1;var n=this.radius*this.radius,r=this.x-t,i=this.y-e;return(r*=r)+(i*=i)<=n},t.prototype.getBounds=function(){return new Kt(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t}(),Qt=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=t,this.y=e,this.width=n,this.height=r,this.type=kt.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var n=(t-this.x)/this.width,r=(e-this.y)/this.height;return(n*=n)+(r*=r)<=1},t.prototype.getBounds=function(){return new Kt(this.x-this.width,this.y-this.height,this.width,this.height)},t}(),$t=function(){function t(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];if(Array.isArray(e[0])&&(e=e[0]),e[0]instanceof jt){for(var r=[],i=0,o=(e=e).length;i<o;i++)r.push(e[i].x,e[i].y);e=r}this.points=e,this.type=kt.POLY,this.closeStroke=!0}return t.prototype.clone=function(){var e=new t(this.points.slice());return e.closeStroke=this.closeStroke,e},t.prototype.contains=function(t,e){for(var n=!1,r=this.points.length/2,i=0,o=r-1;i<r;o=i++){var a=this.points[2*i],s=this.points[2*i+1],u=this.points[2*o],c=this.points[2*o+1];s>e!=c>e&&t<(e-s)/(c-s)*(u-a)+a&&(n=!n)}return n},t}(),te=function(){function t(t,e,n,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=20),this.x=t,this.y=e,this.width=n,this.height=r,this.radius=i,this.type=kt.RREC}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height,this.radius)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var n=t-(this.x+this.radius),r=e-(this.y+this.radius),i=this.radius*this.radius;if(n*n+r*r<=i)return!0;if((n=t-(this.x+this.width-this.radius))*n+r*r<=i)return!0;if(n*n+(r=e-(this.y+this.height-this.radius))*r<=i)return!0;if((n=t-(this.x+this.radius))*n+r*r<=i)return!0}return!1},t}();H.SORTABLE_CHILDREN=!1;var ee=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null};ee.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},ee.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},ee.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?Kt.EMPTY:((t=t||new Kt(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},ee.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},ee.prototype.addQuad=function(t){var e=this.minX,n=this.minY,r=this.maxX,i=this.maxY,o=t[0],a=t[1];e=o<e?o:e,n=a<n?a:n,r=o>r?o:r,i=a>i?a:i,e=(o=t[2])<e?o:e,n=(a=t[3])<n?a:n,r=o>r?o:r,i=a>i?a:i,e=(o=t[4])<e?o:e,n=(a=t[5])<n?a:n,r=o>r?o:r,i=a>i?a:i,e=(o=t[6])<e?o:e,n=(a=t[7])<n?a:n,r=o>r?o:r,i=a>i?a:i,this.minX=e,this.minY=n,this.maxX=r,this.maxY=i},ee.prototype.addFrame=function(t,e,n,r,i){this.addFrameMatrix(t.worldTransform,e,n,r,i)},ee.prototype.addFrameMatrix=function(t,e,n,r,i){var o=t.a,a=t.b,s=t.c,u=t.d,c=t.tx,l=t.ty,h=this.minX,d=this.minY,f=this.maxX,p=this.maxY,m=o*e+s*n+c,y=a*e+u*n+l;h=m<h?m:h,d=y<d?y:d,f=m>f?m:f,p=y>p?y:p,h=(m=o*r+s*n+c)<h?m:h,d=(y=a*r+u*n+l)<d?y:d,f=m>f?m:f,p=y>p?y:p,h=(m=o*e+s*i+c)<h?m:h,d=(y=a*e+u*i+l)<d?y:d,f=m>f?m:f,p=y>p?y:p,h=(m=o*r+s*i+c)<h?m:h,d=(y=a*r+u*i+l)<d?y:d,f=m>f?m:f,p=y>p?y:p,this.minX=h,this.minY=d,this.maxX=f,this.maxY=p},ee.prototype.addVertexData=function(t,e,n){for(var r=this.minX,i=this.minY,o=this.maxX,a=this.maxY,s=e;s<n;s+=2){var u=t[s],c=t[s+1];r=u<r?u:r,i=c<i?c:i,o=u>o?u:o,a=c>a?c:a}this.minX=r,this.minY=i,this.maxX=o,this.maxY=a},ee.prototype.addVertices=function(t,e,n,r){this.addVerticesMatrix(t.worldTransform,e,n,r)},ee.prototype.addVerticesMatrix=function(t,e,n,r,i,o){var a=t.a,s=t.b,u=t.c,c=t.d,l=t.tx,h=t.ty;i=i||0,o=o||0;for(var d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,y=n;y<r;y+=2){var g=e[y],v=e[y+1],_=a*g+u*v+l,b=c*v+s*g+h;d=Math.min(d,_-i),p=Math.max(p,_+i),f=Math.min(f,b-o),m=Math.max(m,b+o)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=m},ee.prototype.addBounds=function(t){var e=this.minX,n=this.minY,r=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>i?t.maxY:i},ee.prototype.addBoundsMask=function(t,e){var n=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(n<=i&&r<=o){var a=this.minX,s=this.minY,u=this.maxX,c=this.maxY;this.minX=n<a?n:a,this.minY=r<s?r:s,this.maxX=i>u?i:u,this.maxY=o>c?o:c}},ee.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},ee.prototype.addBoundsArea=function(t,e){var n=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(n<=i&&r<=o){var a=this.minX,s=this.minY,u=this.maxX,c=this.maxY;this.minX=n<a?n:a,this.minY=r<s?r:s,this.maxX=i>u?i:u,this.maxY=o>c?o:c}},ee.prototype.pad=function(t,e){t=t||0,e=e||(0!==e?t:0),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},ee.prototype.addFramePad=function(t,e,n,r,i,o){t-=i,e-=o,n+=i,r+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r};var ne=function(t){function e(){t.call(this),this.tempDisplayObjectParent=null,this.transform=new Jt,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new ee,this._boundsID=0,this._lastBoundsID=-1,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={_tempDisplayObjectParent:{configurable:!0},x:{configurable:!0},y:{configurable:!0},worldTransform:{configurable:!0},localTransform:{configurable:!0},position:{configurable:!0},scale:{configurable:!0},pivot:{configurable:!0},skew:{configurable:!0},rotation:{configurable:!0},angle:{configurable:!0},zIndex:{configurable:!0},worldVisible:{configurable:!0},mask:{configurable:!0}};return e.mixin=function(t){for(var n=Object.keys(t),r=0;r<n.length;++r){var i=n[r];Object.defineProperty(e.prototype,i,Object.getOwnPropertyDescriptor(t,i))}},n._tempDisplayObjectParent.get=function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new e),this.tempDisplayObjectParent},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.calculateBounds=function(){},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&(this.calculateBounds(),this._lastBoundsID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Kt),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){var e=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,t||(this._localBoundsRect||(this._localBoundsRect=new Kt),t=this._localBoundsRect);var r=this.getBounds(!1,t);return this.parent=n,this.transform=e,r},e.prototype.toGlobal=function(t,e,n){return void 0===n&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,n,r){return e&&(t=e.toGlobal(t,n,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)},e.prototype.render=function(t){},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,e,n,r,i,o,a,s,u){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),this.position.x=t,this.position.y=e,this.scale.x=n||1,this.scale.y=r||1,this.rotation=i,this.skew.x=o,this.skew.y=a,this.pivot.x=s,this.pivot.y=u,this},e.prototype.destroy=function(){this.parent&&this.parent.removeChild(this),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},n.x.get=function(){return this.position.x},n.x.set=function(t){this.transform.position.x=t},n.y.get=function(){return this.position.y},n.y.set=function(t){this.transform.position.y=t},n.worldTransform.get=function(){return this.transform.worldTransform},n.localTransform.get=function(){return this.transform.localTransform},n.position.get=function(){return this.transform.position},n.position.set=function(t){this.transform.position.copyFrom(t)},n.scale.get=function(){return this.transform.scale},n.scale.set=function(t){this.transform.scale.copyFrom(t)},n.pivot.get=function(){return this.transform.pivot},n.pivot.set=function(t){this.transform.pivot.copyFrom(t)},n.skew.get=function(){return this.transform.skew},n.skew.set=function(t){this.transform.skew.copyFrom(t)},n.rotation.get=function(){return this.transform.rotation},n.rotation.set=function(t){this.transform.rotation=t},n.angle.get=function(){return this.transform.rotation*Bt},n.angle.set=function(t){this.transform.rotation=t*Ft},n.zIndex.get=function(){return this._zIndex},n.zIndex.set=function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},n.worldVisible.get=function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},n.mask.get=function(){return this._mask},n.mask.set=function(t){if(this._mask){var e=this._mask.maskObject||this._mask;e.renderable=!0,e.isMask=!1}if(this._mask=t,this._mask){var n=this._mask.maskObject||this._mask;n.renderable=!1,n.isMask=!0}},Object.defineProperties(e.prototype,n),e}(X.a);function re(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}ne.prototype.displayObjectUpdateTransform=ne.prototype.updateTransform;var ie=function(t){function e(){t.call(this),this.children=[],this.sortableChildren=H.SORTABLE_CHILDREN,this.sortDirty=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={width:{configurable:!0},height:{configurable:!0}};return e.prototype.onChildrenChange=function(){},e.prototype.addChild=function(t){var e=arguments,n=arguments.length;if(n>1)for(var r=0;r<n;r++)this.addChild(e[r]);else t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this);return t},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},e.prototype.swapChildren=function(t,e){if(t!==e){var n=this.getChildIndex(t),r=this.getChildIndex(e);this.children[n]=e,this.children[r]=t,this.onChildrenChange(n<r?n:r)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(t);yt(this.children,n,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(t){var e=arguments,n=arguments.length;if(n>1)for(var r=0;r<n;r++)this.removeChild(e[r]);else{var i=this.children.indexOf(t);if(-1===i)return null;t.parent=null,t.transform._parentID=-1,yt(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i)}return t},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,yt(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0);var n,r=t,i="number"==typeof e?e:this.children.length,o=i-r;if(o>0&&o<=i){n=this.children.splice(r,o);for(var a=0;a<n.length;++a)n[a].parent=null,n[a].transform&&(n[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var s=0;s<n.length;++s)n[s].emit("removed",this),this.emit("childRemoved",n[s],this,s);return n}if(0===o&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,e=0,n=this.children.length;e<n;++e){var r=this.children[e];r._lastSortedIndex=e,t||0===r.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(re),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var n=this.children[t];n.visible&&n.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){var n=e._mask.maskObject||e._mask;n.calculateBounds(),this._bounds.addBoundsMask(e._bounds,n._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._lastBoundsID=this._boundsID},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var e=0,n=this.children.length;e<n;++e)this.children[e].render(t)}},e.prototype.renderAdvanced=function(t){t.batch.flush();var e=this.filters,n=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var r=0;r<e.length;r++)e[r].enabled&&this._enabledFilters.push(e[r]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}n&&t.mask.push(this,this._mask),this._render(t);for(var i=0,o=this.children.length;i<o;i++)this.children[i].render(t);t.batch.flush(),n&&t.mask.pop(this,this._mask),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(e){t.prototype.destroy.call(this),this.sortDirty=!1;var n="boolean"==typeof e?e:e&&e.children,r=this.removeChildren(0,this.children.length);if(n)for(var i=0;i<r.length;++i)r[i].destroy(e)},n.width.get=function(){return this.scale.x*this.getLocalBounds().width},n.width.set=function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},n.height.get=function(){return this.scale.y*this.getLocalBounds().height},n.height.set=function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},Object.defineProperties(e.prototype,n),e}(ne);ie.prototype.containerUpdateTransform=ie.prototype.updateTransform,ne.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0});var oe,ae=function(t){this._hookDiv=null,(G.tablet||G.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2,this.div=e,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessibility=!1,window.addEventListener("keydown",this._onKeyDown,!1)};ae.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2,e.style.backgroundColor="#FF0000",e.title="HOOK DIV",e.addEventListener("focus",(function(){t.isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e},ae.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},ae.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},ae.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessibility&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},ae.prototype.updateAccessibleObjects=function(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,n=0;n<e.length;n++)this.updateAccessibleObjects(e[n])}},ae.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),e=t.width/this.renderer.width,n=t.height/this.renderer.height,r=this.div;r.style.left=t.left+"px",r.style.top=t.top+"px",r.style.width=this.renderer.width+"px",r.style.height=this.renderer.height+"px";for(var i=0;i<this.children.length;i++){var o=this.children[i];if(o.renderId!==this.renderId)o._accessibleActive=!1,yt(this.children,i,1),this.div.removeChild(o._accessibleDiv),this.pool.push(o._accessibleDiv),o._accessibleDiv=null,i--,0===this.children.length&&this.deactivate();else{r=o._accessibleDiv;var a=o.hitArea,s=o.worldTransform;o.hitArea?(r.style.left=(s.tx+a.x*s.a)*e+"px",r.style.top=(s.ty+a.y*s.d)*n+"px",r.style.width=a.width*s.a*e+"px",r.style.height=a.height*s.d*n+"px"):(a=o.getBounds(),this.capHitArea(a),r.style.left=a.x*e+"px",r.style.top=a.y*n+"px",r.style.width=a.width*e+"px",r.style.height=a.height*n+"px",r.title!==o.accessibleTitle&&null!==o.accessibleTitle&&(r.title=o.accessibleTitle),r.getAttribute("aria-label")!==o.accessibleHint&&null!==o.accessibleHint&&r.setAttribute("aria-label",o.accessibleHint)),o.accessibleTitle===r.title&&o.tabIndex===r.tabIndex||(r.title=o.accessibleTitle,r.tabIndex=o.tabIndex,this.debug&&this.updateDebugHTML(r))}}this.renderId++}},ae.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},ae.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},ae.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2,e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},ae.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData),e.dispatchEvent(t.target.displayObject,"pointertap",e.eventData),e.dispatchEvent(t.target.displayObject,"tap",e.eventData)},ae.prototype._onFocus=function(t){t.target.getAttribute("aria-live","off")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},ae.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live","off")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},ae.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},ae.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},ae.prototype.destroy=function(){this.destroyTouchHook(),this.div=null;for(var t=0;t<this.children.length;t++)this.children[t].div=null;window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},H.TARGET_FPMS=.06,function(t){t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY"}(oe||(oe={}));var se=function(){function t(t,e,n,r){void 0===e&&(e=null),void 0===n&&(n=0),void 0===r&&(r=!1),this.fn=t,this.context=e,this.priority=n,this.once=r,this.next=null,this.previous=null,this._destroyed=!1}return t.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},t}(),ue=function(){function t(){var t=this;this._head=new se(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/H.TARGET_FPMS,this.elapsedMS=1/H.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._lastFrame=-1,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return t.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(t,e,n){return void 0===n&&(n=oe.NORMAL),this._addListener(new se(t,e,n))},t.prototype.addOnce=function(t,e,n){return void 0===n&&(n=oe.NORMAL),this._addListener(new se(t,e,n,!0))},t.prototype._addListener=function(t){var e=this._head.next,n=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}else t.connect(n);return this._startIfPossible(),this},t.prototype.remove=function(t,e){for(var n=this._head.next;n;)n=n.match(t,e)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(t.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},t.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*H.TARGET_FPMS;for(var r=this._head,i=r.next;i;)i=i.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(t.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),n=Math.min(Math.max(0,e)/1e3,H.TARGET_FPMS);this._maxElapsedMS=1/n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"shared",{get:function(){if(!t._shared){var e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared},enumerable:!0,configurable:!0}),Object.defineProperty(t,"system",{get:function(){if(!t._system){var e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system},enumerable:!0,configurable:!0}),t}(),ce=function(){function t(){}return t.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,oe.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?ue.shared:new ue,t.autoStart&&this.start()},t.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},t}(),le=function(){this.global=new jt,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0},he={pointerId:{configurable:!0}};he.pointerId.get=function(){return this.identifier},le.prototype.getLocalPosition=function(t,e,n){return t.worldTransform.applyInverse(n||this.global,e)},le.prototype.copyEvent=function(t){t.isPrimary&&(this.isPrimary=!0),this.button=t.button,this.buttons=Number.isInteger(t.buttons)?t.buttons:t.which,this.width=t.width,this.height=t.height,this.tiltX=t.tiltX,this.tiltY=t.tiltY,this.pointerType=t.pointerType,this.pressure=t.pressure,this.rotationAngle=t.rotationAngle,this.twist=t.twist||0,this.tangentialPressure=t.tangentialPressure||0},le.prototype.reset=function(){this.isPrimary=!1},Object.defineProperties(le.prototype,he);var de=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null};de.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},de.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null};var fe=function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE},pe={pointerId:{configurable:!0},flags:{configurable:!0},none:{configurable:!0},over:{configurable:!0},rightDown:{configurable:!0},leftDown:{configurable:!0}};fe.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},pe.pointerId.get=function(){return this._pointerId},pe.flags.get=function(){return this._flags},pe.flags.set=function(t){this._flags=t},pe.none.get=function(){return this._flags===this.constructor.FLAGS.NONE},pe.over.get=function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},pe.over.set=function(t){this._doSet(this.constructor.FLAGS.OVER,t)},pe.rightDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},pe.rightDown.set=function(t){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,t)},pe.leftDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},pe.leftDown.set=function(t){this._doSet(this.constructor.FLAGS.LEFT_DOWN,t)},Object.defineProperties(fe.prototype,pe),fe.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4});var me=function(){this._tempPoint=new jt};me.prototype.recursiveFindHit=function(t,e,n,r,i){if(!e||!e.visible)return!1;var o=t.data.global,a=!1,s=i=e.interactive||i,u=!0;if(e.hitArea?(r&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?a=!0:(r=!1,u=!1)),s=!1):e._mask&&r&&(e._mask.containsPoint&&e._mask.containsPoint(o)||(r=!1)),u&&e.interactiveChildren&&e.children)for(var c=e.children,l=c.length-1;l>=0;l--){var h=c[l],d=this.recursiveFindHit(t,h,n,r,s);if(d){if(!h.parent)continue;s=!1,d&&(t.target&&(r=!1),a=!0)}}return i&&(r&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(a=!0),e.interactive&&(a&&!t.target&&(t.target=e),n&&n(t,e,!!a))),a},me.prototype.findHit=function(t,e,n,r){this.recursiveFindHit(t,e,n,r,!1)};var ye={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};ne.mixin(ye);var ge={target:null,data:{global:null}},ve=function(t){function e(e,n){t.call(this),n=n||{},this.renderer=e,this.autoPreventDefault=void 0===n.autoPreventDefault||n.autoPreventDefault,this.interactionFrequency=n.interactionFrequency||10,this.mouse=new le,this.mouse.identifier=1,this.mouse.global.set(-999999),this.activeInteractionData={},this.activeInteractionData[1]=this.mouse,this.interactionDataPool=[],this.eventData=new de,this.interactionDOMElement=null,this.moveWhenInside=!1,this.eventsAdded=!1,this.tickerAdded=!1,this.mouseOverRenderer=!1,this.supportsTouchEvents="ontouchstart"in window,this.supportsPointerEvents=!!window.PointerEvent,this.onPointerUp=this.onPointerUp.bind(this),this.processPointerUp=this.processPointerUp.bind(this),this.onPointerCancel=this.onPointerCancel.bind(this),this.processPointerCancel=this.processPointerCancel.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.processPointerDown=this.processPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.processPointerMove=this.processPointerMove.bind(this),this.onPointerOut=this.onPointerOut.bind(this),this.processPointerOverOut=this.processPointerOverOut.bind(this),this.onPointerOver=this.onPointerOver.bind(this),this.cursorStyles={default:"inherit",pointer:"pointer"},this.currentCursorMode=null,this.cursor=null,this.resolution=1,this.delayedEvents=[],this.search=new me,this._useSystemTicker=void 0===n.useSystemTicker||n.useSystemTicker,this.setTargetElement(this.renderer.view,this.renderer.resolution)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={useSystemTicker:{configurable:!0}};return n.useSystemTicker.get=function(){return this._useSystemTicker},n.useSystemTicker.set=function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},e.prototype.hitTest=function(t,e){return ge.target=null,ge.data.global=t,e||(e=this.renderer._lastObjectRendered),this.processInteractive(ge,e,null,!0),ge.target},e.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents(),this.addTickerListener()},e.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(ue.system.add(this.tickerUpdate,this,oe.INTERACTION),this.tickerAdded=!0)},e.prototype.removeTickerListener=function(){this.tickerAdded&&(ue.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},e.prototype.addEvents=function(){!this.eventsAdded&&this.interactionDOMElement&&(window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},e.prototype.removeEvents=function(){this.eventsAdded&&this.interactionDOMElement&&(window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},e.prototype.tickerUpdate=function(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},e.prototype.update=function(){if(this.interactionDOMElement)if(this.didMove)this.didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var e=this.activeInteractionData[t];if(e.originalEvent&&"touch"!==e.pointerType){var n=this.configureInteractionEventForDOMEvent(this.eventData,e.originalEvent,e);this.processInteractive(n,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){if(t=t||"default",this.currentCursorMode!==t){this.currentCursorMode=t;var e=this.cursorStyles[t];if(e)switch(typeof e){case"string":this.interactionDOMElement.style.cursor=e;break;case"function":e(t);break;case"object":Object.assign(this.interactionDOMElement.style,e)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,e,n){n.stopPropagationHint&&t!==n.stopsPropagatingAt||(n.currentTarget=t,n.type=e,t.emit(e,n),t[e]&&t[e](n))},e.prototype.delayDispatchEvent=function(t,e,n){this.delayedEvents.push({displayObject:t,eventString:e,eventData:n})},e.prototype.mapPositionToPoint=function(t,e,n){var r;r=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var i=1/this.resolution;t.x=(e-r.left)*(this.interactionDOMElement.width/r.width)*i,t.y=(n-r.top)*(this.interactionDOMElement.height/r.height)*i},e.prototype.processInteractive=function(t,e,n,r){var i=this.search.findHit(t,e,n,r),o=this.delayedEvents;if(!o.length)return i;t.stopPropagationHint=!1;var a=o.length;this.delayedEvents=[];for(var s=0;s<a;s++){var u=o[s],c=u.displayObject,l=u.eventString,h=u.eventData;h.stopsPropagatingAt===c&&(h.stopPropagationHint=!0),this.dispatchEvent(c,l,h)}return i},e.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var n=e.length,r=0;r<n;r++){var i=e[r],o=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,o);if(a.data.originalEvent=t,this.processInteractive(a,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",a),"touch"===i.pointerType)this.emit("touchstart",a);else if("mouse"===i.pointerType||"pen"===i.pointerType){var s=2===i.button;this.emit(s?"rightdown":"mousedown",this.eventData)}}}},e.prototype.processPointerDown=function(t,e,n){var r=t.data,i=t.data.identifier;if(n)if(e.trackedPointers[i]||(e.trackedPointers[i]=new fe(i)),this.dispatchEvent(e,"pointerdown",t),"touch"===r.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===r.pointerType||"pen"===r.pointerType){var o=2===r.button;o?e.trackedPointers[i].rightDown=!0:e.trackedPointers[i].leftDown=!0,this.dispatchEvent(e,o?"rightdown":"mousedown",t)}},e.prototype.onPointerComplete=function(t,e,n){for(var r=this.normalizeToPointerData(t),i=r.length,o=t.target!==this.interactionDOMElement?"outside":"",a=0;a<i;a++){var s=r[a],u=this.getInteractionDataForPointerId(s),c=this.configureInteractionEventForDOMEvent(this.eventData,s,u);if(c.data.originalEvent=t,this.processInteractive(c,this.renderer._lastObjectRendered,n,e||!o),this.emit(e?"pointercancel":"pointerup"+o,c),"mouse"===s.pointerType||"pen"===s.pointerType){var l=2===s.button;this.emit(l?"rightup"+o:"mouseup"+o,c)}else"touch"===s.pointerType&&(this.emit(e?"touchcancel":"touchend"+o,c),this.releaseInteractionDataForPointerId(s.pointerId,u))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,e){var n=t.data,r=t.data.identifier;void 0!==e.trackedPointers[r]&&(delete e.trackedPointers[r],this.dispatchEvent(e,"pointercancel",t),"touch"===n.pointerType&&this.dispatchEvent(e,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,e,n){var r=t.data,i=t.data.identifier,o=e.trackedPointers[i],a="touch"===r.pointerType,s="mouse"===r.pointerType||"pen"===r.pointerType,u=!1;if(s){var c=2===r.button,l=fe.FLAGS,h=c?l.RIGHT_DOWN:l.LEFT_DOWN,d=void 0!==o&&o.flags&h;n?(this.dispatchEvent(e,c?"rightup":"mouseup",t),d&&(this.dispatchEvent(e,c?"rightclick":"click",t),u=!0)):d&&this.dispatchEvent(e,c?"rightupoutside":"mouseupoutside",t),o&&(c?o.rightDown=!1:o.leftDown=!1)}n?(this.dispatchEvent(e,"pointerup",t),a&&this.dispatchEvent(e,"touchend",t),o&&(s&&!u||this.dispatchEvent(e,"pointertap",t),a&&(this.dispatchEvent(e,"tap",t),o.over=!1))):o&&(this.dispatchEvent(e,"pointerupoutside",t),a&&this.dispatchEvent(e,"touchendoutside",t)),o&&o.none&&delete e.trackedPointers[i]},e.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this.didMove=!0,this.cursor=null);for(var n=e.length,r=0;r<n;r++){var i=e[r],o=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,o);a.data.originalEvent=t,this.processInteractive(a,this.renderer._lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",a),"touch"===i.pointerType&&this.emit("touchmove",a),"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit("mousemove",a)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,e,n){var r=t.data,i="touch"===r.pointerType,o="mouse"===r.pointerType||"pen"===r.pointerType;o&&this.processPointerOverOut(t,e,n),this.moveWhenInside&&!n||(this.dispatchEvent(e,"pointermove",t),i&&this.dispatchEvent(e,"touchmove",t),o&&this.dispatchEvent(e,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var n=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,n);r.data.originalEvent=e,this.processInteractive(r,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",r),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",r):this.releaseInteractionDataForPointerId(n.identifier)}},e.prototype.processPointerOverOut=function(t,e,n){var r=t.data,i=t.data.identifier,o="mouse"===r.pointerType||"pen"===r.pointerType,a=e.trackedPointers[i];n&&!a&&(a=e.trackedPointers[i]=new fe(i)),void 0!==a&&(n&&this.mouseOverRenderer?(a.over||(a.over=!0,this.delayDispatchEvent(e,"pointerover",t),o&&this.delayDispatchEvent(e,"mouseover",t)),o&&null===this.cursor&&(this.cursor=e.cursor)):a.over&&(a.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),o&&this.dispatchEvent(e,"mouseout",t),a.none&&delete e.trackedPointers[i]))},e.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],n=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,n);r.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",r),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",r)},e.prototype.getInteractionDataForPointerId=function(t){var e,n=t.pointerId;return 1===n||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[n]?e=this.activeInteractionData[n]:((e=this.interactionDataPool.pop()||new le).identifier=n,this.activeInteractionData[n]=e),e.copyEvent(t),e},e.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},e.prototype.configureInteractionEventForDOMEvent=function(t,e,n){return t.data=n,this.mapPositionToPoint(n.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=n.global.x,e.globalY=n.global.y),n.originalEvent=e,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var n=0,r=t.changedTouches.length;n<r;n++){var i=t.changedTouches[n];void 0===i.button&&(i.button=t.touches.length?1:0),void 0===i.buttons&&(i.buttons=t.touches.length?1:0),void 0===i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,e.push(i)}else!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent?e.push(t):(void 0===t.isPrimary&&(t.isPrimary=!0),void 0===t.width&&(t.width=1),void 0===t.height&&(t.height=1),void 0===t.tiltX&&(t.tiltX=0),void 0===t.tiltY&&(t.tiltY=0),void 0===t.pointerType&&(t.pointerType="mouse"),void 0===t.pointerId&&(t.pointerId=1),void 0===t.pressure&&(t.pressure=.5),void 0===t.twist&&(t.twist=0),void 0===t.tangentialPressure&&(t.tangentialPressure=0),t.isNormalized=!0,e.push(t));return e},e.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},Object.defineProperties(e.prototype,n),e}(X.a),_e=function(){function t(t){this.items=[],this._name=t,this._aliasCount=0}return t.prototype.emit=function(t,e,n,r,i,o,a,s){if(arguments.length>8)throw new Error("max arguments reached");var u=this,c=u.name,l=u.items;this._aliasCount++;for(var h=0,d=l.length;h<d;h++)l[h][c](t,e,n,r,i,o,a,s);return l===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},t.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},t.prototype.contains=function(t){return-1!==this.items.indexOf(t)},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),t}();Object.defineProperties(_e.prototype,{dispatch:{value:_e.prototype.emit},run:{value:_e.prototype.emit}});var be=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new _e("setRealSize",2),this.onUpdate=new _e("update"),this.onError=new _e("onError",1)},xe={valid:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};be.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.run(this._width,this._height)},be.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},be.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.run(t,e))},xe.valid.get=function(){return!!this._width&&!!this._height},be.prototype.update=function(){this.destroyed||this.onUpdate.run()},be.prototype.load=function(){return Promise.resolve()},xe.width.get=function(){return this._width},xe.height.get=function(){return this._height},be.prototype.upload=function(t,e,n){return!1},be.prototype.style=function(t,e,n){return!1},be.prototype.dispose=function(){},be.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},Object.defineProperties(be.prototype,xe);var we=function(t){function e(e){var n=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;t.call(this,n,r),this.source=e,this.noSubImage=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.crossOrigin=function(t,e,n){void 0===n&&0!==e.indexOf("data:")?t.crossOrigin=Mt(e):!1!==n&&(t.crossOrigin="string"==typeof n?n:"anonymous")},e.prototype.upload=function(t,e,n,r){var i=t.gl,o=e.realWidth,a=e.realHeight;return r=r||this.source,i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===L.UNPACK),this.noSubImage||e.target!==i.TEXTURE_2D||n.width!==o||n.height!==a?(n.width=o,n.height=a,i.texImage2D(e.target,0,e.format,e.format,e.type,r)):i.texSubImage2D(i.TEXTURE_2D,0,0,0,e.format,e.type,r),!0},e.prototype.update=function(){if(!this.destroyed){var e=this.source.naturalWidth||this.source.videoWidth||this.source.width,n=this.source.naturalHeight||this.source.videoHeight||this.source.height;this.resize(e,n),t.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e}(be),Ee=function(t){function e(e,n){if(n=n||{},!(e instanceof HTMLImageElement)){var r=new Image;t.crossOrigin(r,e,n.crossorigin),r.src=e,e=r}t.call(this,e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(void 0!==n.createBitmap?n.createBitmap:H.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,this.alphaMode="number"==typeof n.alphaMode?n.alphaMode:null,void 0!==n.premultiplyAlpha&&(this.premultiplyAlpha=n.premultiplyAlpha),this.bitmap=null,this._load=null,!1!==n.autoLoad&&this.load()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t){var e=this;return void 0!==t&&(this.createBitmap=t),this._load?this._load:(this._load=new Promise((function(t){e.url=e.source.src;var n=e.source,r=function(){e.destroyed||(n.onload=null,n.onerror=null,e.resize(n.width,n.height),e._load=null,e.createBitmap?t(e.process()):t(e))};n.complete&&n.src?r():(n.onload=r,n.onerror=function(t){return e.onError.run(t)})})),this._load)},e.prototype.process=function(){var t=this;return null!==this._process?this._process:null===this.bitmap&&window.createImageBitmap?(this._process=window.createImageBitmap(this.source,0,0,this.source.width,this.source.height,{premultiplyAlpha:this.premultiplyAlpha===L.UNPACK?"premultiply":"none"}).then((function(e){return t.destroyed?Promise.reject():(t.bitmap=e,t.update(),t._process=null,Promise.resolve(t))})),this._process):Promise.resolve(this)},e.prototype.upload=function(e,n,r){if("number"==typeof this.alphaMode&&(n.alphaMode=this.alphaMode),!this.createBitmap)return t.prototype.upload.call(this,e,n,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(t.prototype.upload.call(this,e,n,r,this.bitmap),!this.preserveBitmap){var i=!0;for(var o in n._glTextures){var a=n._glTextures[o];if(a!==r&&a.dirtyId!==n.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,t.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e}(we),Te=[];function Oe(t,e){if(!t)return null;var n="";if("string"==typeof t){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(n=r[1].toLowerCase())}for(var i=Te.length-1;i>=0;--i){var o=Te[i];if(o.test&&o.test(t,n))return new o(t,e)}return new Ee(t,e)}var Ae=function(t){function e(e,n){var r=n||{},i=r.width,o=r.height;if(!i||!o)throw new Error("BufferResource width or height invalid");t.call(this,i,o),this.data=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.upload=function(t,e,n){var r=t.gl;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===L.UNPACK),n.width===e.width&&n.height===e.height?r.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.type,this.data):(n.width=e.width,n.height=e.height,r.texImage2D(e.target,0,n.internalFormat,e.width,e.height,0,e.format,n.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e}(be),Se={scaleMode:k.NEAREST,format:R.RGBA,alphaMode:L.NPM},Ie=function(t){function e(e,n){void 0===e&&(e=null),void 0===n&&(n=null),t.call(this);var r=(n=n||{}).alphaMode,i=n.mipmap,o=n.anisotropicLevel,a=n.scaleMode,s=n.width,u=n.height,c=n.wrapMode,l=n.format,h=n.type,d=n.target,f=n.resolution,p=n.resourceOptions;!e||e instanceof be||((e=Oe(e,p)).internal=!0),this.width=s||0,this.height=u||0,this.resolution=f||H.RESOLUTION,this.mipmap=void 0!==i?i:H.MIPMAP_TEXTURES,this.anisotropicLevel=void 0!==o?o:H.ANISOTROPIC_LEVEL,this.wrapMode=c||H.WRAP_MODE,this.scaleMode=void 0!==a?a:H.SCALE_MODE,this.format=l||R.RGBA,this.type=h||D.UNSIGNED_BYTE,this.target=d||M.TEXTURE_2D,this.alphaMode=void 0!==r?r:L.UNPACK,void 0!==n.premultiplyAlpha&&(this.premultiplyAlpha=n.premultiplyAlpha),this.uid=_t(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=s>0&&u>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.setResource(e)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={realWidth:{configurable:!0},realHeight:{configurable:!0}};return n.realWidth.get=function(){return Math.ceil(this.width*this.resolution-1e-4)},n.realHeight.get=function(){return Math.ceil(this.height*this.resolution-1e-4)},e.prototype.setStyle=function(t,e){var n;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,n=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,n=!0),n&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,e,n){return this.resolution=n||this.resolution,this.width=t,this.height=e,this._refreshPOT(),this.update(),this},e.prototype.setRealSize=function(t,e,n){return this.resolution=n||this.resolution,this.width=t/this.resolution,this.height=e/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=pt(this.realWidth)&&pt(this.realHeight)},e.prototype.setResolution=function(t){var e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=this.width*e/t,this.height=this.height*e/t,this.emit("update",this)),this._refreshPOT(),this)},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(t){this.emit("error",this,t)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Tt[this.cacheId],delete Et[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.from=function(t,n,r){void 0===r&&(r=H.STRICT_TEXTURE_CACHE);var i="string"==typeof t,o=null;i?o=t:(t._pixiId||(t._pixiId="pixiid_"+_t()),o=t._pixiId);var a=Tt[o];if(i&&r&&!a)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return a||((a=new e(t,n)).cacheId=o,e.addToCache(a,o)),a},e.fromBuffer=function(t,n,r,i){t=t||new Float32Array(n*r*4);var o=new Ae(t,{width:n,height:r}),a=t instanceof Float32Array?D.FLOAT:D.UNSIGNED_BYTE;return new e(o,Object.assign(Se,i||{width:n,height:r,type:a}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Tt[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),Tt[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=Tt[t];if(e){var n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Tt[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)delete Tt[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},Object.defineProperties(e.prototype,n),e}(X.a);Ie._globalBatch=0;var Pe=function(t){function e(e,n){var r;n=n||{};var i=e;Array.isArray(e)&&(r=e,i=e.length),t.call(this,n.width,n.height),this.items=[],this.itemDirtyIds=[];for(var o=0;o<i;o++){var a=new Ie;this.items.push(a),this.itemDirtyIds.push(-1)}if(this.length=i,this._load=null,r)for(var s=0;s<i;s++)this.addResourceAt(Oe(r[s],n),s)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=M.TEXTURE_2D_ARRAY;for(var n=0;n<this.length;n++)this.items[n].on("update",e.update,e)},e.prototype.unbind=function(e){t.prototype.unbind.call(this,e);for(var n=0;n<this.length;n++)this.items[n].off("update",e.update,e)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map((function(t){return t.resource})),n=e.map((function(t){return t.load()}));return this._load=Promise.all(n).then((function(){var n=e[0],r=n.width,i=n.height;return t.resize(r,i),Promise.resolve(t)})),this._load},e.prototype.upload=function(t,e,n){var r=this.length,i=this.itemDirtyIds,o=this.items,a=t.gl;n.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,e.format,this._width,this._height,r,0,e.format,e.type,null);for(var s=0;s<r;s++){var u=o[s];i[s]<u.dirtyId&&(i[s]=u.dirtyId,u.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,s,u.resource.width,u.resource.height,1,e.format,e.type,u.resource.source))}return!0},e}(be),Ce=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.test=function(t){var e=window.OffscreenCanvas;return!!(e&&t instanceof e)||t instanceof HTMLCanvasElement},e}(we),Re=function(t){function e(n,r){if(r=r||{},t.call(this,n,r),this.length!==e.SIDES)throw new Error("Invalid length. Got "+this.length+", expected 6");for(var i=0;i<e.SIDES;i++)this.items[i].target=M.TEXTURE_CUBE_MAP_POSITIVE_X+i;!1!==r.autoLoad&&this.load()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=M.TEXTURE_CUBE_MAP},e.prototype.upload=function(t,n,r){for(var i=this.itemDirtyIds,o=0;o<e.SIDES;o++){var a=this.items[o];i[o]<a.dirtyId&&(i[o]=a.dirtyId,a.valid&&a.resource.upload(t,a,r))}return!0},e}(Pe);Re.SIDES=6;var Me=function(t){function e(e,n){n=n||{},t.call(this,document.createElement("canvas")),this._width=0,this._height=0,this.svg=e,this.scale=n.scale||1,this._overrideWidth=n.width,this._overrideHeight=n.height,this._resolve=null,this._crossorigin=n.crossorigin,this._load=null,!1!==n.autoLoad&&this.load()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;return this._load?this._load:(this._load=new Promise((function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()})),this._load)},e.prototype._loadSvg=function(){var e=this,n=new Image;t.crossOrigin(n,this.svg,this._crossorigin),n.src=this.svg,n.onerror=function(t){n.onerror=null,e.onError.run(t)},n.onload=function(){var t=n.width,r=n.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var i=t*e.scale,o=r*e.scale;(e._overrideWidth||e._overrideHeight)&&(i=e._overrideWidth||e._overrideHeight/r*t,o=e._overrideHeight||e._overrideWidth/t*r),i=Math.round(i),o=Math.round(o);var a=e.source;a.width=i,a.height=o,a._pixiId="canvas_"+_t(),a.getContext("2d").drawImage(n,0,0,t,r,0,0,i,o),e._resolve(),e._resolve=null}},e.getSize=function(t){var n=e.SVG_SIZE.exec(t),r={};return n&&(r[n[1]]=Math.round(parseFloat(n[3])),r[n[5]]=Math.round(parseFloat(n[7]))),r},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,e){return"svg"===e||"string"==typeof t&&0===t.indexOf("data:image/svg+xml;base64")||"string"==typeof t&&0===t.indexOf("<svg")},e}(we);Me.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var De=function(t){function e(e,n){if(n=n||{},!(e instanceof HTMLVideoElement)){var r=document.createElement("video");r.setAttribute("preload","auto"),r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline",""),"string"==typeof e&&(e=[e]),t.crossOrigin(r,e[0].src||e[0],n.crossorigin);for(var i=0;i<e.length;++i){var o=document.createElement("source"),a=e[i],s=a.src,u=a.mime,c=(s=s||e[i]).split("?").shift().toLowerCase(),l=c.substr(c.lastIndexOf(".")+1);u=u||"video/"+l,o.src=s,o.type=u,r.appendChild(o)}e=r}t.call(this,e),this.noSubImage=!0,this._autoUpdate=!0,this._isAutoUpdating=!1,this._updateFPS=n.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==n.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==n.autoLoad&&this.load()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={autoUpdate:{configurable:!0},updateFPS:{configurable:!0}};return e.prototype.update=function(e){if(void 0===e&&(e=0),!this.destroyed){var n=ue.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-n),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this,e),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((function(n){t.valid?n(t):(t._resolve=n,e.load())})),this._load},e.prototype._onError=function(){this.source.removeEventListener("error",this._onError,!0),this.onError.run(event)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){return 3===this.source.readyState||4===this.source.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),!this._isAutoUpdating&&this.autoUpdate&&(ue.shared.add(this.update,this),this._isAutoUpdating=!0)},e.prototype._onPlayStop=function(){this._isAutoUpdating&&(ue.shared.remove(this.update,this),this._isAutoUpdating=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isAutoUpdating&&ue.shared.remove(this.update,this),this.source&&(this.source.removeEventListener("error",this._onError,!0),this.source.pause(),this.source.src="",this.source.load()),t.prototype.dispose.call(this)},n.autoUpdate.get=function(){return this._autoUpdate},n.autoUpdate.set=function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isAutoUpdating?(ue.shared.remove(this.update,this),this._isAutoUpdating=!1):this._autoUpdate&&!this._isAutoUpdating&&(ue.shared.add(this.update,this),this._isAutoUpdating=!0))},n.updateFPS.get=function(){return this._updateFPS},n.updateFPS.set=function(t){t!==this._updateFPS&&(this._updateFPS=t)},e.test=function(t,n){return t instanceof HTMLVideoElement||e.TYPES.indexOf(n)>-1},Object.defineProperties(e.prototype,n),e}(we);De.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];var ke=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.test=function(t){return!!window.createImageBitmap&&t instanceof ImageBitmap},e}(we);Te.push(Ee,ke,Ce,De,Me,Ae,Re,Pe);var je=function(t){this.renderer=t};je.prototype.destroy=function(){this.renderer=null};var Ne=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.upload=function(t,e,n){var r=t.gl;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===L.UNPACK),n.width===e.width&&n.height===e.height?r.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.type,this.data):(n.width=e.width,n.height=e.height,r.texImage2D(e.target,0,r.DEPTH_COMPONENT16,e.width,e.height,0,e.format,e.type,this.data)),!0},e}(Ae),Le=function(t,e){this.width=Math.ceil(t||100),this.height=Math.ceil(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new _e("disposeFramebuffer",2)},Be={colorTexture:{configurable:!0}};Be.colorTexture.get=function(){return this.colorTextures[0]},Le.prototype.addColorTexture=function(t,e){return void 0===t&&(t=0),this.colorTextures[t]=e||new Ie(null,{scaleMode:0,resolution:1,mipmap:!1,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},Le.prototype.addDepthTexture=function(t){return this.depthTexture=t||new Ie(new Ne(null,{width:this.width,height:this.height}),{scaleMode:0,resolution:1,width:this.width,height:this.height,mipmap:!1,format:R.DEPTH_COMPONENT,type:D.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},Le.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},Le.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},Le.prototype.resize=function(t,e){if(t=Math.ceil(t),e=Math.ceil(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var n=0;n<this.colorTextures.length;n++){var r=this.colorTextures[n],i=r.resolution;r.setSize(t/i,e/i)}if(this.depthTexture){var o=this.depthTexture.resolution;this.depthTexture.setSize(t/o,e/o)}}},Le.prototype.dispose=function(){this.disposeRunner.run(this,!1)},Object.defineProperties(Le.prototype,Be);var Fe=function(t){function e(e){if("number"==typeof e){var n=arguments[0],r=arguments[1],i=arguments[2],o=arguments[3];e={width:n,height:r,scaleMode:i,resolution:o}}t.call(this,null,e);var a=e||{},s=a.width,u=a.height;this.mipmap=!1,this.width=Math.ceil(s)||100,this.height=Math.ceil(u)||100,this.valid=!0,this._canvasRenderTarget=null,this.clearColor=[0,0,0,0],this.framebuffer=new Le(this.width*this.resolution,this.height*this.resolution).addColorTexture(0,this),this.maskStack=[],this.filterStack=[{}]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),this.framebuffer.resize(t*this.resolution,e*this.resolution)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this,!0),this.framebuffer=null},e}(Ie),Ue=function(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)};Ue.prototype.set=function(t,e,n){var r=e.width,i=e.height;if(n){var o=t.width/2/r,a=t.height/2/i,s=t.x/r+o,u=t.y/i+a;n=qt.add(n,qt.NW),this.x0=s+o*qt.uX(n),this.y0=u+a*qt.uY(n),n=qt.add(n,2),this.x1=s+o*qt.uX(n),this.y1=u+a*qt.uY(n),n=qt.add(n,2),this.x2=s+o*qt.uX(n),this.y2=u+a*qt.uY(n),n=qt.add(n,2),this.x3=s+o*qt.uX(n),this.y3=u+a*qt.uY(n)}else this.x0=t.x/r,this.y0=t.y/i,this.x1=(t.x+t.width)/r,this.y1=t.y/i,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/i,this.x3=t.x/r,this.y3=(t.y+t.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3};var Ge=new Ue,He=function(t){function e(n,r,i,o,a,s){if(t.call(this),this.noFrame=!1,r||(this.noFrame=!0,r=new Kt(0,0,1,1)),n instanceof e&&(n=n.baseTexture),this.baseTexture=n,this._frame=r,this.trim=o,this.valid=!1,this.requiresUpdate=!1,this._uvs=Ge,this.uvMatrix=null,this.orig=i||r,this._rotate=Number(a||0),!0===a)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=s?new jt(s.x,s.y):new jt(0,0),this._updateID=0,this.textureCacheIds=[],n.valid?this.noFrame?n.valid&&this.onBaseTextureUpdated(n):this.frame=r:n.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&n.on("update",this.onBaseTextureUpdated,this)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={resolution:{configurable:!0},frame:{configurable:!0},rotate:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var n=this.baseTexture.resource;n&&Et[n.url]&&e.removeFromCache(n.url),this.baseTexture.destroy()}this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){return new e(this.baseTexture,this.frame,this.orig,this.trim,this.rotate,this.defaultAnchor)},e.prototype.updateUvs=function(){this._uvs===Ge&&(this._uvs=new Ue),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,n,r){void 0===n&&(n={}),void 0===r&&(r=H.STRICT_TEXTURE_CACHE);var i="string"==typeof t,o=null;i?o=t:(t._pixiId||(t._pixiId="pixiid_"+_t()),o=t._pixiId);var a=Et[o];if(i&&r&&!a)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return a||(n.resolution||(n.resolution=Dt(t)),(a=new e(new Ie(t,n))).baseTexture.cacheId=o,Ie.addToCache(a.baseTexture,o),e.addToCache(a,o)),a},e.fromBuffer=function(t,n,r,i){return new e(Ie.fromBuffer(t,n,r,i))},e.fromLoader=function(t,n,r){var i=new Ee(t);i.url=n;var o=new e(new Ie(i,{scaleMode:H.SCALE_MODE,resolution:Dt(n)}));return r||(r=n),Ie.addToCache(o.baseTexture,r),e.addToCache(o,r),r!==n&&(Ie.addToCache(o.baseTexture,n),e.addToCache(o,n)),o},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Et[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),Et[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=Et[t];if(e){var n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Et[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)Et[t.textureCacheIds[r]]===t&&delete Et[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},n.resolution.get=function(){return this.baseTexture.resolution},n.frame.get=function(){return this._frame},n.frame.set=function(t){this._frame=t,this.noFrame=!1;var e=t.x,n=t.y,r=t.width,i=t.height,o=e+r>this.baseTexture.width,a=n+i>this.baseTexture.height;if(o||a){var s=o&&a?"and":"or",u="X: "+e+" + "+r+" = "+(e+r)+" > "+this.baseTexture.width,c="Y: "+n+" + "+i+" = "+(n+i)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+u+" "+s+" "+c)}this.valid=r&&i&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},n.rotate.get=function(){return this._rotate},n.rotate.set=function(t){this._rotate=t,this.valid&&this.updateUvs()},n.width.get=function(){return this.orig.width},n.height.get=function(){return this.orig.height},Object.defineProperties(e.prototype,n),e}(X.a);function ze(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}He.EMPTY=new He(new Ie),ze(He.EMPTY),ze(He.EMPTY.baseTexture),He.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new He(new Ie(new Ce(t)))}(),ze(He.WHITE),ze(He.WHITE.baseTexture);var Xe=function(t){function e(e,n){var r=null;if(!(e instanceof Fe)){var i=arguments[1],o=arguments[2],a=arguments[3],s=arguments[4];console.warn("Please use RenderTexture.create("+i+", "+o+") instead of the ctor directly."),r=arguments[0],n=null,e=new Fe({width:i,height:o,scaleMode:a,resolution:s})}t.call(this,e,n),this.legacyRenderer=r,this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.resize=function(t,e,n){void 0===n&&(n=!0),t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,n&&this.baseTexture.resize(t,e),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){return"number"==typeof t&&(t={width:t,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),new e(new Fe(t))},e}(He),Ve=function(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0};Ve.prototype.createTexture=function(t,e){var n=new Fe(Object.assign({width:t,height:e,resolution:1},this.textureOptions));return new Xe(n)},Ve.prototype.getOptimalTexture=function(t,e,n){void 0===n&&(n=1);var r=Ve.SCREEN_KEY;t*=n,e*=n,this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight||(r=(65535&(t=ft(t)))<<16|65535&(e=ft(e))),this.texturePool[r]||(this.texturePool[r]=[]);var i=this.texturePool[r].pop();return i||(i=this.createTexture(t,e)),i.filterPoolKey=r,i.setResolution(n),i},Ve.prototype.getFilterTexture=function(t,e){var n=this.getOptimalTexture(t.width,t.height,e||t.resolution);return n.filterFrame=t.filterFrame,n},Ve.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},Ve.prototype.returnFilterTexture=function(t){this.returnTexture(t)},Ve.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var n=this.texturePool[e];if(n)for(var r=0;r<n.length;r++)n[r].destroy(!0)}this.texturePool={}},Ve.prototype.setScreenSize=function(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){var e=Ve.SCREEN_KEY,n=this.texturePool[e];if(this.enableFullScreen=t.width>0&&t.height>0,n)for(var r=0;r<n.length;r++)n[r].destroy(!0);this.texturePool[e]=[],this._pixelsWidth=t.width,this._pixelsHeight=t.height}},Ve.SCREEN_KEY="screen";var Ye=function(t,e,n,r,i,o,a){void 0===n&&(n=!1),void 0===r&&(r=5126),this.buffer=t,this.size=e,this.normalized=n,this.type=r,this.stride=i,this.start=o,this.instance=a};Ye.prototype.destroy=function(){this.buffer=null},Ye.from=function(t,e,n,r,i){return new Ye(t,e,n,r,i)};var We=0,qe=function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=e,this.id=We++,this.disposeRunner=new _e("disposeBuffer",2)};function Je(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}qe.prototype.update=function(t){this.data=t||this.data,this._updateID++},qe.prototype.dispose=function(){this.disposeRunner.run(this,!1)},qe.prototype.destroy=function(){this.dispose(),this.data=null},qe.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new qe(t)};var Ke={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array},Ze={5126:4,5123:2,5121:1},Qe=0,$e={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},tn=function(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Qe++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new _e("disposeGeometry",2),this.refCount=0};tn.prototype.addAttribute=function(t,e,n,r,i,o,a,s){if(void 0===r&&(r=!1),void 0===s&&(s=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e.data||(e instanceof Array&&(e=new Float32Array(e)),e=new qe(e));var u=t.split("|");if(u.length>1){for(var c=0;c<u.length;c++)this.addAttribute(u[c],e,n,r,i);return this}var l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new Ye(l,n,r,i,o,a,s),this.instanced=this.instanced||s,this},tn.prototype.getAttribute=function(t){return this.attributes[t]},tn.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},tn.prototype.addIndex=function(t){return t.data||(t instanceof Array&&(t=new Uint16Array(t)),t=new qe(t)),t.index=!0,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},tn.prototype.getIndex=function(){return this.indexBuffer},tn.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],n=[],r=new qe;for(t in this.attributes){var i=this.attributes[t],o=this.buffers[i.buffer];e.push(o.data),n.push(i.size*Ze[i.type]/4),i.buffer=0}for(r.data=function(t,e){for(var n=0,r=0,i={},o=0;o<t.length;o++)r+=e[o],n+=t[o].length;for(var a=new ArrayBuffer(4*n),s=null,u=0,c=0;c<t.length;c++){var l=e[c],h=t[c],d=Je(h);i[d]||(i[d]=new Ke[d](a)),s=i[d];for(var f=0;f<h.length;f++)s[(f/l|0)*r+u+f%l]=h[f];u+=l}return new Float32Array(a)}(e,n),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},tn.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},tn.prototype.dispose=function(){this.disposeRunner.run(this,!1)},tn.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},tn.prototype.clone=function(){for(var t=new tn,e=0;e<this.buffers.length;e++)t.buffers[e]=new qe(this.buffers[e].data.slice());for(var n in this.attributes){var r=this.attributes[n];t.attributes[n]=new Ye(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.index=!0),t},tn.merge=function(t){for(var e,n=new tn,r=[],i=[],o=[],a=0;a<t.length;a++){e=t[a];for(var s=0;s<e.buffers.length;s++)i[s]=i[s]||0,i[s]+=e.buffers[s].data.length,o[s]=0}for(var u=0;u<e.buffers.length;u++)r[u]=new($e[Je(e.buffers[u].data)])(i[u]),n.buffers[u]=new qe(r[u]);for(var c=0;c<t.length;c++){e=t[c];for(var l=0;l<e.buffers.length;l++)r[l].set(e.buffers[l].data,o[l]),o[l]+=e.buffers[l].data.length}if(n.attributes=e.attributes,e.indexBuffer){n.indexBuffer=n.buffers[e.buffers.indexOf(e.indexBuffer)],n.indexBuffer.index=!0;for(var h=0,d=0,f=0,p=0,m=0;m<e.buffers.length;m++)if(e.buffers[m]!==e.indexBuffer){p=m;break}for(var y in e.attributes){var g=e.attributes[y];(0|g.buffer)===p&&(d+=g.size*Ze[g.type]/4)}for(var v=0;v<t.length;v++){for(var _=t[v].indexBuffer.data,b=0;b<_.length;b++)n.indexBuffer.data[b+f]+=h;h+=e.buffers[p].data.length/d,f+=_.length}}return n};var en=function(t){function e(){t.call(this),this.addAttribute("aVertexPosition",[0,0,1,0,1,1,0,1]).addIndex([0,1,3,2])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(tn),nn=function(t){function e(){t.call(this),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new qe(this.vertices),this.uvBuffer=new qe(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(t,e){var n=0,r=0;return this.uvs[0]=n,this.uvs[1]=r,this.uvs[2]=n+e.width/t.width,this.uvs[3]=r,this.uvs[4]=n+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=n,this.uvs[7]=r+e.height/t.height,n=e.x,r=e.y,this.vertices[0]=n,this.vertices[1]=r,this.vertices[2]=n+e.width,this.vertices[3]=r,this.vertices[4]=n+e.width,this.vertices[5]=r+e.height,this.vertices[6]=n,this.vertices[7]=r+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(tn),rn=0,on=function(t,e){this.uniforms=t,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=rn++,this.static=!!e};on.prototype.update=function(){this.dirtyId++},on.prototype.add=function(t,e,n){this.uniforms[t]=new on(e,n)},on.from=function(t,e){return new on(t,e)};var an=function(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new Kt,this.destinationFrame=new Kt,this.filters=[]};an.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null};var sn=function(t){function e(e){t.call(this,e),this.defaultFilterStack=[{}],this.texturePool=new Ve,this.texturePool.setScreenSize(e.view),this.statePool=[],this.quad=new en,this.quadUv=new nn,this.tempRect=new Kt,this.activeState={},this.globalUniforms=new on({outputFrame:this.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this._pixelsWidth=e.view.width,this._pixelsHeight=e.view.height}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.push=function(t,e){for(var n=this.renderer,r=this.defaultFilterStack,i=this.statePool.pop()||new an,o=e[0].resolution,a=e[0].padding,s=e[0].autoFit,u=e[0].legacy,c=1;c<e.length;c++){var l=e[c];o=Math.min(o,l.resolution),a=Math.max(a,l.padding),s=s||l.autoFit,u=u||l.legacy}1===r.length&&(this.defaultFilterStack[0].renderTexture=n.renderTexture.current),r.push(i),i.resolution=o,i.legacy=u,i.target=t,i.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),i.sourceFrame.pad(a),s&&i.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),i.sourceFrame.ceil(o),i.renderTexture=this.getOptimalFilterTexture(i.sourceFrame.width,i.sourceFrame.height,o),i.filters=e,i.destinationFrame.width=i.renderTexture.width,i.destinationFrame.height=i.renderTexture.height,i.renderTexture.filterFrame=i.sourceFrame,n.renderTexture.bind(i.renderTexture,i.sourceFrame),n.renderTexture.clear()},e.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),n=e.filters;this.activeState=e;var r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;var i=r.inputSize,o=r.inputPixel,a=r.inputClamp;if(i[0]=e.destinationFrame.width,i[1]=e.destinationFrame.height,i[2]=1/i[0],i[3]=1/i[1],o[0]=i[0]*e.resolution,o[1]=i[1]*e.resolution,o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*i[2]-.5*o[2],a[3]=e.sourceFrame.height*i[3]-.5*o[3],e.legacy){var s=r.filterArea;s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=e.sourceFrame.x,s[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();var u=t[t.length-1];if(1===n.length)n[0].apply(this,e.renderTexture,u.renderTexture,!1,e),this.returnFilterTexture(e.renderTexture);else{var c=e.renderTexture,l=this.getOptimalFilterTexture(c.width,c.height,e.resolution);l.filterFrame=c.filterFrame;var h=0;for(h=0;h<n.length-1;++h){n[h].apply(this,c,l,!0,e);var d=c;c=l,l=d}n[h].apply(this,c,u.renderTexture,!1,e),this.returnFilterTexture(c),this.returnFilterTexture(l)}e.clear(),this.statePool.push(e)},e.prototype.applyFilter=function(t,e,n,r){var i=this.renderer;i.renderTexture.bind(n,n?n.filterFrame:null),r&&i.renderTexture.clear(),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,i.state.set(t.state),i.shader.bind(t),t.legacy?(this.quadUv.map(e._frame,e.filterFrame),i.geometry.bind(this.quadUv),i.geometry.draw(C.TRIANGLES)):(i.geometry.bind(this.quad),i.geometry.draw(C.TRIANGLE_STRIP))},e.prototype.calculateSpriteMatrix=function(t,e){var n=this.activeState,r=n.sourceFrame,i=n.destinationFrame,o=e._texture.orig,a=t.set(i.width,0,0,i.height,r.x,r.y),s=e.worldTransform.copyTo(Ut.TEMP_MATRIX);return s.invert(),a.prepend(s),a.scale(1/o.width,1/o.height),a.translate(e.anchor.x,e.anchor.y),a},e.prototype.destroy=function(){this.texturePool.clear(!1)},e.prototype.getOptimalFilterTexture=function(t,e,n){return void 0===n&&(n=1),this.texturePool.getOptimalTexture(t,e,n)},e.prototype.getFilterTexture=function(t,e){if("number"==typeof t){var n=t;t=e,e=n}t=t||this.activeState.renderTexture;var r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution);return r.filterFrame=t.filterFrame,r},e.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},e.prototype.emptyPool=function(){this.texturePool.clear(!0)},e.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},e}(je),un=function(t){this.renderer=t};un.prototype.flush=function(){},un.prototype.destroy=function(){this.renderer=null},un.prototype.start=function(){},un.prototype.stop=function(){this.flush()},un.prototype.render=function(t){};var cn=function(t){function e(e){t.call(this,e),this.emptyRenderer=new un(e),this.currentRenderer=this.emptyRenderer}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.copyBoundTextures=function(t,e){for(var n=this.renderer.texture.boundTextures,r=e-1;r>=0;--r)t[r]=n[r]||null,t[r]&&(t[r]._batchLocation=r)},e.prototype.boundArray=function(t,e,n,r){for(var i=t.elements,o=t.ids,a=t.count,s=0,u=0;u<a;u++){var c=i[u],l=c._batchLocation;if(l>=0&&l<r&&e[l]===c)o[u]=l;else for(;s<r;){var h=e[s];if(!h||h._batchEnabled!==n||h._batchLocation!==s){o[u]=s,c._batchLocation=s,e[s]=c;break}s++}}},e}(je);H.PREFER_ENV=G.any?S.WEBGL:S.WEBGL2,H.STRICT_TEXTURE_CACHE=!1;var ln=0,hn=function(t){function e(e){t.call(this,e),this.webGLVersion=1,this.extensions={},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),e.view.addEventListener("webglcontextlost",this.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={isLost:{configurable:!0}};return n.isLost.get=function(){return!this.gl||this.gl.isContextLost()},e.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=ln++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},e.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=ln++,this.renderer.runners.contextChange.run(t)},e.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},e.prototype.createContext=function(t,e){var n;if(H.PREFER_ENV>=S.WEBGL2&&(n=t.getContext("webgl2",e)),n)this.webGLVersion=2;else if(this.webGLVersion=1,!(n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),n},e.prototype.getExtensions=function(){var t=this.gl;1===this.webGLVersion?Object.assign(this.extensions,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBKIT_WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,{anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:t.getExtension("EXT_color_buffer_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear")})},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.run(this.gl)},e.prototype.destroy=function(){var t=this.renderer.view;t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},e.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},e.prototype.validateContext=function(t){t.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")},Object.defineProperties(e.prototype,n),e}(je),dn=function(t){function e(e){t.call(this,e),this.managedFramebuffers=[],this.unknownFramebuffer=new Le(10,10)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={size:{configurable:!0}};return e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Kt,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var e=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;H.PREFER_ENV===S.WEBGL_LEGACY&&(e=null,n=null),e?t.drawBuffers=function(t){return e.drawBuffersWEBGL(t)}:(this.hasMRT=!1,t.drawBuffers=function(){}),n||(this.writeDepthTexture=!1)}},e.prototype.bind=function(t,e){var n=this.gl;if(t){var r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,r.framebuffer)),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,this.updateFramebuffer(t)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var i=0;i<t.colorTextures.length;i++)t.colorTextures[i].texturePart?this.renderer.texture.unbind(t.colorTextures[i].texture):this.renderer.texture.unbind(t.colorTextures[i]);t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,t.width,t.height)}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},e.prototype.setViewport=function(t,e,n,r){var i=this.viewport;i.width===n&&i.height===r&&i.x===t&&i.y===e||(i.x=t,i.y=e,i.width=n,i.height=r,this.gl.viewport(t,e,n,r))},n.size.get=function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},e.prototype.clear=function(t,e,n,r){var i=this.gl;i.clearColor(t,e,n,r),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},e.prototype.initFramebuffer=function(t){var e={framebuffer:this.gl.createFramebuffer(),stencil:null,dirtyId:0,dirtyFormat:0,dirtySize:0};return t.glFramebuffers[this.CONTEXT_UID]=e,this.managedFramebuffers.push(t),t.disposeRunner.add(this),e},e.prototype.resizeFramebuffer=function(t){var e=this.gl,n=t.glFramebuffers[this.CONTEXT_UID];n.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,n.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));for(var r=t.colorTextures,i=0;i<r.length;i++)this.renderer.texture.bind(r[i],0);t.depthTexture&&this.renderer.texture.bind(t.depthTexture,0)},e.prototype.updateFramebuffer=function(t){var e=this.gl,n=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures.length;e.drawBuffers||(r=Math.min(r,1));for(var i=[],o=0;o<r;o++){var a=t.colorTextures[o];a.texturePart?(this.renderer.texture.bind(a.texture,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+o,e.TEXTURE_CUBE_MAP_NEGATIVE_X+a.side,a.texture._glTextures[this.CONTEXT_UID].texture,0)):(this.renderer.texture.bind(a,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+o,e.TEXTURE_2D,a._glTextures[this.CONTEXT_UID].texture,0)),i.push(e.COLOR_ATTACHMENT0+o)}if(i.length>1&&e.drawBuffers(i),t.depthTexture&&this.writeDepthTexture){var s=t.depthTexture;this.renderer.texture.bind(s,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s._glTextures[this.CONTEXT_UID].texture,0)}n.stencil||!t.stencil&&!t.depth||(n.stencil=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,n.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),t.depthTexture||e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,n.stencil))},e.prototype.disposeFramebuffer=function(t,e){var n=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(n){delete t.glFramebuffers[this.CONTEXT_UID];var i=this.managedFramebuffers.indexOf(t);i>=0&&this.managedFramebuffers.splice(i,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(n.framebuffer),n.stencil&&r.deleteRenderbuffer(n.stencil))}},e.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var n=0;n<e.length;n++)this.disposeFramebuffer(e[n],t)},e.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.enableStencil();var n=t.width,r=t.height,i=this.gl,o=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,o),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,r),e.stencil=o,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,o)}}},e.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Kt},Object.defineProperties(e.prototype,n),e}(je),fn=function(t){this.buffer=t,this.updateID=-1,this.byteLength=-1,this.refCount=0},pn={5126:4,5123:2,5121:1},mn=function(t){function e(e){t.call(this,e),this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.boundBuffers={},this.managedGeometries={},this.managedBuffers={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,!t.createVertexArray){var n=this.renderer.context.extensions.vertexArrayObject;H.PREFER_ENV===S.WEBGL_LEGACY&&(n=null),n?(t.createVertexArray=function(){return n.createVertexArrayOES()},t.bindVertexArray=function(t){return n.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return n.deleteVertexArrayOES(t)}):(this.hasVao=!1,t.createVertexArray=function(){},t.bindVertexArray=function(){},t.deleteVertexArray=function(){})}if(!t.vertexAttribDivisor){var r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=function(t,e){return r.vertexAttribDivisorANGLE(t,e)},t.drawElementsInstanced=function(t,e,n,i,o){return r.drawElementsInstancedANGLE(t,e,n,i,o)},t.drawArraysInstanced=function(t,e,n,i){return r.drawArraysInstancedANGLE(t,e,n,i)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex},e.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var n=this.gl,r=t.glVertexArrayObjects[this.CONTEXT_UID];r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={});var i=r[e.program.id]||this.initGeometryVao(t,e.program);this._activeGeometry=t,this._activeVao!==i&&(this._activeVao=i,this.hasVao?n.bindVertexArray(i):this.activateVao(t,e.program)),this.updateBuffers()},e.prototype.reset=function(){this.unbind()},e.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.gl,n=0;n<t.buffers.length;n++){var r=t.buffers[n],i=r._glBuffers[this.CONTEXT_UID];if(r._updateID!==i.updateID){i.updateID=r._updateID;var o=r.index?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(e.bindBuffer(o,i.buffer),this._boundBuffer=i,i.byteLength>=r.data.byteLength)e.bufferSubData(o,0,r.data);else{var a=r.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;i.byteLength=r.data.byteLength,e.bufferData(o,r.data,a)}}}},e.prototype.checkCompatibility=function(t,e){var n=t.attributes,r=e.attributeData;for(var i in r)if(!n[i])throw new Error('shader and geometry incompatible, geometry missing the "'+i+'" attribute')},e.prototype.getSignature=function(t,e){var n=t.attributes,r=e.attributeData,i=["g",t.id];for(var o in n)r[o]&&i.push(o);return i.join("-")},e.prototype.initGeometryVao=function(t,e){this.checkCompatibility(t,e);var n=this.gl,r=this.CONTEXT_UID,i=this.getSignature(t,e),o=t.glVertexArrayObjects[this.CONTEXT_UID],a=o[i];if(a)return o[e.id]=a,a;var s=t.buffers,u=t.attributes,c={},l={};for(var h in s)c[h]=0,l[h]=0;for(var d in u)!u[d].size&&e.attributeData[d]?u[d].size=e.attributeData[d].size:u[d].size||console.warn("PIXI Geometry attribute '"+d+"' size cannot be determined (likely the bound shader does not have the attribute)"),c[u[d].buffer]+=u[d].size*pn[u[d].type];for(var f in u){var p=u[f],m=p.size;void 0===p.stride&&(c[p.buffer]===m*pn[p.type]?p.stride=0:p.stride=c[p.buffer]),void 0===p.start&&(p.start=l[p.buffer],l[p.buffer]+=m*pn[p.type])}a=n.createVertexArray(),n.bindVertexArray(a);for(var y=0;y<s.length;y++){var g=s[y];g._glBuffers[r]||(g._glBuffers[r]=new fn(n.createBuffer()),this.managedBuffers[g.id]=g,g.disposeRunner.add(this)),g._glBuffers[r].refCount++}return this.activateVao(t,e),this._activeVao=a,o[e.id]=a,o[i]=a,a},e.prototype.disposeBuffer=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var n=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),n&&(e||r.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}},e.prototype.disposeGeometry=function(t,e){if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var n=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,i=t.buffers;if(t.disposeRunner.remove(this),n){for(var o=0;o<i.length;o++){var a=i[o]._glBuffers[this.CONTEXT_UID];a.refCount--,0!==a.refCount||e||this.disposeBuffer(i[o],e)}if(!e)for(var s in n)if("g"===s[0]){var u=n[s];this._activeVao===u&&this.unbind(),r.deleteVertexArray(u)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},e.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),n=0;n<e.length;n++)this.disposeGeometry(this.managedGeometries[e[n]],t);e=Object.keys(this.managedBuffers);for(var r=0;r<e.length;r++)this.disposeBuffer(this.managedBuffers[e[r]],t)},e.prototype.activateVao=function(t,e){var n=this.gl,r=this.CONTEXT_UID,i=t.buffers,o=t.attributes;t.indexBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer._glBuffers[r].buffer);var a=null;for(var s in o){var u=o[s],c=i[u.buffer]._glBuffers[r];if(e.attributeData[s]){a!==c&&(n.bindBuffer(n.ARRAY_BUFFER,c.buffer),a=c);var l=e.attributeData[s].location;if(n.enableVertexAttribArray(l),n.vertexAttribPointer(l,u.size,u.type||n.FLOAT,u.normalized,u.stride,u.start),u.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");n.vertexAttribDivisor(l,1)}}}},e.prototype.draw=function(t,e,n,r){var i=this.gl,o=this._activeGeometry;if(o.indexBuffer){var a=o.indexBuffer.data.BYTES_PER_ELEMENT,s=2===a?i.UNSIGNED_SHORT:i.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?o.instanced?i.drawElementsInstanced(t,e||o.indexBuffer.data.length,s,(n||0)*a,r||1):i.drawElements(t,e||o.indexBuffer.data.length,s,(n||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?i.drawArraysInstanced(t,n,e||o.getSize(),r||1):i.drawArrays(t,n,e||o.getSize());return this},e.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},e}(je),yn=function(t){this.type=U.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null};function gn(t,e,n,r){var i=vn(t,t.VERTEX_SHADER,e),o=vn(t,t.FRAGMENT_SHADER,n),a=t.createProgram();if(t.attachShader(a,i),t.attachShader(a,o),r)for(var s in r)t.bindAttribLocation(a,r[s],s);return t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||(console.warn(e),console.error(t.getShaderInfoLog(i))),t.getShaderParameter(o,t.COMPILE_STATUS)||(console.warn(n),console.error(t.getShaderInfoLog(o))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(a,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(a)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(a)),t.deleteProgram(a),a=null),t.deleteShader(i),t.deleteShader(o),a}function vn(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}function _n(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return bn(2*e);case"bvec3":return bn(3*e);case"bvec4":return bn(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function bn(t){for(var e=new Array(t),n=0;n<e.length;n++)e[n]=!1;return e}yn.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=U.NONE,this.autoDetect=!0),this._target=null},yn.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)};var xn,wn={},En=wn;function Tn(){if(En===wn||En&&En.isContextLost()){var t,e=document.createElement("canvas");H.PREFER_ENV>=S.WEBGL2&&(t=e.getContext("webgl2",{})),t||((t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}))?t.getExtension("WEBGL_draw_buffers"):t=null),En=t}return En}function On(t,e,n){if("precision"!==t.substring(0,9)){var r=e;return e===F.HIGH&&n!==F.HIGH&&(r=F.MEDIUM),"precision "+r+" float;\n"+t}return n!==F.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}var An={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Sn(t){return An[t]}var In=null,Pn={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray"};function Cn(t,e){if(!In){var n=Object.keys(Pn);In={};for(var r=0;r<n.length;++r){var i=n[r];In[t[i]]=Pn[i]}}return In[e]}var Rn,Mn={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},Dn={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},kn=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function jn(t){for(var e="",n=0;n<t;++n)n>0&&(e+="\nelse "),n<t-1&&(e+="if(test == "+n+".0){}");return e}var Nn=0,Ln={},Bn=function t(e,n,r){void 0===r&&(r="pixi-shader"),this.id=Nn++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=n||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),Ln[r]?(Ln[r]++,r+="-"+Ln[r]):Ln[r]=1,this.vertexSrc="#define SHADER_NAME "+r+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+"\n"+this.fragmentSrc,this.vertexSrc=On(this.vertexSrc,H.PRECISION_VERTEX,F.HIGH),this.fragmentSrc=On(this.fragmentSrc,H.PRECISION_FRAGMENT,function(){if(!xn){xn=F.MEDIUM;var t=Tn();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);xn=e.precision?F.HIGH:F.MEDIUM}}return xn}())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null},Fn={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};Bn.prototype.extractData=function(t,e){var n=Tn();if(n){var r=gn(n,t,e);this.attributeData=this.getAttributeData(r,n),this.uniformData=this.getUniformData(r,n),n.deleteProgram(r)}else this.uniformData={},this.attributeData={}},Bn.prototype.getAttributeData=function(t,e){for(var n={},r=[],i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<i;o++){var a=e.getActiveAttrib(t,o),s=Cn(e,a.type),u={type:s,name:a.name,size:Sn(s),location:0};n[a.name]=u,r.push(u)}r.sort((function(t,e){return t.name>e.name?1:-1}));for(var c=0;c<r.length;c++)r[c].location=c;return n},Bn.prototype.getUniformData=function(t,e){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<r;i++){var o=e.getActiveUniform(t,i),a=o.name.replace(/\[.*?\]/,""),s=o.name.match(/\[.*?\]/,""),u=Cn(e,o.type);n[a]={type:u,size:o.size,isArray:s,value:_n(u,o.size)}}return n},Fn.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},Fn.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},Bn.from=function(t,e,n){var r=t+e,i=wt[r];return i||(wt[r]=i=new Bn(t,e,n)),i},Object.defineProperties(Bn,Fn);var Un=function(t,e){for(var n in this.program=t,this.uniformGroup=e?e instanceof on?e:new on(e):new on({}),t.uniformData)this.uniformGroup.uniforms[n]instanceof Array&&(this.uniformGroup.uniforms[n]=new Float32Array(this.uniformGroup.uniforms[n]))},Gn={uniforms:{configurable:!0}};Un.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var n in e.uniforms){var r=e.uniforms[n];if(r.group&&this.checkUniformExists(t,r))return!0}return!1},Un.prototype.destroy=function(){this.uniformGroup=null},Gn.uniforms.get=function(){return this.uniformGroup.uniforms},Un.from=function(t,e,n){var r=Bn.from(t,e);return new Un(r,n)},Object.defineProperties(Un.prototype,Gn);var Hn=function(){this.data=0,this.blendMode=P.NORMAL,this.polygonOffset=0,this.blend=!0},zn={blend:{configurable:!0},offsets:{configurable:!0},culling:{configurable:!0},depthTest:{configurable:!0},clockwiseFrontFace:{configurable:!0},blendMode:{configurable:!0},polygonOffset:{configurable:!0}};zn.blend.get=function(){return!!(1&this.data)},zn.blend.set=function(t){!!(1&this.data)!==t&&(this.data^=1)},zn.offsets.get=function(){return!!(2&this.data)},zn.offsets.set=function(t){!!(2&this.data)!==t&&(this.data^=2)},zn.culling.get=function(){return!!(4&this.data)},zn.culling.set=function(t){!!(4&this.data)!==t&&(this.data^=4)},zn.depthTest.get=function(){return!!(8&this.data)},zn.depthTest.set=function(t){!!(8&this.data)!==t&&(this.data^=8)},zn.clockwiseFrontFace.get=function(){return!!(16&this.data)},zn.clockwiseFrontFace.set=function(t){!!(16&this.data)!==t&&(this.data^=16)},zn.blendMode.get=function(){return this._blendMode},zn.blendMode.set=function(t){this.blend=t!==P.NONE,this._blendMode=t},zn.polygonOffset.get=function(){return this._polygonOffset},zn.polygonOffset.set=function(t){this.offsets=!!t,this._polygonOffset=t},Hn.for2d=function(){var t=new Hn;return t.depthTest=!1,t.blend=!0,t},Object.defineProperties(Hn.prototype,zn);var Xn=function(t){function e(n,r,i){var o=Bn.from(n||e.defaultVertexSrc,r||e.defaultFragmentSrc);t.call(this,o,i),this.padding=0,this.resolution=H.FILTER_RESOLUTION,this.enabled=!0,this.autoFit=!0,this.legacy=!!this.program.attributeData.aTextureCoord,this.state=new Hn}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={blendMode:{configurable:!0}},r={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};return e.prototype.apply=function(t,e,n,r,i){t.applyFilter(this,e,n,r,i)},n.blendMode.get=function(){return this.state.blendMode},n.blendMode.set=function(t){this.state.blendMode=t},r.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},r.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},Object.defineProperties(e.prototype,n),Object.defineProperties(e,r),e}(Un);Xn.SOURCE_KEY_MAP={};var Vn=new Ut,Yn=function(t,e){this._texture=t,this.mapCoord=new Ut,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._updateID=-1,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1},Wn={texture:{configurable:!0}};Wn.texture.get=function(){return this._texture},Wn.texture.set=function(t){this._texture=t,this._updateID=-1},Yn.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var n=this.mapCoord,r=0;r<t.length;r+=2){var i=t[r],o=t[r+1];e[r]=i*n.a+o*n.c+n.tx,e[r+1]=i*n.b+o*n.d+n.ty}return e},Yn.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._updateID===e._updateID)return!1;this._updateID=e._updateID;var n=e._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);var r=e.orig,i=e.trim;i&&(Vn.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Vn));var o=e.baseTexture,a=this.uClampFrame,s=this.clampMargin/o.resolution,u=this.clampOffset;return a[0]=(e._frame.x+s+u)/o.width,a[1]=(e._frame.y+s+u)/o.height,a[2]=(e._frame.x+e._frame.width-s+u)/o.width,a[3]=(e._frame.y+e._frame.height-s+u)/o.height,this.uClampOffset[0]=u/o.realWidth,this.uClampOffset[1]=u/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&0===e.rotate,!0},Object.defineProperties(Yn.prototype,Wn);var qn=function(t){function e(e){var n=new Ut;t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n"),e.renderable=!1,this.maskSprite=e,this.maskMatrix=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(t,e,n,r){var i=this.maskSprite,o=this.maskSprite.texture;o.valid&&(o.transform||(o.transform=new Yn(o,0)),o.transform.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,i).prepend(o.transform.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=o.transform.uClampFrame,t.applyFilter(this,e,n,r))},e}(Xn),Jn=function(t){function e(e){t.call(this,e),this.scissorRenderTarget=null,this.enableScissor=!1,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},e.prototype.push=function(t,e){if(!e.isMaskData){var n=this.maskDataPool.pop()||new yn;n.pooled=!0,n.maskObject=e,e=n}switch(e.autoDetect&&this.detect(e),e.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),e._target=t,e.type){case U.SCISSOR:this.maskStack.push(e),this.renderer.scissor.push(e);break;case U.STENCIL:this.maskStack.push(e),this.renderer.stencil.push(e);break;case U.SPRITE:e.copyCountersOrReset(null),this.pushSpriteMask(e),this.maskStack.push(e)}},e.prototype.pop=function(t){var e=this.maskStack.pop();if(e&&e._target===t){switch(e.type){case U.SCISSOR:this.renderer.scissor.pop();break;case U.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case U.SPRITE:this.popSpriteMask()}e.reset(),e.pooled&&this.maskDataPool.push(e)}},e.prototype.detect=function(t){var e=t.maskObject;if(e.isSprite)t.type=U.SPRITE;else if(t.type=U.STENCIL,this.enableScissor&&e.isFastRect&&e.isFastRect()){var n=e.worldTransform,r=Math.atan2(n.b,n.a),i=Math.atan2(n.d,n.c);r=Math.round(r*(180/Math.PI)*100),i=((i=Math.round(i*(180/Math.PI)*100)-r)%18e3+18e3)%18e3,0===(r=(r%9e3+9e3)%9e3)&&9e3===i&&(t.type=U.SCISSOR)}},e.prototype.pushSpriteMask=function(t){var e=t.maskObject,n=t._target,r=this.alphaMaskPool[this.alphaMaskIndex];r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new qn(e)]),r[0].resolution=this.renderer.resolution,r[0].maskSprite=e;var i=n.filterArea;n.filterArea=e.getBounds(!0),this.renderer.filter.push(n,r),n.filterArea=i,this.alphaMaskIndex++},e.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},e}(je),Kn=function(t){function e(e){t.call(this,e),this.maskStack=[],this.glConst=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getStackLength=function(){return this.maskStack.length},e.prototype.setMaskStack=function(t){var e=this.renderer.gl,n=this.getStackLength();this.maskStack=t;var r=this.getStackLength();r!==n&&(0===r?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},e.prototype._useCurrent=function(){},e.prototype.destroy=function(){t.prototype.destroy.call(this,this),this.maskStack=null},e}(je),Zn=function(t){function e(e){t.call(this,e),this.glConst=WebGLRenderingContext.SCISSOR_TEST}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.push=function(t){var e=t.maskObject;e.renderable=!0;var n=t._scissorRect,r=e.getBounds(!0),i=this.renderer.gl;e.renderable=!1,n?r.fit(n):i.enable(i.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=r,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,e=this.renderer.renderTexture.current,n=this.renderer.projection,r=n.transform,i=n.sourceFrame,o=n.destinationFrame,a=e?e.resolution:this.renderer.resolution,s=(t.x-i.x)*a+o.x,u=(t.y-i.y)*a+o.y,c=t.width*a,l=t.height*a;r&&(s+=r.tx*a,u+=r.ty*a),e||(u=this.renderer.height-l-u),this.renderer.gl.scissor(s,u,c,l)},e}(Kn),Qn=function(t){function e(e){t.call(this,e),this.glConst=WebGLRenderingContext.STENCIL_TEST}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var e=t.maskObject,n=this.renderer.gl,r=t._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),n.enable(n.STENCIL_TEST)),t._stencilCounter++,n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.EQUAL,r,this._getBitwiseMask()),n.stencilOp(n.KEEP,n.KEEP,n.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},e}(Kn),$n=function(t){function e(e){t.call(this,e),this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Ut,this.transform=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(t,e,n,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,r),this.transform&&this.projectionMatrix.append(this.transform);var i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)},e.prototype.calculateProjection=function(t,e,n,r){var i=this.projectionMatrix;r?(i.a=1/t.width*2*n,i.d=-1/t.height*2*n,i.tx=-1-e.x*i.a,i.ty=1-e.y*i.d):(i.a=1/t.width*2*n,i.d=1/t.height*2*n,i.tx=-1-e.x*i.a,i.ty=-1-e.y*i.d)},e.prototype.setTransform=function(){},e}(je),tr=new Kt,er=function(t){function e(e){t.call(this,e),this.clearColor=e._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Kt,this.destinationFrame=new Kt}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.bind=function(t,e,n){void 0===t&&(t=null),this.current=t;var r,i=this.renderer;if(t){var o=t.baseTexture;r=o.resolution,n||(tr.width=o.realWidth,tr.height=o.realHeight,n=tr),e||(e=n),this.renderer.framebuffer.bind(o.framebuffer,n),this.renderer.projection.update(n,e,r,!1),this.renderer.mask.setMaskStack(o.maskStack)}else r=this.renderer.resolution,n||(tr.width=i.width,tr.height=i.height,n=tr),e||(e=n),i.framebuffer.bind(null,n),this.renderer.projection.update(n,e,r,!0),this.renderer.mask.setMaskStack(this.defaultMaskStack);this.sourceFrame.copyFrom(e),this.destinationFrame.x=n.x/r,this.destinationFrame.y=n.y/r,this.destinationFrame.width=n.width/r,this.destinationFrame.height=n.height/r,e===n&&this.sourceFrame.copyFrom(this.destinationFrame)},e.prototype.clear=function(t){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor,this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3])},e.prototype.resize=function(){this.bind(null)},e.prototype.reset=function(){this.bind(null)},e}(je),nr=function(t,e){this.program=t,this.uniformData=e,this.uniformGroups={}};nr.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null};var rr=0,ir={textureCount:0},or=function(t){function e(e){t.call(this,e),this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this.id=rr++}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof Rn)return Rn;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");Rn=!0===t({a:"b"},"a","b")}catch(t){Rn=!1}return Rn}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},e.prototype.contextChange=function(t){this.gl=t,this.reset()},e.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var n=t.program,r=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(r.program)),e||(ir.textureCount=0,this.syncUniformGroup(t.uniformGroup,ir)),r},e.prototype.setUniforms=function(t){var e=this.shader.program,n=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(n.uniformData,t,this.renderer)},e.prototype.syncUniformGroup=function(t,e){var n=this.getglProgram();t.static&&t.dirtyId===n.uniformGroups[t.id]||(n.uniformGroups[t.id]=t.dirtyId,this.syncUniforms(t,n,e))},e.prototype.syncUniforms=function(t,e,n){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,n)},e.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData);return this.cache[e]||(this.cache[e]=function(t,e){var n="var v = null;\n    var cv = null\n    var t = 0;\n    var gl = renderer.gl\n    ";for(var r in t.uniforms){var i=e[r];i?"float"===i.type&&1===i.size?n+="\n            if(uv."+r+" !== ud."+r+".value)\n            {\n                ud."+r+".value = uv."+r+"\n                gl.uniform1f(ud."+r+".location, uv."+r+")\n            }\n":"sampler2D"!==i.type&&"samplerCube"!==i.type&&"sampler2DArray"!==i.type||1!==i.size||i.isArray?"mat3"===i.type&&1===i.size?void 0!==t.uniforms[r].a?n+="\n                gl.uniformMatrix3fv(ud."+r+".location, false, uv."+r+".toArray(true));\n                \n":n+="\n                gl.uniformMatrix3fv(ud."+r+".location, false, uv."+r+");\n                \n":"vec2"===i.type&&1===i.size?void 0!==t.uniforms[r].x?n+="\n                cv = ud."+r+".value;\n                v = uv."+r+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud."+r+".location, v.x, v.y);\n                }\n":n+="\n                cv = ud."+r+".value;\n                v = uv."+r+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud."+r+".location, v[0], v[1]);\n                }\n                \n":"vec4"===i.type&&1===i.size?void 0!==t.uniforms[r].width?n+="\n                cv = ud."+r+".value;\n                v = uv."+r+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud."+r+".location, v.x, v.y, v.width, v.height)\n                }\n":n+="\n                cv = ud."+r+".value;\n                v = uv."+r+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud."+r+".location, v[0], v[1], v[2], v[3])\n                }\n                \n":n+="\n            cv = ud."+r+".value;\n            v = uv."+r+";\n            "+(1===i.size?Mn:Dn)[i.type].replace("location","ud."+r+".location")+";\n":n+="\n\n            t = syncData.textureCount++;\n\n            renderer.texture.bind(uv."+r+", t);\n            \n            if(ud."+r+".value !== t)\n            {\n                ud."+r+".value = t;\n                gl.uniform1i(ud."+r+".location, t);\n; // eslint-disable-line max-len\n            }\n":t.uniforms[r].group&&(n+="\n                    renderer.shader.syncUniformGroup(uv."+r+", syncData);\n                ")}return new Function("ud","uv","renderer","syncData",n)}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},e.prototype.getSignature=function(t,e){var n=t.uniforms,r=[];for(var i in n)r.push(i),e[i]&&r.push(e[i].type);return r.join("-")},e.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},e.prototype.generateShader=function(t){var e=this.gl,n=t.program,r={};for(var i in n.attributeData)r[i]=n.attributeData[i].location;var o=gn(e,n.vertexSrc,n.fragmentSrc,r),a={};for(var s in n.uniformData){var u=n.uniformData[s];a[s]={location:e.getUniformLocation(o,s),value:_n(u.type,u.size)}}var c=new nr(o,a);return n.glPrograms[this.renderer.CONTEXT_UID]=c,c},e.prototype.reset=function(){this.program=null,this.shader=null},e.prototype.destroy=function(){this.destroyed=!0},e}(je),ar=function(t){function e(e){t.call(this,e),this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=P.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.checks=[],this.defaultState=new Hn,this.defaultState.blend=!0,this.defaultState.depth=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contextChange=function(t){this.gl=t,this.blendModes=function(t,e){return void 0===e&&(e=[]),e[P.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.ADD]=[t.ONE,t.ONE],e[P.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.NONE]=[0,0],e[P.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[P.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[P.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[P.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[P.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[P.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[P.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[P.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[P.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[P.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[P.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()},e.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,n=0;e;)1&e&&this.map[n].call(this,!!(t.data&1<<n)),e>>=1,n++;this.stateId=t.data}for(var r=0;r<this.checks.length;r++)this.checks[r](this,t)},e.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(var n=0;n<this.checks.length;n++)this.checks[n](this,t);this.stateId=t.data},e.prototype.setBlend=function(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},e.prototype.setOffset=function(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},e.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},e.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},e.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},e.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],n=this.gl;2===e.length?n.blendFunc(e[0],e[1]):n.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,n.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}},e.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},e.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(0),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},e.prototype.updateCheck=function(t,e){var n=this.checks.indexOf(t);e&&-1===n?this.checks.push(t):e||-1===n||this.checks.splice(n,1)},e.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},e.checkPolygonOffset=function(t,e){t.setPolygonOffset(e.polygonOffset,0)},e}(je),sr=function(t){function e(e){t.call(this,e),this.count=0,this.checkCount=0,this.maxIdle=H.GC_MAX_IDLE,this.checkCountMax=H.GC_MAX_CHECK_COUNT,this.mode=H.GC_MODE}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==B.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},e.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,n=!1,r=0;r<e.length;r++){var i=e[r];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[r]=null,n=!0)}if(n){for(var o=0,a=0;a<e.length;a++)null!==e[a]&&(e[o++]=e[a]);e.length=o}},e.prototype.unload=function(t){var e=this.renderer.textureSystem;t._texture&&t._texture._glRenderTargets&&e.destroyTexture(t._texture);for(var n=t.children.length-1;n>=0;n--)this.unload(t.children[n])},e}(je),ur=function(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121},cr=function(t){function e(e){t.call(this,e),this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Ie}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};var r=new ur(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new ur(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(var i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var o=0;o<this.boundTextures.length;o++)this.bind(null,o)},e.prototype.bind=function(t,e){void 0===e&&(e=0);var n=this.gl;if(t){if((t=t.baseTexture||t).valid){t.touched=this.renderer.textureGC.count;var r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}}else this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[e]=null},e.prototype.reset=function(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},e.prototype.unbind=function(t){var e=this.gl,n=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var r=0;r<n.length;r++)n[r]===this.unknownTexture&&this.bind(null,r)}for(var i=0;i<n.length;i++)n[i]===t&&(this.currentLocation!==i&&(e.activeTexture(e.TEXTURE0+i),this.currentLocation=i),e.bindTexture(e.TEXTURE_2D,this.emptyTextures[t.target].texture),n[i]=null)},e.prototype.initTexture=function(t){var e=new ur(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},e.prototype.initTextureType=function(t,e){if(e.internalFormat=t.format,e.type=t.type,2===this.webGLVersion){var n=this.renderer.gl;t.type===n.FLOAT&&t.format===n.RGBA&&(e.internalFormat=n.RGBA32F),t.type===D.HALF_FLOAT&&(e.type=n.HALF_FLOAT),e.type===n.HALF_FLOAT&&t.format===n.RGBA&&(e.internalFormat=n.RGBA16F)}},e.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var n=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(n,t,e));else{var r=t.realWidth,i=t.realHeight,o=n.gl;(e.width!==r||e.height!==i||e.dirtyId<0)&&(e.width=r,e.height=i,o.texImage2D(t.target,0,e.internalFormat,r,i,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},e.prototype.destroyTexture=function(t,e){var n=this.gl;if((t=t.baseTexture||t)._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var r=this.managedTextures.indexOf(t);-1!==r&&yt(this.managedTextures,r,1)}},e.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==N.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=0,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=j.CLAMP,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},e.prototype.setStyle=function(t,e){var n=this.gl;if(e.mipmap&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,e.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);var r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===k.LINEAR){var i=Math.min(t.anisotropicLevel,n.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,i)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode?n.LINEAR:n.NEAREST)},e}(je),lr=new Ut,hr=function(t){function e(n){void 0===n&&(n={}),t.call(this,"WebGL",n),n=this.options,this.type=I.WEBGL,this.gl=null,this.CONTEXT_UID=0,this.runners={destroy:new _e("destroy"),contextChange:new _e("contextChange",1),reset:new _e("reset"),update:new _e("update"),postrender:new _e("postrender"),prerender:new _e("prerender"),resize:new _e("resize",2)},this.globalUniforms=new on({projectionMatrix:new Ut},!0),this.addSystem(Jn,"mask").addSystem(hn,"context").addSystem(ar,"state").addSystem(or,"shader").addSystem(cr,"texture").addSystem(mn,"geometry").addSystem(dn,"framebuffer").addSystem(Zn,"scissor").addSystem(Qn,"stencil").addSystem($n,"projection").addSystem(sr,"textureGC").addSystem(sn,"filter").addSystem(er,"renderTexture").addSystem(cn,"batch"),this.initPlugins(e.__plugins),n.context?this.context.initFromContext(n.context):this.context.initFromOptions({alpha:this.transparent,antialias:n.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,powerPreference:this.options.powerPreference}),this.renderingToScreen=!0,Q(2===this.context.webGLVersion?"WebGL 2":"WebGL 1"),this.resize(this.options.width,this.options.height)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.create=function(t){if($())return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.addSystem=function(t,e){e||(e=t.name);var n=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var r in this[e]=n,this.runners)this.runners[r].add(n);return this},e.prototype.render=function(t,e,n,r,i){if(this.renderingToScreen=!e,this.runners.prerender.run(),this.emit("prerender"),this.projection.transform=r,!this.context.isLost){if(e||(this._lastObjectRendered=t),!i){var o=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=o}this.renderTexture.bind(e),this.batch.currentRenderer.start(),(void 0!==n?n:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),e&&e.baseTexture.update(),this.runners.postrender.run(),this.projection.transform=null,this.emit("postrender")}},e.prototype.resize=function(e,n){t.prototype.resize.call(this,e,n),this.runners.resize.run(e,n)},e.prototype.reset=function(){return this.runners.reset.run(),this},e.prototype.clear=function(){this.framebuffer.bind(),this.framebuffer.clear()},e.prototype.destroy=function(e){for(var n in this.runners.destroy.run(),this.runners)this.runners[n].destroy();t.prototype.destroy.call(this,e),this.gl=null},e.registerPlugin=function(t,n){e.__plugins=e.__plugins||{},e.__plugins[t]=n},e}(function(t){function e(e,n){t.call(this),(n=Object.assign({},H.RENDER_OPTIONS,n)).roundPixels&&(H.ROUND_PIXELS=n.roundPixels,xt("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),this.options=n,this.type=I.UNKNOWN,this.screen=new Kt(0,0,n.width,n.height),this.view=n.view||document.createElement("canvas"),this.resolution=n.resolution||H.RESOLUTION,this.transparent=n.transparent,this.autoDensity=n.autoDensity||n.autoResize||!1,this.preserveDrawingBuffer=n.preserveDrawingBuffer,this.clearBeforeRender=n.clearBeforeRender,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,0],this._backgroundColorString="#000000",this.backgroundColor=n.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent=new ie,this._lastObjectRendered=this._tempDisplayObjectParent,this.plugins={}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={width:{configurable:!0},height:{configurable:!0},backgroundColor:{configurable:!0}};return e.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},n.width.get=function(){return this.view.width},n.height.get=function(){return this.view.height},e.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoDensity&&(this.view.style.width=t+"px",this.view.style.height=e+"px")},e.prototype.generateTexture=function(t,e,n,r){0===(r=r||t.getLocalBounds()).width&&(r.width=1),0===r.height&&(r.height=1);var i=Xe.create(0|r.width,0|r.height,e,n);return lr.tx=-r.x,lr.ty=-r.y,this.render(t,i,!1,lr,!!t.parent),i},e.prototype.destroy=function(t){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.plugins=null,this.type=I.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoDensity=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},n.backgroundColor.get=function(){return this._backgroundColor},n.backgroundColor.set=function(t){this._backgroundColor=t,this._backgroundColorString=et(t),tt(t,this._backgroundColorRgba)},Object.defineProperties(e.prototype,n),e}(X.a));function dr(t){return hr.create(t)}var fr=function(){this.texArray=null,this.blend=0,this.type=C.TRIANGLES,this.start=0,this.size=0,this.data=null},pr=function(){this.elements=[],this.ids=[],this.count=0};pr.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0};var mr=function(t){this.rawBinaryData=new ArrayBuffer(t),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)},yr={int8View:{configurable:!0},uint8View:{configurable:!0},int16View:{configurable:!0},uint16View:{configurable:!0},int32View:{configurable:!0}};yr.int8View.get=function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},yr.uint8View.get=function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},yr.int16View.get=function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},yr.uint16View.get=function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},yr.int32View.get=function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},mr.prototype.view=function(t){return this[t+"View"]},mr.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},mr.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},Object.defineProperties(mr.prototype,yr);var gr=function(t){function e(e){t.call(this,e),this.shaderGenerator=null,this.geometryClass=null,this.vertexSize=null,this.state=Hn.for2d(),this.size=4*H.SPRITE_BATCH_SIZE,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contextChange=function(){var t=this.renderer.gl;H.PREFER_ENV===S.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),H.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var n=e.createShader(e.FRAGMENT_SHADER);;){var r=kn.replace(/%forloop%/gi,jn(t));if(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var t=e._drawCallPool,n=e._textureArrayPool,r=this.size/4,i=Math.floor(r/this.MAX_TEXTURES)+1;t.length<r;)t.push(new fr);for(;n.length<i;)n.push(new pr);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},e.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,n=this.MAX_TEXTURES,r=e._textureArrayPool,i=this.renderer.batch,o=this._tempBoundTextures,a=this.renderer.textureGC.count,s=++Ie._globalBatch,u=0,c=r[0],l=0;i.copyBoundTextures(o,n);for(var h=0;h<this._bufferSize;++h){var d=t[h];t[h]=null,d._batchEnabled!==s&&(c.count>=n&&(i.boundArray(c,o,s,n),this.buildDrawCalls(c,l,h),l=h,c=r[++u],++s),d._batchEnabled=s,d.touched=a,c.elements[c.count++]=d)}c.count>0&&(i.boundArray(c,o,s,n),this.buildDrawCalls(c,l,this._bufferSize),++u,++s);for(var f=0;f<o.length;f++)o[f]=null;Ie._globalBatch=s},e.prototype.buildDrawCalls=function(t,n,r){var i=this._bufferedElements,o=this._attributeBuffer,a=this._indexBuffer,s=this.vertexSize,u=e._drawCallPool,c=this._dcIndex,l=this._aIndex,h=this._iIndex,d=u[c];d.start=this._iIndex,d.texArray=t;for(var f=n;f<r;++f){var p=i[f],m=p._texture.baseTexture,y=it[m.alphaMode?1:0][p.blendMode];i[f]=null,n<f&&d.blend!==y&&(d.size=h-d.start,n=f,(d=u[++c]).texArray=t,d.start=h),this.packInterleavedGeometry(p,o,a,l,h),l+=p.vertexData.length/2*s,h+=p.indices.length,d.blend=y}n<r&&(d.size=h-d.start,++c),this._dcIndex=c,this._aIndex=l,this._iIndex=h},e.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,n=0;n<t.count;n++)e.bind(t.elements[n],t.ids[n]),t.elements[n]=null;t.count=0},e.prototype.updateGeometry=function(){var t=this._packedGeometries,e=this._attributeBuffer,n=this._indexBuffer;H.CAN_UPLOAD_SAME_BUFFER?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var t=this._dcIndex,n=this.renderer,r=n.gl,i=n.state,o=e._drawCallPool,a=null,s=0;s<t;s++){var u=o[s],c=u.texArray,l=u.type,h=u.size,d=u.start,f=u.blend;a!==c&&(a=c,this.bindAndClearTexArray(c)),this.state.blendMode=f,i.set(this.state),r.drawElements(l,h,r.UNSIGNED_SHORT,2*d)}},e.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),H.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),t.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var e=ft(Math.ceil(t/8)),n=mt(e),r=8*e;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var i=this._aBuffers[r];return i||(this._aBuffers[r]=i=new mr(r*this.vertexSize*4)),i},e.prototype.getIndexBuffer=function(t){var e=ft(Math.ceil(t/12)),n=mt(e),r=12*e;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var i=this._iBuffers[n];return i||(this._iBuffers[n]=i=new Uint16Array(r)),i},e.prototype.packInterleavedGeometry=function(t,e,n,r,i){for(var o=e.uint32View,a=e.float32View,s=r/this.vertexSize,u=t.uvs,c=t.indices,l=t.vertexData,h=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=d<1&&t._texture.baseTexture.alphaMode?st(t._tintRGB,d):t._tintRGB+(255*d<<24),p=0;p<l.length;p+=2)a[r++]=l[p],a[r++]=l[p+1],a[r++]=u[p],a[r++]=u[p+1],o[r++]=f,a[r++]=h;for(var m=0;m<c.length;m++)n[i++]=s+c[m]},e}(un);gr._drawCallPool=[],gr._textureArrayPool=[];var vr=function(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')};vr.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),n=0;n<t;n++)e[n]=n;this.defaultGroupCache[t]=on.from({uSamplers:e},!0);var r=this.fragTemplate;r=(r=r.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Bn(this.vertexSrc,r)}var i={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ut,default:this.defaultGroupCache[t]};return new Un(this.programCache[t],i)},vr.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var n=0;n<t;n++)n>0&&(e+="\nelse "),n<t-1&&(e+="if(vTextureId < "+n+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+n+"], vTextureCoord);",e+="\n}";return(e+="\n")+"\n"};var _r=function(t){function e(e){void 0===e&&(e=!1),t.call(this),this._buffer=new qe(null,e,!1),this._indexBuffer=new qe(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,D.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,D.FLOAT).addAttribute("aColor",this._buffer,4,!0,D.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,D.FLOAT).addIndex(this._indexBuffer)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(tn),br="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",xr="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",wr=function(){},Er={defaultVertexSrc:{configurable:!0},defaultFragmentTemplate:{configurable:!0}};wr.create=function(t){var e=Object.assign({vertex:br,fragment:xr,geometryClass:_r,vertexSize:6},t),n=e.vertex,r=e.fragment,i=e.vertexSize,o=e.geometryClass;return function(t){function e(e){t.call(this,e),this.shaderGenerator=new vr(n,r),this.geometryClass=o,this.vertexSize=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(gr)},Er.defaultVertexSrc.get=function(){return br},Er.defaultFragmentTemplate.get=function(){return xr},Object.defineProperties(wr,Er);var Tr=wr.create(),Or=function t(e){var n=this;e=Object.assign({forceCanvas:!1},e),this.renderer=dr(e),this.stage=new ie,t._plugins.forEach((function(t){t.init.call(n,e)}))},Ar={view:{configurable:!0},screen:{configurable:!0}};Or.registerPlugin=function(t){Or._plugins.push(t)},Or.prototype.render=function(){this.renderer.render(this.stage)},Ar.view.get=function(){return this.renderer.view},Ar.screen.get=function(){return this.renderer.screen},Or.prototype.destroy=function(t,e){var n=this,r=Or._plugins.slice(0);r.reverse(),r.forEach((function(t){t.destroy.call(n)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null,this._options=null},Object.defineProperties(Or.prototype,Ar),Or._plugins=[];var Sr=function(){};Sr.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(t){window.removeEventListener("resize",this.resize),this._resizeTo=t,t&&(window.addEventListener("resize",this.resize),this.resize())},get:function(){return this._resizeTo}}),this.resize=function(){e._resizeTo&&(e._resizeTo===window?e.renderer.resize(window.innerWidth,window.innerHeight):e.renderer.resize(e._resizeTo.clientWidth,e._resizeTo.clientHeight))},this._resizeTo=null,this.resizeTo=t.resizeTo||null},Sr.destroy=function(){this.resizeTo=null,this.resize=null},Or.registerPlugin(Sr);var Ir=new Kt,Pr=function(t){this.renderer=t,t.extract=this};Pr.prototype.image=function(t,e,n){var r=new Image;return r.src=this.base64(t,e,n),r},Pr.prototype.base64=function(t,e,n){return this.canvas(t).toDataURL(e,n)},Pr.prototype.canvas=function(t){var e,n,r,i=this.renderer,o=!1,a=!1;t&&(t instanceof Xe?r=t:(r=this.renderer.generateTexture(t),a=!0)),r?(e=r.baseTexture.resolution,n=r.frame,o=!1,i.renderTexture.bind(r)):(e=this.renderer.resolution,o=!0,(n=Ir).width=this.renderer.width,n.height=this.renderer.height,i.renderTexture.bind(null));var s=Math.floor(n.width*e+1e-4),u=Math.floor(n.height*e+1e-4),c=new St(s,u,1),l=new Uint8Array(4*s*u),h=i.gl;h.readPixels(n.x*e,n.y*e,s,u,h.RGBA,h.UNSIGNED_BYTE,l);var d=c.context.getImageData(0,0,s,u);return Pr.arrayPostDivide(l,d.data),c.context.putImageData(d,0,0),o&&(c.context.scale(1,-1),c.context.drawImage(c.canvas,0,-u)),a&&r.destroy(!0),c.canvas},Pr.prototype.pixels=function(t){var e,n,r,i=this.renderer,o=!1;t&&(t instanceof Xe?r=t:(r=this.renderer.generateTexture(t),o=!0)),r?(e=r.baseTexture.resolution,n=r.frame,i.renderTexture.bind(r)):(e=i.resolution,(n=Ir).width=i.width,n.height=i.height,i.renderTexture.bind(null));var a=n.width*e,s=n.height*e,u=new Uint8Array(4*a*s),c=i.gl;return c.readPixels(n.x*e,n.y*e,a,s,c.RGBA,c.UNSIGNED_BYTE,u),o&&r.destroy(!0),Pr.arrayPostDivide(u,u),u},Pr.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},Pr.arrayPostDivide=function(t,e){for(var n=0;n<t.length;n+=4){var r=e[n+3]=t[n+3];0!==r?(e[n]=Math.round(Math.min(255*t[n]/r,255)),e[n+1]=Math.round(Math.min(255*t[n+1]/r,255)),e[n+2]=Math.round(Math.min(255*t[n+2]/r,255))):(e[n]=t[n],e[n+1]=t[n+1],e[n+2]=t[n+2])}};var Cr=n(13),Rr=n.n(Cr),Mr=n(4),Dr=n.n(Mr);function kr(){}function jr(t,e,n,r){var i=0,o=t.length;!function a(s){s||i===o?n&&n(s):r?setTimeout((function(){e(t[i++],a)}),1):e(t[i++],a)}()}function Nr(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}var Lr={};function Br(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fr(t,e,n){return e&&Br(t.prototype,e),n&&Br(t,n),t}var Ur=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),Gr=null;function Hr(){}var zr=function(){function t(e,n,r){if("string"!=typeof e||"string"!=typeof n)throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===n.indexOf("data:")),this.name=e,this.url=n,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===r.crossOrigin?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=Hr,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Dr.a,this.onProgress=new Dr.a,this.onComplete=new Dr.a,this.onAfterMiddleware=new Dr.a}t.setExtensionLoadType=function(e,n){Xr(t._loadTypeMap,e,n)},t.setExtensionXhrType=function(e,n){Xr(t._xhrTypeMap,e,n)};var e=t.prototype;return e.complete=function(){this._clearEvents(),this._finish()},e.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},e.load=function(e){var n=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout((function(){return e(n)}),1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:Ur&&this.crossOrigin?this._loadXdr():this._loadXhr()}},e._hasFlag=function(t){return 0!=(this._flags&t)},e._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},e._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},e._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,n=0;n<this.url.length;++n)this.data.appendChild(this._createSource(t,this.url[n],Array.isArray(e)?e[n]:e));else{var r=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(r)?r[0]:r))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},e._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=t.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},e._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout((function(){return t.send()}),1)},e._createSource=function(t,e,n){n||(n=t+"/"+this._getExtension(e));var r=document.createElement("source");return r.src=e,r.type=n,r},e._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},e._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},e._onTimeout=function(){this.abort("Load timed out.")},e._xhrOnError=function(){var t=this.xhr;this.abort(Vr(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},e._xhrOnTimeout=function(){var t=this.xhr;this.abort(Vr(t)+" Request timed out.")},e._xhrOnAbort=function(){var t=this.xhr;this.abort(Vr(t)+" Request was aborted by the user.")},e._xhrOnLoad=function(){var e=this.xhr,n="",r=void 0===e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(n=e.responseText),0===r&&(n.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?r=200:1223===r&&(r=204),2===(r/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=n,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(n),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var i=new DOMParser;this.data=i.parseFromString(n,"text/xml")}else{var o=document.createElement("div");o.innerHTML=n,this.data=o}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||n;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},e._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";e=e||window.location,Gr||(Gr=document.createElement("a")),Gr.href=t;var n=!(t=Rr()(Gr.href,{strictMode:!0})).port&&""===e.port||t.port===e.port,r=t.protocol?t.protocol+":":"";return t.host===e.hostname&&n&&r===e.protocol?"":"anonymous"},e._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},e._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},e._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var n=t.indexOf("/");e=t.substring(n+1,t.indexOf(";",n))}else{var r=t.indexOf("?"),i=t.indexOf("#"),o=Math.min(r>-1?r:t.length,i>-1?i:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},e._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},Fr(t,[{key:"isDataUrl",get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)}}]),t}();function Xr(t,e,n){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=n)}function Vr(t){return t.toString().replace("object ","")}zr.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},zr.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},zr.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},zr.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},zr._loadTypeMap={gif:zr.LOAD_TYPE.IMAGE,png:zr.LOAD_TYPE.IMAGE,bmp:zr.LOAD_TYPE.IMAGE,jpg:zr.LOAD_TYPE.IMAGE,jpeg:zr.LOAD_TYPE.IMAGE,tif:zr.LOAD_TYPE.IMAGE,tiff:zr.LOAD_TYPE.IMAGE,webp:zr.LOAD_TYPE.IMAGE,tga:zr.LOAD_TYPE.IMAGE,svg:zr.LOAD_TYPE.IMAGE,"svg+xml":zr.LOAD_TYPE.IMAGE,mp3:zr.LOAD_TYPE.AUDIO,ogg:zr.LOAD_TYPE.AUDIO,wav:zr.LOAD_TYPE.AUDIO,mp4:zr.LOAD_TYPE.VIDEO,webm:zr.LOAD_TYPE.VIDEO},zr._xhrTypeMap={xhtml:zr.XHR_RESPONSE_TYPE.DOCUMENT,html:zr.XHR_RESPONSE_TYPE.DOCUMENT,htm:zr.XHR_RESPONSE_TYPE.DOCUMENT,xml:zr.XHR_RESPONSE_TYPE.DOCUMENT,tmx:zr.XHR_RESPONSE_TYPE.DOCUMENT,svg:zr.XHR_RESPONSE_TYPE.DOCUMENT,tsx:zr.XHR_RESPONSE_TYPE.DOCUMENT,gif:zr.XHR_RESPONSE_TYPE.BLOB,png:zr.XHR_RESPONSE_TYPE.BLOB,bmp:zr.XHR_RESPONSE_TYPE.BLOB,jpg:zr.XHR_RESPONSE_TYPE.BLOB,jpeg:zr.XHR_RESPONSE_TYPE.BLOB,tif:zr.XHR_RESPONSE_TYPE.BLOB,tiff:zr.XHR_RESPONSE_TYPE.BLOB,webp:zr.XHR_RESPONSE_TYPE.BLOB,tga:zr.XHR_RESPONSE_TYPE.BLOB,json:zr.XHR_RESPONSE_TYPE.JSON,text:zr.XHR_RESPONSE_TYPE.TEXT,txt:zr.XHR_RESPONSE_TYPE.TEXT,ttf:zr.XHR_RESPONSE_TYPE.BUFFER,otf:zr.XHR_RESPONSE_TYPE.BUFFER},zr.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var Yr=window.URL||window.webkitURL,Wr={caching:function(t,e){var n=this;Lr[t.url]?(t.data=Lr[t.url],t.complete()):t.onComplete.once((function(){return Lr[n.url]=n.data})),e()},parsing:function(t,e){if(t.data){if(t.xhr&&t.xhrType===zr.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var n=Yr.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=n,t.type=zr.TYPE.IMAGE,void(t.data.onload=function(){Yr.revokeObjectURL(n),t.data.onload=null,e()})}}else{var r=t.xhr.getResponseHeader("content-type");if(r&&0===r.indexOf("image"))return t.data=new Image,t.data.src="data:"+r+";base64,"+function(t){for(var e="",n=0;n<t.length;){for(var r=[0,0,0],i=[0,0,0,0],o=0;o<r.length;++o)n<t.length?r[o]=255&t.charCodeAt(n++):r[o]=0;switch(i[0]=r[0]>>2,i[1]=(3&r[0])<<4|r[1]>>4,i[2]=(15&r[1])<<2|r[2]>>6,i[3]=63&r[2],n-(t.length-1)){case 2:i[3]=64,i[2]=64;break;case 1:i[3]=64}for(var a=0;a<i.length;++a)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i[a])}return e}(t.xhr.responseText),t.type=zr.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}},qr=/(#[\w-]+)?$/,Jr=function(){function t(e,n){var r=this;void 0===e&&(e=""),void 0===n&&(n=10),this.baseUrl=e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return r._loadResource(t,e)},this._queue=function(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var n=0,r={_tasks:[],concurrency:e,saturated:kr,unsaturated:kr,buffer:e/4,empty:kr,drain:kr,error:kr,started:!1,paused:!1,push:function(t,e){i(t,!1,e)},kill:function(){n=0,r.drain=kr,r.started=!1,r._tasks=[]},unshift:function(t,e){i(t,!0,e)},process:function(){for(;!r.paused&&n<r.concurrency&&r._tasks.length;){var e=r._tasks.shift();0===r._tasks.length&&r.empty(),(n+=1)===r.concurrency&&r.saturated(),t(e.data,Nr(o(e)))}},length:function(){return r._tasks.length},running:function(){return n},idle:function(){return r._tasks.length+n===0},pause:function(){!0!==r.paused&&(r.paused=!0)},resume:function(){if(!1!==r.paused){r.paused=!1;for(var t=1;t<=r.concurrency;t++)r.process()}}};function i(t,e,n){if(null!=n&&"function"!=typeof n)throw new Error("task callback must be a function");if(r.started=!0,null==t&&r.idle())setTimeout((function(){return r.drain()}),1);else{var i={data:t,callback:"function"==typeof n?n:kr};e?r._tasks.unshift(i):r._tasks.push(i),setTimeout((function(){return r.process()}),1)}}function o(t){return function(){n-=1,t.callback.apply(t,arguments),null!=arguments[0]&&r.error(arguments[0],t.data),n<=r.concurrency-r.buffer&&r.unsaturated(),r.idle()&&r.drain(),r.process()}}return r}(this._boundLoadResource,n),this._queue.pause(),this.resources={},this.onProgress=new Dr.a,this.onError=new Dr.a,this.onLoad=new Dr.a,this.onStart=new Dr.a,this.onComplete=new Dr.a;for(var i=0;i<t._defaultBeforeMiddleware.length;++i)this.pre(t._defaultBeforeMiddleware[i]);for(var o=0;o<t._defaultAfterMiddleware.length;++o)this.use(t._defaultAfterMiddleware[o])}var e=t.prototype;return e.add=function(t,e,n,r){if(Array.isArray(t)){for(var i=0;i<t.length;++i)this.add(t[i]);return this}if("object"==typeof t&&(r=e||t.callback||t.onComplete,n=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(r=n,n=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof n&&(r=n,n=null),this.loading&&(!n||!n.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new zr(t,e,n),"function"==typeof r&&this.resources[t].onAfterMiddleware.once(r),this.loading){for(var o=n.parentResource,a=[],s=0;s<o.children.length;++s)o.children[s].isComplete||a.push(o.children[s]);var u=o.progressChunk*(a.length+1)/(a.length+2);o.children.push(this.resources[t]),o.progressChunk=u;for(var c=0;c<a.length;++c)a[c].progressChunk=u;this.resources[t].progressChunk=u}return this._queue.push(this.resources[t]),this},e.pre=function(t){return this._beforeMiddleware.push(t),this},e.use=function(t){return this._afterMiddleware.push(t),this},e.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},e.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,n=0;n<this._queue._tasks.length;++n)this._queue._tasks[n].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},e._prepareUrl=function(t){var e,n=Rr()(t,{strictMode:!0});if(e=n.protocol||!n.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var r=qr.exec(e)[0];-1!==(e=e.substr(0,e.length-r.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=r}return e},e._loadResource=function(t,e){var n=this;t._dequeue=e,jr(this._beforeMiddleware,(function(e,r){e.call(n,t,(function(){r(t.isComplete?{}:null)}))}),(function(){t.isComplete?n._onLoad(t):(t._onLoadBinding=t.onComplete.once(n._onLoad,n),t.load())}),!0)},e._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),jr(this._afterMiddleware,(function(n,r){n.call(e,t,r)}),(function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(100,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()}),!0)},Fr(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),t}();Jr._defaultBeforeMiddleware=[],Jr._defaultAfterMiddleware=[],Jr.pre=function(t){return Jr._defaultBeforeMiddleware.push(t),Jr},Jr.use=function(t){return Jr._defaultAfterMiddleware.push(t),Jr};var Kr=function(){};Kr.use=function(t,e){t.data&&t.type===zr.TYPE.IMAGE&&(t.texture=He.fromLoader(t.data,t.url,t.name)),e()};var Zr=function(t){function e(n,r){var i=this;t.call(this,n,r),X.a.call(this);for(var o=0;o<e._plugins.length;++o){var a=e._plugins[o],s=a.pre,u=a.use;s&&this.pre(s),u&&this.use(u)}this.onStart.add((function(t){return i.emit("start",t)})),this.onProgress.add((function(t,e){return i.emit("progress",t,e)})),this.onError.add((function(t,e,n){return i.emit("error",t,e,n)})),this.onLoad.add((function(t,e){return i.emit("load",t,e)})),this.onComplete.add((function(t,e){return i.emit("complete",t,e)})),this._protected=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={shared:{configurable:!0}};return e.prototype.destroy=function(){this._protected||(this.removeAllListeners(),this.reset())},n.shared.get=function(){var t=e._shared;return t||((t=new e)._protected=!0,e._shared=t),t},Object.defineProperties(e,n),e}(Jr);Object.assign(Zr.prototype,X.a.prototype),Zr._plugins=[],Zr.registerPlugin=function(t){return Zr._plugins.push(t),t.add&&t.add(),Zr},Zr.registerPlugin({use:Wr.parsing}),Zr.registerPlugin(Kr);var Qr=function(){};Qr.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?Zr.shared:new Zr},Qr.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)};var $r=zr,ti=function(t,e,n){this.geometry=new tn,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(var r=0;r<t.length;++r){var i=t[r];i={attributeName:i.attributeName,size:i.size,uploadFunction:i.uploadFunction,type:i.type||D.FLOAT,offset:i.offset},e[r]?this.dynamicProperties.push(i):this.staticProperties.push(i)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()};ti.prototype.initBuffers=function(){var t=this.geometry,e=0;this.indexBuffer=new qe(ct(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(var n=0;n<this.dynamicProperties.length;++n){var r=this.dynamicProperties[n];r.offset=e,e+=r.size,this.dynamicStride+=r.size}var i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new qe(this.dynamicData,!1,!1);var o=0;this.staticStride=0;for(var a=0;a<this.staticProperties.length;++a){var s=this.staticProperties[a];s.offset=o,o+=s.size,this.staticStride+=s.size}var u=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(u),this.staticDataUint32=new Uint32Array(u),this.staticBuffer=new qe(this.staticData,!0,!1);for(var c=0;c<this.dynamicProperties.length;++c){var l=this.dynamicProperties[c];t.addAttribute(l.attributeName,this.dynamicBuffer,0,l.type===D.UNSIGNED_BYTE,l.type,4*this.dynamicStride,4*l.offset)}for(var h=0;h<this.staticProperties.length;++h){var d=this.staticProperties[h];t.addAttribute(d.attributeName,this.staticBuffer,0,d.type===D.UNSIGNED_BYTE,d.type,4*this.staticStride,4*d.offset)}},ti.prototype.uploadDynamic=function(t,e,n){for(var r=0;r<this.dynamicProperties.length;r++){var i=this.dynamicProperties[r];i.uploadFunction(t,e,n,i.type===D.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer._updateID++},ti.prototype.uploadStatic=function(t,e,n){for(var r=0;r<this.staticProperties.length;r++){var i=this.staticProperties[r];i.uploadFunction(t,e,n,i.type===D.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer._updateID++},ti.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()};var ei=function(t){function e(e){t.call(this,e),this.shader=null,this.properties=null,this.tempMatrix=new Ut,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:D.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Un.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=Hn.for2d()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=t.children,n=t._maxSize,r=t._batchSize,i=this.renderer,o=e.length;if(0!==o){o>n&&!t.autoResize&&(o=n);var a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));var s=e[0]._texture.baseTexture;this.state.blendMode=ot(t.blendMode,s.alphaMode),i.state.set(this.state);var u=i.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=at(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,s.alphaMode),this.shader.uniforms.uSampler=s,this.renderer.shader.bind(this.shader);for(var l=!1,h=0,d=0;h<o;h+=r,d+=1){var f=o-h;f>r&&(f=r),d>=a.length&&a.push(this._generateOneMoreBuffer(t));var p=a[d];p.uploadDynamic(e,h,f);var m=t._bufferUpdateIDs[d]||0;(l=l||p._updateID<m)&&(p._updateID=t._updateID,p.uploadStatic(e,h,f)),i.geometry.bind(p.geometry),u.drawElements(u.TRIANGLES,6*f,u.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(t){for(var e=[],n=t._maxSize,r=t._batchSize,i=t._properties,o=0;o<n;o+=r)e.push(new ti(this.properties,i,r));return e},e.prototype._generateOneMoreBuffer=function(t){var e=t._batchSize,n=t._properties;return new ti(this.properties,n,e)},e.prototype.uploadVertices=function(t,e,n,r,i,o){for(var a=0,s=0,u=0,c=0,l=0;l<n;++l){var h=t[e+l],d=h._texture,f=h.scale.x,p=h.scale.y,m=d.trim,y=d.orig;m?(a=(s=m.x-h.anchor.x*y.width)+m.width,u=(c=m.y-h.anchor.y*y.height)+m.height):(a=y.width*(1-h.anchor.x),s=y.width*-h.anchor.x,u=y.height*(1-h.anchor.y),c=y.height*-h.anchor.y),r[o]=s*f,r[o+1]=c*p,r[o+i]=a*f,r[o+i+1]=c*p,r[o+2*i]=a*f,r[o+2*i+1]=u*p,r[o+3*i]=s*f,r[o+3*i+1]=u*p,o+=4*i}},e.prototype.uploadPosition=function(t,e,n,r,i,o){for(var a=0;a<n;a++){var s=t[e+a].position;r[o]=s.x,r[o+1]=s.y,r[o+i]=s.x,r[o+i+1]=s.y,r[o+2*i]=s.x,r[o+2*i+1]=s.y,r[o+3*i]=s.x,r[o+3*i+1]=s.y,o+=4*i}},e.prototype.uploadRotation=function(t,e,n,r,i,o){for(var a=0;a<n;a++){var s=t[e+a].rotation;r[o]=s,r[o+i]=s,r[o+2*i]=s,r[o+3*i]=s,o+=4*i}},e.prototype.uploadUvs=function(t,e,n,r,i,o){for(var a=0;a<n;++a){var s=t[e+a]._texture._uvs;s?(r[o]=s.x0,r[o+1]=s.y0,r[o+i]=s.x1,r[o+i+1]=s.y1,r[o+2*i]=s.x2,r[o+2*i+1]=s.y2,r[o+3*i]=s.x3,r[o+3*i+1]=s.y3,o+=4*i):(r[o]=0,r[o+1]=0,r[o+i]=0,r[o+i+1]=0,r[o+2*i]=0,r[o+2*i+1]=0,r[o+3*i]=0,r[o+3*i+1]=0,o+=4*i)}},e.prototype.uploadTint=function(t,e,n,r,i,o){for(var a=0;a<n;++a){var s=t[e+a],u=s._texture.baseTexture.alphaMode>0,c=s.alpha,l=c<1&&u?st(s._tintRGB,c):s._tintRGB+(255*c<<24);r[o]=l,r[o+i]=l,r[o+2*i]=l,r[o+3*i]=l,o+=4*i}},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e}(un),ni={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive||!t||Number.isNaN(t))return e;var n=Math.ceil(t/this.maxLength);return n<this.minSegments?n=this.minSegments:n>this.maxSegments&&(n=this.maxSegments),n}},ri=function(){this.reset()};ri.prototype.clone=function(){var t=new ri;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t},ri.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=He.WHITE,this.matrix=null,this.visible=!1},ri.prototype.destroy=function(){this.texture=null,this.matrix=null};var ii={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var n=t.points,r=t.holes,i=e.points,o=e.indices;if(n.length>=6){for(var a=[],s=0;s<r.length;s++){var u=r[s];a.push(n.length/2),n=n.concat(u.points)}var c=Y()(n,a,2);if(!c)return;for(var l=i.length/2,h=0;h<c.length;h+=3)o.push(c[h]+l),o.push(c[h+1]+l),o.push(c[h+2]+l);for(var d=0;d<n.length;d++)i.push(n[d])}}},oi={build:function(t){var e,n,r=t.shape,i=t.points,o=r.x,a=r.y;if(i.length=0,t.type===kt.CIRC?(e=r.radius,n=r.radius):(e=r.width,n=r.height),0!==e&&0!==n){var s=Math.floor(30*Math.sqrt(r.radius))||Math.floor(15*Math.sqrt(r.width+r.height));s/=2.3;for(var u=2*Math.PI/s,c=0;c<s-.5;c++)i.push(o+Math.sin(-u*c)*e,a+Math.cos(-u*c)*n);i.push(i[0],i[1])}},triangulate:function(t,e){var n=t.points,r=e.points,i=e.indices,o=r.length/2,a=o;r.push(t.shape.x,t.shape.y);for(var s=0;s<n.length;s+=2)r.push(n[s],n[s+1]),i.push(o++,a,o)}},ai={build:function(t){var e=t.shape,n=t.points,r=e.x,i=e.y,o=e.width,a=e.height,s=e.radius;n.length=0,ui(r,i+s,r,i,r+s,i,n),ui(r+o-s,i,r+o,i,r+o,i+s,n),ui(r+o,i+a-s,r+o,i+a,r+o-s,i+a,n),ui(r+s,i+a,r,i+a,r,i+a-s,n)},triangulate:function(t,e){for(var n=t.points,r=e.points,i=e.indices,o=r.length/2,a=Y()(n,null,2),s=0,u=a.length;s<u;s+=3)i.push(a[s]+o),i.push(a[s+1]+o),i.push(a[s+2]+o);for(var c=0,l=n.length;c<l;c++)r.push(n[c],n[++c])}};function si(t,e,n){return t+(e-t)*n}function ui(t,e,n,r,i,o,a){void 0===a&&(a=[]);for(var s=a,u=0,c=0,l=0,h=0,d=0,f=0,p=0,m=0;p<=20;++p)u=si(t,n,m=p/20),c=si(e,r,m),l=si(n,i,m),h=si(r,o,m),d=si(u,l,m),f=si(c,h,m),s.push(d,f);return s}function ci(t,e){t.lineStyle.native?function(t,e){var n=0,r=t.shape,i=t.points||r.points,o=r.type!==kt.POLY||r.closeStroke;if(0!==i.length){var a=e.points,s=e.indices,u=i.length/2,c=a.length/2,l=c;for(a.push(i[0],i[1]),n=1;n<u;n++)a.push(i[2*n],i[2*n+1]),s.push(l,l+1),l++;o&&s.push(l,c)}}(t,e):function(t,e){var n=t.shape,r=t.points||n.points.slice(),i=e.closePointEps;if(0!==r.length){var o=t.lineStyle,a=new jt(r[0],r[1]),s=new jt(r[r.length-2],r[r.length-1]),u=n.type!==kt.POLY||n.closeStroke,c=Math.abs(a.x-s.x)<i&&Math.abs(a.y-s.y)<i;if(u){r=r.slice(),c&&(r.pop(),r.pop(),s.set(r[r.length-2],r[r.length-1]));var l=s.x+.5*(a.x-s.x),h=s.y+.5*(a.y-s.y);r.unshift(l,h),r.push(l,h)}var d=e.points,f=r.length/2,p=r.length,m=d.length/2,y=o.width/2,g=r[0],v=r[1],_=r[2],b=r[3],x=0,w=0,E=-(v-b),T=g-_,O=0,A=0,S=0,I=0,P=Math.sqrt(E*E+T*T);E/=P,T/=P,E*=y,T*=y;var C=o.alignment,R=2*(1-C),M=2*C;d.push(g-E*R,v-T*R),d.push(g+E*M,v+T*M);for(var D=1;D<f-1;++D){g=r[2*(D-1)],v=r[2*(D-1)+1],_=r[2*D],b=r[2*D+1],x=r[2*(D+1)],w=r[2*(D+1)+1],E=-(v-b),T=g-_,E/=P=Math.sqrt(E*E+T*T),T/=P,E*=y,T*=y,O=-(b-w),A=_-x,O/=P=Math.sqrt(O*O+A*A),A/=P;var k=-T+v-(-T+b),j=-E+_-(-E+g),N=(-E+g)*(-T+b)-(-E+_)*(-T+v),L=-(A*=y)+w-(-A+b),B=-(O*=y)+_-(-O+x),F=(-O+x)*(-A+b)-(-O+_)*(-A+w),U=k*B-L*j;if(Math.abs(U)<.1)U+=10.1,d.push(_-E*R,b-T*R),d.push(_+E*M,b+T*M);else{var G=(j*F-B*N)/U,H=(L*N-k*F)/U;(G-_)*(G-_)+(H-b)*(H-b)>196*y*y?(S=E-O,I=T-A,S/=P=Math.sqrt(S*S+I*I),I/=P,S*=y,I*=y,d.push(_-S*R,b-I*R),d.push(_+S*M,b+I*M),d.push(_-S*M*R,b-I*R),p++):(d.push(_+(G-_)*R,b+(H-b)*R),d.push(_-(G-_)*M,b-(H-b)*M))}}g=r[2*(f-2)],v=r[2*(f-2)+1],_=r[2*(f-1)],E=-(v-(b=r[2*(f-1)+1])),T=g-_,E/=P=Math.sqrt(E*E+T*T),T/=P,E*=y,T*=y,d.push(_-E*R,b-T*R),d.push(_+E*M,b+T*M);for(var z=e.indices,X=0;X<p-2;++X)z.push(m,m+1,m+2),m++}}(t,e)}var li=function(t){function e(e,n,r,i,o,a){o=o||i/2;for(var s=-1*Math.PI/2+a,u=2*r,c=Lt/u,l=[],h=0;h<u;h++){var d=h%2?o:i,f=h*c+s;l.push(e+d*Math.cos(f),n+d*Math.sin(f))}t.call(this,l)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}($t),hi=function(){};hi.curveTo=function(t,e,n,r,i,o){var a=o[o.length-2],s=o[o.length-1]-e,u=a-t,c=r-e,l=n-t,h=Math.abs(s*l-u*c);if(h<1e-8||0===i)return o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e),null;var d=s*s+u*u,f=c*c+l*l,p=s*c+u*l,m=i*Math.sqrt(d)/h,y=i*Math.sqrt(f)/h,g=m*p/d,v=y*p/f,_=m*l+y*u,b=m*c+y*s,x=u*(y+g),w=s*(y+g),E=l*(m+v),T=c*(m+v);return{cx:_+t,cy:b+e,radius:i,startAngle:Math.atan2(w-b,x-_),endAngle:Math.atan2(T-b,E-_),anticlockwise:u*c>l*s}},hi.arc=function(t,e,n,r,i,o,a,s,u){for(var c=a-o,l=ni._segmentsCount(Math.abs(c)*i,40*Math.ceil(Math.abs(c)/Lt)),h=c/(2*l),d=2*h,f=Math.cos(h),p=Math.sin(h),m=l-1,y=m%1/m,g=0;g<=m;++g){var v=h+o+d*(g+y*g),_=Math.cos(v),b=-Math.sin(v);u.push((f*_+p*b)*i+n,(f*-b+p*_)*i+r)}};var di=function(){};di.curveLength=function(t,e,n,r,i,o,a,s){for(var u=0,c=0,l=0,h=0,d=0,f=0,p=0,m=0,y=0,g=0,v=0,_=t,b=e,x=1;x<=10;++x)g=_-(m=(p=(f=(d=1-(c=x/10))*d)*d)*t+3*f*c*n+3*d*(l=c*c)*i+(h=l*c)*a),v=b-(y=p*e+3*f*c*r+3*d*l*o+h*s),_=m,b=y,u+=Math.sqrt(g*g+v*v);return u},di.curveTo=function(t,e,n,r,i,o,a){var s=a[a.length-2],u=a[a.length-1];a.length-=2;var c=ni._segmentsCount(di.curveLength(s,u,t,e,n,r,i,o)),l=0,h=0,d=0,f=0,p=0;a.push(s,u);for(var m=1,y=0;m<=c;++m)d=(h=(l=1-(y=m/c))*l)*l,p=(f=y*y)*y,a.push(d*s+3*h*y*t+3*l*f*n+p*i,d*u+3*h*y*e+3*l*f*r+p*o)};var fi=function(){};fi.curveLength=function(t,e,n,r,i,o){var a=t-2*n+i,s=e-2*r+o,u=2*n-2*t,c=2*r-2*e,l=4*(a*a+s*s),h=4*(a*u+s*c),d=u*u+c*c,f=2*Math.sqrt(l+h+d),p=Math.sqrt(l),m=2*l*p,y=2*Math.sqrt(d),g=h/p;return(m*f+p*h*(f-y)+(4*d*l-h*h)*Math.log((2*p+g+f)/(g+y)))/(4*m)},fi.curveTo=function(t,e,n,r,i){for(var o=i[i.length-2],a=i[i.length-1],s=ni._segmentsCount(fi.curveLength(o,a,t,e,n,r)),u=0,c=0,l=1;l<=s;++l){var h=l/s;u=o+(t-o)*h,c=a+(e-a)*h,i.push(u+(t+(n-t)*h-u)*h,c+(e+(r-e)*h-c)*h)}};var pi=function(){this.reset()};pi.prototype.begin=function(t,e,n){this.reset(),this.style=t,this.start=e,this.attribStart=n},pi.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},pi.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0};var mi={};mi[kt.POLY]=ii,mi[kt.CIRC]=oi,mi[kt.ELIP]=oi,mi[kt.RECT]={build:function(t){var e=t.shape,n=e.x,r=e.y,i=e.width,o=e.height,a=t.points;a.length=0,a.push(n,r,n+i,r,n+i,r+o,n,r+o)},triangulate:function(t,e){var n=t.points,r=e.points,i=r.length/2;r.push(n[0],n[1],n[2],n[3],n[6],n[7],n[4],n[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},mi[kt.RREC]=ai;var yi=[],gi=[],vi=function(t,e,n,r){void 0===e&&(e=null),void 0===n&&(n=null),void 0===r&&(r=null),this.shape=t,this.lineStyle=n,this.fillStyle=e,this.matrix=r,this.type=t.type,this.points=[],this.holes=[]};vi.prototype.clone=function(){return new vi(this.shape,this.fillStyle,this.lineStyle,this.matrix)},vi.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null};var _i=new jt,bi=new ee,xi=function(t){function e(){t.call(this),this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.dirty=0,this.batchDirty=-1,this.cacheDirty=-1,this.clearDirty=0,this.drawCalls=[],this.batches=[],this.shapeIndex=0,this._bounds=new ee,this.boundsDirty=-1,this.boundsPadding=0,this.batchable=!1,this.indicesUint16=null,this.uvsFloat32=null,this.closePointEps=1e-4}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={bounds:{configurable:!0}};return n.bounds.get=function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},e.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].textures.length=0,gi.push(this.drawCalls[t]);this.drawCalls.length=0;for(var e=0;e<this.batches.length;e++){var n=this.batches[e];n.reset(),yi.push(n)}this.batches.length=0},e.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},e.prototype.drawShape=function(t,e,n,r){var i=new vi(t,e,n,r);return this.graphicsData.push(i),this.dirty++,this},e.prototype.drawHole=function(t,e){if(!this.graphicsData.length)return null;var n=new vi(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=r.lineStyle,r.holes.push(n),this.dirty++,this},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e);for(var n=0;n<this.graphicsData.length;++n)this.graphicsData[n].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(t){for(var e=this.graphicsData,n=0;n<e.length;++n){var r=e[n];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(t,_i):_i.copyFrom(t),r.shape.contains(_i.x,_i.y))){var i=!1;if(r.holes)for(var o=0;o<r.holes.length;o++)if(r.holes[o].shape.contains(_i.x,_i.y)){i=!0;break}if(!i)return!0}}return!1},e.prototype.updateBatches=function(){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var t=this.uvs,e=this.graphicsData,n=null,r=null;this.batches.length>0&&(r=(n=this.batches[this.batches.length-1]).style);for(var i=this.shapeIndex;i<e.length;i++){this.shapeIndex++;var o=e[i],a=o.fillStyle,s=o.lineStyle;mi[o.type].build(o),o.matrix&&this.transformPoints(o.points,o.matrix);for(var u=0;u<2;u++){var c=0===u?a:s;if(c.visible){var l=c.texture.baseTexture,h=this.indices.length,d=this.points.length/2;l.wrapMode=j.REPEAT,0===u?this.processFill(o):this.processLine(o);var f=this.points.length/2-d;0!==f&&(n&&!this._compareStyles(r,c)&&(n.end(h,d),n=null),n||((n=yi.pop()||new pi).begin(c,h,d),this.batches.push(n),r=c),this.addUvs(this.points,t,c.texture,d,f,c.matrix))}}}if(n){var p=this.indices.length,m=this.points.length/2;n.end(p,m)}0!==this.batches.length?(this.indicesUint16=new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()):this.batchable=!0}}else this.batchable=!0},e.prototype._compareStyles=function(t,e){return!(!t||!e)&&t.texture.baseTexture===e.texture.baseTexture&&t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native},e.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var n=this.graphicsData[t],r=n.fillStyle,i=n.lineStyle;if(r&&!r.texture.baseTexture.valid)return!1;if(i&&!i.texture.baseTexture.valid)return!1}return!0},e.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,e=0,n=t.length;e<n;e++)for(var r=t[e],i=0;i<r.size;i++){var o=r.start+i;this.indicesUint16[o]=this.indicesUint16[o]-r.attribStart}},e.prototype.isBatchable=function(){for(var t=this.batches,n=0;n<t.length;n++)if(t[n].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE},e.prototype.buildDrawCalls=function(){for(var t=++Ie._globalBatch,e=0;e<this.drawCalls.length;e++)this.drawCalls[e].textures.length=0,gi.push(this.drawCalls[e]);this.drawCalls.length=0;var n=this.colors,r=this.textureIds,i=gi.pop();i||((i=new fr).textures=new pr),i.textures.count=0,i.start=0,i.size=0,i.type=C.TRIANGLES;var o=0,a=null,s=0,u=!1,c=C.TRIANGLES,l=0;this.drawCalls.push(i);for(var h=0;h<this.batches.length;h++){var d=this.batches[h],f=d.style,p=f.texture.baseTexture;u!==!!f.native&&(c=(u=!!f.native)?C.LINES:C.TRIANGLES,a=null,o=8,t++),a!==p&&(a=p,p._batchEnabled!==t&&(8===o&&(t++,o=0,i.size>0&&((i=gi.pop())||((i=new fr).textures=new pr),this.drawCalls.push(i)),i.start=l,i.size=0,i.textures.count=0,i.type=c),p.touched=1,p._batchEnabled=t,p._batchLocation=o,p.wrapMode=10497,i.textures.elements[i.textures.count++]=p,o++)),i.size+=d.size,l+=d.size,s=p._batchLocation,this.addColors(n,f.color,f.alpha,d.attribSize),this.addTextureIds(r,s,d.attribSize)}Ie._globalBatch=t,this.packAttributes()},e.prototype.packAttributes=function(){for(var t=this.points,e=this.uvs,n=this.colors,r=this.textureIds,i=new ArrayBuffer(3*t.length*4),o=new Float32Array(i),a=new Uint32Array(i),s=0,u=0;u<t.length/2;u++)o[s++]=t[2*u],o[s++]=t[2*u+1],o[s++]=e[2*u],o[s++]=e[2*u+1],a[s++]=n[u],o[s++]=r[u];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)},e.prototype.processFill=function(t){t.holes.length?(this.processHoles(t.holes),ii.triangulate(t,this)):mi[t.type].triangulate(t,this)},e.prototype.processLine=function(t){ci(t,this);for(var e=0;e<t.holes.length;e++)ci(t.holes[e],this)},e.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var n=t[e];mi[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}},e.prototype.calculateBounds=function(){var t=this._bounds,e=bi,n=Ut.IDENTITY;this._bounds.clear(),e.clear();for(var r=0;r<this.graphicsData.length;r++){var i=this.graphicsData[r],o=i.shape,a=i.type,s=i.lineStyle,u=i.matrix||Ut.IDENTITY,c=0;if(s&&s.visible){var l=s.alignment;c=s.width,a===kt.POLY?c*=.5+Math.abs(.5-l):c*=Math.max(0,l)}n!==u&&(e.isEmpty()||(t.addBoundsMatrix(e,n),e.clear()),n=u),a===kt.RECT||a===kt.RREC?e.addFramePad(o.x,o.y,o.x+o.width,o.y+o.height,c,c):a===kt.CIRC?e.addFramePad(o.x,o.y,o.x,o.y,o.radius+c,o.radius+c):a===kt.ELIP?e.addFramePad(o.x,o.y,o.x,o.y,o.width+c,o.height+c):t.addVerticesMatrix(n,o.points,0,o.points.length,c,c)}e.isEmpty()||t.addBoundsMatrix(e,n),t.pad(this.boundsPadding,this.boundsPadding)},e.prototype.transformPoints=function(t,e){for(var n=0;n<t.length/2;n++){var r=t[2*n],i=t[2*n+1];t[2*n]=e.a*r+e.c*i+e.tx,t[2*n+1]=e.b*r+e.d*i+e.ty}},e.prototype.addColors=function(t,e,n,r){for(var i=st((e>>16)+(65280&e)+((255&e)<<16),n);r-- >0;)t.push(i)},e.prototype.addTextureIds=function(t,e,n){for(;n-- >0;)t.push(e)},e.prototype.addUvs=function(t,e,n,r,i,o){for(var a=0,s=e.length,u=n.frame;a<i;){var c=t[2*(r+a)],l=t[2*(r+a)+1];if(o){var h=o.a*c+o.c*l+o.tx;l=o.b*c+o.d*l+o.ty,c=h}a++,e.push(c/u.width,l/u.height)}var d=n.baseTexture;(u.width<d.width||u.height<d.height)&&this.adjustUvs(e,n,s,i)},e.prototype.adjustUvs=function(t,e,n,r){for(var i=e.baseTexture,o=n+2*r,a=e.frame,s=a.width/i.width,u=a.height/i.height,c=a.x/a.width,l=a.y/a.height,h=Math.floor(t[n]+1e-6),d=Math.floor(t[n+1]+1e-6),f=n+2;f<o;f+=2)h=Math.min(h,Math.floor(t[f]+1e-6)),d=Math.min(d,Math.floor(t[f+1]+1e-6));c-=h,l-=d;for(var p=n;p<o;p+=2)t[p]=(t[p]+c)*s,t[p+1]=(t[p+1]+l)*u},Object.defineProperties(e.prototype,n),e}(_r);xi.BATCHABLE_SIZE=100;var wi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t},e.prototype.reset=function(){t.prototype.reset.call(this),this.color=0,this.width=0,this.alignment=.5,this.native=!1},e}(ri),Ei=new Float32Array(3),Ti={},Oi=function(t){function e(e){void 0===e&&(e=null),t.call(this),this.geometry=e||new xi,this.geometry.refCount++,this.shader=null,this.state=Hn.for2d(),this._fillStyle=new ri,this._lineStyle=new wi,this._matrix=null,this._holeMode=!1,this.currentPath=null,this.batches=[],this.batchTint=-1,this.vertexData=null,this._transformID=-1,this.batchDirty=-1,this.pluginName="batch",this.tint=16777215,this.blendMode=P.NORMAL}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={blendMode:{configurable:!0},tint:{configurable:!0},fill:{configurable:!0},line:{configurable:!0}};return e.prototype.clone=function(){return this.finishPoly(),new e(this.geometry)},n.blendMode.set=function(t){this.state.blendMode=t},n.blendMode.get=function(){return this.state.blendMode},n.tint.get=function(){return this._tint},n.tint.set=function(t){this._tint=t},n.fill.get=function(){return this._fillStyle},n.line.get=function(){return this._lineStyle},e.prototype.lineStyle=function(t){if("number"==typeof t){var e=arguments;t={width:e[0]||0,color:e[1]||0,alpha:void 0!==e[2]?e[2]:1,alignment:void 0!==e[3]?e[3]:.5,native:!!e[4]}}return this.lineTextureStyle(t)},e.prototype.lineTextureStyle=function(t){if("number"==typeof t){xt("v5.2.0","Please use object-based options for Graphics#lineTextureStyle");var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3],o=arguments[4],a=arguments[5],s=arguments[6];t={width:e,texture:n,color:r,alpha:i,matrix:o,alignment:a,native:s},Object.keys(t).forEach((function(e){return void 0===t[e]&&delete t[e]}))}t=Object.assign({width:0,texture:He.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1},t),this.currentPath&&this.startPoly();var u=t.width>0&&t.alpha>0;return u?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:u},t)):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new $t,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new $t,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},e.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var n=this.currentPath.points,r=n[n.length-2],i=n[n.length-1];return r===t&&i===e||n.push(t,e),this},e.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},e.prototype.quadraticCurveTo=function(t,e,n,r){this._initCurve();var i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),fi.curveTo(t,e,n,r,i),this},e.prototype.bezierCurveTo=function(t,e,n,r,i,o){return this._initCurve(),di.curveTo(t,e,n,r,i,o,this.currentPath.points),this},e.prototype.arcTo=function(t,e,n,r,i){this._initCurve(t,e);var o=this.currentPath.points,a=hi.curveTo(t,e,n,r,i,o);if(a){var s=a.cx,u=a.cy,c=a.radius,l=a.startAngle,h=a.endAngle,d=a.anticlockwise;this.arc(s,u,c,l,h,d)}return this},e.prototype.arc=function(t,e,n,r,i,o){if(void 0===o&&(o=!1),r===i)return this;if(!o&&i<=r?i+=Lt:o&&r<=i&&(r+=Lt),0===i-r)return this;var a=t+Math.cos(r)*n,s=e+Math.sin(r)*n,u=this.geometry.closePointEps,c=this.currentPath?this.currentPath.points:null;if(c){var l=Math.abs(c[c.length-2]-a),h=Math.abs(c[c.length-1]-s);l<u&&h<u||c.push(a,s)}else this.moveTo(a,s),c=this.currentPath.points;return hi.arc(a,s,t,e,n,r,i,o,c),this},e.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill({texture:He.WHITE,color:t,alpha:e})},e.prototype.beginTextureFill=function(t){if(t instanceof He){xt("v5.2.0","Please use object-based options for Graphics#beginTextureFill");var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];t={texture:e,color:n,alpha:r,matrix:i},Object.keys(t).forEach((function(e){return void 0===t[e]&&delete t[e]}))}t=Object.assign({texture:He.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var o=t.alpha>0;return o?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:o},t)):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(t,e,n,r){return this.drawShape(new Kt(t,e,n,r))},e.prototype.drawRoundedRect=function(t,e,n,r,i){return this.drawShape(new te(t,e,n,r,i))},e.prototype.drawCircle=function(t,e,n){return this.drawShape(new Zt(t,e,n))},e.prototype.drawEllipse=function(t,e,n,r){return this.drawShape(new Qt(t,e,n,r))},e.prototype.drawPolygon=function(t){var e=arguments,n=t,r=!0;if(n.points&&(r=n.closeStroke,n=n.points),!Array.isArray(n)){n=new Array(arguments.length);for(var i=0;i<n.length;++i)n[i]=e[i]}var o=new $t(n);return o.closeStroke=r,this.drawShape(o),this},e.prototype.drawShape=function(t){return this._holeMode?this.geometry.drawHole(t,this._matrix):this.geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.drawStar=function(t,e,n,r,i,o){return void 0===o&&(o=0),this.drawPolygon(new li(t,e,n,r,i,o))},e.prototype.clear=function(){return this.geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){return 1===this.geometry.graphicsData.length&&this.geometry.graphicsData[0].shape.type===kt.RECT&&!this.geometry.graphicsData[0].lineWidth},e.prototype._render=function(t){this.finishPoly();var e=this.geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},e.prototype._populateBatches=function(){var t=this.geometry,e=this.blendMode;this.batches=[],this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.vertexData=new Float32Array(t.points);for(var n=0,r=t.batches.length;n<r;n++){var i=t.batches[n],o=i.style.color,a=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),s=new Float32Array(t.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),u={vertexData:a,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*i.start,i.size),uvs:s,_batchRGB:tt(o),_tintRGB:o,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[n]=u}},e.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,n=this.batches.length;e<n;e++){var r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}},e.prototype._renderDirect=function(t){var e=this._resolveDirectShader(t),n=this.geometry,r=this.tint,i=this.worldAlpha,o=e.uniforms,a=n.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(r>>16&255)/255*i,o.tint[1]=(r>>8&255)/255*i,o.tint[2]=(255&r)/255*i,o.tint[3]=i,t.shader.bind(e),t.geometry.bind(n,e),t.state.set(this.state);for(var s=0,u=a.length;s<u;s++)this._renderDrawCallDirect(t,n.drawCalls[s])},e.prototype._renderDrawCallDirect=function(t,e){for(var n=e.textures,r=e.type,i=e.size,o=e.start,a=n.count,s=0;s<a;s++)t.texture.bind(n.elements[s],s);t.geometry.draw(r,i,o)},e.prototype._resolveDirectShader=function(t){var e=this.shader,n=this.pluginName;if(!e){if(!Ti[n]){for(var r=new Int32Array(16),i=0;i<16;i++)r[i]=i;var o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ut,default:on.from({uSamplers:r},!0)},a=t.plugins[n]._shader.program;Ti[n]=new Un(a,o)}e=Ti[n]}return e},e.prototype._calculateBounds=function(){this.finishPoly();var t=this.geometry;if(t.graphicsData.length){var e=t.bounds,n=e.minX,r=e.minY,i=e.maxX,o=e.maxY;this._bounds.addFrame(this.transform,n,r,i,o)}},e.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this.geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=tt(this.tint,Ei),e=0;e<this.batches.length;e++){var n=this.batches[e],r=n._batchRGB,i=(t[0]*r[0]*255<<16)+(t[1]*r[1]*255<<8)+(0|t[2]*r[2]*255);n._tintRGB=(i>>16)+(65280&i)+((255&i)<<16)}}},e.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID;for(var t=this.transform.worldTransform,e=t.a,n=t.b,r=t.c,i=t.d,o=t.tx,a=t.ty,s=this.geometry.points,u=this.vertexData,c=0,l=0;l<s.length;l+=2){var h=s[l],d=s[l+1];u[c++]=e*h+r*d+o,u[c++]=i*d+n*h+a}}},e.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0),this},e.prototype.setMatrix=function(t){return this._matrix=t,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this.geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,t.prototype.destroy.call(this,e)},Object.defineProperties(e.prototype,n),e}(ie);Oi._TEMP_POINT=new jt;var Ai=new jt,Si=new Uint16Array([0,1,2,0,2,3]),Ii=function(t){function e(e){t.call(this),this._anchor=new Nt(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=P.NORMAL,this.shader=null,this._cachedTint=16777215,this.uvs=null,this.texture=e||He.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Si,this.size=4,this.start=0,this.pluginName="batch",this.isSprite=!0,this._roundPixels=H.ROUND_PIXELS}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={roundPixels:{configurable:!0},width:{configurable:!0},height:{configurable:!0},anchor:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=gt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=gt(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,n=e.a,r=e.b,i=e.c,o=e.d,a=e.tx,s=e.ty,u=this.vertexData,c=t.trim,l=t.orig,h=this._anchor,d=0,f=0,p=0,m=0;if(c?(d=(f=c.x-h._x*l.width)+c.width,p=(m=c.y-h._y*l.height)+c.height):(d=(f=-h._x*l.width)+l.width,p=(m=-h._y*l.height)+l.height),u[0]=n*f+i*m+a,u[1]=o*m+r*f+s,u[2]=n*d+i*m+a,u[3]=o*m+r*d+s,u[4]=n*d+i*p+a,u[5]=o*p+r*d+s,u[6]=n*f+i*p+a,u[7]=o*p+r*f+s,this._roundPixels)for(var y=H.RESOLUTION,g=0;g<u.length;++g)u[g]=Math.round((u[g]*y|0)/y)}},e.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,n=t.orig,r=this._anchor,i=this.transform.worldTransform,o=i.a,a=i.b,s=i.c,u=i.d,c=i.tx,l=i.ty,h=-r._x*n.width,d=h+n.width,f=-r._y*n.height,p=f+n.height;e[0]=o*h+s*f+c,e[1]=u*f+a*h+l,e[2]=o*d+s*f+c,e[3]=u*f+a*d+l,e[4]=o*d+s*p+c,e[5]=u*p+a*d+l,e[6]=o*h+s*p+c,e[7]=u*p+a*h+l},e.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Kt),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Ai);var e=this._texture.orig.width,n=this._texture.orig.height,r=-e*this.anchor.x,i=0;return Ai.x>=r&&Ai.x<r+e&&(i=-n*this.anchor.y,Ai.y>=i&&Ai.y<i+n)},e.prototype.destroy=function(e){if(t.prototype.destroy.call(this,e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof e?e:e&&e.texture){var n="boolean"==typeof e?e:e&&e.baseTexture;this._texture.destroy(!!n)}this._texture=null,this.shader=null},e.from=function(t,n){return new e(t instanceof He?t:He.from(t,n))},n.roundPixels.set=function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},n.roundPixels.get=function(){return this._roundPixels},n.width.get=function(){return Math.abs(this.scale.x)*this._texture.orig.width},n.width.set=function(t){var e=gt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},n.height.get=function(){return Math.abs(this.scale.y)*this._texture.orig.height},n.height.set=function(t){var e=gt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},n.anchor.get=function(){return this._anchor},n.anchor.set=function(t){this._anchor.copyFrom(t)},n.tint.get=function(){return this._tint},n.tint.set=function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},n.texture.get=function(){return this._texture},n.texture.set=function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||He.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},Object.defineProperties(e.prototype,n),e}(ie),Pi={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:0,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},Ci=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Ri=function(t){this.styleID=0,this.reset(),ji(this,t,t)},Mi={align:{configurable:!0},breakWords:{configurable:!0},dropShadow:{configurable:!0},dropShadowAlpha:{configurable:!0},dropShadowAngle:{configurable:!0},dropShadowBlur:{configurable:!0},dropShadowColor:{configurable:!0},dropShadowDistance:{configurable:!0},fill:{configurable:!0},fillGradientType:{configurable:!0},fillGradientStops:{configurable:!0},fontFamily:{configurable:!0},fontSize:{configurable:!0},fontStyle:{configurable:!0},fontVariant:{configurable:!0},fontWeight:{configurable:!0},letterSpacing:{configurable:!0},lineHeight:{configurable:!0},leading:{configurable:!0},lineJoin:{configurable:!0},miterLimit:{configurable:!0},padding:{configurable:!0},stroke:{configurable:!0},strokeThickness:{configurable:!0},textBaseline:{configurable:!0},trim:{configurable:!0},whiteSpace:{configurable:!0},wordWrap:{configurable:!0},wordWrapWidth:{configurable:!0}};function Di(t){return"number"==typeof t?et(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function ki(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=Di(t[e]);return t}return Di(t)}function ji(t,e,n){for(var r in n)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}Ri.prototype.clone=function(){var t={};return ji(t,this,Pi),new Ri(t)},Ri.prototype.reset=function(){ji(this,Pi,Pi)},Mi.align.get=function(){return this._align},Mi.align.set=function(t){this._align!==t&&(this._align=t,this.styleID++)},Mi.breakWords.get=function(){return this._breakWords},Mi.breakWords.set=function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},Mi.dropShadow.get=function(){return this._dropShadow},Mi.dropShadow.set=function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},Mi.dropShadowAlpha.get=function(){return this._dropShadowAlpha},Mi.dropShadowAlpha.set=function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},Mi.dropShadowAngle.get=function(){return this._dropShadowAngle},Mi.dropShadowAngle.set=function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},Mi.dropShadowBlur.get=function(){return this._dropShadowBlur},Mi.dropShadowBlur.set=function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},Mi.dropShadowColor.get=function(){return this._dropShadowColor},Mi.dropShadowColor.set=function(t){var e=ki(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},Mi.dropShadowDistance.get=function(){return this._dropShadowDistance},Mi.dropShadowDistance.set=function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},Mi.fill.get=function(){return this._fill},Mi.fill.set=function(t){var e=ki(t);this._fill!==e&&(this._fill=e,this.styleID++)},Mi.fillGradientType.get=function(){return this._fillGradientType},Mi.fillGradientType.set=function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},Mi.fillGradientStops.get=function(){return this._fillGradientStops},Mi.fillGradientStops.set=function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},Mi.fontFamily.get=function(){return this._fontFamily},Mi.fontFamily.set=function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},Mi.fontSize.get=function(){return this._fontSize},Mi.fontSize.set=function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},Mi.fontStyle.get=function(){return this._fontStyle},Mi.fontStyle.set=function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},Mi.fontVariant.get=function(){return this._fontVariant},Mi.fontVariant.set=function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},Mi.fontWeight.get=function(){return this._fontWeight},Mi.fontWeight.set=function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},Mi.letterSpacing.get=function(){return this._letterSpacing},Mi.letterSpacing.set=function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},Mi.lineHeight.get=function(){return this._lineHeight},Mi.lineHeight.set=function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},Mi.leading.get=function(){return this._leading},Mi.leading.set=function(t){this._leading!==t&&(this._leading=t,this.styleID++)},Mi.lineJoin.get=function(){return this._lineJoin},Mi.lineJoin.set=function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},Mi.miterLimit.get=function(){return this._miterLimit},Mi.miterLimit.set=function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},Mi.padding.get=function(){return this._padding},Mi.padding.set=function(t){this._padding!==t&&(this._padding=t,this.styleID++)},Mi.stroke.get=function(){return this._stroke},Mi.stroke.set=function(t){var e=ki(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},Mi.strokeThickness.get=function(){return this._strokeThickness},Mi.strokeThickness.set=function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},Mi.textBaseline.get=function(){return this._textBaseline},Mi.textBaseline.set=function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},Mi.trim.get=function(){return this._trim},Mi.trim.set=function(t){this._trim!==t&&(this._trim=t,this.styleID++)},Mi.whiteSpace.get=function(){return this._whiteSpace},Mi.whiteSpace.set=function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},Mi.wordWrap.get=function(){return this._wordWrap},Mi.wordWrap.set=function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},Mi.wordWrapWidth.get=function(){return this._wordWrapWidth},Mi.wordWrapWidth.set=function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},Ri.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var n=e.length-1;n>=0;n--){var r=e[n].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&Ci.indexOf(r)<0&&(r='"'+r+'"'),e[n]=r}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},Object.defineProperties(Ri.prototype,Mi);var Ni=function(t,e,n,r,i,o,a,s,u){this.text=t,this.style=e,this.width=n,this.height=r,this.lines=i,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=s,this.fontProperties=u};Ni.measureText=function(t,e,n,r){void 0===r&&(r=Ni._canvas),n=null==n?e.wordWrap:n;var i=e.toFontString(),o=Ni.measureFont(i);0===o.fontSize&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);var a=r.getContext("2d");a.font=i;for(var s=(n?Ni.wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),u=new Array(s.length),c=0,l=0;l<s.length;l++){var h=a.measureText(s[l]).width+(s[l].length-1)*e.letterSpacing;u[l]=h,c=Math.max(c,h)}var d=c+e.strokeThickness;e.dropShadow&&(d+=e.dropShadowDistance);var f=e.lineHeight||o.fontSize+e.strokeThickness,p=Math.max(f,o.fontSize+e.strokeThickness)+(s.length-1)*(f+e.leading);return e.dropShadow&&(p+=e.dropShadowDistance),new Ni(t,e,d,p,s,u,f+e.leading,c,o)},Ni.wordWrap=function(t,e,n){void 0===n&&(n=Ni._canvas);for(var r=n.getContext("2d"),i=0,o="",a="",s={},u=e.letterSpacing,c=e.whiteSpace,l=Ni.collapseSpaces(c),h=Ni.collapseNewlines(c),d=!l,f=e.wordWrapWidth+u,p=Ni.tokenize(t),m=0;m<p.length;m++){var y=p[m];if(Ni.isNewline(y)){if(!h){a+=Ni.addLine(o),d=!l,o="",i=0;continue}y=" "}if(l){var g=Ni.isBreakingSpace(y),v=Ni.isBreakingSpace(o[o.length-1]);if(g&&v)continue}var _=Ni.getFromCache(y,u,s,r);if(_>f)if(""!==o&&(a+=Ni.addLine(o),o="",i=0),Ni.canBreakWords(y,e.breakWords))for(var b=Ni.wordWrapSplit(y),x=0;x<b.length;x++){for(var w=b[x],E=1;b[x+E];){var T=b[x+E],O=w[w.length-1];if(Ni.canBreakChars(O,T,y,x,e.breakWords))break;w+=T,E++}x+=w.length-1;var A=Ni.getFromCache(w,u,s,r);A+i>f&&(a+=Ni.addLine(o),d=!1,o="",i=0),o+=w,i+=A}else{o.length>0&&(a+=Ni.addLine(o),o="",i=0);var S=m===p.length-1;a+=Ni.addLine(y,!S),d=!1,o="",i=0}else _+i>f&&(d=!1,a+=Ni.addLine(o),o="",i=0),(o.length>0||!Ni.isBreakingSpace(y)||d)&&(o+=y,i+=_)}return a+Ni.addLine(o,!1)},Ni.addLine=function(t,e){return void 0===e&&(e=!0),t=Ni.trimRight(t),e?t+"\n":t},Ni.getFromCache=function(t,e,n,r){var i=n[t];if(void 0===i){var o=t.length*e;i=r.measureText(t).width+o,n[t]=i}return i},Ni.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},Ni.collapseNewlines=function(t){return"normal"===t},Ni.trimRight=function(t){if("string"!=typeof t)return"";for(var e=t.length-1;e>=0;e--){var n=t[e];if(!Ni.isBreakingSpace(n))break;t=t.slice(0,-1)}return t},Ni.isNewline=function(t){return"string"==typeof t&&Ni._newlines.indexOf(t.charCodeAt(0))>=0},Ni.isBreakingSpace=function(t){return"string"==typeof t&&Ni._breakingSpaces.indexOf(t.charCodeAt(0))>=0},Ni.tokenize=function(t){var e=[],n="";if("string"!=typeof t)return e;for(var r=0;r<t.length;r++){var i=t[r];Ni.isBreakingSpace(i)||Ni.isNewline(i)?(""!==n&&(e.push(n),n=""),e.push(i)):n+=i}return""!==n&&e.push(n),e},Ni.canBreakWords=function(t,e){return e},Ni.canBreakChars=function(t,e,n,r,i){return!0},Ni.wordWrapSplit=function(t){return t.split("")},Ni.measureFont=function(t){if(Ni._fonts[t])return Ni._fonts[t];var e={},n=Ni._canvas,r=Ni._context;r.font=t;var i=Ni.METRICS_STRING+Ni.BASELINE_SYMBOL,o=Math.ceil(r.measureText(i).width),a=Math.ceil(r.measureText(Ni.BASELINE_SYMBOL).width),s=2*a;a=a*Ni.BASELINE_MULTIPLIER|0,n.width=o,n.height=s,r.fillStyle="#f00",r.fillRect(0,0,o,s),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(i,0,a);var u=r.getImageData(0,0,o,s).data,c=u.length,l=4*o,h=0,d=0,f=!1;for(h=0;h<a;++h){for(var p=0;p<l;p+=4)if(255!==u[d+p]){f=!0;break}if(f)break;d+=l}for(e.ascent=a-h,d=c-l,f=!1,h=s;h>a;--h){for(var m=0;m<l;m+=4)if(255!==u[d+m]){f=!0;break}if(f)break;d-=l}return e.descent=h-a,e.fontSize=e.ascent+e.descent,Ni._fonts[t]=e,e},Ni.clearMetrics=function(t){void 0===t&&(t=""),t?delete Ni._fonts[t]:Ni._fonts={}};var Li=function(){try{var t=new OffscreenCanvas(0,0),e=t.getContext("2d");return e&&e.measureText?t:document.createElement("canvas")}catch(t){return document.createElement("canvas")}}();Li.width=Li.height=10,Ni._canvas=Li,Ni._context=Li.getContext("2d"),Ni._fonts={},Ni.METRICS_STRING="|\xc9q\xc5",Ni.BASELINE_SYMBOL="M",Ni.BASELINE_MULTIPLIER=1.4,Ni._newlines=[10,13],Ni._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var Bi={texture:!0,children:!1,baseTexture:!0},Fi=function(t){function e(e,n,r){(r=r||document.createElement("canvas")).width=3,r.height=3;var i=He.from(r);i.orig=new Kt,i.trim=new Kt,t.call(this,i),this.canvas=r,this.context=this.canvas.getContext("2d"),this._resolution=H.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=n,this.localStyleID=-1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={width:{configurable:!0},height:{configurable:!0},style:{configurable:!0},text:{configurable:!0},resolution:{configurable:!0}};return e.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var n,r,i=this.context,o=Ni.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),a=o.width,s=o.height,u=o.lines,c=o.lineHeight,l=o.lineWidths,h=o.maxLineWidth,d=o.fontProperties;this.canvas.width=Math.ceil((Math.max(1,a)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,s)+2*e.padding)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;for(var f=e.dropShadow?2:1,p=0;p<f;++p){var m=e.dropShadow&&0===p,y=m?2*s:0,g=y*this.resolution;if(m){i.fillStyle="black",i.strokeStyle="black";var v=e.dropShadowColor,_=tt("number"==typeof v?v:nt(v));i.shadowColor="rgba("+255*_[0]+","+255*_[1]+","+255*_[2]+","+e.dropShadowAlpha+")",i.shadowBlur=e.dropShadowBlur,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*e.dropShadowDistance+g}else i.fillStyle=this._generateFillStyle(e,u),i.strokeStyle=e.stroke,i.shadowColor=0,i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;for(var b=0;b<u.length;b++)n=e.strokeThickness/2,r=e.strokeThickness/2+b*c+d.ascent,"right"===e.align?n+=h-l[b]:"center"===e.align&&(n+=(h-l[b])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(u[b],n+e.padding,r+e.padding-y,!0),e.fill&&this.drawLetterSpacing(u[b],n+e.padding,r+e.padding-y)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,e,n,r){void 0===r&&(r=!1);var i=this._style.letterSpacing;if(0!==i)for(var o=e,a=Array.from?Array.from(t):t.split(""),s=this.context.measureText(t).width,u=0,c=0;c<a.length;++c){var l=a[c];r?this.context.strokeText(l,o,n):this.context.fillText(l,o,n),o+=s-(u=this.context.measureText(t.substring(c+1)).width)+i,s=u}else r?this.context.strokeText(t,e,n):this.context.fillText(t,e,n)},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=It(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var n=this._texture,r=this._style,i=r.trim?0:r.padding,o=n.baseTexture;n.trim.width=n._frame.width=Math.ceil(t.width/this._resolution),n.trim.height=n._frame.height=Math.ceil(t.height/this._resolution),n.trim.x=-i,n.trim.y=-i,n.orig.width=n._frame.width-2*i,n.orig.height=n._frame.height-2*i,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),this.dirty=!1},e.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,e)},e.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._onStyleChange=function(){this.dirty=!0},e.prototype._generateFillStyle=function(t,e){if(!Array.isArray(t.fill))return t.fill;if(1===t.fill.length)return t.fill[0];var n,r,i,o,a=t.dropShadow?t.dropShadowDistance:0,s=Math.ceil(this.canvas.width/this._resolution)-a,u=Math.ceil(this.canvas.height/this._resolution)-a,c=t.fill.slice(),l=t.fillGradientStops.slice();if(!l.length)for(var h=c.length+1,d=1;d<h;++d)l.push(d/h);if(c.unshift(t.fill[0]),l.unshift(0),c.push(t.fill[t.fill.length-1]),l.push(1),0===t.fillGradientType){n=this.context.createLinearGradient(s/2,0,s/2,u),r=(c.length+1)*e.length,i=0;for(var f=0;f<e.length;f++){i+=1;for(var p=0;p<c.length;p++)o="number"==typeof l[p]?l[p]/e.length+f/e.length:i/r,n.addColorStop(o,c[p]),i++}}else{n=this.context.createLinearGradient(0,u/2,s,u/2),r=c.length+1,i=1;for(var m=0;m<c.length;m++)o="number"==typeof l[m]?l[m]:i/r,n.addColorStop(o,c[m]),i++}return n},e.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},Bi,e),t.prototype.destroy.call(this,e),this.context=null,this.canvas=null,this._style=null},n.width.get=function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},n.width.set=function(t){this.updateText(!0);var e=gt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},n.height.get=function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},n.height.set=function(t){this.updateText(!0);var e=gt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},n.style.get=function(){return this._style},n.style.set=function(t){t=t||{},this._style=t instanceof Ri?t:new Ri(t),this.localStyleID=-1,this.dirty=!0},n.text.get=function(){return this._text},n.text.set=function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},n.resolution.get=function(){return this._resolution},n.resolution.set=function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},Object.defineProperties(e.prototype,n),e}(Ii);H.UPLOADS_PER_FRAME=4;var Ui=function(t){this.maxItemsPerFrame=t,this.itemsLeft=0};Ui.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},Ui.prototype.allowedToUpload=function(){return this.itemsLeft-- >0};var Gi=function(t){var e=this;this.limiter=new Ui(H.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(Wi),this.registerFindHook(qi),this.registerFindHook(Hi),this.registerFindHook(zi),this.registerFindHook(Xi),this.registerUploadHook(Vi),this.registerUploadHook(Yi)};function Hi(t,e){var n=!1;if(t&&t._textures&&t._textures.length)for(var r=0;r<t._textures.length;r++)if(t._textures[r]instanceof He){var i=t._textures[r].baseTexture;-1===e.indexOf(i)&&(e.push(i),n=!0)}return n}function zi(t,e){if(t.baseTexture instanceof Ie){var n=t.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function Xi(t,e){if(t._texture&&t._texture instanceof He){var n=t._texture.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function Vi(t,e){return e instanceof Fi&&(e.updateText(!0),!0)}function Yi(t,e){if(e instanceof Ri){var n=e.toFontString();return Ni.measureFont(n),!0}return!1}function Wi(t,e){if(t instanceof Fi){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var n=t._texture.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function qi(t,e){return t instanceof Ri&&(-1===e.indexOf(t)&&e.push(t),!0)}Gi.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,ue.system.addOnce(this.tick,this,oe.UTILITY))):e&&e()},Gi.prototype.tick=function(){setTimeout(this.delayedTick,0)},Gi.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var n=0,r=this.uploadHooks.length;n<r;n++)if(this.uploadHooks[n](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)ue.system.addOnce(this.tick,this,oe.UTILITY);else{this.ticking=!1;var i=this.completes.slice(0);this.completes.length=0;for(var o=0,a=i.length;o<a;o++)i[o]()}},Gi.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},Gi.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},Gi.prototype.add=function(t){for(var e=0,n=this.addHooks.length;e<n&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ie)for(var r=t.children.length-1;r>=0;r--)this.add(t.children[r]);return this},Gi.prototype.destroy=function(){this.ticking&&ue.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null};var Ji=function(t){function e(e){t.call(this,e),this.uploadHookHelper=this.renderer,this.registerFindHook(Qi),this.registerUploadHook(Ki),this.registerUploadHook(Zi)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Gi);function Ki(t,e){return e instanceof Ie&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Zi(t,e){if(!(e instanceof Oi))return!1;var n=e.geometry;e.finishPoly(),n.updateBatches();for(var r=n.batches,i=0;i<r.length;i++){var o=r[i].style.texture;o&&Ki(t,o.baseTexture)}return n.batchable||t.geometry.bind(n,e._resolveDirectShader()),!0}function Qi(t,e){return t instanceof Oi&&(e.push(t),!0)}var $i=function(t){this.maxMilliseconds=t,this.frameStart=0};$i.prototype.beginFrame=function(){this.frameStart=Date.now()},$i.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds};var to=function(t,e,n){void 0===n&&(n=null),this.baseTexture=t,this.textures={},this.animations={},this.data=e,this.resolution=this._updateResolution(n||(this.baseTexture.resource?this.baseTexture.resource.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null},eo={BATCH_SIZE:{configurable:!0}};eo.BATCH_SIZE.get=function(){return 1e3},to.prototype._updateResolution=function(t){var e=this.data.meta.scale,n=Dt(t,null);return null===n&&(n=void 0!==e?parseFloat(e):1),1!==n&&this.baseTexture.setResolution(n),n},to.prototype.parse=function(t){this._batchIndex=0,this._callback=t,this._frameKeys.length<=to.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},to.prototype._processFrames=function(t){for(var e=t,n=to.BATCH_SIZE;e-t<n&&e<this._frameKeys.length;){var r=this._frameKeys[e],i=this._frames[r],o=i.frame;if(o){var a,s=null,u=!1!==i.trimmed&&i.sourceSize?i.sourceSize:i.frame,c=new Kt(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);a=i.rotated?new Kt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):new Kt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),!1!==i.trimmed&&i.spriteSourceSize&&(s=new Kt(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[r]=new He(this.baseTexture,a,c,s,i.rotated?2:0,i.anchor),He.addToCache(this.textures[r],r)}e++}},to.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var n=0;n<t[e].length;n++){var r=t[e][n];this.animations[e].push(this.textures[r])}}},to.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},to.prototype._nextBatch=function(){var t=this;this._processFrames(this._batchIndex*to.BATCH_SIZE),this._batchIndex++,setTimeout((function(){t._batchIndex*to.BATCH_SIZE<t._frameKeys.length?t._nextBatch():(t._processAnimations(),t._parseComplete())}),0)},to.prototype.destroy=function(t){for(var e in void 0===t&&(t=!1),this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&this.baseTexture.destroy(),this.baseTexture=null},Object.defineProperties(to,eo);var no=function(){};no.use=function(t,e){var n=t.name+"_image";if(t.data&&t.type===$r.TYPE.JSON&&t.data.frames&&!this.resources[n]){var r={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},i=no.getResourcePath(t,this.baseUrl);this.add(n,i,r,(function(n){if(n.error)e(n.error);else{var r=new to(n.texture.baseTexture,t.data,t.url);r.parse((function(){t.spritesheet=r,t.textures=r.textures,e()}))}}))}else e()},no.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:q.a.resolve(t.url.replace(e,""),t.data.meta.image)};var ro=new jt,io=function(t){function e(e,n,r){void 0===n&&(n=100),void 0===r&&(r=100),t.call(this,e),this.tileTransform=new Jt,this._width=n,this._height=r,this._canvasPattern=null,this.uvMatrix=e.uvMatrix||new Yn(e),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={clampMargin:{configurable:!0},tileScale:{configurable:!0},tilePosition:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return n.clampMargin.get=function(){return this.uvMatrix.clampMargin},n.clampMargin.set=function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},n.tileScale.get=function(){return this.tileTransform.scale},n.tileScale.set=function(t){this.tileTransform.scale.copyFrom(t)},n.tilePosition.get=function(){return this.tileTransform.position},n.tilePosition.set=function(t){this.tileTransform.position.copyFrom(t)},e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,n=this._width*(1-this._anchor._x),r=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,n,r)},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Kt),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,ro);var e=this._width,n=this._height,r=-e*this.anchor._x;if(ro.x>=r&&ro.x<r+e){var i=-n*this.anchor._y;if(ro.y>=i&&ro.y<i+n)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,n,r){return new e(He.from(t),n,r)},e.fromFrame=function(t,n,r){var i=Et[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache '+this);return new e(i,n,r)},e.fromImage=function(t,n,r,i){return i&&"object"!=typeof i&&(i={scaleMode:arguments[4],resourceOptions:{crossorigin:arguments[3]}}),new e(He.from(t,i),n,r)},n.width.get=function(){return this._width},n.width.set=function(t){this._width=t},n.height.get=function(){return this._height},n.height.set=function(t){this._height=t},Object.defineProperties(e.prototype,n),e}(Ii),oo="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",ao=new Ut,so=function(t){function e(e){t.call(this,e);var n={globals:this.renderer.globalUniforms};this.shader=Un.from(oo,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord - floor(vTextureCoord - uClampOffset);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",n),this.simpleShader=Un.from(oo,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n",n),this.quad=new nn,this.state=Hn.for2d()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(t){var e=this.renderer,n=this.quad,r=n.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&((r=n.uvs)[0]=r[6]=-t.anchor.x,r[1]=r[3]=-t.anchor.y,r[2]=r[4]=1-t.anchor.x,r[5]=r[7]=1-t.anchor.y),n.invalidate();var i=t._texture,o=i.baseTexture,a=t.tileTransform.localTransform,s=t.uvMatrix,u=o.isPowerOfTwo&&i.frame.width===o.width&&i.frame.height===o.height;u&&(o._glTextures[e.CONTEXT_UID]?u=o.wrapMode!==j.CLAMP:o.wrapMode===j.CLAMP&&(o.wrapMode=j.REPEAT));var c=u?this.simpleShader:this.shader,l=i.width,h=i.height,d=t._width,f=t._height;ao.set(a.a*l/d,a.b*l/f,a.c*h/d,a.d*h/f,a.tx/d,a.ty/f),ao.invert(),u?ao.prepend(s.mapCoord):(c.uniforms.uMapCoord=s.mapCoord.toArray(!0),c.uniforms.uClampFrame=s.uClampFrame,c.uniforms.uClampOffset=s.uClampOffset),c.uniforms.uTransform=ao.toArray(!0),c.uniforms.uColor=ut(t.tint,t.worldAlpha,c.uniforms.uColor,o.alphaMode),c.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),c.uniforms.uSampler=i,e.shader.bind(c),e.geometry.bind(n),this.state.blendMode=ot(t.blendMode,o.alphaMode),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e}(un),uo=function(t){function e(e,n){var r=this;void 0===n&&(n={}),t.call(this),this._textWidth=0,this._textHeight=0,this._glyphs=[],this._font={tint:void 0!==n.tint?n.tint:16777215,align:n.align||"left",name:null,size:0},this.font=n.font,this._text=e,this._maxWidth=0,this._maxLineHeight=0,this._letterSpacing=0,this._anchor=new Nt((function(){r.dirty=!0}),this,0,0),this.dirty=!1,this.roundPixels=H.ROUND_PIXELS,this.updateText()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={tint:{configurable:!0},align:{configurable:!0},anchor:{configurable:!0},font:{configurable:!0},text:{configurable:!0},maxWidth:{configurable:!0},maxLineHeight:{configurable:!0},textWidth:{configurable:!0},letterSpacing:{configurable:!0},textHeight:{configurable:!0}};return e.prototype.updateText=function(){for(var t=e.fonts[this._font.name],n=this._font.size/t.size,r=new jt,i=[],o=[],a=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",s=a.length,u=this._maxWidth*t.size/this._font.size,c=null,l=0,h=0,d=0,f=-1,p=0,m=0,y=0,g=0;g<s;g++){var v=a.charCodeAt(g),_=a.charAt(g);if(/(?:\s)/.test(_)&&(f=g,p=l),"\r"!==_&&"\n"!==_){var b=t.chars[v];b&&(c&&b.kerning[c]&&(r.x+=b.kerning[c]),i.push({texture:b.texture,line:d,charCode:v,position:new jt(r.x+b.xOffset+this._letterSpacing/2,r.y+b.yOffset)}),r.x+=b.xAdvance+this._letterSpacing,l=r.x,y=Math.max(y,b.yOffset+b.texture.height),c=v,-1!==f&&u>0&&r.x>u&&(yt(i,1+f-++m,1+g-f),g=f,f=-1,o.push(p),h=Math.max(h,p),d++,r.x=0,r.y+=t.lineHeight,c=null))}else o.push(l),h=Math.max(h,l),++d,++m,r.x=0,r.y+=t.lineHeight,c=null}var x=a.charAt(a.length-1);"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(l=p),o.push(l),h=Math.max(h,l));for(var w=[],E=0;E<=d;E++){var T=0;"right"===this._font.align?T=h-o[E]:"center"===this._font.align&&(T=(h-o[E])/2),w.push(T)}for(var O=i.length,A=this.tint,S=0;S<O;S++){var I=this._glyphs[S];I?I.texture=i[S].texture:((I=new Ii(i[S].texture)).roundPixels=this.roundPixels,this._glyphs.push(I)),I.position.x=(i[S].position.x+w[i[S].line])*n,I.position.y=i[S].position.y*n,I.scale.x=I.scale.y=n,I.tint=A,I.parent||this.addChild(I)}for(var P=O;P<this._glyphs.length;++P)this.removeChild(this._glyphs[P]);if(this._textWidth=h*n,this._textHeight=(r.y+t.lineHeight)*n,0!==this.anchor.x||0!==this.anchor.y)for(var C=0;C<O;C++)this._glyphs[C].x-=this._textWidth*this.anchor.x,this._glyphs[C].y-=this._textHeight*this.anchor.y;this._maxLineHeight=y*n},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},n.tint.get=function(){return this._font.tint},n.tint.set=function(t){this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0},n.align.get=function(){return this._font.align},n.align.set=function(t){this._font.align=t||"left",this.dirty=!0},n.anchor.get=function(){return this._anchor},n.anchor.set=function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},n.font.get=function(){return this._font},n.font.set=function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):e.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)},n.text.get=function(){return this._text},n.text.set=function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},n.maxWidth.get=function(){return this._maxWidth},n.maxWidth.set=function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},n.maxLineHeight.get=function(){return this.validate(),this._maxLineHeight},n.textWidth.get=function(){return this.validate(),this._textWidth},n.letterSpacing.get=function(){return this._letterSpacing},n.letterSpacing.set=function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},n.textHeight.get=function(){return this.validate(),this._textHeight},e.registerFont=function(t,n){var r={},i=t.getElementsByTagName("info")[0],o=t.getElementsByTagName("common")[0],a=t.getElementsByTagName("page"),s=Dt(a[0].getAttribute("file"),H.RESOLUTION),u={};r.font=i.getAttribute("face"),r.size=parseInt(i.getAttribute("size"),10),r.lineHeight=parseInt(o.getAttribute("lineHeight"),10)/s,r.chars={},n instanceof He&&(n=[n]);for(var c=0;c<a.length;c++){var l=a[c].getAttribute("id"),h=a[c].getAttribute("file");u[l]=n instanceof Array?n[c]:n[h]}for(var d=t.getElementsByTagName("char"),f=0;f<d.length;f++){var p=d[f],m=parseInt(p.getAttribute("id"),10),y=p.getAttribute("page")||0,g=new Kt(parseInt(p.getAttribute("x"),10)/s+u[y].frame.x/s,parseInt(p.getAttribute("y"),10)/s+u[y].frame.y/s,parseInt(p.getAttribute("width"),10)/s,parseInt(p.getAttribute("height"),10)/s);r.chars[m]={xOffset:parseInt(p.getAttribute("xoffset"),10)/s,yOffset:parseInt(p.getAttribute("yoffset"),10)/s,xAdvance:parseInt(p.getAttribute("xadvance"),10)/s,kerning:{},texture:new He(u[y].baseTexture,g),page:y}}for(var v=t.getElementsByTagName("kerning"),_=0;_<v.length;_++){var b=v[_],x=parseInt(b.getAttribute("first"),10)/s,w=parseInt(b.getAttribute("second"),10)/s,E=parseInt(b.getAttribute("amount"),10)/s;r.chars[w]&&(r.chars[w].kerning[x]=E)}return e.fonts[r.font]=r,r},Object.defineProperties(e.prototype,n),e}(ie);uo.fonts={};var co=function(){};co.parse=function(t,e){t.bitmapFont=uo.registerFont(t.data,e)},co.add=function(){$r.setExtensionXhrType("fnt",$r.XHR_RESPONSE_TYPE.DOCUMENT)},co.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},co.use=function(t,e){if(t.data&&t.type===$r.TYPE.XML)if(0!==t.data.getElementsByTagName("page").length&&0!==t.data.getElementsByTagName("info").length&&null!==t.data.getElementsByTagName("info")[0].getAttribute("face")){var n=t.isDataUrl?"":co.dirname(t.url);t.isDataUrl&&("."===n&&(n=""),this.baseUrl&&n&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(n+="/")),(n=n.replace(this.baseUrl,""))&&"/"!==n.charAt(n.length-1)&&(n+="/");for(var r=t.data.getElementsByTagName("page"),i={},o=function(n){i[n.metadata.pageFile]=n.texture,Object.keys(i).length===r.length&&(co.parse(t,i),e())},a=0;a<r.length;++a){var s=r[a].getAttribute("file"),u=n+s,c=!1;for(var l in this.resources){var h=this.resources[l];if(h.url===u){h.metadata.pageFile=s,h.texture?o(h):h.onAfterMiddleware.add(o),c=!0;break}}if(!c){var d={crossOrigin:t.crossOrigin,loadType:$r.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:s},t.metadata.imageMetadata),parentResource:t};this.add(u,d,o)}}}else e();else e()},["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");var lo=function(t){function e(){var e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};t.call(this,"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",e),this.alpha=1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={matrix:{configurable:!0},alpha:{configurable:!0}};return e.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var n=t;e&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n},e.prototype._multiply=function(t,e,n){return t[0]=e[0]*n[0]+e[1]*n[5]+e[2]*n[10]+e[3]*n[15],t[1]=e[0]*n[1]+e[1]*n[6]+e[2]*n[11]+e[3]*n[16],t[2]=e[0]*n[2]+e[1]*n[7]+e[2]*n[12]+e[3]*n[17],t[3]=e[0]*n[3]+e[1]*n[8]+e[2]*n[13]+e[3]*n[18],t[4]=e[0]*n[4]+e[1]*n[9]+e[2]*n[14]+e[3]*n[19]+e[4],t[5]=e[5]*n[0]+e[6]*n[5]+e[7]*n[10]+e[8]*n[15],t[6]=e[5]*n[1]+e[6]*n[6]+e[7]*n[11]+e[8]*n[16],t[7]=e[5]*n[2]+e[6]*n[7]+e[7]*n[12]+e[8]*n[17],t[8]=e[5]*n[3]+e[6]*n[8]+e[7]*n[13]+e[8]*n[18],t[9]=e[5]*n[4]+e[6]*n[9]+e[7]*n[14]+e[8]*n[19]+e[9],t[10]=e[10]*n[0]+e[11]*n[5]+e[12]*n[10]+e[13]*n[15],t[11]=e[10]*n[1]+e[11]*n[6]+e[12]*n[11]+e[13]*n[16],t[12]=e[10]*n[2]+e[11]*n[7]+e[12]*n[12]+e[13]*n[17],t[13]=e[10]*n[3]+e[11]*n[8]+e[12]*n[13]+e[13]*n[18],t[14]=e[10]*n[4]+e[11]*n[9]+e[12]*n[14]+e[13]*n[19]+e[14],t[15]=e[15]*n[0]+e[16]*n[5]+e[17]*n[10]+e[18]*n[15],t[16]=e[15]*n[1]+e[16]*n[6]+e[17]*n[11]+e[18]*n[16],t[17]=e[15]*n[2]+e[16]*n[7]+e[17]*n[12]+e[18]*n[17],t[18]=e[15]*n[3]+e[16]*n[8]+e[17]*n[13]+e[18]*n[18],t[19]=e[15]*n[4]+e[16]*n[9]+e[17]*n[14]+e[18]*n[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){var n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.greyscale=function(t,e){var n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var n=Math.cos(t),r=Math.sin(t),i=1/3,o=(0,Math.sqrt)(i),a=[n+(1-n)*i,i*(1-n)-o*r,i*(1-n)+o*r,0,0,i*(1-n)+o*r,n+i*(1-n),i*(1-n)-o*r,0,0,i*(1-n)-o*r,i*(1-n)+o*r,n+i*(1-n),0,0,0,0,0,1,0];this._loadMatrix(a,e)},e.prototype.contrast=function(t,e){var n=(t||0)+1,r=-.5*(n-1),i=[n,0,0,0,r,0,n,0,0,r,0,0,n,0,r,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.saturate=function(t,e){void 0===t&&(t=0);var n=2*t/3+1,r=-.5*(n-1),i=[n,r,r,0,0,r,n,r,0,0,r,r,n,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,n,r,i){var o=((n=n||16770432)>>16&255)/255,a=(n>>8&255)/255,s=(255&n)/255,u=((r=r||3375104)>>16&255)/255,c=(r>>8&255)/255,l=(255&r)/255,h=[.3,.59,.11,0,0,o,a,s,t=t||.2,0,u,c,l,e=e||.15,0,o-u,a-c,s-l,0,0];this._loadMatrix(h,i)},e.prototype.night=function(t,e){var n=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.predator=function(t,e){var n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},n.matrix.get=function(){return this.uniforms.m},n.matrix.set=function(t){this.uniforms.m=t},n.alpha.get=function(){return this.uniforms.uAlpha},n.alpha.set=function(t){this.uniforms.uAlpha=t},Object.defineProperties(e.prototype,n),e}(Xn);lo.prototype.grayscale=lo.prototype.greyscale;var ho=new Ut;ne.prototype._cacheAsBitmap=!1,ne.prototype._cacheData=!1;var fo=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null};Object.defineProperties(ne.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new fo),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),ne.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},ne.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.batch.flush();var n=this.getLocalBounds().clone();if(this.filters){var r=this.filters[0].padding;n.pad(r)}n.ceil(H.RESOLUTION);var i=t.renderTexture.current,o=t.renderTexture.sourceFrame,a=t.projection.transform,s=Xe.create(n.width,n.height),u="cacheAsBitmap_"+_t();this._cacheData.textureCacheId=u,Ie.addToCache(s.baseTexture,u),He.addToCache(s,u);var c=ho;c.tx=-n.x,c.ty=-n.y,this.transform.worldTransform.identity(),this.render=this._cacheData.originalRender,t.render(this,s,!0,c,!0),t.projection.transform=a,t.renderTexture.bind(i,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var l=new Ii(s);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-n.x/n.width,l.anchor.y=-n.y/n.height,l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)}},ne.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},ne.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(),n=this.alpha;this.alpha=1;var r=t.context;e.ceil(H.RESOLUTION);var i=Xe.create(e.width,e.height),o="cacheAsBitmap_"+_t();this._cacheData.textureCacheId=o,Ie.addToCache(i.baseTexture,o),He.addToCache(i,o);var a=ho;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,i,!0,a,!1),t.context=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var s=new Ii(i);s.transform.worldTransform=this.transform.worldTransform,s.anchor.x=-e.x/e.width,s.anchor.y=-e.y/e.height,s.alpha=n,s._bounds=this._bounds,this._cacheData.sprite=s,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=s.containsPoint.bind(s)}},ne.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._lastBoundsID=this._boundsID},ne.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},ne.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Ie.removeFromCache(this._cacheData.textureCacheId),He.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},ne.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},ne.prototype.name=null,ie.prototype.getChildByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null},ne.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new jt),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var po=function(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0};po.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}};var mo=new jt,yo=new $t;function go(t,e){if(!(t.length<=0||e>=t.length||e<-t.length))return e<0&&(e+=t.length),t[e]}function vo(t){if(null==t)throw new Error("Assertion of not null and undefined failed");return t}function _o(t,e,n,r,i){return(n-t)/(e-t)*(i-r)+r}function bo(t){var e,n,r=[];try{for(var i=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),o=i.next();!o.done;o=i.next()){var a=o.value;r.push(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(function(t){function e(e,n,r,i){void 0===i&&(i=C.TRIANGLES),t.call(this),this.geometry=e,e.refCount++,this.shader=n,this.state=r||Hn.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=0,this._transformID=-1,this.tint=16777215,this.blendMode=P.NORMAL,this._roundPixels=H.ROUND_PIXELS,this.batchUvs=null}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={uvBuffer:{configurable:!0},verticesBuffer:{configurable:!0},material:{configurable:!0},blendMode:{configurable:!0},roundPixels:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return n.uvBuffer.get=function(){return this.geometry.buffers[1]},n.verticesBuffer.get=function(){return this.geometry.buffers[0]},n.material.set=function(t){this.shader=t},n.material.get=function(){return this.shader},n.blendMode.set=function(t){this.state.blendMode=t},n.blendMode.get=function(){return this.state.blendMode},n.roundPixels.set=function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},n.roundPixels.get=function(){return this._roundPixels},n.tint.get=function(){return this.shader.tint},n.tint.set=function(t){this.shader.tint=t},n.texture.get=function(){return this.shader.texture},n.texture.set=function(t){this.shader.texture=t},e.prototype._render=function(t){var n=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===C.TRIANGLES&&n.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.program.uniformData.translationMatrix&&(e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var e=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry,e=t.buffers[0].data;if(t.vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var n=this.transform.worldTransform,r=n.a,i=n.b,o=n.c,a=n.d,s=n.tx,u=n.ty,c=this.vertexData,l=0;l<c.length/2;l++){var h=e[2*l],d=e[2*l+1];c[2*l]=r*h+o*d+s,c[2*l+1]=i*h+a*d+u}if(this._roundPixels)for(var f=H.RESOLUTION,p=0;p<c.length;++p)c[p]=Math.round((c[p]*f|0)/f);this.vertexDirty=t.vertexDirtyId}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new po(t,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,mo);for(var e=this.geometry.getBuffer("aVertexPosition").data,n=yo.points,r=this.geometry.getIndex().data,i=r.length,o=4===this.drawMode?3:1,a=0;a+2<i;a+=o){var s=2*r[a],u=2*r[a+1],c=2*r[a+2];if(n[0]=e[s],n[1]=e[s+1],n[2]=e[u],n[3]=e[u+1],n[4]=e[c],n[5]=e[c+1],yo.contains(mo.x,mo.y))return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},Object.defineProperties(e.prototype,n),e}(ie)).BATCHABLE_SIZE=100,hr.registerPlugin("accessibility",ae),hr.registerPlugin("extract",Pr),hr.registerPlugin("interaction",ve),hr.registerPlugin("particle",ei),hr.registerPlugin("prepare",Ji),hr.registerPlugin("batch",Tr),hr.registerPlugin("tilingSprite",so),Zr.registerPlugin(co),Zr.registerPlugin(no),Or.registerPlugin(ce),Or.registerPlugin(Qr);for(var xo=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},wo=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(xo(arguments[e]));return t},Eo=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},To=function(){function t(){this.listeners=new Set,this.prevArgs=null}return t.prototype.emit=function(){for(var t,e,n=this,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=bo(this.listeners),a=function(t){t.apply(void 0,wo([function(){return n.listeners.delete(t)}],r))};try{for(var s=Eo(o),u=s.next();!u.done;u=s.next()){var c=u.value;a(c)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}this.prevArgs=r},t.prototype.add=function(t){this.listeners.add(t)},t.prototype.remove=function(t){return this.listeners.delete(t)},t.prototype.clear=function(){this.listeners.clear()},t}(),Oo=[],Ao=-3;Ao<4;Ao++)Oo.push(640+153.6*Ao);for(var So=function(t){var e=1e3*t|0;if(!(e<-200))return e<-150||e>150?"miss":e<-125||e>125?"bad":e<-100||e>100?"good":e<-50||e>50?"great":"perfect"},Io=function(t){var e=1e3*t|0;if(!(e<-200))return e<-170||e>170?"miss":e<-150||e>150?"bad":e<-120||e>120?"good":e<-70||e>70?"great":"perfect"},Po=function(t){var e=1e3*t|0;if(!(e<-200))return e<-150||e>200?"miss":e<-125?"bad":e<-100?"good":e<-50?"great":"perfect"},Co=function(t){var e=1e3*t|0;if(!(e<0))return e>120?"miss":"perfect"},Ro=function(t){var e=1e3*t|0;if(!(e<0))return e>200?"miss":"perfect"},Mo=[],Do=0;Do<100;Do++)Mo.push(Math.pow(1.1,Do-50));function ko(t,e){var n,r,i=(19*(n=50*(t+1),(r=Math.floor(n))>98?r=98:r<0&&(r=0),_o(r,r+1,n,Mo[r],Mo[r+1]))+1)/20;return{x:640+(e-640)*i,y:617*i-5,scale:i}}var jo,No=(jo=function(t,e){return(jo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}jo(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Lo=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Bo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return No(e,t),e}(ie),Fo=function(){this.Update=new To,this.Resize=new To,this.WindowBlur=new To,this.WindowFocus=new To,this.End=new To},Uo=function(){},Go=function(){function t(t){this.staytime=5.5-(t.speed-1)/2,this.noteScale=e.noteInitScale*t.noteScale}var e;return e=t,t.prototype.calc=function(t,e){return ko((e-t.time)/this.staytime,Oo[t.lane])},t.prototype.setScale=function(t,e){t.scale.set(e*this.noteScale)},t.noteInitScale=.7,e=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Lo("design:paramtypes",[a])],t)}(),Ho=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),zo=function(t){function e(e,n){var r=t.call(this)||this;return r._width=e,r._height=n,r}return Ho(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width*this.scale.x},set:function(t){var e=t/this._width;this.scale.set(e,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height*this.scale.x},set:function(t){var e=t/this._height;this.scale.set(e,e)},enumerable:!0,configurable:!0}),e.prototype.setInit=function(t,e){this._width=t,this._height=e},Object.defineProperty(e.prototype,"ratio",{get:function(){return this._width/this._height},enumerable:!0,configurable:!0}),e.prototype.resize=function(t,e,n,r,i){void 0===n&&(n=!1),void 0===r&&(r=.5),void 0===i&&(i=.5),t/e>this.ratio!==n?(this.height=e,this.x=t*r-this.width*r,this.y=0):(this.width=t,this.x=0,this.y=e*i-this.height*i)},e}(ie),Xo=document.createElement("img");Xo.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAACQCAYAAACoPrZBAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAvoSURBVHhe7d1tV9NKG4ZhFSwKuBVBBUQsBSv4hv//z/V5rujgML2Spk2applzr3WsVe9Oyod9r8m8z5P//zfDP//999/s+/fvBX12ZYAy5M/SbDBbSpzfv38X9NmVAcqQP0uzwWyRQGiC/FmaDWaLJjSaIH+WZoMA0AUbBIAu2ODg0VRGE+RPa2xw8JQ4DBZiVeRPa2xw8EggNEH+tMYGB48mNJogf1pjgwDQBRsEgC7Y4GDQVEYT5M/a2eBgKHEYLMSqyJ+1s8HBIIHQBPmzdjbYa0+fPp29f/9+dnh4aL+P0YRGE+TP2tlgr7148eLhrXRzczN79eqVLQeklCvX19dUJv1hg72mJAoVUHB3dzc7Ojqy5QFRy/nbt29Fvvz8+XP2/PlzWw6dssFee/v27VwFFIzH4yLR3HPI27t37+ZyxZVDp2yw1zT+EydS6tOnT/Y55OvZs2ezHz9+zOUKXbGNs8FeOz8/n0uk1MuXL+2zyNPp6anNE3XJVDm5Z9AJG+y1y8vL2efPn2cfPnyYTSaT2a9fv+YS6+zszD6LvOzs7Mxev35djPmkORJoIkOtarWGGBfqnA32mmYx4il4vcE0LnR7e/uQVFdXV4+eQR5U4bx582b28ePH2devXx9VNHWpslKldHBwYP8GWmWDvaaKZm9vz36nVtH9/X3RMnLfY7hU+Wi9jqtUVkEOdcIGe02DiUo2951otkNdNPcdhmt3d7d4+bjKZBXqurm/g1bZYG9pil1jPu67QGVYE5Qndb/aqITUkna/j9bZYG9pkFAzF+47QPTyaVIJ0XrulA1unCoaDSSqslEyhYHBi4uL2ZcvX+wzQHB8fGwrl0Wm0ynT8t2ywY3SXi+3aCxghgt1pCuf6xiNRva3sDY2uDHxfp0yagW5Z4FYvGm5Lhawds4GN6Zqn1egRWPuWSCmdTwuf6poENv9FtbGBjdGrRuXGDG92dyzQEzT6C5/qjD71Tkb3JiyPTuBtmG454BUndZ0ivzqnA1ujGa/ylazapc7R22gLjcIre0Z6mZprEet7XQfITOsnbPBjVIlpJaQZrtEG0v39/dtWaBMPBWv6XW3sllT7ioX9o1p6UdaBmtlg8DWU2tZlUvdI3urtvdgbWwQALpggwDQBRtcO647QRPkz2DY4NrFM1367MoAZcifwbDBtSOB0AT5Mxg2uHY0odEE+TMYNggAXbBBAOiCDbaGpjKaIH8GzwZbo8RhsBCrIn8GzwZbQwKhCfJn8GywNTSh0QT5M3g2CABdsEGgNeG6ZJ3PU3ajLbJlg0ujqQxH5zLHN5yU3elG/mTLBpemxGGwEDGd3Z2eOKjKyJUlf7Jlg0sjgZDS8aYhJ4Lz83NblvzJlg0ujSY0Yu5GCt1uW3bqIPmTrfng7u5ucZSlDoEfj8fFXdm6i4vrcFCHjkK9vb2dq4C48gbGv3+o4tFNAVUX+19fX3N7JCq563A09qMD4HXhAHevI/LngyqVRVciB6qglGTRjwCFsqu1J5PJQ6tIA9O0pvHXn2tw4qnSOlQJ0VdH6uTkxOZL6ujoyD6P7DyZ3dzc2CTRG0tjQPredcs0qKjKK/lBZEpdKw0ip3mSUi6RNyjozqQ0QZREWkAWFxyNRsX4T1qWi9wQaJA5zQ9H44zueWRId2HHyaG3U9lyefXvww2SgSorVxZ50fS6WsRxbjga/9Fkh/sNZOju7u5Rgiy6nF/jPnF5YUARuj47zQtH5dzzyFS6VH7R7JbedHF5qXv1LYZJLZo0j5yqhYjIVNps1gJEW/AvKiCktEg1zQmHhYiYk47paNWzLfiXW2JPFyxvaffLLekICxHd88iYZrHiRNEgdDoDFiiB0gqrbHcz8qEumDaZyuHhoV2IqPVB7llkTiug02RRt0wtnbigpuHdeiGm4RHToWNpjqhC0gyqK4/sPSm6XWnSiKbYtfZnOp3a71VRMaWKQC1k1/1i2w4q/GlCp9PxdeiYzeTHkDG3EFGr6Wn9oMKfD1oan47vlNGUK281xNT6cQsR2S+IBf79Q0mkt1jVmg6NA3EcB1KaCU1zpez0QyAyH1RFpO6VEkiHkmnvjgYXmW5HGXWzrq6uinFDHcXKbnfUZIOAxdGpaMLkjy8IOEqc0MXSZ1cGKGPyxxcEHCogNEEFhEbogqEJumAA+sQGAaALNojM0dVCE0vkjw0ic0ocBpuxqiXyxwaROSogNEEFhEbogqEJumAAtoENAkAXbBCZoKuFJlrIHxtEJpQ4DDZjVS3kjw0iE1RAaIIKCI3QBUNKZzvprjfdcOK+j9EFwyO6JFIXCVCZYFXx6ZY6AXXNF4/aILaQ3lzhTi6dz6xzvl05oIoqnFABBbq0Yk2nXNogtlB6J9d4PLblgCq6cCLOo5hyquVbTmwQW6bsTi66YljWorv+dU68e25FNogtc3p6apNFXTJVTu4ZwNFlFC6XYi3ejGOD2BI7OzvFNdruTq5AA4l6q6k1xLgQFrm8vCxuS9YVXZPJxF7TdXZ2Zp9dgQ2ip1Th6Mok3clf9yLJlCorVUoHBwf2byBvmkWNp+DVgta4kG65DTmkK5jiZxqwQfSQKh+tt4grkyb0dnN/B3lTRbO3t2e/U6vo/v6+zdyxQfSQ7vDX/3xXmaxCXTf3d5A3TWboZee+E822qovmvluBDaKn1P1qoxLSm8z9PvKmKXaN+bjvApVpcU2QDaLH9D+/SSXU4tsLA6NJCs2cuu/WxAbRc8fHx7ZyWWQ6nTItj6Ki0USGKhu9zMLExMXFRXG3v3tmTWwQWyBd+VzHaDSyv4V8aK+XW7QatDjDVYcNYgvEmwbranEBGbZQvF+wjFpB7tk1sUFsAa3jcQlURYPY7reQh6p9XoEWrbpn18QGsQU0je4SqAqzX3lT68blRUwta/fsmtggtkCdt1lKy+zdbyEPZXsGgw3khw1iC7hBaG3PUDdLYz1626X7eDqe4UDPaParbDW9drm3fNRGHTaILRBPxWt63a1s1pS7yoV9Y5p6TcsgL6qE1BLSbJdoY+n+/r4t2wEbxBbQ20qVS90jM6uW1wMbYoMA0AUbBIAu2CA2rIXrTpCxLcofG8SGxTMV+uzKAGW2KH9sEBtGBYQmqIDQCF0wNEEXDAAWs0EA6IINoiN0tdDEAPLHBtERJQ6DzVjVAPLHBtERKiA0QQWERuiCoQm6YACwOhvEEsJ1yTqfp+xGSQCWDaImncsc3zBQdqcSXS00MeD8sUHUoLNz0xMHVRm5skqcUEafXRmgzIDzxwZRg443DUkRnJ+f27JUQGiCCgiPuBspdLtk2amDdMHQBF0wPNBRqLe3t3MVEFfeoI7d3d3iKF0dAj8ej4u7+nUXV8fX4fSFDaKCuw5HYz86AF4HfnP3OhxVPLqpRHexp/kTXF9f53Z7rQ2iRNnVtpPJ5KFVpIHpTN9mKKFKZdGVyIEqKL3k3O8MkA2ixMnJiU2a1NHRkX0e+VGrOF6qUYcqoUzGCm0QhrpWGgR0CRNT8ijp3G8gPzc3NzZP1GLWGJC+d90yTWpkkEc2CEODzGmSOOrnu+eRH93ZluaHXmJawBqXG41GxfhPWjaDiyRtEAlNr+uNlCZISuM/Gmx0v4H86K71OD/U0inbrqPxxXCDbaDKypUdEBtEQtfXxolRRuXc88jT3d3do/xQheTKBRr3icvLwCc0bBARtWjSLRdO1UJE5CnNm0WzW8qfuLzUvXp7S9kgIlokliaFw0JEpNJuuxYgunIBFRDmpN0vN6UaFiK655GvdExHq55ducBt8aELljl1wbTJVA4PD+2CMq0Pcs8ib5rFivNEg9DpDFigF1haYZWdrjAgNogSOnQsThBRhaQZDFceedMK6DRf1C1TSycup2l4t16IaXg80BvKdb8yWjaPFajbleaMaIpda3+m06n9XhVVBks6bBCGW4io1ay0flBFlUg6HV+Hjvl1vzcwNoiEWj9uISJn+6AObalIx3fKaOqezah4RDMRaaKUnX4IOHqJqRVdtaZM40Acx4E56mZdXV0V/XYdxcpud6xKFZG6V3qB6VAy7R3U5EZ+R7g8mf0PvyfvUdCSoaMAAAAASUVORK5CYII=";var Vo=["Loading...","???","\u5728\u52a0\u8f7d\u4e86","bangbangboom \u70b8\u4e86\u591a\u4e45\u4e86","\u5c0f\u9c7c\u5e72 -20..\u9c7c\u5e72\u4e0d\u8db3"];function Yo(t,e,n){var r=8*(0|e);return t&~(255<<r)|(255&n)<<r}var Wo={r:2,g:1,b:0};function qo(t,e,n){var r=function(i){n((function(){return t.removeEventListener(e,r)}),i)};return t.addEventListener(e,r),function(){return t.removeEventListener(e,r)}}!function(){function t(){this.pool=[]}t.prototype.get=function(){if(!this.newObj)throw new Error("Can not create new object");this.pool.length<=0&&this.pool.push(this.newObj());var t=this.pool.pop();return this.pre?this.pre(t):t},t.prototype.save=function(t){this.after?this.pool.push(this.after(t)):this.pool.push(t)},t.prototype.ensure=function(t){if(!this.newObj)throw new Error("Can not create new object");for(;this.pool.length<t;)this.pool.push(this.newObj())},t.prototype.destroy=function(){this.pool.length=0}}();var Jo=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},Ko=new Map,Zo=new WeakMap;function Qo(t,e){if(t.loop||t.yoyo){var n=e/t.totaltime|0;e-=t.totaltime*n,t.yoyo&&n%2&&(e=t.totaltime-e)}var r=t.keyframes;if(0===r.length)return Zo.get(t)||(Zo.set(t,1),console.warn("Empty animation")),0;var i=function(t,e,n){var r=0,i=e-1;if(e<=0)return-1;if(n<t(r))return-1;if(t(i)<=n)return i;for(;r<i-1;){var o=(r+i)/2|0,a=t(o);if(n<a)i=o;else{if(!(a<n))return o;r=o}}return r}((function(t){return r[t].time}),r.length,e);if(i===r.length-1)return r[i].value;if(-1===i)return r[0].value;var o=r[i],a=r[i+1];switch(o.type){case"static":return o.value;case"linear":return _o(o.time,a.time,e,o.value,a.value);case"bezier":return o.calc||(o.calc=function(t){var e,n=(1e3*(e=Jo(t,4))[0]|0)+":"+(1e3*e[1]|0)+":"+(1e3*e[2]|0)+":"+(1e3*e[3]|0),r=Ko.get(n);if(r)return r;for(var i=[],o=function(t){return(t[0]<0||t[0]>1||t[2]<0||t[2]>1)&&console.warn("Unexpected control points of bezier curve"),function(e){var n=3*e*(1-e)*(1-e),r=3*e*e*(1-e),i=e*e*e;return{x:t[0]*n+t[2]*r+i,y:t[1]*n+t[3]*r+i}}}(t),a=0;a<=10;a++)i.push(o(a/10));var s=new Float32Array(101);for(s[0]=0,a=1;a<100;a++){for(var u=a/100,c=0;u>i[c].x;)c++;s[a]=_o(i[c-1].x,i[c].x,u,i[c-1].y,i[c].y)}return s[100]=1,r=function(t){if(t<0)return 0;if(t>1)return 1;var e=100*t,n=0|e,r=n+1;return s[n]*(r-e)+s[r]*(e-n)},Ko.set(n,r),r}(o.ctrl)),n=o.calc((e-o.time)/(a.time-o.time)),(a.value-o.value)*n+o.value}}var $o=function(){function t(t){this.currentTime=0,this.animations=new Map,this.onEnd=new To,this.paused=!1,this._ended=!1,this.targetPropMapper=t}return t.prototype.update=function(t){var e,n;if(!this.paused&&this.targetPropMapper){this.currentTime+=t;var r=0;try{for(var i=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.animations),o=i.next();!o.done;o=i.next()){var a=Jo(o.value,2),s=a[0],u=a[1],c=Qo(u,this.currentTime)*("number"==typeof u.scale?u.scale:1)+("number"==typeof u.base?u.base:0);this.targetPropMapper(s,c),!u.loop&&!u.yoyo&&this.currentTime>=u.totaltime&&r++}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}r===this.animations.size?(this._ended||this.onEnd.emit(),this._ended=!0):this._ended=!1}},Object.defineProperty(t.prototype,"ended",{get:function(){return this._ended},enumerable:!0,configurable:!0}),t}();function ta(t){var e=t;return function(n,r){switch(n){case"x":case"y":case"alpha":case"rotation":case"angle":t[n]=r;break;case"scale":t.scale.set(r);break;case"scalex":t.scale.x=r;break;case"scaley":t.scale.y=r;break;case"r":case"g":case"b":e.isSprite&&(e.tint=Yo(e.tint,Wo[n],r))}}}var ea={type:"bezier",ctrl:[0,0,.58,1],time:0,value:0};function na(t,e,n,r){return{keyframes:[r,{type:"linear",time:n,value:1}],totaltime:n,base:t,scale:e-t}}var ra=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ia=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},oa=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},aa=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(oa(arguments[e]));return t},sa=function(){function t(){this.progress=0,this.targetProgress=0,this.finished=!1}return t.prototype.set=function(t){this.targetProgress=t,t>=1&&(this.finished=!0)},t.prototype.update=function(t){if(this.progress+=t*(this.targetProgress-this.progress)*5,this.finished&&(this.progress+=.1*t,this.progress>1))return this.progress=1,!0},t}(),ua=function(t){function e(e,n){var r=t.call(this)||this;r.progress=new sa;var i=He.from(Xo),o=new(io.bind.apply(io,aa([void 0,i],e.Resize.prevArgs)));r.addChild(o);var a=new zo(1280,720);a.resize.apply(a,aa(e.Resize.prevArgs));var s=new Fi(Vo[0],{fontSize:72,fill:"white"});s.position.set(400,330),s.scale.set(.5),a.addChild(s);var u=(new Oi).beginFill(8421504).drawRoundedRect(0,0,480,18,8).endFill();u.position.set(400,380),a.addChild(u);var c=new Oi;c.position.set(400,380),a.addChild(c),r.addChild(a);var l=r.setTextAnim(s,e.Update);e.Resize.add((function(t,e,n){if(!r.parent)return t();o.width=e,o.height=n,o.tileScale.set(Math.max(e,n)/1e3),a.resize(e,n)}));var h=0;return e.Update.add((function(t,e){if(!r.parent)return t();o.tilePosition.x+=20*e,o.tilePosition.y+=10*e,l.update(e),r.progress.update(e);var n=r.progress.progress;n>.04&&h!==n&&(h=n,c.clear().beginFill(15286111).drawRoundedRect(0,0,480*n,18,8).endFill())})),r.messages=n.loadingMessages||Vo,r}return ra(e,t),e.prototype.getRandomMessage=function(t){void 0===t&&(t="");for(var e=t;e===t;){var n=Math.floor(Math.random()*this.messages.length);e=this.messages[n]}return e},e.prototype.setTextAnim=function(t,e){var n=this,r=5,i=new $o(ta(t));i.paused=!0;var o=na(1,0,.3,ea),a=na(t.x,t.x-20,.3,ea),s=na(0,1,.3,ea),u=na(t.x+20,t.x,.3,ea),c=function(){return t.text=n.getRandomMessage(t.text),i.currentTime=0,i.animations.set("alpha",s),i.animations.set("x",u),i.onEnd.add((function(){return i.paused=!0,i.currentTime=0,r=5,"remove"})),"remove"};return e.add((function(t,e){if(!n.parent)return t();(r-=e)<0&&r+e>=0&&n.parent&&(i.paused=!1,i.animations.set("alpha",o),i.animations.set("x",a),i.onEnd.add(c))})),i},function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),ia("design:paramtypes",[Fo,s])],e)}(ie),ca=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),la=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ha=function(t){function e(e,n,r){var i,o=t.call(this,0,0)||this,a=new Ii(null===(i=n.background)||void 0===i?void 0:i.texture);a.alpha=1-e.backgroundDim,o.setInit(a.width,a.height);var s=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}(r.Resize.prevArgs,2),u=s[0],c=s[1];return o.resize(u,c,!0),r.Resize.add((function(t,e,n){if(!o.parent)return t();o.resize(e,n,!0)})),o.addChild(a),o}return ca(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),la("design:paramtypes",[a,Uo,Fo])],e)}(zo);function da(t,e){e&&(void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),void 0!==e.width&&(t.width=e.width),void 0!==e.height&&(t.height=e.height),void 0!==e.anchor&&("number"==typeof e.anchor?t.anchor.set(e.anchor):t.anchor.set(e.anchor.x,e.anchor.y)),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&("number"==typeof e.scale?t.scale.set(e.scale):t.scale.set(e.scale.x,e.scale.y)))}var fa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pa=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ma=function(t){function e(n,r){var i,o,a=t.call(this,n.texture&&r&&r[n.texture]||void 0)||this;if(a.infoSprites=[],a.animation=new $o,a.update=function(t){var e,n;if(a.visible){a.animation.update(t);try{for(var r=pa(a.infoSprites),i=r.next();!i.done;i=r.next())i.value.update(t)}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}},a.animation.targetPropMapper=ta(a),n.position&&da(a,n.position),n.animations instanceof Object)for(var s in n.animations)a.animation.animations.set(s,n.animations[s]);if(n.children instanceof Array)try{for(var u=pa(n.children),c=u.next();!c.done;c=u.next()){var l=new e(c.value,r);a.addChild(l),a.infoSprites.push(l)}}catch(t){i={error:t}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return"add"===n.blend&&(a.blendMode=P.ADD),void 0!==n.tint&&(a.tint=parseInt(n.tint.replace("#","0x"))),a}return fa(e,t),e.prototype.resetAnim=function(){var t,e;this.visible=!0,this.animation.currentTime=0;try{for(var n=pa(this.infoSprites),r=n.next();!r.done;r=n.next())r.value.resetAnim()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},e.prototype.allAnimEnd=function(){var t,e;if(!this.animation.ended)return!1;try{for(var n=pa(this.infoSprites),r=n.next();!r.done;r=n.next())if(!r.value.allAnimEnd())return!1}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return!0},e}(Ii),ya=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ga=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},va=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},_a=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ba=function(t){function e(e,n,r){var i,o,a=t.call(this,1280,720)||this;a.start=function(t){void 0===t&&(t=!1)},a.resize.apply(a,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(va(arguments[e]));return t}(r.Resize.prevArgs)),r.Resize.add((function(t,e,n){if(!a.parent)return t();a.resize(e,n)}));var s=e.ui.data.info.ready,u=e.ui.textures;if(s.other instanceof Array)try{for(var c=_a(s.other),l=c.next();!l.done;l=c.next()){var h=l.value;a.addChild(new ma(h,u))}}catch(t){i={error:t}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}var d=new ma(s.play,u);a.addChild(d);var f=new ma(s.auto,u);if(a.addChild(f),s.name){var p=new Fi(n.songName,s.name.style);da(p,s.name.position),a.addChild(p)}return d.interactive=!0,f.interactive=!0,d.once("pointertap",(function(){return a.start()})),f.once("pointertap",(function(){return a.start(!0)})),r.Update.add((function(t,e){var n,r;if(!a.parent)return t();try{for(var i=_a(a.children),o=i.next();!o.done;o=i.next()){var s=o.value;s instanceof ma&&s.update(e)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}})),a}return ya(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),ga("design:paramtypes",[Uo,s,Fo])],e)}(zo),xa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wa=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ea=function(t){function e(e){var n=t.call(this)||this,r=new Ii(e.game.textures.rhythm_line);r.anchor.set(.5,1),r.position.set(640,612),n.addChild(r);var i=new Ii(e.game.textures.play_line);return i.anchor.set(.5),i.position.set(640,612),n.addChild(i),n}return xa(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),wa("design:paramtypes",[Uo])],e)}(ie),Ta=function(){return(Ta=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Oa=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Aa=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Sa={perfect:2e3,great:1e3,good:600,bad:300,miss:0},Ia=function(){function t(t,e){var n,r,i,o=this;if(this.maxCombo=0,this.currentCombo=0,this.perfect=0,this.great=0,this.good=0,this.bad=0,this.miss=0,this.onMusicTimeUpdate=new To,this.onPointer=new To,this.onJudge=new To,this.onEmptyTap=new To,this.onPause=new To,this.onContinue=new To,this.onFullCombo=new To,this.onEnd=new To,this.onRestart=new To,this.onAbort=new To,this.GetMusicTime=function(){return 0},this.maxScore=0,this.currentScore=0,this._ended=!1,this._paused=!1,this.map=function(t){var e,n,r,i,o,a;t.notes=t.notes.sort((function(t,e){return t.time-e.time||t.lane-e.lane}));var s=new Map,u=new Map;try{for(var c=Oa(t.slides),l=c.next();!l.done;l=c.next()){var h=l.value;s.set(h.id,{type:"slide",flickend:h.flickend,notes:[]})}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}try{for(var d=Oa(t.notes),f=d.next();!f.done;f=d.next())if("slide"===(x=f.value).type){var p=u.get(x.slideid);p?p.push(x):u.set(x.slideid,[x])}}catch(t){r={error:t}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}var m=[],y=[],g=[],v=new Map;try{for(var _=Oa(t.notes),b=_.next();!b.done;b=_.next()){var x;if("slide"!==(x=b.value).type)m.push(Ta({},x));else{if(!(h=s.get(x.slideid)))throw new Error("Can not find slide for note");var w=u.get(x.slideid);if(!w)throw new Error("Never happens");if(w.length<2)throw new Error("Slide can not have less than 2 notes");if(x===w[0]){m.push({type:"slidestart",parent:h,time:x.time,lane:x.lane});var E=go(m,-1);h.notes.push(E)}else{x===w[w.length-1]?h.flickend?m.push({type:"flickend",parent:h,time:x.time,lane:x.lane}):m.push({type:"slideend",parent:h,time:x.time,lane:x.lane}):m.push({type:"slideamong",parent:h,time:x.time,lane:x.lane}),E=go(h.notes,-1);var T=go(m,-1);h.notes.push(T),g.push({type:"slidebar",start:E,end:T})}}var O=go(m,-1);if("slideamong"!==O.type){var A=v.get(x.time);A&&y.push({type:"simline",left:A,right:O}),v.set(x.time,O)}}}catch(t){o={error:t}}finally{try{b&&!b.done&&(a=_.return)&&a.call(_)}finally{if(o)throw o.error}}return{notes:m,bars:g,simlines:y,combo:m.length}}(t.map.data),e.mirror)try{for(var a=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.map.notes),s=a.next();!s.done;s=a.next()){var u=s.value;u.lane=6-u.lane}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}this.musicTime=Math.min(-1,((null===(i=this.map.notes[0])||void 0===i?void 0:i.time)||0)-5),this.maxScore=(Sa.perfect+1+Sa.perfect+this.map.combo)*this.map.combo/2,this.maxScore<=0&&(this.maxScore=1,this.map.combo=1),this.onJudge.add((function(t,e){if(o.ended)return t();e.judge&&o.addJudge(e.judge)})),this.onEnd.add((function(){o._ended=!0,o.onMusicTimeUpdate.clear(),o.onPause.clear(),o.onContinue.clear(),o.onJudge.clear(),o.onPointer.clear()})),this.onPause.add((function(){o._paused=!0})),this.onContinue.add((function(){o._paused=!1}))}return Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:function(){return this._ended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){return 1e6*this.currentScore/this.maxScore|0},enumerable:!0,configurable:!0}),t.prototype.addJudge=function(t){"perfect"===t||"great"===t?(this.currentCombo++,this.maxCombo<this.currentCombo&&(this.maxCombo=this.currentCombo),this.currentCombo===this.map.combo&&this.onFullCombo.emit()):this.currentCombo=0,this.currentScore+=Sa[t]+this.maxCombo,this[t]++},function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Aa("design:paramtypes",[Uo,a])],t)}(),Pa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ca=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ra=function(t){function e(e,n){var r=t.call(this)||this,i=4.5*153.6,o=new Oi;o.position.set(640,216),o.lineStyle(3,16711816),o.moveTo(-i,0).lineTo(i,0).lineTo(i,864).lineTo(-i,864).lineTo(-i,0),r.addChild(o),o.alpha=e.debug?1:0,o.interactive=!0,o.hitArea=o.getLocalBounds();var a=function(t,e){if(e<0)return-1;var n=t>=0?1:-1,r=(Math.abs(t)+76.8)/153.6;return r>=5?-1:(r>=4&&(r=3.5),3+Math.floor(r)*n)},s={pointerup:"up",pointerdown:"down",pointerupoutside:"up",pointermove:"move"};return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];t.forEach((function(t){return o.on(t,(function(r){r.stopPropagation();var i=s[t],u=o.toLocal(r.data.global),c={pointerId:r.data.pointerId||16777215,time:0,lane:a(u.x,u.y),type:i,x:u.x,y:u.y};n.onPointer.emit(c),e.debug&&t.indexOf("move")<0&&console.log(t,c)}))}))}("pointerup","pointerdown","pointerupoutside","pointermove"),r}return Pa(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Ca("design:paramtypes",[a,Ia])],e)}(ie),Ma=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Da=function(t){function e(e){void 0===e&&(e=!1);var n=t.call(this)||this;return n._buffer=new qe(null,e,!1),n._indexBuffer=new qe(null,e,!0),n.addAttribute("aVertexPosition",n._buffer,3,!1,D.FLOAT).addAttribute("aTextureCoord",n._buffer,2,!1,D.FLOAT).addAttribute("aColor",n._buffer,4,!0,D.UNSIGNED_BYTE).addAttribute("aTextureId",n._buffer,1,!0,D.FLOAT).addIndex(n._indexBuffer),n}return Ma(e,t),e}(tn),ka=function(t){function e(e){var n=t.call(this,e)||this;return n.shaderGenerator=new vr("\nprecision highp float;\n\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position.xyw = projectionMatrix * aVertexPosition;\n    gl_Position.z = 0.0;\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}","\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%;\n    gl_FragColor = color * vColor;\n}"),n.geometryClass=Da,n.vertexSize=7,n}return Ma(e,t),e.prototype.packInterleavedGeometry=function(t,e,n,i,o){var a=e.uint32View,s=e.float32View,u=i/this.vertexSize,c=t.uvs,l=t.indices,h=t.vertexData,d=t.vertexData2d,f=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),m=p<1&&t._texture.baseTexture.alphaMode?r.premultiplyTint(t._tintRGB,p):t._tintRGB+(255*p<<24);if(d)for(var y=0,g=0;y<d.length;y+=3,g+=2)s[i++]=d[y],s[i++]=d[y+1],s[i++]=d[y+2],s[i++]=c[g],s[i++]=c[g+1],a[i++]=m,s[i++]=f;else for(y=0;y<h.length;y+=2)s[i++]=h[y],s[i++]=h[y+1],s[i++]=1,s[i++]=c[y],s[i++]=c[y+1],a[i++]=m,s[i++]=f;for(y=0;y<l.length;y++)n[o++]=u+l[y]},e}(gr);hr.registerPlugin("mybatch2d",ka);var ja=function(t){function e(e){var n=t.call(this,e)||this;return n.projection=new jt,n.pluginName="mybatch2d",n}return Ma(e,t),Object.defineProperty(e.prototype,"projectionX",{get:function(){return this.projection.x},set:function(t){this.projection.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionY",{get:function(){return this.projection.y},set:function(t){this.projection.y=t},enumerable:!0,configurable:!0}),e.prototype.calculateVertices=function(){var t=this.texture,e=this.transform._worldID,n=t._updateID;if(this._transformID!==e||this._textureID!==n){this._textureID!==n&&(this.uvs=t._uvs.uvsFloat32),this._transformID=e,this._textureID=n;var r=this.vertexData,i=t.trim,o=t.orig,a=this._anchor,s=0,u=0,c=0,l=0;i?(s=(u=i.x-a._x*o.width)+i.width,c=(l=i.y-a._y*o.height)+i.height):(s=(u=-a._x*o.width)+o.width,c=(l=-a._y*o.height)+o.height),this.vertexData2d||(this.vertexData2d=new Float32Array(12));var h=this.vertexData2d,d=(this.projectionX||0)/(s-u),f=(this.projectionY||0)/(c-l),p=this.transform.worldTransform,m=p.a,y=p.b,g=p.c,v=p.d,_=p.tx,b=p.ty;if(h[2]=u*d+l*f+1,h[0]=m*u+g*l+_*h[2],h[1]=v*l+y*u+b*h[2],r[0]=h[0]/h[2],r[1]=h[1]/h[2],h[5]=s*d+l*f+1,h[3]=m*s+g*l+_*h[5],h[4]=v*l+y*s+b*h[5],r[2]=h[3]/h[5],r[3]=h[4]/h[5],h[8]=s*d+c*f+1,h[6]=m*s+g*c+_*h[8],h[7]=v*c+y*s+b*h[8],r[4]=h[6]/h[8],r[5]=h[7]/h[8],h[11]=u*d+c*f+1,h[9]=m*u+g*c+_*h[11],h[10]=v*c+y*u+b*h[11],r[6]=h[9]/h[11],r[7]=h[10]/h[11],this._roundPixels)for(var x=0;x<8;x++)r[x]=Math.round(r[x])}},e}(Ii),Na=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),La=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ba=function(t){function e(e,n){var r,i=t.call(this,null===(r=e.game.textures)||void 0===r?void 0:r.slide_bar)||this;return i.helper=n,i.shouldRemove=!1,i.anchor.set(.5,1),i.visible=!1,i}return Na(e,t),e.prototype.applyInfo=function(t){this.bar=t,this.visible=!0,this.shouldRemove=!1},e.prototype.update=function(t){if(this.visible&&!this.shouldRemove&&this.bar){var e=this.bar.start.time;e<t&&this.bar.start.parent.pointerId&&(e=t);var n=this.bar.end.time;if(n>t+this.helper.staytime&&(n=t+this.helper.staytime),this.bar.end.judge||"miss"===this.bar.start.judge||e>=n||t>this.bar.end.time+1||!this.bar.start.parent.pointerId&&t>this.bar.start.time+1)return this.shouldRemove=!0,this.visible=!1,void(this.zIndex=0);var r=_o(this.bar.start.time,this.bar.end.time,e,Oo[this.bar.start.lane],Oo[this.bar.end.lane]),i=ko((t-e)/this.helper.staytime,r),o=_o(this.bar.start.time,this.bar.end.time,n,Oo[this.bar.start.lane],Oo[this.bar.end.lane]),a=ko((t-n)/this.helper.staytime,o),s=i.scale/a.scale,u=this.helper.noteScale*i.scale/Go.noteInitScale,c=(i.y-a.y)/this.texture.height*s;this.transform.setFromMatrix(new Ut(u,0,(a.x-i.x)/(a.y-i.y)*c,c,i.x,i.y)),this.projectionY=1-s,this.zIndex=i.scale}},function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),La("design:paramtypes",[Uo,Go])],e)}(ja),Fa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ua=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ga=function(t){function e(e,n){var r,i=t.call(this,null===(r=e.game.textures)||void 0===r?void 0:r.simultaneous_line)||this;return i.helper=n,i.shouldRemove=!1,i.anchor.set(.5),i.visible=!1,i}return Fa(e,t),e.prototype.applyInfo=function(t){this.sim=t,this.shouldRemove=!1,this.visible=!0},e.prototype.update=function(t){if(this.visible&&!this.shouldRemove&&this.sim){if(this.sim.left.judge||this.sim.right.judge||t>this.sim.left.time+1)return this.shouldRemove=!0,this.visible=!1,void(this.zIndex=0);var e=this.helper.calc(this.sim.left,t),n=this.helper.calc(this.sim.right,t);this.height=e.scale*this.texture.height*this.helper.noteScale,this.width=e.x-n.x,this.x=(e.x+n.x)/2,this.y=e.y,this.zIndex=e.scale}},function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Ua("design:paramtypes",[Uo,Go])],e)}(Ii),Ha=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),za=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Xa=function(t){function e(e,n,r){var i=t.call(this)||this;return i.resource=e,i.helper=n,i.config=r,i.shouldRemove=!1,i.anchor.set(.5),i.visible=!1,i}return Ha(e,t),e.prototype.setTexture=function(t){var e;!(null===(e=this.note)||void 0===e?void 0:e.onbeat)&&this.config.beatNote?this.texture=this.resource.game.textures["gray_"+t]:this.texture=this.resource.game.textures["single_"+t]},e.prototype.applyInfo=function(t){this.note=t,this.setTexture(t.lane),this.shouldRemove=!1,this.visible=!0},e.prototype.update=function(t){if(this.visible&&!this.shouldRemove&&this.note){if(this.note.judge||t>this.note.time+1)return this.shouldRemove=!0,this.visible=!1,void(this.zIndex=0);var e=this.helper.calc(this.note,t);this.position.set(e.x,e.y),this.helper.setScale(this,e.scale),this.zIndex=e.scale}},function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),za("design:paramtypes",[Uo,Go,a])],e)}(Ii),Va=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ya=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Wa=function(t){function e(e,n){var r=t.call(this)||this;return r.resource=e,r.helper=n,r.shouldRemove=!1,r.anchor.set(.5),r.visible=!1,r.top=new Ii(e.game.textures.flick_top),r.top.anchor.set(.5,1),r.addChild(r.top),r}return Va(e,t),e.prototype.setTexture=function(t){this.texture=this.resource.game.textures["flick_"+t]},e.prototype.applyInfo=function(t){this.note=t,this.setTexture(t.lane),this.shouldRemove=!1,this.visible=!0},e.prototype.update=function(t){if(this.visible&&!this.shouldRemove&&this.note){if(this.note.judge||t>this.note.time+1)return this.shouldRemove=!0,this.visible=!1,void(this.zIndex=0);var e=this.helper.calc(this.note,t);this.position.set(e.x,e.y),this.helper.setScale(this,e.scale),this.top.y=30*Math.sin(10*t)-30,this.zIndex=e.scale}},function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Ya("design:paramtypes",[Uo,Go])],e)}(Ii),qa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ja=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ka=function(t){function e(e,n){var r=t.call(this)||this;return r.resource=e,r.helper=n,r.shouldRemove=!1,r.anchor.set(.5),r.visible=!1,r}return qa(e,t),e.prototype.setTexture=function(t){this.texture=this.resource.game.textures["slide_"+t]},e.prototype.applyInfo=function(t){this.note=t,this.setTexture(t.lane),this.shouldRemove=!1,this.visible=!0},e.prototype.update=function(t){if(this.visible&&!this.shouldRemove&&this.note){if(this.note.judge||t>this.note.time+1)return this.shouldRemove=!0,this.visible=!1,void(this.zIndex=0);var e=this.helper.calc(this.note,t);this.position.set(e.x,e.y),this.helper.setScale(this,e.scale),this.zIndex=e.scale}},function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Ja("design:paramtypes",[Uo,Go])],e)}(Ii),Za=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qa=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},$a=function(t){function e(e,n){var r,i=t.call(this,null===(r=e.game.textures)||void 0===r?void 0:r.slide_among)||this;return i.helper=n,i.shouldRemove=!1,i.anchor.set(.5),i.visible=!1,i}return Za(e,t),e.prototype.applyInfo=function(t){this.note=t,this.shouldRemove=!1,this.visible=!0},e.prototype.update=function(t){if(this.visible&&!this.shouldRemove&&this.note){if(this.note.judge||t>this.note.time+1)return this.shouldRemove=!0,this.visible=!1,void(this.zIndex=0);var e=this.helper.calc(this.note,t);this.position.set(e.x,e.y),this.helper.setScale(this,e.scale),this.zIndex=e.scale}},function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Qa("design:paramtypes",[Uo,Go])],e)}(Ii),ts=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),es=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ns=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},rs=function(t){function e(e,n,r){var i=t.call(this)||this;return i.state=e,i.helper=n,i.ioc=r,i.nextBarIndex=0,i.pool=[],i.freeIndexes=[],i.sortableChildren=!0,i}return ts(e,t),e.prototype.update=function(t,e){for(var n=this.nextBarIndex,r=this.state.map.bars;n<r.length&&r[n].start.time<e;){if(void 0===(o=this.freeIndexes.pop())){o=this.pool.length;var i=this.ioc.resolve(Ba);this.addChild(i),this.pool.push(i)}this.pool[o].applyInfo(r[n]),n++}this.nextBarIndex=n;for(var o=0;o<this.pool.length;o++){var a=this.pool[o];a.update(t),a.shouldRemove&&(a.shouldRemove=!1,this.freeIndexes.push(o))}},es([Object(l.injectable)(),ns("design:paramtypes",[Ia,Go,l.Container])],e)}(ie),is=function(t){function e(e,n,r){var i=t.call(this)||this;return i.config=e,i.state=n,i.ioc=r,i.nextSimIndex=0,i.pool=[],i.freeIndexes=[],i.sortableChildren=!0,i}return ts(e,t),e.prototype.update=function(t,e){if(this.config.showSimLine){for(var n=this.nextSimIndex,r=this.state.map.simlines;n<r.length&&r[n].left.time<e;){if(void 0===(o=this.freeIndexes.pop())){o=this.pool.length;var i=this.ioc.resolve(Ga);this.addChild(i),this.pool.push(i)}this.pool[o].applyInfo(r[n]),n++}this.nextSimIndex=n;for(var o=0;o<this.pool.length;o++){var a=this.pool[o];a.update(t),a.shouldRemove&&(a.shouldRemove=!1,this.freeIndexes.push(o))}}},es([Object(l.injectable)(),ns("design:paramtypes",[a,Ia,l.Container])],e)}(ie),os={single:Xa,flick:Wa,flickend:Wa,slidestart:Ka,slideend:Ka,slideamong:$a},as=function(t){function e(e,n){var r=t.call(this)||this;for(var i in r.state=e,r.ioc=n,r.nextNoteIndex=0,r.pool=[],r.sortableChildren=!0,r.freeIndexes={},os)r.freeIndexes[i]=[];return r}return ts(e,t),e.prototype.update=function(t,e){for(var n=this.nextNoteIndex,r=this.state.map.notes;n<r.length&&r[n].time<e;){var i=r[n];if(void 0===(a=this.freeIndexes[i.type].pop())){a=this.pool.length;var o=this.ioc.resolve(os[i.type]);this.addChild(o),this.pool.push(o)}this.pool[a].applyInfo(i),n++}this.nextNoteIndex=n;for(var a=0;a<this.pool.length;a++){var s=this.pool[a];s.update(t),s.shouldRemove&&(s.shouldRemove=!1,this.freeIndexes[s.note.type].push(a))}},es([Object(l.injectable)(),ns("design:paramtypes",[Ia,l.Container])],e)}(ie),ss=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.state=e,o.helper=r,o.config=i,o.update=function(t,e){if(o.state.ended)return t();var n=o.helper.staytime+e.visualTime;o.barLayer.update(e.visualTime,n),o.simLineLayer.update(e.visualTime,n),o.noteLayer.update(e.visualTime,n)},e.onMusicTimeUpdate.add(o.update),o.barLayer=n.resolve(rs),o.noteLayer=n.resolve(as),o.simLineLayer=n.resolve(is),o.addChild(o.barLayer),o.addChild(o.simLineLayer),o.addChild(o.noteLayer),o.barLayer.alpha=i.barOpacity,o}return ts(e,t),es([Object(l.injectable)(),ns("design:paramtypes",[Ia,l.Container,Go,a])],e)}(ie),us=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),cs=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},ls=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(cs(arguments[e]));return t},hs=function(t){function e(e,n){var r=t.call(this,n)||this;return r.num=e,r.anchor.set(.5),r}return us(e,t),e}(Ii),ds=function(t){function e(e){var n=t.call(this)||this;return n.tex=[],n.spritepool=[],n.charWidth=0,n.charHeight=0,n.tint=16777215,n.fontSize=36,n.padding=4,n.tex=e,n.charWidth=Math.max.apply(Math,ls(e.map((function(t){return t.width})))),n.charHeight=Math.max.apply(Math,ls(e.map((function(t){return t.height})))),n}return us(e,t),e.prototype.setValue=function(t){var e,n,r=t.toFixed().split("").map((function(t){return parseInt(t)})),i=this.fontSize/this.charHeight,o=this.charWidth*i+this.padding,a=this.charWidth*i/2,s=this.charHeight*i/2;try{for(var u=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.children),c=u.next();!c.done;c=u.next()){var l=c.value;this.saveDigit(l)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}this.removeChildren();for(var h=0;h<r.length;h++){l=r[h];var d=this.getDigit(l);d.position.set(a+o*h,s),d.scale.set(i),d.tint=this.tint,this.addChild(d)}},e.prototype.getDigit=function(t){var e=this.spritepool[t];return void 0===e&&(e=[],this.spritepool[t]=e),e.length<=0&&e.push(new hs(t,this.tex[t])),e.pop()},e.prototype.saveDigit=function(t){var e=t.num,n=this.spritepool[e];void 0===n&&(n=[],this.spritepool[e]=n),n.push(t)},e}(ie),fs=function(t){function e(e){var n=t.call(this)||this;return n.content=new ds(e),n.addChild(n.content),n.anchor=new Nt((function(){n.justifyPos()}),void 0),n}return us(e,t),Object.defineProperty(e.prototype,"tint",{get:function(){return this.content.tint},set:function(t){this.content.tint=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.content.fontSize},set:function(t){this.content.fontSize=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this.content.padding},set:function(t){this.content.padding=t},enumerable:!0,configurable:!0}),e.prototype.setValue=function(t){this.content.setValue(t),this.justifyPos()},e.prototype.justifyPos=function(){var t=this.fontSize/this.content.charHeight,e=this.content.children.length*this.content.charWidth*t+(this.content.children.length-1)*this.padding,n=this.content.charHeight*t;this.content.position.set(-e*this.anchor.x,-n*this.anchor.y)},e}(ie),ps=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ms=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ys=function(t){function e(e,n){var r,i,o=t.call(this,[0,1,2,3,4,5,6,7,8,9].map((function(t){return t.toString()})).map((function(t){return n[t]})))||this;if(o.infoSprites=[],o.animation=new $o,o.update=function(t){var e,n;if(o.visible){o.animation.update(t);try{for(var r=ms(o.infoSprites),i=r.next();!i.done;i=r.next())i.value.update(t)}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}},void 0!==e.fontSize&&(o.fontSize=e.fontSize),void 0!==e.fontTint&&(o.tint=parseInt(e.fontTint.replace("#","0x"))),void 0!==e.fontPadding&&(o.padding=e.fontPadding),da(o,e.position),o.animation.targetPropMapper=ta(o),e.animations instanceof Object)for(var a in e.animations)o.animation.animations.set(a,e.animations[a]);if(e.children instanceof Array)try{for(var s=ms(e.children),u=s.next();!u.done;u=s.next()){var c=u.value,l=new ma(c,n);o.addChild(l),o.infoSprites.push(l)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o}return ps(e,t),e.prototype.resetAnim=function(){var t,e;this.animation.currentTime=0;try{for(var n=ms(this.infoSprites),r=n.next();!r.done;r=n.next())r.value.resetAnim()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},e.prototype.allAnimEnd=function(){var t,e;if(!this.animation.ended)return!1;try{for(var n=ms(this.infoSprites),r=n.next();!r.done;r=n.next())if(!r.value.allAnimEnd())return!1}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return!0},e}(fs),gs=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),vs=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},_s=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},bs=function(t){function e(e,n,r,i){var o,a,s=t.call(this)||this,u=r.ui.data.info.game,c=r.ui.textures;if(u.other instanceof Array)try{for(var l=_s(u.other),h=l.next();!h.done;h=l.next()){var d=h.value;s.addChild(new ma(d,c))}}catch(t){o={error:t}}finally{try{h&&!h.done&&(a=l.return)&&a.call(l)}finally{if(o)throw o.error}}var f=new ma(u.judge,c),p=new ma(u.pause,c),m=new ys(u.combo,c),y=new ys(u.score,c);return s.addChild(f),s.addChild(p),s.addChild(m),s.addChild(y),p.interactive=!0,p.on("pointertap",(function(){e.onPause.emit()})),y.setValue(0),m.visible=!1,e.onJudge.add((function(t,n){if(!s.parent)return t();f.texture=c[n.judge],f.resetAnim(),e.currentCombo>0?(m.setValue(e.currentCombo),m.resetAnim(),m.visible=!0):m.visible=!1,y.setValue(e.score),y.resetAnim()})),i.Update.add((function(t,n){var r,i;if(!s.parent)return t();if(!e.paused)try{for(var o=_s(s.children),a=o.next();!a.done;a=o.next()){var u=a.value;(u instanceof ma||u instanceof ys)&&u.update(n)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}})),s}return gs(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),vs("design:paramtypes",[Ia,a,Uo,Fo])],e)}(ie),xs=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function ws(t){if(void 0!==t)return"number"==typeof t?t:t instanceof Array?t[Math.floor(Math.random()*t.length)]:"max"in t?t.min+Math.random()*(t.max-t.min):t.base+(2*Math.random()-1)*t.offset}var Es=function(t){function e(e){var n=t.call(this,e)||this;return n.startX=0,n.startY=0,n.speedX=0,n.speedY=0,n.lifetime=0,n.currentTime=0,n.accelRad=0,n.accelTan=0,n.start={},n.end={},n.shouldRemove=!1,n.setSize=function(t){return n.scale.set(t)},n.setSpin=function(t){return n.rotation=t},n.setR=function(t){return n.tint=Yo(n.tint,2,t)},n.setG=function(t){return n.tint=Yo(n.tint,1,t)},n.setB=function(t){return n.tint=Yo(n.tint,0,t)},n.setAlpha=function(t){return n.alpha=t},n.anchor.set(.5),n}return xs(e,t),e.prototype.setOption=function(t,e){"add"===t.blend&&(this.blendMode=P.ADD);var n=ws(t.speed)||0,r=ws(t.radian)||0;this.speedX=n*Math.cos(r),this.speedY=n*Math.sin(r),this.lifetime=ws(t.lifeTime)||0,this.gravity=t.gravity,this.accelRad=ws(t.accelRad)||0,this.accelTan=ws(t.accelTan)||0,this.startX=(ws(t.emitRect.x)||0)+e.x,this.startY=(ws(t.emitRect.y)||0)+e.y,this.x=this.startX,this.y=this.startY,this.start={size:ws(t.start.size),spin:ws(t.start.spin),r:ws(t.start.r),g:ws(t.start.g),b:ws(t.start.b),alpha:ws(t.start.alpha)},this.end={size:ws(t.end.size),spin:ws(t.end.spin),r:ws(t.end.r),g:ws(t.end.g),b:ws(t.end.b),alpha:ws(t.end.alpha)}},e.prototype.setRatio=function(t,e){var n=function(t,e,n,r,i){if(void 0!==r)return void 0===i?r:(n-0)/(e-0)*(i-r)+r}(0,this.lifetime,this.currentTime,this.start[t],this.end&&this.end[t]);void 0!==n&&e(n)},e.prototype.update=function(t){if(this.currentTime+=t,this.currentTime>this.lifetime)return this.visible=!1,void(this.shouldRemove=!0);this.x+=this.speedX*t,this.y+=this.speedY*t;var e=0,n=0;this.gravity&&(e+=this.gravity.x,n+=this.gravity.y),this.accelTan&&(e+=this.accelTan*this.speedY,n+=this.accelTan*-this.speedX),this.accelRad&&(e+=this.accelRad*(this.x-this.startX),n+=this.accelRad*(this.y-this.startY)),this.speedX+=e*t,this.speedY+=n*t,this.setRatio("size",this.setSize),this.setRatio("spin",this.setSpin),this.setRatio("r",this.setR),this.setRatio("g",this.setG),this.setRatio("b",this.setB),this.setRatio("alpha",this.setAlpha)},e}(Ii),Ts=function(t){function e(e,n){var r=t.call(this)||this;return r.textures=e,r.option=n,r.freeIndexes=[],r.offset={x:0,y:0},r.canEmit=!0,r.destroyed=!1,r.currentTime=0,r.counter=0,r.onEmitEnd=new To,r.emitEnded=!1,r.onAllEnd=new To,r.allEnd=!1,r}return xs(e,t),e.prototype.useParticle=function(t){var e=this.children[t];e.visible=!0,e.setOption(this.option,this.offset),e.currentTime=0;var n=Math.random()*this.textures.length|0;return e.texture=this.textures[n],e},e.prototype.update=function(t){if(this.currentTime+=t,!(this.destroyed||this.currentTime<0)){if(this.currentTime-t<0&&(this.currentTime=0),this.canEmit&&(this.option.duration<=0||this.currentTime-t<this.option.duration)){var e=this.option.duration>0?this.currentTime<this.option.duration?t:this.option.duration-this.currentTime+t:t;for(this.counter+=e*this.option.emissionRate;this.counter>1;){this.counter-=1,this.freeIndexes.length<=0&&(this.addChild(new Es(this.textures[0])),this.freeIndexes.push(this.children.length-1));var n=this.freeIndexes.pop();this.useParticle(n)}}var r=0;for(n=0;n<this.children.length;n++){var i=this.children[n];i.visible&&(i.update(t),i.shouldRemove?(i.shouldRemove=!1,i.visible=!1,this.freeIndexes.push(n)):r++)}!this.canEmit||this.option.duration>0&&this.currentTime>=this.option.duration?(this.emitEnded||this.onEmitEnd.emit(),this.emitEnded=!0):this.emitEnded=!1,r<=0&&this.emitEnded?(this.allEnd||this.onAllEnd.emit(),this.allEnd=!0):this.allEnd=!1}},e.prototype.destroy=function(){this.destroyed=!0,this.removeChildren()},e}(ie),Os=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),As=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ss=function(t){function e(e,n){var r,i,o,a,s=t.call(this)||this;if(s.delaymap=new Map,s.update=function(t){var e,n;if(s.visible)try{for(var r=As(s.children),i=r.next();!i.done;i=r.next()){var o=i.value;(o instanceof ma||o instanceof Ts)&&o.update(t)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},e.particles instanceof Array)try{for(var u=As(e.particles),c=u.next();!c.done;c=u.next()){var l=c.value,h=new Ts(l.textures.map((function(t){return n&&n[t]})),l.option);h.currentTime=-(l.delay||0),s.delaymap.set(h,-(l.delay||0)),s.addChild(h)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}if(e.sprites instanceof Array)try{for(var d=As(e.sprites),f=d.next();!f.done;f=d.next()){l=f.value;var p=new ma(l,n);s.addChild(p)}}catch(t){o={error:t}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}return s}return Os(e,t),e.prototype.setPosition=function(t,e){var n,r,i=this.scale;try{for(var o=As(this.children),a=o.next();!a.done;a=o.next()){var s=a.value;s instanceof ma?s.position.set(t/i.x,e/i.y):s instanceof Ts&&(s.offset={x:t/i.x,y:e/i.y})}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype.resetAnim=function(){var t,e;try{for(var n=As(this.children),r=n.next();!r.done;r=n.next()){var i=r.value;i instanceof Ts?(i.currentTime=vo(this.delaymap.get(i)),i.emitEnded=!1,i.allEnd=!1,i.visible=!0,i.canEmit=!0):i instanceof ma&&i.resetAnim()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},e.prototype.stopEmit=function(){var t,e;try{for(var n=As(this.children),r=n.next();!r.done;r=n.next()){var i=r.value;i instanceof Ts?i.canEmit=!1:i instanceof ma&&(i.visible=!1)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},e.prototype.allAnimEnd=function(){var t,e;try{for(var n=As(this.children),r=n.next();!r.done;r=n.next()){var i=r.value;if(i instanceof Ts){if(!i.allEnd)return!1}else if(i instanceof ma&&!i.allAnimEnd())return!1}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return!0},e}(ie),Is=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ps=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Cs=function(t){function e(e,n,r){var i=t.call(this)||this;return i.info=e,i.textures=n,i.initScale=r,i.freeIndexes=[],i}return Is(e,t),e.prototype.update=function(t){for(var e=0;e<this.children.length;e++){var n=this.children[e];n instanceof Ss&&(n.update(t),n.visible&&n.allAnimEnd()&&(n.visible=!1,this.freeIndexes.push(e)))}},e.prototype.setEffect=function(t,e){var n=this.freeIndexes.pop();if(void 0===n){n=this.children.length;var r=new Ss(this.info,this.textures);r.scale.set(this.initScale),this.addChild(r)}var i=this.children[n];i.setPosition(t,e),i.resetAnim(),i.visible=!0},e.prototype.setTrackedEffect=function(t){var e=this.freeIndexes.pop();if(void 0===e){e=this.children.length;var n=new Ss(this.info,this.textures);n.scale.set(this.initScale),this.addChild(n)}var r=this.children[e],i=r.update;r.update=function(e){if(r.visible){var n=t();if(!n.visible)return r.update=i,void r.stopEmit();r.setPosition(n.x,n.y),i.call(r,e)}};var o=t();r.setPosition(o.x,o.y),r.resetAnim(),r.visible=!0},e}(ie),Rs=function(t){function e(e,n,r,i){var o=t.call(this)||this,a=e.effect.data.info,s=e.effect.textures,u=new Cs(a.tap,s,i.noteScale),c=new Cs(a.single,s,i.noteScale),l=new Cs(a.flick,s,i.noteScale),h=new Cs(a.slide,s,i.noteScale),d=new Cs(a.fullcombo,s,i.noteScale),f=new Set;return n.onJudge.add((function(t,e){"miss"!==e.judge?("flick"===e.type||"flickend"===e.type?l.setEffect(Oo[e.lane],612):c.setEffect(Oo[e.lane],612),"single"!==e.type&&"flick"!==e.type&&(f.has(e.parent)?"slideend"!==e.type&&"flickend"!==e.type||f.delete(e.parent):(f.add(e.parent),h.setTrackedEffect((function(){var t,r,i,o,a,s=e.parent,u=n.onMusicTimeUpdate.prevArgs[0].visualTime,c=s.nextJudgeIndex<s.notes.length&&f.has(s)&&go(s.notes,-1).time>=u;return{x:c&&(t=s,r=u,i=t.nextJudgeIndex||1,o=t.notes[i-1],a=t.notes[i],_o(o.time,a.time,r,Oo[o.lane],Oo[a.lane]))||0,y:612,visible:c}}))))):"parent"in e&&f.delete(e.parent)})),n.onEmptyTap.add((function(t,e){0<=e&&e<=6&&u.setEffect(Oo[e],612)})),n.onFullCombo.add((function(){d.setEffect(640,360)})),r.Update.add((function(t,e){var r,i;if(!o.parent)return t();if(!n.paused)try{for(var a=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(o.children),s=a.next();!s.done;s=a.next()){var u=s.value;u instanceof Cs&&u.update(e)}}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}})),o.addChild(u,c,l,h,d),o}return Is(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Ps("design:paramtypes",[Uo,Ia,Fo,a])],e)}(ie),Ms=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ds=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ks=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},js=function(t){function e(e,n){void 0===n&&(n=!1);var r=t.call(this,e)||this;return r.anim=new $o,r.anim.targetPropMapper=ta(r),r.anim.animations.set("scalex",{keyframes:[{time:0,value:n?-1:1,type:"bezier",ctrl:[1,0,1,1]},{time:.25,value:n?-.4:.4,type:"static"}],totaltime:.25}),r.anim.animations.set("scaley",{keyframes:[{time:0,value:1,type:"bezier",ctrl:[1,0,1,1]},{time:.25,value:.4,type:"static"}],totaltime:.25}),r.anim.animations.set("alpha",{keyframes:[{time:0,value:.8,type:"bezier",ctrl:[.42,0,1,1]},{time:.25,value:0,type:"static"}],totaltime:.25}),r.anim.onEnd.add((function(){r.visible=!1})),r}return Ms(e,t),e.prototype.setAnim=function(){this.visible=!0,this.anim.currentTime=0},e.prototype.update=function(t){this.visible&&this.anim.update(t)},e}(Ii),Ns=function(t){function e(e,n,r,i){var o=t.call(this)||this;if(!i.laneEffect)return o;var a=[.166,.23,.36,.5],s=[0,1,2,3,4,5,6].map((function(t){var n=3-Math.abs(t-3),r=new js(e.game.textures["bg_line"+n],t>3);return r.y=612,r.x=Oo[t],r.visible=!1,r.anchor.set(a[n],1),r}));return o.addChild.apply(o,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ks(arguments[e]));return t}(s)),r.Update.add((function(t,e){var r,i;if(n.ended)return t();if(!n.paused)try{for(var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(s),a=o.next();!a.done;a=o.next())a.value.update(e)}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}})),n.onJudge.add((function(t,e){"miss"!==e.judge&&s[e.lane].setAnim()})),n.onEmptyTap.add((function(t,e){s[e].setAnim()})),o}return Ms(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Ds("design:paramtypes",[Uo,Ia,Fo,a])],e)}(ie),Ls=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Bs=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Fs=function(t){function e(){var e=t.call(this)||this,n=new Fi("AUTOPLAY",{fontSize:52,fill:[16777215,8947848]});return n.blendMode=P.ADD,n.alpha=.3,n.anchor.x=.5,n.position.set(640,360),e.addChild(n),e}return Ls(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Bs("design:paramtypes",[])],e)}(ie),Us=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gs=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Hs=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},zs=function(t){function e(e,n,r){var i=t.call(this,1280,720)||this;return i.resize.apply(i,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Hs(arguments[e]));return t}(n.Resize.prevArgs)),n.Resize.add((function(t,e,n){if(!i.parent)return t();i.resize(e,n)})),i.addChild(e.resolve(Ea)),i.addChild(e.resolve(Ns)),i.addChild(e.resolve(ss)),i.addChild(e.resolve(Rs)),i.addChild(e.resolve(bs)),i.addChild(e.resolve(Ra)),r.autoplay&&i.addChild(e.resolve(Fs)),i}return Us(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Gs("design:paramtypes",[l.Container,Fo,a])],e)}(zo),Xs=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Vs=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ys=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},Ws=function(t){function e(e,n){var r=t.call(this,1280,720)||this;r.visible=!!n.debug,r.alpha=.2,r.resize.apply(r,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Ys(arguments[e]));return t}(e.Resize.prevArgs)),e.Resize.add((function(t,e,n){if(!r.parent)return t();r.resize(e,n)}));var i=new Oi;i.lineStyle(2,16746496),i.moveTo(0,0).lineTo(0,720).lineTo(1280,720).lineTo(1280,0).lineTo(0,0),r.addChild(i);var o=new Oi;o.lineStyle(4,35071),o.moveTo(0,612).lineTo(1280,612),o.lineStyle(2,35071),o.moveTo(0,25.85).lineTo(1280,25.85),r.addChild(o);var a=new Oi;a.lineStyle(2,17442),Oo.forEach((function(t){a.moveTo(640,-5).lineTo(t,612)})),r.addChild(a);var s=new Oi;s.lineStyle(2,43588);var u=Oo.map((function(t){return t-76.8}));return u.push(u[u.length-1]+153.6),u.forEach((function(t){s.moveTo(640,-5).lineTo(t,612)})),r.addChild(s),r}return Xs(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Vs("design:paramtypes",[Fo,a])],e)}(zo),qs=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Js=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ks=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Zs=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},Qs=function(){},$s={single:function(){return So},flick:function(){return So},slidestart:function(t){return t.parent.long?So:Po},slideamong:function(t){return t.parent.pointerId?Ro:Po},slideend:function(t){return t.parent.pointerId?t.parent.long?Io:Po:So},flickend:function(t){return t.parent.pointerId?Co:So}};function tu(t){return $s[t.type](t)}function eu(t){var e=t.parent.nextJudgeIndex||0;return t.parent.notes[e]===t}var nu=function(t){function e(e,n){var r=t.call(this)||this,i=e.map.notes,o=[],a=new Map,s=new Map,u=0,c=0,l=function(){var t,r,h,d,f,p,m,y,g,v;if(!e.ended&&(requestAnimationFrame(l),!e.paused)){for(var _=e.GetMusicTime()+n.judgeOffset/1e3,b=u;b<i.length&&i[b].time<=_+.3;)i[b].judge||o.push(i[b]),b++;u=b;var x=new Set;try{for(var w=Ks(o),E=w.next();!E.done;E=w.next())_-(B=E.value).time>=.1&&"miss"===(A=tu(B)(_-B.time))&&(B.judge=A,"slidestart"===B.type?B.parent.nextJudgeIndex=1:"single"!==B.type&&"flick"!==B.type?(B.parent.nextJudgeIndex++,"slideamong"!==B.type&&(a.delete(B.parent.pointerId),s.delete(B.parent.pointerId),B.parent.pointerId=void 0)):"flick"===B.type&&(s.delete(B.pointerId),B.pointerId=void 0),e.onJudge.emit(B),x.add(B))}catch(e){t={error:e}}finally{try{E&&!E.done&&(r=w.return)&&r.call(w)}finally{if(t)throw t.error}}x.size>0&&(o=o.filter((function(t){return!x.has(t)})),x.clear());try{for(var T=Ks(o),O=T.next();!O.done;O=T.next()){var A;if("slideamong"===(D=O.value).type&&D.parent.pointerId&&eu(D)&&"perfect"===(A=tu(D)(_-D.time))){var S=D.parent,I=a.get(S.pointerId);I&&Math.abs(go(I.track,-1).lane-D.lane)<=1&&(D.judge=A,S.nextJudgeIndex++,e.onJudge.emit(D),x.add(D))}}}catch(t){h={error:t}}finally{try{O&&!O.done&&(d=T.return)&&d.call(T)}finally{if(h)throw h.error}}x.size>0&&(o=o.filter((function(t){return!x.has(t)})),x.clear());try{for(var P=Ks(s),C=P.next();!C.done;C=P.next())_-("flick"===(B=Zs(C.value,2)[1]).note.type?B.start.time:B.note.time)>.1&&(B.note.judge="miss","flickend"===B.note.type&&(a.delete(B.note.parent.pointerId),B.note.parent.pointerId=void 0,B.note.parent.nextJudgeIndex++),s.delete(B.start.pointerId),e.onJudge.emit(B.note),x.add(B.note))}catch(t){f={error:t}}finally{try{C&&!C.done&&(p=P.return)&&p.call(P)}finally{if(f)throw f.error}}x.size>0&&(o=o.filter((function(t){return!x.has(t)})),x.clear());try{for(var R=Ks(o),M=R.next();!M.done;M=R.next()){var D;if("flickend"===(D=M.value).type&&!D.parent.long&&D.parent.pointerId){var k=tu(D);if("perfect"===k(_-D.time)&&void 0===k(c-D.time)){var j=go(vo(a.get(D.parent.pointerId)).track,-1);Math.abs(j.lane-D.lane)<=1&&s.set(D.parent.pointerId,{note:D,start:j})}}}}catch(t){m={error:t}}finally{try{M&&!M.done&&(y=R.return)&&y.call(R)}finally{if(m)throw m.error}}try{for(var N=Ks(o),L=N.next();!L.done;L=N.next()){var B;if("parent"in(B=L.value)&&"slidestart"!==B.type){var F=(B.parent.nextJudgeIndex||0)+1;if(B.parent.notes[F]===B&&_>=B.time&&c<B.time){var U=B.parent.notes[F-1];if(U.judge)continue;U.judge="miss",B.parent.nextJudgeIndex=F,e.onJudge.emit(U),x.add(U)}}}}catch(t){g={error:t}}finally{try{L&&!L.done&&(v=N.return)&&v.call(N)}finally{if(g)throw g.error}}x.size>0&&(o=o.filter((function(t){return!x.has(t)})),x.clear()),c=_}};return requestAnimationFrame(l),e.onPointer.add((function(t,r){if(e.ended)return t();if(!e.paused){var i=e.GetMusicTime()+n.judgeOffset/1e3;r.time=i;var u,c,l,h,d=new Set,f=!1;switch(r.type){case"down":if(r.lane<0)break;var p=o.filter((function(t){return!(Math.abs(t.lane-r.lane)>1)&&!("parent"in t&&!eu(t))&&("flick"!==t.type||!t.pointerId)&&("slideamong"!==t.type&&"slideend"!==t.type&&"flickend"!==t.type||!t.parent.pointerId)}));if(p.length<=0)break;void 0!==(_=tu(g=(p=p.sort((function(t,e){return Math.abs(t.time-i)-Math.abs(e.time-i)||Math.abs(t.lane-r.lane)-Math.abs(e.lane-r.lane)})))[0])(i-g.time))&&(f=!0,"flick"!==g.type&&"flickend"!==g.type?(g.judge=_,"slidestart"===g.type||"slideamong"===g.type?(g.parent.pointerId=r.pointerId,g.parent.nextJudgeIndex||(g.parent.nextJudgeIndex=0),g.parent.nextJudgeIndex++,a.set(r.pointerId,{track:[r],slide:g.parent}),"slidestart"===g.type&&g.parent.long&&g.parent.flickend&&s.set(r.pointerId,{note:g.parent.notes[1],start:r})):"slideend"===g.type&&(g.parent.nextJudgeIndex++,g.parent.pointerId=void 0),e.onJudge.emit(g),d.add(g)):(s.set(r.pointerId,{note:g,start:r}),"flick"===g.type&&(g.pointerId=r.pointerId)));break;case"up":var m=s.get(r.pointerId),y=a.get(r.pointerId);if(m)m.note.judge="miss","flickend"===m.note.type&&(m.note.parent.pointerId=void 0,m.note.parent.nextJudgeIndex++),d.add(m.note),e.onJudge.emit(m.note);else if(y){var g;(g=y.slide.notes[y.slide.nextJudgeIndex])&&(g.parent.pointerId=void 0,g.parent.nextJudgeIndex++,"slideamong"===g.type||"flickend"===g.type?g.judge="miss":"slideend"===g.type&&((void 0===(_=tu(g)(i-g.time))||Math.abs(r.lane-g.lane)>1)&&(_="miss"),g.judge=_),d.add(g),e.onJudge.emit(g))}a.delete(r.pointerId),s.delete(r.pointerId);break;case"move":var v=a.get(r.pointerId);if(v&&v.track.push(r),(m=s.get(r.pointerId))&&(u=m.start,c=r,(l=u.x-c.x)*l+(h=u.y-c.y)*h>1600)){var _,b="flick"===m.note.type?m.start.time:i;void 0!==(_=tu(m.note)(b-m.note.time))&&("flickend"===m.note.type&&(m.note.parent.pointerId=void 0,m.note.parent.nextJudgeIndex++),m.note.judge=_,d.add(m.note),e.onJudge.emit(m.note),a.delete(r.pointerId),s.delete(r.pointerId))}}d.size>0&&(o=o.filter((function(t){return!d.has(t)})),d.clear()),"down"!==r.type||f||-1!==r.lane&&e.onEmptyTap.emit(r.lane)}})),r}return qs(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Js("design:paramtypes",[Ia,a])],e)}(Qs),ru=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),iu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ou=function(t){function e(e){var n=t.call(this)||this,r=0,i=e.map.notes,o=0,a=function(){if(!e.ended&&(requestAnimationFrame(a),!e.paused)){for(var t=e.GetMusicTime()+.05,n=r,s=function(){var r=i[n];r.judge="perfect","slidestart"===r.type?(r.parent.pointerId=1,r.parent.nextJudgeIndex=1):"slideamong"===r.type?r.parent.nextJudgeIndex++:"slideend"!==r.type&&"flickend"!==r.type||(r.parent.pointerId=0),setTimeout((function(){e.onJudge.emit(r);var t=e.GetMusicTime()-r.time;o=.9*o+.01*t}),t-r.time-o),n++};n<i.length&&i[n].time<t;)s();r=n}};return requestAnimationFrame(a),n}return ru(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),iu("design:paramtypes",[Ia])],e)}(Qs),au=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},su=function(){function t(t,e,n,r){var i,o=e.music.data;o.stop();var a=o.play();o.pause(a),o.seek(0,a);var s=Math.max(4-o.duration()+((null===(i=go(t.map.notes,-1))||void 0===i?void 0:i.time)||0),0);o.once("end",(function(){n.Update.add((function(e,n){return t.ended?e():t.paused?void 0:(s-=n)<0?(t.onEnd.emit(),e()):void 0}))}));var u=!1,c=Math.min(t.musicTime,-1),l=performance.now(),h=performance.now();t.GetMusicTime=function(){var t=o.seek(a);if(l===t){var e=(performance.now()-h)/1e3;e<.03&&(t+=e)}else l=t,h=performance.now();return t},n.Update.add((function(e,n){if(t.ended)return e();if(!t.paused){var i=0;if(u?i=o.seek(a):(i=c+=n,c>=0&&(u=!0,o.play(a),i=o.seek(a))),l===i){var s=(performance.now()-h)/1e3;s<.03&&(i+=s)}else l=i,h=performance.now();t.onMusicTimeUpdate.emit({musicTime:i,visualTime:i+r.visualOffset/1e3,judgeTime:i+r.judgeOffset/1e3})}})),n.WindowBlur.add((function(){t.paused||t.onPause.emit()})),t.onPause.add((function(){o.pause(a)})),t.onContinue.add((function(){o.play(a)})),t.onMusicTimeUpdate.add((function(e,n){t.onMusicTimeUpdate.prevArgs&&t.onMusicTimeUpdate.prevArgs[0]===n&&console.warn("no use music time update:",n)})),n.End.add((function(){o.stop(),o.unload()}))}return function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),au("design:paramtypes",[Ia,Uo,Fo,a])],t)}(),uu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cu=function(){function t(t,e,n,r){this.state=e;var i={perfect:t.perfect.data,great:t.great.data,good:t.good.data,flick:t.flick.data,long:t.long.data,button:t.button.data},o=function(t){i[t].play()};for(var a in i)i[a].volume(n.effectVolume);e.onJudge.add((function(t,n){if(e.ended)return t();"miss"===n.judge?"single"!==n.type&&n.type:"bad"!==n.judge&&("flick"===n.type||"flickend"===n.type?o("flick"):o(n.judge))})),e.onEmptyTap.add((function(t){if(e.ended)return t();o("button")})),r.End.add((function(){for(var t in i)i[t].unload()}))}return function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),uu("design:paramtypes",[Uo,Ia,a,Fo])],t)}(),lu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),hu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},du=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},fu=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},pu=function(t){function e(e,n,r,i){var o,a,s=t.call(this)||this,u=new Ii(He.WHITE);u.tint=0,u.alpha=.5;var c=new zo(1280,720);u.width=i.Resize.prevArgs[0],u.height=i.Resize.prevArgs[1],c.resize.apply(c,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(du(arguments[e]));return t}(i.Resize.prevArgs)),i.Resize.add((function(t,e,n){if(!s.parent)return t();u.width=e,u.height=n,c.resize(e,n)})),u.interactive=!0,u.on("pointertap",(function(t){return t.stopPropagation()})),s.addChild(u),s.addChild(c);var l=r.ui.data.info.pause,h=r.ui.textures;if(l.other instanceof Array)try{for(var d=fu(l.other),f=d.next();!f.done;f=d.next()){var p=f.value;s.addChild(new ma(p,h))}}catch(t){o={error:t}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}var m=new ma(l.continue,h),y=new ma(l.restart,h),g=new ma(l.back,h);return m.interactive=!0,m.on("pointertap",(function(){e.onContinue.emit()})),y.interactive=!0,y.on("pointertap",(function(){e.onRestart.emit()})),g.interactive=!0,g.on("pointertap",(function(){e.onAbort.emit()})),c.addChild(m,y,g),i.Update.add((function(t,e){var n,r;if(!s.parent)return t();try{for(var i=fu(s.children),o=i.next();!o.done;o=i.next()){var a=o.value;a instanceof ma&&a.update(e)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}})),s}return lu(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),hu("design:paramtypes",[Ia,a,Uo,Fo])],e)}(ie),mu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),yu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},gu=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},vu=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},_u=function(t){function e(e,n,r,i,o,a){var s,u,c=t.call(this,1280,720)||this;c.onRetry=function(){},c.onBack=function(){},c.resize.apply(c,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(gu(arguments[e]));return t}(n.Resize.prevArgs)),n.Resize.add((function(t,e,n){if(!c.parent)return t();c.resize(e,n)}));var l=r.ui.data.info.score,h=r.ui.textures;if(l.other instanceof Array)try{for(var d=vu(l.other),f=d.next();!f.done;f=d.next()){var p=f.value;c.addChild(new ma(p,h))}}catch(t){s={error:t}}finally{try{f&&!f.done&&(u=d.return)&&u.call(d)}finally{if(s)throw s.error}}if(["perfect","great","good","bad","miss","score","combo"].forEach((function(t){var n=new ys(l[t],h);"combo"===t?n.setValue(e.maxCombo):n.setValue(e[t]),c.addChild(n)})),e.maxCombo===e.map.combo&&c.addChild(new ma(l.fullcombo,h)),l.name){var m=new Fi(i.songName,l.name.style);da(m,l.name.position),c.addChild(m)}var y=new ma(l.retry,h),g=new ma(l.back,h);return y.interactive=!0,g.interactive=!0,y.once("pointertap",(function(){c.onRetry()})),g.once("pointertap",(function(){c.onBack()})),c.addChild(y,g),n.Update.add((function(t,e){var n,r;if(!c.parent)return t();try{for(var i=vu(c.children),o=i.next();!o.done;o=i.next()){var a=o.value;(a instanceof ma||a instanceof ys)&&a.update(e)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}})),a.autoplay&&c.addChild(o.resolve(Fs)),c}return mu(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),yu("design:paramtypes",[Ia,Fo,Uo,s,l.Container,a])],e)}(zo),bu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},xu=function(){function t(t,e){this.stage=t,this.events=e}return t.prototype.switch=function(t,e,n,r,i){var o=this;void 0===n&&(n=.6),void 0===r&&(r=.6),void 0===i&&(i=0);var a=new $o(ta(t)),s=new $o(ta(e));e.alpha=0,a.animations.set("alpha",na(1,0,n,ea)),s.animations.set("alpha",na(0,1,r,ea)),this.events.Update.add((function(t,e){if(a.ended)return t();a.update(e),a.currentTime>i&&s.update(e)}));var u=this.stage.getChildIndex(t);return this.stage.addChildAt(e,u),a.onEnd.add((function(){o.stage.removeChild(t)})),{inEnd:s.onEnd,outEnd:a.onEnd}},function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),bu("design:paramtypes",[Bo,Fo])],t)}(),wu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Eu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Tu=function(t){function e(e,n,r){var i=t.call(this)||this,o=e.resolve(_u);return o.onBack=function(){n.End.emit()},o.onRetry=function(){var t=e.resolve(Cu);r.switch(i,t).outEnd.add((function(t){return i.destroy({children:!0}),t()}))},i.addChild(o),i}return wu(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Eu("design:paramtypes",[l.Container,Fo,xu])],e)}(ie),Ou=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Au=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Su=function(t){function e(e,n,r,i,o){var a=t.call(this)||this;e.isBound(Go)&&e.unbind(Go),e.bind(Go).toConstantValue(e.resolve(Go)),e.isBound(Ia)&&e.unbind(Ia);var s,u=e.resolve(Ia);return e.bind(Ia).toConstantValue(u),n.autoplay?e.resolve(ou):e.resolve(nu),e.resolve(su),e.resolve(cu),a.addChild(e.resolve(zs)),n.debug&&a.addChild(e.resolve(Ws)),u.onPause.add((function(){s=e.resolve(pu),a.addChild(s)})),u.onContinue.add((function(){a.removeChild(s)})),u.onEnd.add((function(){var t=e.resolve(Tu);o.switch(a,t).outEnd.add((function(){return a.destroy({children:!0}),"remove"}))})),u.onRestart.add((function(){var t=e.resolve(Cu);o.switch(a,t).outEnd.add((function(){return a.destroy({children:!0}),"remove"}))})),u.onAbort.add((function(){i.End.emit()})),a}return Ou(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Au("design:paramtypes",[l.Container,a,Bo,Fo,xu])],e)}(ie),Iu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Pu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Cu=function(t){function e(e,n,r,i){var o=t.call(this)||this,a=e.resolve(ba);return a.start=function(t){i.autoplay=!!t;var r=e.resolve(Su);n.switch(o,r).outEnd.add((function(){return o.destroy({children:!0}),"remove"}))},o.addChild(a),o}return Iu(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Pu("design:paramtypes",[l.Container,xu,Fo,a])],e)}(ie),Ru=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Mu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};function Du(t,e){if(t.loadType===$r.LOAD_TYPE.AUDIO)var n=new h.Howl({src:t.url,format:/\..{1,5}$/.test(t.url)?void 0:"mp3",onload:function(){t.data=n,t.complete(),e()},onloaderror:function(n,r){t.error=r,t.abort("load error"),e()}});else e()}var ku={load:function(){return null},url:"object:///rawmap"};function ju(t,e){if(t.url===ku.url){var n=ku.load();n?n instanceof Promise?n.then((function(n){t.data=n,t.complete(),e()})).catch((function(n){t.error=n,t.abort("Load error"),e()})):(t.data=n,t.complete(),e()):(t.error=new Error("Load error"),t.abort("Load error"),e())}else e()}var Nu=function(t){function e(e,n){var r=t.call(this)||this;r.ioc=e,r.loadedcount=0,r.progress=function(t){r.loadedcount++;var e=0;for(var n in t.resources)e++;r.layer.progress.set(r.loadedcount===e?1:r.loadedcount/(e+3))},r.loaded=function(t,e){r.ioc.bind(Uo).toConstantValue(e),r.ioc.get(Bo).addChildAt(r.ioc.resolve(ha),0);var n=r.ioc.resolve(Cu);r.ioc.get(xu).switch(r,n).outEnd.add((function(){return r.destroy({children:!0}),"remove"}))},r.alertedError=!1,r.error=function(t,e,n){console.error("load ",n," error:",t),r.alertedError||(alert("load "+n.url+" error: "+t),r.alertedError=!0)};var i=new Zr;for(var o in i.pre(Du),i.pre(ju),ku.load=n.mapContent,i.add("music",n.musicSrc,{loadType:$r.LOAD_TYPE.AUDIO}),n.backgroundSrc&&i.add("background",n.backgroundSrc,{loadType:$r.LOAD_TYPE.IMAGE}),i.add("map",ku.url,{loadType:$r.LOAD_TYPE.XHR}),u)i.add(o,n.skin+"/"+u[o]);for(var o in c)i.add(o,n.skin+"/"+c[o]);return i.on("progress",r.progress),i.on("error",r.error),i.load(r.loaded),r.layer=e.resolve(ua),r.addChild(r.layer),r}return Ru(e,t),function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([Object(l.injectable)(),Mu("design:paramtypes",[l.Container,s])],e)}(ie),Lu=function(){function t(t,e,n){var r=this;this.stage=new Bo,this.ticker=new o,this.ioc=new l.Container({skipBaseClassChecks:!0}),this.events=new Fo,this._destroyed=!1,this.renderer=dr({view:t,width:t.clientWidth,height:t.clientHeight,resolution:e.resolution}),this.ioc.bind(l.Container).toConstantValue(this.ioc),this.ioc.bind(Bo).toConstantValue(this.stage),this.ioc.bind(Fo).toConstantValue(this.events),e instanceof a?this.ioc.bind(a).toConstantValue(e):this.ioc.bind(a).toConstantValue(Object.assign(new a,e)),n instanceof s?this.ioc.bind(s).toConstantValue(n):this.ioc.bind(s).toConstantValue(Object.assign(new s,n)),this.ioc.bind(xu).toSelf().inSingletonScope(),this.ticker.Tick.add((function(t,e){r.resize(),r.events.Update.emit(t,e),r.renderer.render(r.stage)})),this.resize(),this.stage.addChild(this.ioc.resolve(Nu)),qo(window,"blur",(function(){if(r._destroyed)return"remove";r.events.WindowBlur.emit(),r.ticker.Stop()})),qo(window,"focus",(function(){if(r._destroyed)return"remove";r.ticker.Start(),r.events.WindowFocus.emit()})),this.events.End.add((function(){if(r._destroyed)return"remove";r.destroy()}))}return t.prototype.start=function(){this.ticker.Start()},t.prototype.pause=function(){this.ticker.Stop()},t.prototype.destroy=function(){if(!this._destroyed){for(var t in this._destroyed=!0,this.ticker.Stop(),this.ticker.Tick.clear(),this.events.End.emit(),this.events)this.events[t].clear();this.ioc.unbindAll(),this.stage.destroy(),this.renderer.clear(),this.renderer.destroy(),r.clearTextureCache(),this.ondestroyed instanceof Function&&this.ondestroyed()}},t.prototype.resize=function(){var t=window.innerHeight,e=window.innerWidth,n=this.renderer.screen;t===n.height&&e===n.width&&this.events.Resize.prevArgs||(this.renderer.resize(e,t),this.events.Resize.emit(e,t))},t}();n.d(e,"Game",(function(){return Lu})),n.d(e,"GameConfig",(function(){return a})),n.d(e,"GameLoadConfig",(function(){return s}))}])},159:function(t,e,n){t.exports=n(197)},164:function(t,e,n){},197:function(t,e,n){"use strict";n.r(e);var r=n(0),i=n.n(r),o=n(18),a=n.n(o),s=(n(164),n(85)),u=n(14),c=n(117),l=n(118);const h=new Set;s.a.use(l.a).use(c.a).use(u.a).init({fallbackLng:"en",debug:!1,nsSeparator:"::",interpolation:{escapeValue:!1},backend:{loadPath:"/locales/{{lng}}.json"},react:{useSuspense:!1},saveMissing:!0,missingKeyHandler:function(t,e,n){h.add(n)}});const d=window;d.i18n=s.a,d.missingKeys=h;var f=s.a,p=n(268),m=n(267),y=n(240),g=n(239),v=n(238),_=n(72),b=n.n(_),x=n(15),w=n(10);n(64);class E extends Error{}function T(t="Ran into never happen"){throw new E(t)}function O(t){return null!==t&&void 0!==t||T("Assertion for not null or undefined fail"),t}function A(){return 2147483648*Math.random()|0}function S(t){return t&&"object"===typeof t}const I=function(t,e){const n={};let r=!1;for(const i in e)void 0!==e[i]?t[i]!==e[i]&&(n[i]=t[i],t[i]=e[i],r=!0):delete t[i];if(r)return n},P=function t(e,n){if(!S(e)&&!S(n))return;const r={};let i=!1;for(const o in n)if(void 0!==n[o])if(S(n[o])&&S(e[o])){const a=t(e[o],n[o]);a&&(r[o]=a,i=!0)}else e[o]!==n[o]&&(r[o]=e[o],e[o]=n[o],i=!0);else delete e[o];return i?r:void 0};function C(t){const e=[];for(const n of t.entries())e.push(n);return e}function R(t){const e=[];for(const n of t.entries())e.push(n[0]);return e}function M(t){if(t<0)return"-"+M(-t);let e=1e3*t+.5|0,n=e/6e4|0;e=e%6e4|0,n=n+100|0;let r=e/1e3|0;return e=e%1e3|0,r=r+100|0,e=e+1e3|0,n.toString().substr(1)+":"+r.toString().substr(1)+"."+e.toString().substr(1)}function D(t){let e,n=!1;return function(){return n||(n=!0,e=t()),e}}function k(t,e,n){void 0===n&&(n=1),void 0===e&&(e=t,t=0);const r=[];for(;(e-t)*n>0;)r.push(t),t+=n;return r}function j(t){return new Promise((e,n)=>{const r=document.createElement("input");r.type="file",r.accept=t,r.onchange=t=>{let i;if(r.files&&(i=r.files.item(0))){const t=new FileReader;t.onload=n=>e(t.result),t.onerror=t=>n(t),t.readAsText(i)}else n()},r.oncancel=t=>n(),r.click()})}class N{constructor(t){this.timepoints=void 0,this.slides=void 0,this.notes=void 0,this.timepoints=t.timepoints,this.slides=t.slides,this.notes=t.notes}static create(){return new N({timepoints:new Map,slides:new Map,notes:new Map})}static toJsonString(t){const{timepoints:e,slides:n,notes:r}=t,i={timepoints:C(e).map(t=>({...t[1]})),slides:C(n).map(t=>({...t[1]})),notes:C(r).map(t=>({...t[1]}))};return i.timepoints.forEach(t=>delete t.ticktimecache),i.notes.forEach(t=>delete t.realtimecache),JSON.stringify(i)}static fromJson(t){const{timepoints:e,slides:n,notes:r}=JSON.parse(t),i={timepoints:new Map(e.map(t=>[t.id,t])),slides:new Map(n.map(t=>[t.id,t])),notes:new Map(r.map(t=>[t.id,t]))};return n.some(t=>t.notes.some(t=>!i.notes.has(t)))&&T(),r.some(t=>"slide"===t.type&&!i.slides.has(t.slide))&&T(),r.some(t=>!i.timepoints.has(t.timepoint))&&T(),e.forEach(t=>L(t)),r.forEach(t=>B(i,t)),new N(i)}}function L(t){t.ticktimecache=60/t.bpm/48}function B(t,e){const n=O(t.timepoints.get(e.timepoint));e.realtimecache=n.time+n.ticktimecache*e.offset}function F(t,e){let n=!1;const r=e.notes.sort((e,r)=>{const i=O(t.notes.get(e)).realtimecache-O(t.notes.get(r)).realtimecache;return 0===i&&(n=!0),i});return e.notes=r,n}const U=(t,e,n,r,i,o)=>{const a={type:n,id:e,timepoint:r,offset:i,lane:o,realtimecache:0};return t.notes.set(a.id,a),B(t,a),a},G=(t,e)=>{const n=O(t.notes.get(e));return"single"!==n.type&&"flick"!==n.type&&T(),t.notes.delete(e),n},H=(t,e,n)=>{const r=O(t.notes.get(e));"single"!==r.type&&"flick"!==r.type&&T();const i=I(r,n);if(i)return B(t,r),i},z={Add:(t,e,n,r,i,o)=>{const a=U(t,e,n,r,i,o);if(a)return t=>G(t,a.id)},Remove:(t,e)=>{const n=G(t,e);if(n)return t=>U(t,n.id,n.type,n.timepoint,n.offset,n.lane)},Set:(t,e,n)=>{const r=H(t,e,n);if(r)return t=>H(t,e,r)}},X=(t,e,n)=>{const r={id:e,flickend:n,notes:[]};return t.slides.set(e,r),r},V=(t,e)=>{const n=O(t.slides.get(e));return n.notes.length>0&&T(),t.slides.delete(e),n},Y=(t,e,n)=>{const r=O(t.slides.get(e)),i=I(r,n);if(i)return i},W={Add:(t,e,n)=>{const r=X(t,e,n);if(r)return t=>V(t,r.id)},Remove:(t,e)=>{const n=V(t,e);if(n)return t=>X(t,n.id,n.flickend)},Set:(t,e,n)=>{const r=Y(t,e,n);if(r)return t=>Y(t,e,r)}},q=(t,e,n,r,i,o)=>{const a={type:"slide",id:e,slide:n,timepoint:r,offset:i,lane:o,realtimecache:0},s=O(t.slides.get(n));return s.notes.push(e),t.notes.set(e,a),B(t,a),F(t,s),a},J=(t,e)=>{const n=O(t.notes.get(e));"slide"!==n.type&&T();const r=O(t.slides.get(n.slide));return r.notes=r.notes.filter(t=>t!==n.id),t.notes.delete(e),F(t,r),n},K=(t,e,n)=>{const r=O(t.notes.get(e));"slide"!==r.type&&T();const i=I(r,n);if(i){B(t,r);const e=O(t.slides.get(r.slide));return F(t,e),i}},Z={Add:(t,e,n,r,i,o)=>{const a=q(t,e,n,r,i,o);if(a)return t=>J(t,a.id)},Remove:(t,e)=>{const n=J(t,e);if(n)return t=>q(t,n.id,n.slide,n.timepoint,n.offset,n.lane)},Set:(t,e,n)=>{const r=K(t,e,n);if(r)return t=>K(t,e,r)}},Q=(t,e,n,r,i)=>{const o={id:e,time:n,bpm:r,bpb:i,ticktimecache:0};return t.timepoints.set(o.id,o),L(o),o},$=(t,e)=>{const n=O(t.timepoints.get(e));return t.timepoints.delete(e),n},tt=(t,e,n)=>{const r=O(t.timepoints.get(e)),i=I(r,n);if(i)return L(r),i},et={Add:(t,e,n,r,i)=>{const o=Q(t,e,n,r,i);if(o)return t=>$(t,o.id)},Remove:(t,e)=>{const n=$(t,e);if(n)return t=>Q(t,n.id,n.time,n.bpm,n.bpb)},Set:(t,e,n)=>{const r=tt(t,e,n);if(r)return t=>tt(t,e,r)}};class nt{constructor(t){this.state=t,this.act_done=[],this.act_todo=[],this.act_undo=[]}get canRedo(){return this.act_todo.length>0}get canUndo(){return this.act_undo.length>0}callAtom(t,...e){const n=n=>t(n,...e),r=n(this.state);return!!r&&(this.act_todo.length=0,this.act_done.push(n),this.act_undo.push(r),!0)}undoAtom(){const t=this.act_undo.pop(),e=this.act_done.pop();if(!t||!e){if(!t&&!e)return!1;T("Undo list and done list length not equal")}return t(this.state),this.act_todo.push(e),!0}redoAtom(){const t=this.act_todo.pop();if(!t)return!1;const e=t(this.state);if(e)return this.act_done.push(t),this.act_undo.push(e),!0;T("Can not redo an action.")}doTransaction(t){const e=this.act_done.length;if(t())return this.act_done.length-e;for(;this.act_done.length>e;)this.undoAtom();return 0}doParallel(t){const e=this.act_done.length;return t(),this.act_done.length-e}}class rt extends class extends class{get canUndo(){return this.act_done.length>0}get canRedo(){return this.act_todo.length>0}constructor(t){this.state=t,this.history=void 0,this.act_done=[],this.act_todo=[],this.changeListeners=new Set,this.ResetState=t=>{this.state=t,this.history=new nt(t),this.act_done=[],this.act_todo=[],this.changed()},this.Undo=()=>{const t=this.act_done.pop();if(void 0!==t){this.act_todo.push(t);for(let e=0;e<t;e++)this.history.undoAtom();this.changed()}},this.Redo=()=>{const t=this.act_todo.pop();if(void 0!==t){this.act_done.push(t);for(let e=0;e<t;e++)this.history.redoAtom();this.changed()}},this.history=new nt(t)}changed(){for(const t of this.changeListeners)t()}done(t){return t>0&&(this.act_todo.length=0,this.act_done.push(t),this.changed(),!0)}}{constructor(t){super(t),this._timepoints=null,this._slides=null,this._notes=null,this.changeListeners.add(()=>{this._timepoints=null,this._slides=null,this._notes=null})}get timepoints(){return this.state.timepoints}get slides(){return this.state.slides}get notes(){return this.state.notes}get timepointlist(){return this._timepoints||(this._timepoints=C(this.state.timepoints).map(t=>t[1]).sort((t,e)=>t.time-e.time||t.id-e.id)),this._timepoints}get slidelist(){return this._slides||(this._slides=C(this.state.slides).map(t=>t[1])),this._slides}get notelist(){return this._notes||(this._notes=C(this.state.notes).map(t=>t[1])),this._notes}findTimepoint(t){const e=this.timepointlist;if(e.length<=0)return[void 0,-1];let n=0;for(;n<e.length&&t>=e[n].time;)n++;return n>0&&n--,[e[n],n]}calcNearestPosition(t,e){const n=48/e,[r,i]=this.findTimepoint(t);if(!r)return;const o=Math.round((t-r.time)/(r.ticktimecache*n))*n,a=r.time+r.ticktimecache*o,[s,u]=this.findTimepoint(a+r.ticktimecache);return s&&s.id!==r.id?{timepoint:s,offset:0,timepointIndex:u,realtime:s.time}:{timepoint:r,offset:o,timepointIndex:i,realtime:a}}patchNote(t,e){return"slide"===t.type?this.history.callAtom(Z.Set,t.id,e):this.history.callAtom(z.Set,t.id,e)}justifyFollowChanged(t,e){for(const n of t){B(this.state,n);const t=O(this.calcNearestPosition(n.realtimecache,e));t.timepoint.id===n.timepoint&&t.offset===n.offset||this.patchNote(n,{timepoint:t.timepoint.id,offset:t.offset})}}justifyFindNearest(t,e){for(const n of t){const t=O(this.calcNearestPosition(n.realtimecache,e));t.timepoint.id===n.timepoint&&t.offset===n.offset||this.patchNote(n,{timepoint:t.timepoint.id,offset:t.offset})}}deleteSlideNote(t){if(!this.state.notes.has(t.id))return!1;const e=O(this.state.slides.get(t.slide));if(e.notes.length>2)return this.history.callAtom(Z.Remove,t.id);{const t=e.notes[0],n=e.notes[1];return this.history.doTransaction(()=>this.history.callAtom(Z.Remove,t)&&this.history.callAtom(Z.Remove,n)&&this.history.callAtom(W.Remove,e.id))>0}}deleteOne(t){return!!this.notes.has(t.id)&&("slide"===t.type?this.deleteSlideNote(t):this.history.callAtom(z.Remove,t.id))}deleteMany(t){for(const e of t)this.deleteOne(e)}}{addTimepoint(t,e,n,r){return this.done(this.history.doParallel(()=>{this.history.callAtom(et.Add,A(),t,e,n)&&this.justifyFindNearest(this.notelist,r)}))}moveTimepoint(t,e,n,r,i,o){const a=O(this.state.timepoints.get(t)),s=void 0!==r&&a.time!==r||void 0!==i&&a.bpm!==i;return this.done(this.history.doParallel(()=>{this.history.callAtom(et.Set,t,{time:r,bpm:i,bpb:o})&&s&&(e?this.justifyFindNearest(this.notelist,n):this.justifyFollowChanged(this.notelist,n))}))}removeTimepoint(t,e){return this.state.timepoints.size>1?this.done(this.history.doParallel(()=>{this.history.callAtom(et.Remove,t)&&this.justifyFindNearest(this.notelist,e)})):this.done(this.history.doParallel(()=>{this.deleteMany(this.notelist),this.history.callAtom(et.Remove,t),(this.state.slides.size||this.state.notes.size||this.state.timepoints.size)&&T()}))}addSingle(t,e,n){return this.done(this.history.doTransaction(()=>this.history.callAtom(z.Add,A(),"single",t,e,n)))}toggleFlick(t){return this.done(this.history.doTransaction(()=>this.history.callAtom(z.Set,t.id,{type:"single"===t.type?"flick":"single"})))}addSlide(t,e,n,r,i,o){const a=A();return this.done(this.history.doTransaction(()=>this.history.callAtom(W.Add,a,!1)&&this.history.callAtom(Z.Add,A(),a,t,e,n)&&this.history.callAtom(Z.Add,A(),a,r,i,o)))}toggleFlickend(t){const e=O(this.state.slides.get(t));return this.done(this.history.doTransaction(()=>this.history.callAtom(W.Set,t,{flickend:!e.flickend})))}addSlideMid(t,e,n,r){return this.done(this.history.doTransaction(()=>this.history.callAtom(Z.Add,A(),t,e,n,r)))}moveMany(t,e,n,r,i,o){return this.done(this.history.doTransaction(()=>{for(const o of t){const a=o.realtimecache+e,s=o.lane+i;if(a>r||a<n||s<0||s>6){for(const e of t)B(this.state,e);return!1}this.patchNote(o,{lane:s}),o.realtimecache=a}return this.justifyFindNearest(t,o),!0}))}copyMany(t,e,n,r,i,o){return this.done(this.history.doTransaction(()=>{const a={},s={};for(const e of t)"slide"===e.type&&(s[e.slide]=s[e.slide]&&s[e.slide]+1||1);for(const t in s){const e=parseInt(t);if(s[e]>=2){const t=A();this.history.callAtom(W.Add,t,O(this.state.slides.get(e)).flickend),a[e]=t}}for(const u of t){const t=u.realtimecache+e,s=u.lane+i;if(t>r||t<n||s<0||s>6)return!1;const c=O(this.calcNearestPosition(t,o));if("slide"===u.type){const t=a[u.slide];if(!t)continue;if(!this.history.callAtom(Z.Add,A(),t,c.timepoint.id,c.offset,s))return!1}else{if(!this.history.callAtom(z.Add,A(),u.type,c.timepoint.id,c.offset,s))return!1}}return!0}))}removeNotes(t){return this.done(this.history.doParallel(()=>{this.deleteMany(t)}))}}var it=n(5);const ot={name:""},at={general:{song_volume:1,effect_volume:1,background_dim:.7},editor:{keep_pitch:!1,justify_find_nearest:!0,justify_grid_divisor:48,show_info_window:!0,warn_for_same_pos_notes:!0,autosave_interval:5},game:{judge_offset:0,visual_offset:0,speed:10,resolution:1.25,note_scale:1,bar_opaciry:.9,show_sim_line:!0,lane_effect:!0,mirror:!1,beat_note:!0}};var st,ut,ct,lt;const ht="editor:meta",dt="editor:mapcontent",ft="editor:settings";const pt=new(st=class{constructor(){this.map=void 0,Object(x.a)(this,"lastSave",ut,this),this.save=()=>{const t=N.toJsonString(this.map.state);localStorage.setItem(dt,t),this.lastSave=new Date},this.reset=t=>{this.map.ResetState(t||N.create())},Object(x.a)(this,"meta",ct,this),Object(x.a)(this,"settings",lt,this);const t=localStorage.getItem(dt);let e=null;if(t)try{e=N.fromJson(t)}catch(i){localStorage.removeItem(dt),console.error(i)}e||(e=N.create()),this.map=new rt(e);const n=localStorage.getItem(ht);this.meta=Object(it.f)(ot),n&&P(this.meta,JSON.parse(n)),Object(it.b)(()=>{const t=JSON.stringify(this.meta);localStorage.setItem(ht,t)});const r=localStorage.getItem(ft);this.settings=Object(it.f)(at),r&&P(this.settings,JSON.parse(r)),Object(it.b)(()=>{const t=JSON.stringify(this.settings);localStorage.setItem(ft,t)}),this.map.changeListeners.add(()=>{this.settings.editor.autosave_interval>0&&setTimeout(()=>{const t=(new Date).getTime(),e=60*this.settings.editor.autosave_interval*1e3;(!this.lastSave||t-this.lastSave.getTime()>e)&&this.save()},60*this.settings.editor.autosave_interval*1e3-1e3)})}},ut=Object(w.a)(st.prototype,"lastSave",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct=Object(w.a)(st.prototype,"meta",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lt=Object(w.a)(st.prototype,"settings",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st);window.AudioContext=window.AudioContext||window.webkitAudioContext;var mt=AudioContext&&new class{constructor(){this._ctx=void 0,this._output=void 0,this._ctx=new AudioContext,this._output=this._ctx.createGain(),this._output.connect(this._ctx.destination)}get ctx(){return this._ctx}get now(){return this._ctx.currentTime}get latency(){return this._ctx.baseLatency+this._ctx.outputLatency}get mastervolume(){return this._output.gain}get destination(){return this._output}};class yt{constructor(){this.listeners=new Set,this.add=t=>(this.listeners.add(t),()=>this.listeners.delete(t)),this.dispatch=(...t)=>{const e=[];for(const n of this.listeners)e.push(n);e.forEach(e=>e(()=>this.listeners.delete(e),...t))},this.dispose=()=>this.listeners.clear()}}class gt{constructor(){this.gain=void 0,this.buffer=void 0,this.onload=new yt,this.onloaderr=new yt,this.load=()=>this,this.gain=mt.ctx.createGain(),this.gain.connect(mt.destination)}get destination(){return this.gain}get volume(){return Math.sqrt(this.gain.gain.value)}set volume(t){this.gain.gain.value=t*t}get loaded(){return!!this.buffer}get duration(){return this.buffer?this.buffer.duration:0}static from(t){const e=new gt,n=t=>e.onloaderr.dispatch(t),r=t=>{if(t instanceof Blob){const e=new FileReader;e.onabort=n,e.onerror=n,e.onload=t=>{e.result instanceof ArrayBuffer?r(e.result):n(t)},e.readAsArrayBuffer(t)}else mt.ctx.decodeAudioData(t,t=>{e.buffer=t,e.onload.dispatch()},n)};return e.load=()=>{const i=t instanceof Function?t():t;return i instanceof Promise?i.then(r).catch(n):r(i),e},e}}class vt{constructor(t){this.source=void 0,this.gain=void 0,this.node=void 0,this._playing=!1,this._starttime=0,this._startpos=0,this._playbackrate=1,this.onplay=new yt,this.onpause=new yt,this.onseek=new yt,this.onend=new yt,this.callstart=t=>{const e=mt.now+t;this.node.start(e,this._startpos);const n=this._startpos/this._playbackrate;this._starttime=e-n,this._playing=!0},this.handleNormalEnd=()=>{this._startpos=0,this._playing=!1,this.node=this.createnode(),this.onend.dispatch()},this.handlePauseEnd=()=>{this._startpos=this.position,this._playing=!1,this.node=this.createnode(),this.onpause.dispatch()},this.handleSeekEnd=()=>{this.node=this.createnode(),this.node.onended=this.handleNormalEnd,this.callstart(0),this.onseek.dispatch()},this.source=t,this.gain=mt.ctx.createGain(),this.gain.connect(t.destination),this.node=this.createnode()}get volume(){return Math.sqrt(this.gain.gain.value)}set volume(t){this.gain.gain.value=t*t}createnode(){const t=mt.ctx.createBufferSource();return t.buffer=this.source.buffer,t.connect(this.gain),t.playbackRate.value=this._playbackrate,t}get position(){if(!this._playing)return this._startpos;return(mt.now-this._starttime)*this._playbackrate}play(t=0){this._playing||(this.callstart(t),this.node.onended=this.handleNormalEnd,this.onplay.dispatch())}stop(t=0){this._playing?(this.node.onended=this.handleNormalEnd,this.node.stop(mt.now+t)):this._startpos=0}pause(t=0){this._playing&&(this.node.onended=this.handlePauseEnd,this.node.stop(mt.now+t))}seek(t){if(t=Math.max(0,Math.min(this.source.duration,t)),!this._playing)return this._startpos=t,void this.onseek.dispatch();this._startpos=t;const e=this._startpos/this._playbackrate;this._starttime=mt.now-e,this.node.onended=this.handleSeekEnd,this.node.stop(mt.now)}get rate(){return this._playbackrate}setRate(t){t=Math.max(.25,Math.min(4,t));const e=this.position;if(this._playbackrate=t,this.node.playbackRate.value=this._playbackrate,this._playing){const n=mt.now,r=e/t;this._starttime=n-r}}}class _t{constructor(t){this._loaded=!1,this.onload=new yt,this.onloaderr=new yt,this.source=void 0,this.el=void 0,this.onplay=new yt,this.onpause=new yt,this.onseek=new yt,this.onend=new yt,this.source=t,this.el=document.createElement("audio"),this.el.oncanplaythrough=t=>{this.el.oncanplaythrough=null,this._loaded=!0,this.onload.dispatch()},this.el.onerror=t=>this.onloaderr.dispatch(t),this.el.preservesPitch=!0,this.el.onended=t=>{this.onend.dispatch(),this.el.currentTime=0},this.el.src=URL.createObjectURL(t),this.el.load()}get loaded(){return this._loaded}get duration(){return this.el.duration}get volume(){return this.el.volume}set volume(t){this.el.volume=t}get position(){return this.el.currentTime}play(t=0){this.el.play(),this.onplay.dispatch()}stop(t=0){this.el.pause(),this.el.currentTime=0,this.onend.dispatch()}pause(t=0){this.el.pause(),this.onpause.dispatch()}seek(t){this.el.currentTime=t,this.onseek.dispatch()}get rate(){return this.el.playbackRate}setRate(t){t=Math.max(.25,Math.min(4,t)),this.el.playbackRate=t}}var bt,xt,wt,Et,Tt,Ot,At,St;async function It(t){const e=await fetch(t);return await e.arrayBuffer()}function Pt(){const[t,e]=Object(r.useState)(1);return Object(r.useEffect)(()=>{const t=()=>e(t=>t+1);return pt.map.changeListeners.add(t),()=>{pt.map.changeListeners.delete(t)}},[]),t}const Ct=new(bt=class{constructor(){Object(x.a)(this,"src",xt,this)}},xt=Object(w.a)(bt.prototype,"src",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),bt);const Rt=new(wt=class{constructor(){Object(x.a)(this,"audio",Et,this),Object(x.a)(this,"duration",Tt,this),Object(x.a)(this,"playing",Ot,this),Object(x.a)(this,"playbackrate",At,this),Object(x.a)(this,"seekcounter",St,this),this.musicfile=null,this.load=(t,e,n)=>{const r=this;if(null!==r.audio&&r.audio.stop(),r.audio=null,r.duration=5,r.playing=!1,r.seekcounter=1,r.musicfile=null,pt.settings.editor.keep_pitch){const i=new _t(t);return i.onload.add(()=>{this.musicfile=t,r.duration=i.duration,i.setRate(this.playbackrate),n(),this.audio=i,this.audio.onend.add(()=>{this.playing=!1})}),void i.onloaderr.add(t=>{console.error(t),e()})}const i=gt.from(t);i.onload.add(()=>{this.musicfile=t,r.duration=i.duration,n(),this.audio=new vt(i),this.audio.setRate(this.playbackrate),this.audio.onend.add(()=>{this.playing=!1})}),i.onloaderr.add(t=>{console.error(t),e()}),i.load()},this.position=()=>this.audio&&this.seekcounter?this.audio.position:1,this.remaintime=()=>(this.duration-this.position())/this.playbackrate,this.seek=t=>{if(!this.audio)return;const e=this.duration;t<0&&(t=0),t>=e&&(t=e-.05),this.audio.seek(t),this.seekcounter++},this.toggle=()=>{this.audio&&(this.playing?(this.audio.pause(),this.playing=!1):(this.audio.play(),this.playing=!0))},this.stop=()=>{this.audio&&this.audio.stop()},Object(it.b)(()=>{this.audio&&(this.audio.setRate(this.playbackrate),this.audio.volume=pt.settings.general.song_volume)})}get loaded(){return null!==this.audio}},Et=Object(w.a)(wt.prototype,"audio",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tt=Object(w.a)(wt.prototype,"duration",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Ot=Object(w.a)(wt.prototype,"playing",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),At=Object(w.a)(wt.prototype,"playbackrate",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),St=Object(w.a)(wt.prototype,"seekcounter",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),wt);var Mt=n(7);const Dt=b()(t=>({background:{position:"absolute",zIndex:-1,top:0,left:0,right:0,bottom:0,backgroundPosition:"center",backgroundRepeat:"no-repeat",transition:"opacity 0.3s",backgroundSize:"cover"}}));var kt=()=>{const t=Dt();return Object(Mt.a)(()=>i.a.createElement(p.a,{className:t.background,style:{backgroundImage:Ct.src?`url(${Ct.src})`:"",opacity:1-pt.settings.general.background_dim}}))},jt=n(141),Nt=n(84),Lt=n(82);const Bt=Object(jt.a)({palette:{primary:{main:Nt.a[500],contrastText:"white"},secondary:{main:Lt.a.A200},error:Lt.a,type:"dark",background:{default:"#000"}},overrides:{MuiButton:{root:{textTransform:"inherit",transition:"color 0.2s"}},MuiTab:{root:{textTransform:"inherit",minWidth:"96px !important"}},MuiSnackbarContent:{root:{color:"#fff"}},MuiTableRow:{root:{"&$selected":{background:"rgb(128,216,255,0.16)","&:hover":{background:"rgb(128,216,255,0.16)"}}}},MuiDivider:{root:{height:2,backgroundColor:"rgba(127, 127, 127, 0.5)"}}}});var Ft=n(255),Ut=n(276),Gt=n(242),Ht=n(243),zt=n(249),Xt=n(250),Vt=n(277);const Yt=Object(g.a)(t=>({paper:{width:"calc(60vw + 200px)"}})),Wt=Object(it.f)({open:!1,content:"",title:""});function qt(t,e){Wt.open=!0,Wt.content=e,Wt.title=t}var Jt=()=>{const t=()=>{navigator.clipboard.writeText(Wt.content)},e=t=>{t.target.select()},n=Yt(),{t:r}=Object(u.b)();return Object(Mt.a)(()=>i.a.createElement(Ut.a,{open:Wt.open,onClose:()=>Wt.open=!1,classes:{paper:n.paper}},i.a.createElement(Gt.a,null,Wt.title),i.a.createElement(Ht.a,null,i.a.createElement(Vt.a,{autoFocus:!0,onFocus:e,fullWidth:!0,multiline:!0,rowsMax:20,variant:"outlined",value:Wt.content})),i.a.createElement(zt.a,null,i.a.createElement(Xt.a,{onClick:t,color:"primary"},r("Copy")),i.a.createElement(Xt.a,{onClick:()=>Wt.open=!1,color:"primary"},r("Close")))))},Kt=n(3),Zt=n(119),Qt=n.n(Zt),$t=n(121),te=n.n($t),ee=n(122),ne=n.n(ee),re=n(123),ie=n.n(re),oe=n(251),ae=n(252),se=n(83),ue=n(203),ce=n(273),le=n(253),he=n(120),de=n.n(he);const fe={success:Qt.a,warning:de.a,error:te.a,info:ne.a},pe=Object(it.f)({message:"",open:!1,type:"info"}),me=Object(g.a)(t=>({success:{backgroundColor:oe.a[700]},error:{backgroundColor:Lt.a[600]},info:{backgroundColor:ae.a[600]},warning:{backgroundColor:se.a[700]},icon:{fontSize:20},iconVariant:{opacity:.9,marginRight:t.spacing(1)},message:{display:"flex",alignItems:"center"}}));function ye(t,e="info"){pe.message=t,pe.type=e,pe.open=!0}const ge=(t,e)=>{"clickaway"!==e&&(pe.open=!1)};var ve=()=>{const t=me(),e=fe[pe.type];return Object(Mt.a)(()=>i.a.createElement(ce.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:pe.open,autoHideDuration:5e3,onClose:ge,key:pe.message+pe.type},i.a.createElement(le.a,{className:t[pe.type],message:i.a.createElement("span",{className:t.message},i.a.createElement(e,{className:Object(Kt.a)(t.icon,t.iconVariant)}),pe.message),action:[i.a.createElement(ue.a,{key:"close","aria-label":"close",color:"inherit",onClick:ge},i.a.createElement(ie.a,{className:t.icon}))]})))};function _e(t,e){for(let n=30;n<=6e4;n++){const r=60/n,i=t/r;let o=i+.5|0;if((i>o?i-o:o-i)*r<=.001){if(e%n===0){const t=e/n;n*=t,o*=t}return{bpm:n,beatcount:o}}}}function be(t){const e=C(t.timepoints).map(t=>t[1]).sort((t,e)=>t.time-e.time);if(e.length<=0)return"[]";const n=new Set,r=C(t.notes).map(t=>t[1]).sort((t,e)=>{const n=t.realtimecache-e.realtimecache;return n||t.lane-e.lane}),i=[];let o=e[0],a=0;{if(o.bpm!==(0|o.bpm))throw new Error("Can not have float point bpm");const t=_e(o.time,o.bpm);if(!t)throw new Error("Can not calculate bpm insertion");t.bpm===o.bpm||t.beatcount<=0?i.push({type:"System",cmd:"BPM",beat:0,bpm:o.bpm}):(i.push({type:"System",cmd:"BPM",beat:0,bpm:t.bpm}),i.push({type:"System",cmd:"BPM",beat:t.beatcount,bpm:o.bpm})),a=t.beatcount,n.add(o)}let s=0,u=a;const c=function(){let t=null,e=0,n=null,r=0;return{start(i,o){if(null===t&&o>e)return t=i,"A";if(null===n&&o>r)return n=i,"B";throw new Error("Can not use 3 slides at same time")},mid(e){if(t===e)return"A";if(n===e)return"B";throw new Error("Map may be corrupted")},end(i,o){if(t===i)return t=null,e=o,"A";if(n===i)return n=null,r=o,"B";throw new Error("Map may be corrupted")}}}();for(;s<r.length;){const e=r[s++],l=t.timepoints.get(e.timepoint);if(!l)throw new Error("Map may be corrupted");if(n.has(l)){if(o!==l)throw new Error("Map may be corrupted");const n={type:"Note",beat:a+e.offset/48,lane:e.lane+1};switch(u=n.beat,e.type){case"single":i.push({...n,note:"Single"});break;case"flick":i.push({...n,note:"Single",flick:!0});break;case"slide":const r=t.slides.get(e.slide);if(!r)throw new Error("Map may be corrupted");const o={...n,note:"Slide",pos:"A"};r.notes[0]===e.id?(o.start=!0,o.pos=c.start(r.id,n.beat)):r.notes[r.notes.length-1]===e.id?(o.end=!0,o.pos=c.end(r.id,n.beat),r.flickend&&(o.flick=!0)):o.pos=c.mid(r.id),i.push(o)}}else{if(l.bpm!==(0|l.bpm))throw new Error("Can not have float point bpm");u=1048575-(1048575-u|0);const t=(u-a)*o.ticktimecache*48+o.time,e=_e(l.time-t,l.bpm);if(!e)throw new Error("Can not calculate bpm insertion");e.bpm===l.bpm||e.beatcount<=0?(a=u+e.beatcount,i.push({type:"System",cmd:"BPM",beat:a,bpm:l.bpm})):(a=u+e.beatcount,i.push({type:"System",cmd:"BPM",beat:u,bpm:e.bpm}),i.push({type:"System",cmd:"BPM",beat:a,bpm:l.bpm})),o=l,u=a,n.add(l)}}return function(t){const e=[];e.push("[");for(let n=0;n<t.length;n++){const r=t[n];e.push(JSON.stringify(r)),n!==t.length-1&&e.push(",\n")}return e.push("]"),e.join("")}(i)}var xe=n(254);const we=Object(it.f)({open:!1,title:"",content:"",confirm:()=>{}});var Ee=()=>{const{t:t}=Object(u.b)();return Object(Mt.a)(()=>i.a.createElement(Ut.a,{open:we.open,onClose:()=>we.open=!1},i.a.createElement(Gt.a,null,we.title),i.a.createElement(Ht.a,null,i.a.createElement(xe.a,null,we.content)),i.a.createElement(zt.a,null,i.a.createElement(Xt.a,{onClick:()=>we.open=!1,color:"primary",autoFocus:!0},t("Cancel")),i.a.createElement(Xt.a,{onClick:()=>{we.confirm(),we.open=!1},color:"secondary"},t("Reset")))))};function Te(t){return{time:parseFloat(t[1]),bpm:parseFloat(t[2]),bpb:parseInt(t[3]),id:A(),ticktimecache:0}}function Oe(t){const e=t.split(":");return{offset:2*parseInt(e[0]),lane:parseInt(e[1])}}function Ae(t,e){return{type:"single",id:A(),timepoint:e,...Oe(t[1]),realtimecache:0}}function Se(t,e){return{type:"flick",id:A(),timepoint:e,...Oe(t[1]),realtimecache:0}}function Ie(t,e){const n={id:A(),flickend:"1"===t[1],notes:[]},r=[];for(let i=2;i<t.length;i++){const o={type:"slide",id:A(),timepoint:e,...Oe(t[i]),realtimecache:0,slide:n.id};n.notes.push(o.id),r.push(o)}return[n,r]}var Pe=()=>{const{t:t}=Object(u.b)();return i.a.createElement(Ft.a,{style:{margin:"20px 0"},item:!0,container:!0,direction:"column",spacing:2},i.a.createElement(Ft.a,{item:!0},i.a.createElement(Xt.a,{fullWidth:!0,variant:"outlined",onClick:async()=>{try{const e=await j("*");pt.reset(function(t){const e=t.split(/\r?\n/).map(t=>t.trim()).filter(t=>t),n=[],r=[],i=[];let o;for(const a of e){const t=a.split("|");switch(t[0]){case"+":o=Te(t),L(o),n.push(o);break;case"s":i.push(Ae(t,o.id));break;case"f":i.push(Se(t,o.id));break;case"l":{const[e,n]=Ie(t,o.id);r.push(e),i.push(...n);break}}}return N.fromJson(JSON.stringify({timepoints:n,slides:r,notes:i}))}(e)),ye(t("Import success"),"success")}catch(e){if(!e)return;throw ye(t("Error import"),"error"),e}}},t("Import bangbangboom format v1 (current map will loss)"))),i.a.createElement(Ft.a,{item:!0},i.a.createElement(Xt.a,{fullWidth:!0,variant:"outlined",onClick:()=>{try{const e=be(pt.map.state);qt(t("Export Bestdori format map"),e)}catch(e){throw qt(t("An error occurred during export"),t(""+e)),ye(t("Error export"),"error"),e}}},t("Export Bestdori format map"))),i.a.createElement(Ft.a,{item:!0},i.a.createElement(Xt.a,{fullWidth:!0,variant:"outlined",onClick:()=>{!function(t){"string"===typeof t&&(t=new Blob([t]));const e=URL.createObjectURL(t),n=document.createElement("a");n.style.display="none",n.href=e,n.download=(pt.meta.name||"No title")+" - bbbEditor.json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(e)}(N.toJsonString(pt.map))}},t("Download editor format map"))),i.a.createElement(Ft.a,{item:!0},i.a.createElement(Xt.a,{fullWidth:!0,variant:"outlined",onClick:async()=>{try{const e=await j("*");pt.reset(N.fromJson(e)),ye(t("Import success"),"success")}catch(e){if(!e)return;throw ye(t("Error import"),"error"),e}}},t("Import editor format map (current map will loss)"))),i.a.createElement(Ft.a,{item:!0},i.a.createElement(Xt.a,{fullWidth:!0,variant:"outlined",onClick:()=>{var e,n,r;e=t("Are you sure to reset current map?"),n=t("This action can not be reverted. Please make sure you have backed up your map."),r=()=>{pt.reset(),ye(t("Reset success"),"success")},we.open=!0,we.content=n,we.title=e,we.confirm=r}},t("Reset current map"))))},Ce=n(124),Re=n.n(Ce),Me=n(125),De=n.n(Me);var ke=Object(r.forwardRef)((t,e)=>{const{onFileSelected:n,inputProps:o,multiple:a=!1,accept:s,value:u="",...c}=t,[l,h]=Object(r.useState)(u),d=Object(r.useCallback)((t,e)=>{if(t.files&&t.files.length){const n=Array.from(t.files);h(n.map(t=>t.name).join(", ")),e&&e(n)}},[h]),f=Object(r.useMemo)(()=>{const t=document.createElement("input");return t.type="file",t},[]);return i.a.createElement(Vt.a,Object.assign({},c,{ref:e,inputProps:{...o,onClick:()=>{f.accept=s||"*",f.multiple=a,f.onchange=()=>d(f,n),f.click()}},value:l}))});const je=({children:t})=>i.a.createElement(Ft.a,{item:!0,container:!0,spacing:2,alignItems:"flex-end"},i.a.createElement(Ft.a,{item:!0},i.a.createElement(Re.a,null)),i.a.createElement(Ft.a,{item:!0,xs:!0},t)),Ne=()=>{const{t:t}=Object(u.b)();return Object(Mt.a)(()=>i.a.createElement(Ft.a,{item:!0,container:!0,spacing:2,alignItems:"flex-end"},i.a.createElement(Ft.a,{item:!0},i.a.createElement(De.a,null)),i.a.createElement(Ft.a,{item:!0,xs:!0},i.a.createElement(Vt.a,{fullWidth:!0,label:t("Map name"),value:pt.meta.name,onChange:t=>pt.meta.name=t.target.value}))))};let Le="";const Be=()=>{const{t:t}=Object(u.b)();return i.a.createElement(je,null,i.a.createElement(ke,{fullWidth:!0,value:Le,label:t("Load music"),accept:"audio/*",onFileSelected:e=>{Le=e[0].name,Rt.load(e[0],()=>ye(t("Load failed"),"error"),()=>ye(t("Load success"),"success"))}}))};let Fe="";const Ue=()=>{const{t:t}=Object(u.b)();return i.a.createElement(je,null,i.a.createElement(ke,{fullWidth:!0,value:Fe,label:t("Load background"),accept:"image/*",onFileSelected:t=>{Fe=t[0].name;const e=URL.createObjectURL(t[0]);Ct.src=e}}))};var Ge=()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(Ne,null),i.a.createElement(Be,null),i.a.createElement(Ue,null)),He=n(67),ze=n(256);const Xe=Object(g.a)(()=>({panel:{width:"100%",maxWidth:600,margin:"64px auto"}}));var Ve=()=>{const t=Xe();return i.a.createElement(Ft.a,{className:t.panel,container:!0,direction:"column",spacing:4},i.a.createElement(Ge,null),i.a.createElement(Pe,null),i.a.createElement(Ft.a,{item:!0},i.a.createElement(He.a,{align:"right",color:"textSecondary"},i.a.createElement(ze.a,{target:"_blank",rel:"noopener noreferrer",href:"https://bestdori.com"},"Bestdori"),"\xa0|\xa0",i.a.createElement(ze.a,{target:"_blank",rel:"noopener noreferrer",href:"https://player.banground.fun"},"Banground Player"),"\xa0|\xa0",i.a.createElement(ze.a,{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/K024/bangbangboom-editor"},"About bangbangboom editor"))),i.a.createElement(Jt,null),i.a.createElement(Ee,null))},Ye=n(257),We=n(258),qe=n(259),Je=n(260),Ke=n(261);const Ze=Object(it.f)({bpm:90,bpb:4,time:0,selected:null,muteticker:!1,measuring:!1,autoswitchtp:!0});Object(it.g)(()=>Ze.selected,t=>{if(null!==t){const e=pt.map.timepoints.get(t);if(!e)return;Ze.bpm=e.bpm,Ze.bpb=e.bpb,Ze.time=e.time}});const Qe=Object(g.a)(t=>({table:{maxHeight:"60vh",overflow:"auto","-webkit-overflow-scrolling":"touch"},tablerow:{cursor:"pointer"}})),$e=()=>{const t=Qe(),{t:e}=Object(u.b)();return Pt(),Object(Mt.a)(()=>i.a.createElement(Ye.a,{className:t.table},i.a.createElement(We.a,null,i.a.createElement(qe.a,null,i.a.createElement(Je.a,null,e("Start time")),i.a.createElement(Je.a,null,"BPM"),i.a.createElement(Je.a,null,e("Meter")))),i.a.createElement(Ke.a,null,pt.map.timepointlist.map(e=>i.a.createElement(qe.a,{key:e.id,selected:e.id===Ze.selected,hover:!0,onClick:()=>Ze.selected=e.id===Ze.selected?null:e.id,classes:{root:t.tablerow}},i.a.createElement(Je.a,null,M(e.time)),i.a.createElement(Je.a,null,e.bpm),i.a.createElement(Je.a,null,e.bpb,"/4"))))))},tn=()=>{const{t:t}=Object(u.b)(),e=()=>{null!==Ze.selected&&(pt.map.removeTimepoint(Ze.selected,pt.settings.editor.justify_grid_divisor),Ze.selected=null)};return Object(Mt.a)(()=>i.a.createElement(Xt.a,{color:"secondary",disabled:null===Ze.selected,onClick:e},t("Remove")))};var en=()=>{const{t:t}=Object(u.b)();return Object(Mt.a)(()=>i.a.createElement(Ft.a,{item:!0,xs:12,sm:!0,container:!0,spacing:2,direction:"column"},i.a.createElement(Ft.a,{item:!0},i.a.createElement(He.a,null,t("Timepoints"))),i.a.createElement(Ft.a,{item:!0},i.a.createElement($e,null)),i.a.createElement(Ft.a,{item:!0},i.a.createElement(tn,null))))};const nn={note_flick:"/assets/mapping/note_flick.png",note_long:"/assets/mapping/note_long.png",note_normal:"/assets/mapping/note_normal.png",note_slide_among:"/assets/mapping/note_slide_among.png",timing_tack:"/assets/mapping/timing_tack.wav",timing_tick:"/assets/mapping/timing_tick.wav",perfect:"/assets/mapping/perfect.mp3",flick:"/assets/mapping/flick.mp3",long:"/assets/mapping/long.mp3"};for(const ia in nn)nn[ia]=""+nn[ia];var rn=nn,on=n(92);function an(t){let e=!1;const n=()=>{e=!0},r=()=>{e||(requestAnimationFrame(r),t(n))};return requestAnimationFrame(r),n}function sn(t,e){return Object(on.a)(t,e),function(){on.a.unbind(t,e)}}const un=Object(it.f)({counter:1});function cn(t,e,n,r){t.style[e]=r instanceof Function?r(n):n+r,t.style.transition="none",getComputedStyle(t)[e]}function ln(t,e,n,r,i,o){t.style[e]=i instanceof Function?i(n):n+i,t.style.transition="none",getComputedStyle(t)[e]&&un.counter,t.style[e]=i instanceof Function?i(r):r+i,t.style.transition=e+" "+o+"s linear"}setInterval(()=>{un.counter++},500);var hn=n(262),dn=n(263);const fn=()=>{pt.map.addTimepoint(Ze.time,Ze.bpm,Ze.bpb,pt.settings.editor.justify_grid_divisor)},pn=()=>{const t=Ze.selected;null!==t&&pt.map.moveTimepoint(t,pt.settings.editor.justify_find_nearest,pt.settings.editor.justify_grid_divisor,Ze.time,Ze.bpm,Ze.bpb)},mn=()=>{const t=Ze.selected;if(null===t)return!1;const e=pt.map.timepoints.get(t);return e?e.bpb!==Ze.bpb||e.bpm!==Ze.bpm||e.time!==Ze.time:(Ze.selected=null,!1)};var yn=()=>{const{t:t}=Object(u.b)();return Pt(),Object(Mt.a)(()=>i.a.createElement(Ft.a,{item:!0,container:!0,wrap:"wrap",spacing:2},i.a.createElement(Ft.a,{item:!0,xs:!0},i.a.createElement(Xt.a,{fullWidth:!0,onClick:fn,disabled:null!==Ze.selected,color:"primary"},t("Add timepoint"))),i.a.createElement(Ft.a,{item:!0,xs:!0},i.a.createElement(Xt.a,{fullWidth:!0,onClick:pn,disabled:!mn(),color:"primary"},t("Apply changes"))),i.a.createElement(Ft.a,{item:!0,container:!0,style:{marginTop:16}},i.a.createElement(hn.a,{style:{marginLeft:"auto"},control:i.a.createElement(dn.a,{checked:Ze.muteticker,onChange:(t,e)=>Ze.muteticker=e}),label:t("Mute metronome"),labelPlacement:"start"})),i.a.createElement(Ft.a,{item:!0,container:!0},i.a.createElement(hn.a,{style:{marginLeft:"auto"},control:i.a.createElement(dn.a,{checked:Ze.autoswitchtp,onChange:(t,e)=>Ze.autoswitchtp=e}),label:t("Auto swich selected timepoint"),labelPlacement:"start"}))))};const gn=Object(g.a)(t=>({root:{display:"flex",alignItems:"center",height:80,padding:10,transform:"translate(0, 0)","&>*":{flexGrow:1,height:"100%",margin:10,border:"solid 3px cornflowerblue",borderRadius:6,overflow:"hidden"},"& :first-child":{borderColor:"darkorange"},"&>*>*":{width:"100%",height:"100%",backgroundColor:"cornflowerblue",willChange:"opacity",opacity:0},"& :first-child>*":{backgroundColor:"darkorange"}}})),vn=D(()=>({tick:gt.from(It(rn.timing_tick)).load(),tack:gt.from(It(rn.timing_tack)).load()}));let _n=0;let bn=-1;function xn(t){const e=Rt.position();if(!Ze.measuring&&Ze.autoswitchtp&&null!==Ze.selected&&Rt.playing&&!mn()){const[t]=pt.map.findTimepoint(e);if(!t)return;t.id!==Ze.selected&&(Ze.selected=t.id)}const{time:n,bpm:r,bpb:i}=Ze,o=60/r,a=(e-n)/o,s=Math.floor(a),u=a-s,c=s%i,l=o/Rt.playbackrate;if(Rt.playing){let e=a-bn;if(e>.3&&(e=0),u-e<0)for(let r=0;r<t.length;r++)r===c?ln(t[r],"opacity",1,0,"",l/2):cn(t[r],"opacity",0,"");const n=(1-u)*l*1e3;n<50&&function(t,e){if(Ze.measuring||Ze.muteticker)return;const n=performance.now()+e;if(n<=_n)return;const r=vn();_n=n+100,new vt(t?r.tick:r.tack).play(e/1e3)}(c===i-1,n)}else for(let h=0;h<t.length;h++)cn(t[h],"opacity",h===c?Math.max(0,2*(.5-u)):0,"");bn=a}var wn=()=>{const t=gn(),e=Object(r.useRef)(null),n=Object(Mt.a)(()=>Ze.bpb);return Object(r.useEffect)(()=>an(()=>{if(e.current){xn(Array.from(e.current.children).map(t=>t.firstChild))}}),[]),Object(r.useEffect)(()=>Object(it.b)(()=>{const t=vn();t.tick.volume=pt.settings.general.effect_volume,t.tack.volume=pt.settings.general.effect_volume}),[]),i.a.createElement("div",{className:t.root,ref:e},k(n).map(t=>i.a.createElement("div",{key:t},i.a.createElement("div",null))))};function En(t){const e=t.length/2|0;let n=0,r=0;for(;r+e<t.length;r++)n+=t[r+e]-t[r];const i=n/e/r,o=60/i;for(n=0,r=0;r<t.length;r++)n+=t[r]-r*i;return{bpm:o,offset:n/r}}const Tn={taps:[],timeoutId:void 0},On=t=>{const e=Rt.position();if(Tn.taps.push(e),t(Tn.taps.length),Tn.taps.length>=5){const t=function(t){const e=En(t);let n=!1;const r=60/e.bpm,i=[t[0]];for(let o=1;o<t.length;o++){const e=t[o],a=i[i.length-1],s=e-a;s<.3*r?n=!0:s>1.7*r?(i.push(a+r),o--,n=!0):i.push(e)}return n?En(i):e}(Tn.taps);Ze.bpm=t.bpm,Ze.time=t.offset}Ze.measuring=!0,clearTimeout(Tn.timeoutId),Tn.timeoutId=setTimeout(()=>{Tn.taps.length=0,Ze.measuring=!1,t(0)},3e3)};var An=()=>{const[t,e]=Object(r.useState)(0);Object(r.useEffect)(()=>sn("t",()=>[On(e)]),[]);const{t:n}=Object(u.b)();return Object(Mt.a)(()=>i.a.createElement(Xt.a,{fullWidth:!0,disableRipple:!0,onClick:()=>On(e),disabled:!Rt.playing,title:n("Hotkey: {{ hotkey }}",{hotkey:"t"})},Rt.playing?t<=0?n("Click here or press 'T' to measure"):t<5?n("More {{ count }} times",{count:5-t}):n("Keep stable"):n("Play the music to start measure")))};var Sn=Object(r.forwardRef)((t,e)=>{const{number:n,validator:o=(t=>/^-?([0-9]+(\.[0-9]+)?)$/.test(t)&&parseFloat(t)),numberDisplay:a=(t=>t.toString()),onNumberChange:s,onBlur:u,onChange:c,...l}=t,h=a(n),[d,f]=Object(r.useState)(h),[p,m]=Object(r.useState)(!0);p&&o(h)!==o(d)&&f(h);return i.a.createElement(Vt.a,Object.assign({},l,{ref:e,value:d,onChange:t=>{f(t.target.value),c&&c(t);const e=o(t.target.value);"number"!==typeof e||isNaN(e)?m(!1):(m(!0),e!==n&&s&&s(t,e))},onBlur:t=>{u&&u(t),p||(f(h),m(!0))},color:p?"primary":"secondary"}))}),In=n(126),Pn=n.n(In),Cn=n(127),Rn=n.n(Cn),Mn=n(264);const Dn=t=>{Ze.time+=60*t/Ze.bpm};function kn(t){if(!/^-?([0-9]+:[0-9]{2}(.[0-9]+)?|[0-9]+(.[0-9]+)?)$/.test(t))return!1;const e=t.indexOf(":");return e<0?parseFloat(t):60*parseInt(t.substr(0,e))+parseFloat(t.substr(e+1))}var jn=()=>{const{t:t}=Object(u.b)();return Object(Mt.a)(()=>i.a.createElement(Ft.a,{item:!0,container:!0,spacing:2},i.a.createElement(Ft.a,{item:!0,xs:12,sm:6},i.a.createElement(Sn,{fullWidth:!0,label:t("Time"),numberDisplay:M,validator:kn,number:Ze.time,onNumberChange:(t,e)=>Ze.time=e})),i.a.createElement(Ft.a,{item:!0,xs:12,container:!0,alignItems:"center"},i.a.createElement(Ft.a,{item:!0},i.a.createElement(ue.a,{onClick:()=>Dn(-1),title:t("Backward one beat")},i.a.createElement(Pn.a,null)),i.a.createElement(ue.a,{onClick:()=>Dn(1),title:t("Forward one beat")},i.a.createElement(Rn.a,null))),i.a.createElement(Ft.a,{item:!0,xs:!0},i.a.createElement(Xt.a,{fullWidth:!0,onClick:()=>Ze.time=Rt.position()},t("Set to current player time")))),i.a.createElement(Ft.a,{item:!0,xs:12,sm:6},i.a.createElement(Sn,{fullWidth:!0,label:"BPM",inputProps:{type:"number",step:"0.001"},number:Ze.bpm,onNumberChange:(t,e)=>Ze.bpm=e})),i.a.createElement(Ft.a,{item:!0,xs:12,sm:6},i.a.createElement(Sn,{InputProps:{endAdornment:i.a.createElement(Mn.a,{position:"end"},"/ 4")},fullWidth:!0,label:t("Meter"),inputProps:{type:"number",step:"1"},number:Ze.bpb,validator:t=>/^[0-9]+$/.test(t)&&parseInt(t),onNumberChange:(t,e)=>Ze.bpb=e}))))};const Nn=()=>{const{t:t}=Object(u.b)();return Object(Mt.a)(()=>pt.settings.editor.keep_pitch?i.a.createElement(Ft.a,{item:!0},i.a.createElement(p.a,{p:1,fontWeight:"fontWeightLight",fontFamily:"sans-serif",fontStyle:"italic",textAlign:"center"},t('Some unstable delay may be caused by setting "Keep pitch"'))):null)};var Ln=()=>i.a.createElement(Ft.a,{item:!0,xs:12,sm:!0,container:!0,spacing:2,direction:"column"},i.a.createElement(Ft.a,{item:!0},i.a.createElement(wn,null)),i.a.createElement(Nn,null),i.a.createElement(Ft.a,{item:!0},i.a.createElement(An,null)),i.a.createElement(jn,null),i.a.createElement(yn,null));const Bn=b()(t=>({timing:{width:"100%",maxWidth:1e3,margin:"32px auto"}}));var Fn=()=>{const t=Bn();return i.a.createElement(Ft.a,{className:t.timing,container:!0,spacing:3},i.a.createElement(en,null),i.a.createElement(Ln,null))},Un=n(274),Gn=n(246),Hn=n(247),zn=n(269),Xn=n(275),Vn=n(265),Yn=n(202);const Wn=Object(g.a)(t=>({panel:{width:"100%",maxWidth:600,margin:"32px auto"}})),qn=t=>i.a.createElement(Ft.a,{item:!0,container:!0,spacing:2,alignItems:"center"},i.a.createElement(Ft.a,{component:Yn.a,item:!0,style:{width:150}},i.a.createElement(He.a,null,t.label)),i.a.createElement(Ft.a,{item:!0,xs:!0},t.children)),Jn=t=>i.a.createElement(Ft.a,{component:Yn.a,item:!0,container:!0,spacing:2,alignItems:"center"},i.a.createElement(Ft.a,{item:!0,xs:!0},i.a.createElement(He.a,null,t.label)),i.a.createElement(Ft.a,{item:!0},t.children)),Kn=()=>{const{t:t}=Object(u.b)();return Object(Mt.a)(()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(Ft.a,{item:!0},i.a.createElement(He.a,{variant:"h6"},t("General"))),i.a.createElement(qn,{label:t("Song volume")},i.a.createElement(Un.a,{value:pt.settings.general.song_volume,min:0,max:1,step:.01,valueLabelDisplay:"auto",onChange:(t,e)=>pt.settings.general.song_volume=e})),i.a.createElement(qn,{label:t("Effect volume")},i.a.createElement(Un.a,{value:pt.settings.general.effect_volume,min:0,max:1,step:.01,valueLabelDisplay:"auto",onChange:(t,e)=>pt.settings.general.effect_volume=e})),i.a.createElement(qn,{label:t("Background dim")},i.a.createElement(Un.a,{value:pt.settings.general.background_dim,min:0,max:1,step:.01,valueLabelDisplay:"auto",onChange:(t,e)=>pt.settings.general.background_dim=e}))))},Zn=()=>{const{t:t}=Object(u.b)(),e=(e,n)=>{pt.settings.editor.keep_pitch=n,ye(n?t("This may cause unstable delay of song. ")+t("Please reload the music to activate"):t("Please reload the music to activate"),"warning")};return Object(Mt.a)(()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(Ft.a,{item:!0},i.a.createElement(He.a,{variant:"h6"},t("Editor"))),i.a.createElement(Ft.a,{item:!0,container:!0,spacing:2},i.a.createElement(Ft.a,{component:Yn.a,item:!0,xs:12},i.a.createElement(He.a,null,t("Auto save interval (minutes, 0 to disable)")," \xa0\xa0",t("Last save: {{ time }}",{time:pt.lastSave?pt.lastSave.getHours()+":"+pt.lastSave.getMinutes()+":"+pt.lastSave.getSeconds():t("Never")}))),i.a.createElement(Ft.a,{item:!0,xs:!0},i.a.createElement(Un.a,{value:pt.settings.editor.autosave_interval,min:0,max:10,step:.5,valueLabelDisplay:"auto",onChange:(t,e)=>pt.settings.editor.autosave_interval=e}))),i.a.createElement(Jn,{label:t("Keep pitch when changing playback rate")},i.a.createElement(dn.a,{checked:pt.settings.editor.keep_pitch,onChange:e})),i.a.createElement(Ft.a,{item:!0},i.a.createElement(Gn.a,{fullWidth:!0},i.a.createElement(Hn.a,null,t("When changes applied, try to keep notes at")),i.a.createElement(zn.a,{value:pt.settings.editor.justify_find_nearest?1:0,onChange:t=>pt.settings.editor.justify_find_nearest=!!t.target.value},i.a.createElement(Xn.a,{value:1},t("Previous time")),i.a.createElement(Xn.a,{value:0},t("Previous beat"))))),i.a.createElement(Ft.a,{item:!0},i.a.createElement(Gn.a,{fullWidth:!0},i.a.createElement(Hn.a,null,t("Grid divisor (of a quarter) to justify notes when justifying timepoint")),i.a.createElement(zn.a,{value:pt.settings.editor.justify_grid_divisor,onChange:t=>pt.settings.editor.justify_grid_divisor=t.target.value},i.a.createElement(Xn.a,{value:1},"1 / 1"),i.a.createElement(Xn.a,{value:2},"1 / 2"),i.a.createElement(Xn.a,{value:3},"1 / 3"),i.a.createElement(Xn.a,{value:4},"1 / 4"),i.a.createElement(Xn.a,{value:6},"1 / 6"),i.a.createElement(Xn.a,{value:8},"1 / 8"),i.a.createElement(Xn.a,{value:16},"1 / 16"),i.a.createElement(Xn.a,{value:48},"1 / 48")))),i.a.createElement(Jn,{label:t("Show cursor infomation in mapping")},i.a.createElement(dn.a,{checked:pt.settings.editor.show_info_window,onChange:(t,e)=>pt.settings.editor.show_info_window=e})),i.a.createElement(Jn,{label:t("Show warning for same position notes")},i.a.createElement(dn.a,{checked:pt.settings.editor.warn_for_same_pos_notes,onChange:(t,e)=>pt.settings.editor.warn_for_same_pos_notes=e}))))};let Qn;const $n=()=>{const{t:t}=Object(u.b)();return Object(Mt.a)(()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(Ft.a,{item:!0},i.a.createElement(He.a,{variant:"h6"},t("Game"))),i.a.createElement(Ft.a,{item:!0,container:!0,spacing:2},i.a.createElement(Ft.a,{component:Yn.a,item:!0,xs:12},i.a.createElement(He.a,null,t("Judge offset (ms, smaller means you have to tap earlier)"))),i.a.createElement(Ft.a,{item:!0,xs:!0},i.a.createElement(Un.a,{value:pt.settings.game.judge_offset,min:-1e3,max:1e3,step:1,valueLabelDisplay:"auto",onChange:(t,e)=>pt.settings.game.judge_offset=e})),i.a.createElement(Ft.a,{item:!0,style:{width:72}},i.a.createElement(Sn,{inputProps:{type:"number",step:"1",max:"1000",min:"-1000"},number:pt.settings.game.judge_offset,validator:t=>/^-?[0-9]+$/.test(t)&&(Qn=parseInt(t),Qn<=1e3&&Qn>=-1e3&&Qn),onNumberChange:(t,e)=>pt.settings.game.judge_offset=e}))),i.a.createElement(Ft.a,{item:!0,container:!0,spacing:2},i.a.createElement(Ft.a,{component:Yn.a,item:!0,xs:12},i.a.createElement(He.a,null,t("Visual offset (ms, smaller means notes fall earlier)"))),i.a.createElement(Ft.a,{item:!0,xs:!0},i.a.createElement(Un.a,{value:pt.settings.game.visual_offset,min:-1e3,max:1e3,step:1,valueLabelDisplay:"auto",onChange:(t,e)=>pt.settings.game.visual_offset=e})),i.a.createElement(Ft.a,{item:!0,style:{width:72}},i.a.createElement(Sn,{inputProps:{type:"number",step:"1",max:"1000",min:"-1000"},number:pt.settings.game.visual_offset,validator:t=>/^-?[0-9]+$/.test(t)&&(Qn=parseInt(t),Qn<=1e3&&Qn>=-1e3&&Qn),onNumberChange:(t,e)=>pt.settings.game.visual_offset=e}))),i.a.createElement(Ft.a,{item:!0,container:!0,spacing:2},i.a.createElement(Ft.a,{component:Yn.a,item:!0,style:{width:150}},i.a.createElement(He.a,null,t("Fall speed"))),i.a.createElement(Ft.a,{item:!0,xs:!0},i.a.createElement(Un.a,{value:pt.settings.game.speed,min:1,max:11,step:.1,valueLabelDisplay:"auto",onChange:(t,e)=>pt.settings.game.speed=e})),i.a.createElement(Ft.a,{item:!0,style:{width:72}},i.a.createElement(Sn,{inputProps:{type:"number",step:"0.1",max:"11",min:"1"},number:pt.settings.game.speed,validator:t=>/^[0-9]+(.[0-9]?)?$/.test(t)&&(Qn=parseFloat(t),Qn<=11&&Qn>=1&&Qn),onNumberChange:(t,e)=>pt.settings.game.speed=e}))),i.a.createElement(qn,{label:t("Resolution")},i.a.createElement(Un.a,{value:pt.settings.game.resolution,min:.2,max:4,step:.05,valueLabelDisplay:"auto",onChange:(t,e)=>pt.settings.game.resolution=e})),i.a.createElement(qn,{label:t("Slide bar opacity")},i.a.createElement(Un.a,{value:pt.settings.game.bar_opaciry,min:0,max:1,step:.01,valueLabelDisplay:"auto",onChange:(t,e)=>pt.settings.game.bar_opaciry=e})),i.a.createElement(Jn,{label:t("Show simultaneou line")},i.a.createElement(dn.a,{checked:pt.settings.game.show_sim_line,onChange:(t,e)=>pt.settings.game.show_sim_line=e})),i.a.createElement(Jn,{label:t("Lane tap effect")},i.a.createElement(dn.a,{checked:pt.settings.game.lane_effect,onChange:(t,e)=>pt.settings.game.lane_effect=e})),i.a.createElement(Jn,{label:t("Mirror")},i.a.createElement(dn.a,{checked:pt.settings.game.mirror,onChange:(t,e)=>pt.settings.game.mirror=e})),i.a.createElement(Jn,{label:t("Rythem visual assist")},i.a.createElement(dn.a,{checked:pt.settings.game.beat_note,onChange:(t,e)=>pt.settings.game.beat_note=e}))))};var tr,er,nr,rr,ir,or,ar,sr,ur=()=>{const t=Wn();return i.a.createElement(Ft.a,{className:t.panel,container:!0,direction:"column",spacing:4},i.a.createElement(Kn,null),i.a.createElement(Vn.a,{style:{margin:"32px -24px",width:"30%"}}),i.a.createElement(Zn,null),i.a.createElement(Vn.a,{style:{margin:"32px -24px",width:"30%"}}),i.a.createElement($n,null))};const cr=new(tr=class{get viewOffset(){return 100/this.timeHeightFactor}get viewduration(){return Rt.duration-this.viewOffset}get paddedDuration(){return 1.2*Rt.duration}get samePosNotes(){const t=new Set;if(this.mapChangeCounter){const e=t=>`${t.timepoint}:${t.offset}:${t.lane}`;for(const r of pt.map.slidelist){let e=O(pt.map.notes.get(r.notes[0]));for(let n=1;n<r.notes.length;n++){const i=O(pt.map.notes.get(r.notes[n]));e.timepoint===i.timepoint&&e.offset===i.offset&&(t.add(e.id),t.add(i.id)),e=i}}const n=new Set;for(const r of pt.map.notelist){const i=e(r);n.has(i)&&t.add(r.id),n.add(i)}}return t}get noteListOrdered(){const t=[];if(this.mapChangeCounter)for(const e of pt.map.notelist)t.push(e);return t.sort((t,e)=>t.realtimecache-e.realtimecache)}constructor(){Object(x.a)(this,"_viewposition",er,this),this.getViewposition=()=>this.tracking?Rt.position()-this.viewOffset:this._viewposition,this.setViewposition=t=>{const e=this.viewOffset;t<-e&&(t=-e),t>Rt.duration-e&&(t=Rt.duration-.05-e),this.tracking?Rt.seek(t+e):this._viewposition=t},Object(x.a)(this,"tracking",nr,this),Object(x.a)(this,"timeHeightFactor",rr,this),Object(x.a)(this,"division",ir,this),Object(x.a)(this,"tool",or,this),Object(x.a)(this,"mirror",ar,this),Object(x.a)(this,"mapChangeCounter",sr,this),Object(it.g)(()=>this.tracking,t=>{const e=100/this.timeHeightFactor;t||(this._viewposition=Rt.position()-e)}),pt.map.changeListeners.add(()=>this.mapChangeCounter++)}},er=Object(w.a)(tr.prototype,"_viewposition",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(w.a)(tr.prototype,"viewOffset",[it.c],Object.getOwnPropertyDescriptor(tr.prototype,"viewOffset"),tr.prototype),Object(w.a)(tr.prototype,"viewduration",[it.c],Object.getOwnPropertyDescriptor(tr.prototype,"viewduration"),tr.prototype),nr=Object(w.a)(tr.prototype,"tracking",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rr=Object(w.a)(tr.prototype,"timeHeightFactor",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 400}}),ir=Object(w.a)(tr.prototype,"division",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),or=Object(w.a)(tr.prototype,"tool",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"none"}}),ar=Object(w.a)(tr.prototype,"mirror",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(w.a)(tr.prototype,"paddedDuration",[it.c],Object.getOwnPropertyDescriptor(tr.prototype,"paddedDuration"),tr.prototype),sr=Object(w.a)(tr.prototype,"mapChangeCounter",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Object(w.a)(tr.prototype,"samePosNotes",[it.c],Object.getOwnPropertyDescriptor(tr.prototype,"samePosNotes"),tr.prototype),Object(w.a)(tr.prototype,"noteListOrdered",[it.c],Object.getOwnPropertyDescriptor(tr.prototype,"noteListOrdered"),tr.prototype),tr);function lr(){const t=pt.map.timepointlist,e=[];let n=0;for(let r=0;r<t.length;r++){const i=t[r];n=r<t.length-1?t[r+1].time:Rt.duration;let o=1;for(;;){const t=i.time+48*i.ticktimecache*o;if(t>=n)break;const a=1+(o/i.bpb|0),s=o%i.bpb+1;e.push({time:t,name:`${r+1}:${a}:${s}`}),o++}}return e}var hr=n(279),dr=n(271),fr=n(129),pr=n.n(fr),mr=n(130),yr=n.n(mr),gr=n(131),vr=n.n(gr),_r=n(278);const br=Object(g.a)(t=>({tools:{position:"relative",flexGrow:.5,flexShrink:1.5,maxWidth:"calc(40% - 100px)",overflowX:"hidden",overflowY:"auto","-webkit-overflow-scrolling":"touch","&>*":{maxWidth:300,position:"absolute",right:0,top:30}},toolimg:{width:80}})),xr=()=>{let t=1.414*cr.timeHeightFactor;t>1580&&(t=1600),cr.timeHeightFactor=t},wr=()=>{let t=cr.timeHeightFactor/1.414;t<120&&(t=100),cr.timeHeightFactor=t},Er=()=>{const t=br(),{t:e}=Object(u.b)();return Object(r.useEffect)(()=>sn("1",()=>cr.tool="none"),[]),Object(r.useEffect)(()=>sn("2",()=>cr.tool="single"),[]),Object(r.useEffect)(()=>sn("3",()=>cr.tool="slide"),[]),Object(r.useEffect)(()=>sn("4",()=>cr.tool="delete"),[]),Object(Mt.a)(()=>i.a.createElement(Ft.a,{item:!0},i.a.createElement(p.a,{display:"block",my:2,component:Yn.a},i.a.createElement(Ft.a,{container:!0,alignItems:"center",spacing:2},i.a.createElement(Ft.a,{item:!0},e("Tool")),i.a.createElement(Ft.a,{item:!0},i.a.createElement(_r.a,{placement:"right",title:i.a.createElement(He.a,{variant:"body2"},e("Double click to switch flick")," ",i.a.createElement("br",null),e("Right click to delete note(s)")," ",i.a.createElement("br",null),e("Click the slide bar to add mid note")," ",i.a.createElement("br",null),e("Hold ctrl and drag to multi-select & copy notes"))},i.a.createElement(pr.a,{fontSize:"small"}))))),i.a.createElement(hr.a,{value:cr.tool,onChange:(t,e)=>cr.tool=e},i.a.createElement(hn.a,{value:"none",control:i.a.createElement(dr.a,null),label:e("None"),title:e("Hotkey: {{ hotkey }}",{hotkey:"1"})}),i.a.createElement(hn.a,{value:"single",control:i.a.createElement(dr.a,null),label:i.a.createElement("img",{className:t.toolimg,src:rn.note_normal,alt:"Single / Flick"}),title:e("Hotkey: {{ hotkey }}",{hotkey:"2"})}),i.a.createElement(hn.a,{value:"slide",control:i.a.createElement(dr.a,null),label:i.a.createElement("img",{className:t.toolimg,src:rn.note_long,alt:"Slide"}),title:e("Hotkey: {{ hotkey }}",{hotkey:"3"})}),i.a.createElement(hn.a,{value:"delete",control:i.a.createElement(dr.a,null),label:e("Delete"),title:e("Hotkey: {{ hotkey }}",{hotkey:"4 / Right click"})}))))},Tr=()=>{const{t:t}=Object(u.b)();return Object(Mt.a)(()=>i.a.createElement(Ft.a,{item:!0},i.a.createElement(Gn.a,{fullWidth:!0},i.a.createElement(Hn.a,null,t("Grid divisor (of a quarter note)")),i.a.createElement(zn.a,{fullWidth:!0,value:cr.division,onChange:t=>cr.division=t.target.value},i.a.createElement(Xn.a,{value:1},"1 / 1"),i.a.createElement(Xn.a,{value:2},"1 / 2"),i.a.createElement(Xn.a,{value:3},"1 / 3"),i.a.createElement(Xn.a,{value:4},"1 / 4"),i.a.createElement(Xn.a,{value:6},"1 / 6"),i.a.createElement(Xn.a,{value:8},"1 / 8"),i.a.createElement(Xn.a,{value:16},"1 / 16"),i.a.createElement(Xn.a,{value:48},"1 / 48")))))},Or=()=>{const{t:t}=Object(u.b)();return Object(r.useEffect)(()=>sn("+,=",xr),[]),Object(r.useEffect)(()=>sn("-,_",wr),[]),Object(r.useEffect)(()=>{const t=document.getElementById("root"),e=t=>{t.ctrlKey&&(t.stopPropagation(),t.preventDefault(),t.deltaY<0?xr():wr())};return null===t||void 0===t||t.addEventListener("wheel",e),()=>null===t||void 0===t?void 0:t.removeEventListener("wheel",e)},[]),Object(Mt.a)(()=>i.a.createElement(Ft.a,{item:!0,container:!0,spacing:2},i.a.createElement(Ft.a,{item:!0},i.a.createElement(ue.a,{onClick:xr,disabled:cr.timeHeightFactor>1580,title:t("Hotkey: {{ hotkey }}",{hotkey:"+ / ctrl + wheel"})},i.a.createElement(yr.a,null))),i.a.createElement(Ft.a,{item:!0},i.a.createElement(ue.a,{onClick:wr,disabled:cr.timeHeightFactor<120,title:t("Hotkey: {{ hotkey }}",{hotkey:"- / ctrl + wheel"})},i.a.createElement(vr.a,null)))))},Ar=()=>{const{t:t}=Object(u.b)();return Object(r.useEffect)(()=>sn("f",()=>cr.tracking=!cr.tracking),[]),Object(r.useEffect)(()=>sn("tab",t=>{cr.mirror=!cr.mirror,t.stopPropagation(),t.preventDefault()}),[]),Object(Mt.a)(()=>i.a.createElement(Ft.a,{item:!0,container:!0,spacing:2},i.a.createElement(Ft.a,{item:!0},i.a.createElement(hn.a,{label:t("Follow"),title:t("Hotkey: {{ hotkey }}",{hotkey:"f"}),control:i.a.createElement(dn.a,{checked:cr.tracking,onChange:(t,e)=>cr.tracking=e})})),i.a.createElement(Ft.a,{item:!0},i.a.createElement(hn.a,{label:t("Mirror"),title:t("Hotkey: {{ hotkey }}",{hotkey:"tab"}),control:i.a.createElement(dn.a,{checked:cr.mirror,onChange:(t,e)=>cr.mirror=e})}))))};var Sr=()=>{const t=br();return i.a.createElement(p.a,{className:t.tools},i.a.createElement(Ft.a,{container:!0,spacing:4,direction:"column"},i.a.createElement(Er,null),i.a.createElement(Tr,null),i.a.createElement(Or,null),i.a.createElement(Ar,null)))};const Ir=Object(g.a)(t=>({track:{position:"relative",flexGrow:1,maxWidth:600},panel:{width:"100%",position:"absolute",bottom:0,willChange:"transform"},layer:{width:"100%",height:"100%",position:"absolute",pointerEvents:"none"}})),Pr=Object(g.a)(t=>({note:{transform:"translateY(50%) scale(1.2)",width:"10%",position:"absolute",pointerEvents:"auto",minHeight:"10px"},noevent:{pointerEvents:"none"},slidebar:{background:"greenyellow",opacity:.2,width:"10%",position:"absolute",pointerEvents:"auto"},selection:{position:"absolute",pointerEvents:"none",background:"gray",opacity:.3,border:"2px solid rgba(80, 182, 255, 0.8)"}}));var Cr,Rr,Mr,Dr,kr,jr,Nr,Lr,Br,Fr,Ur,Gr,Hr;const zr=new(Cr=class{get pointerTime(){const t=this.panelRef.current;if(!t)return 0;return(t.getBoundingClientRect().bottom-this.pointerClientY)/cr.timeHeightFactor}get pointerLeftPercent(){const t=this.panelRef.current;if(!t)return-1;const e=t.getBoundingClientRect();return cr.mirror?(e.right-this.pointerClientX)/e.width*100:(this.pointerClientX-e.left)/e.width*100}get pointerLane(){return this.laneFromLeftPercent(this.pointerLeftPercent)}get pointerBeat(){return pt.map.calcNearestPosition(this.pointerTime,cr.division)}get draggingSelected(){const t=pt.map.notes.get(this.draggingNote);return!!t&&this.selectedNotes.has(t.id)}constructor(){Object(x.a)(this,"pointerClientX",Rr,this),Object(x.a)(this,"pointerClientY",Mr,this),Object(x.a)(this,"panelRef",Dr,this),this.laneFromLeftPercent=t=>{const e=t-15;return e<0?-1:e>=70?-1:e/10|0},Object(x.a)(this,"slideNote1Beat",kr,this),Object(x.a)(this,"slideNote1Lane",jr,this),Object(x.a)(this,"preventClick",Nr,this),Object(x.a)(this,"draggingNote",Lr,this),Object(x.a)(this,"selecting",Br,this),Object(x.a)(this,"selectingStartTime",Fr,this),Object(x.a)(this,"selectingStartLeft",Ur,this),Object(x.a)(this,"selectingNotes",Gr,this),Object(x.a)(this,"selectedNotes",Hr,this),this.getSelectedNotes=()=>{const t=new Set;for(const e of this.selectedNotes){const n=pt.map.notes.get(e);n&&t.add(n)}for(const e of this.selectingNotes){const n=pt.map.notes.get(e);n&&t.add(n)}return R(t)},Object(it.g)(()=>cr.tool,t=>{this.slideNote1Beat=void 0})}},Rr=Object(w.a)(Cr.prototype,"pointerClientX",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mr=Object(w.a)(Cr.prototype,"pointerClientY",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Dr=Object(w.a)(Cr.prototype,"panelRef",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{current:null}}}),Object(w.a)(Cr.prototype,"pointerTime",[it.c],Object.getOwnPropertyDescriptor(Cr.prototype,"pointerTime"),Cr.prototype),Object(w.a)(Cr.prototype,"pointerLeftPercent",[it.c],Object.getOwnPropertyDescriptor(Cr.prototype,"pointerLeftPercent"),Cr.prototype),Object(w.a)(Cr.prototype,"pointerLane",[it.c],Object.getOwnPropertyDescriptor(Cr.prototype,"pointerLane"),Cr.prototype),Object(w.a)(Cr.prototype,"pointerBeat",[it.c],Object.getOwnPropertyDescriptor(Cr.prototype,"pointerBeat"),Cr.prototype),kr=Object(w.a)(Cr.prototype,"slideNote1Beat",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jr=Object(w.a)(Cr.prototype,"slideNote1Lane",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Nr=Object(w.a)(Cr.prototype,"preventClick",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lr=Object(w.a)(Cr.prototype,"draggingNote",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Br=Object(w.a)(Cr.prototype,"selecting",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Fr=Object(w.a)(Cr.prototype,"selectingStartTime",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ur=Object(w.a)(Cr.prototype,"selectingStartLeft",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gr=Object(w.a)(Cr.prototype,"selectingNotes",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Hr=Object(w.a)(Cr.prototype,"selectedNotes",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Set}}),Object(w.a)(Cr.prototype,"draggingSelected",[it.c],Object.getOwnPropertyDescriptor(Cr.prototype,"draggingSelected"),Cr.prototype),Cr);function Xr(){const t=Object(r.useRef)(null);return Object(r.useEffect)(()=>Object(it.b)(()=>{t.current&&(cr.mirror?t.current.style.transform="scaleX(-1)":t.current.style.transform="none")}),[]),t}const Vr=t=>{var e;return i.a.createElement("svg",Object.assign({viewBox:"0 0 500 500"},t),i.a.createElement("g",{stroke:t.color||(null===(e=t.style)||void 0===e?void 0:e.color),strokeWidth:"20",fill:"none"},i.a.createElement("path",{d:"M 0 250 H 500"}),i.a.createElement("path",{d:"M 250 0 V 500"})))},Yr=t=>{var e;return i.a.createElement("svg",Object.assign({viewBox:"0 0 500 200"},t),i.a.createElement("g",{stroke:t.color||(null===(e=t.style)||void 0===e?void 0:e.color),strokeWidth:"40",fill:"none"},i.a.createElement("path",{d:"M 0 0 H 500 V 200 H 0 V 0"})))},Wr=(t,e)=>({bottom:t*cr.timeHeightFactor+"px",left:10*e+15+"%"}),qr=()=>{const t=Pr(),e=Object(Mt.a)(()=>{if(zr.selecting)return;if(zr.pointerLane<0)return;const t=zr.pointerBeat;if(!t)return;let e="#afafaf";switch(cr.tool){case"single":e="#0088ff";break;case"slide":e="#00ff88";break;case"delete":e="#ff4444"}return{...Wr(t.realtime,zr.pointerLane),color:e}});return e?i.a.createElement(Vr,{className:t.note+" "+t.noevent,style:e}):null},Jr=()=>{const t=Pr(),e=Object(Mt.a)(()=>{if(!zr.slideNote1Beat)return;const t=zr.slideNote1Beat.timepoint.time+zr.slideNote1Beat.timepoint.ticktimecache*zr.slideNote1Beat.offset;return{...Wr(t,zr.slideNote1Lane),color:"#00ff88"}});return e?i.a.createElement(Yr,{className:t.note+" "+t.noevent,style:e}):null},Kr=()=>{const t=Pr(),e=Object(Mt.a)(()=>{if(zr.draggingNote<0)return;if(zr.pointerLane<0)return;const t=pt.map.notes.get(zr.draggingNote);if(!t)return;const e=zr.pointerBeat;if(!e)return;const n=e.realtime;return n!==t.realtimecache||zr.pointerLane!==t.lane?{from:{...Wr(t.realtimecache,t.lane),color:"#a0a0a0"},to:{...Wr(n,zr.pointerLane),color:"#e0e0e0"}}:void 0});return e?i.a.createElement(i.a.Fragment,null,i.a.createElement(Yr,{className:t.note+" "+t.noevent,style:e.from}),i.a.createElement(Yr,{className:t.note+" "+t.noevent,style:e.to})):null},Zr=()=>{const t=Pr();Pt();const e=Object(Mt.a)(()=>{const e=t.note+" "+t.noevent,n=new Map;for(const t of zr.getSelectedNotes())n.set(t.id,{key:t.id,style:{...Wr(t.realtimecache,t.lane),color:"rgba(102, 183, 255, 0.8)"},className:e});return C(n).map(t=>t[1])});return e.length<=0?null:i.a.createElement(i.a.Fragment,null,e.map(t=>i.a.createElement(Yr,t)))},Qr=()=>{const t=Pr(),e=Object(Mt.a)(()=>{if(!zr.selecting)return;const t=zr.selectingStartLeft,e=zr.pointerLeftPercent,n=zr.selectingStartTime,r=zr.pointerTime;return{left:Math.min(t,e)+"%",width:Math.abs(t-e)+"%",bottom:Math.min(n,r)*cr.timeHeightFactor+"px",height:Math.abs(n-r)*cr.timeHeightFactor+"px"}});return e?i.a.createElement("div",{className:t.selection,style:e}):null};var $r=()=>{const t=Ir(),e=Xr();return i.a.createElement("div",{className:t.layer,ref:e},i.a.createElement(Jr,null),i.a.createElement(Zr,null),i.a.createElement(Kr,null),i.a.createElement(Qr,null),i.a.createElement(qr,null))};const ti=Object(g.a)(t=>({vertline:{borderLeft:"1.2px solid lightgray",height:"100%",position:"absolute",pointerEvents:"none"},beatline1:{position:"absolute",textAlign:"right",width:"80%",right:"5%",borderBottom:"1.2px lightgray solid"},subline:{position:"absolute",width:"70%",left:"15%"},beatline2:{borderBottom:"1.2px solid gray"},beatline3:{borderBottom:"1.2px solid firebrick"},beatline4:{borderBottom:"1.2px solid darkslateblue"},time:{position:"absolute",left:0},bpm:{position:"absolute",right:0},timepoint:{position:"absolute",color:"aquamarine",width:"95%",borderBottom:"1.2px aquamarine solid",height:"1.5em"}})),ei=t=>({bottom:cr.timeHeightFactor*t+"px"}),ni=k(15,90,10),ri=()=>{const t=ti();return Object(Mt.a)(()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(i.a.Fragment,null,ni.map(e=>i.a.createElement("div",{key:e,className:t.vertline,style:{left:e+"%"}}))),i.a.createElement(i.a.Fragment,null,k(0,Rt.duration,2).map(e=>i.a.createElement("div",{key:e,className:t.time,style:ei(e)},M(e))))))},ii=()=>{const t=ti();return Pt(),Object(Mt.a)(()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(i.a.Fragment,null,lr().map(({time:e,name:n},r)=>i.a.createElement("div",{key:r,className:t.beatline1,style:ei(e)},n))),i.a.createElement(i.a.Fragment,null,cr.division%2===0&&function(){const t=pt.map.timepointlist,e=[];let n=0;for(let r=0;r<t.length;r++){const i=t[r];n=r<t.length-1?t[r+1].time:Rt.duration;let o=0;const a=24*i.ticktimecache;for(;;){const t=i.time+48*i.ticktimecache*o+a;if(t>=n)break;e.push(t),o++}}return e}().map((e,n)=>i.a.createElement("div",{key:n,className:t.subline+" "+t.beatline2,style:ei(e)}))),i.a.createElement(i.a.Fragment,null,cr.division%3===0&&function(){const t=pt.map.timepointlist,e=[];let n=0;for(let r=0;r<t.length;r++){const i=t[r];n=r<t.length-1?t[r+1].time:Rt.duration;let o=1;for(;;){const t=i.time+16*i.ticktimecache*o;if(t>=n)break;e.push(t),o++,o%3===0&&o++}}return e}().map((e,n)=>i.a.createElement("div",{key:n,className:t.subline+" "+t.beatline3,style:ei(e)}))),i.a.createElement(i.a.Fragment,null,cr.division%4===0&&function(){const t=pt.map.timepointlist,e=[];let n=0;for(let r=0;r<t.length;r++){const i=t[r];n=r<t.length-1?t[r+1].time:Rt.duration;let o=.5;for(;;){const t=i.time+24*i.ticktimecache*o;if(t>=n)break;e.push(t),o++}}return e}().map((e,n)=>i.a.createElement("div",{key:n,className:t.subline+" "+t.beatline4,style:ei(e)})))))},oi=()=>{const t=ti();return Pt(),Object(Mt.a)(()=>i.a.createElement(i.a.Fragment,null,pt.map.timepointlist.map(e=>i.a.createElement("div",{className:t.timepoint,key:e.id,style:ei(e.time)},i.a.createElement("div",{className:t.time},M(e.time)),i.a.createElement("div",{className:t.bpm},e.bpm)))))};var ai=()=>{const t=Ir();return i.a.createElement("div",{className:t.layer},i.a.createElement(ri,null),i.a.createElement(ii,null),i.a.createElement(oi,null))};let si=-1;const ui=t=>{if("buttons"in t){if(t.button!==si)return}else if(t.changedTouches[0].identifier!==si)return;if(si=-1,zr.draggingNote>=0){const e=O(pt.map.notes.get(zr.draggingNote)),n=zr.draggingSelected;if(zr.draggingNote=-1,!zr.pointerBeat)return;if(zr.pointerLane<0)return;const r=zr.pointerBeat.realtime-e.realtimecache,i=zr.pointerLane-e.lane;if(!r&&!i)return;const o=new Set,a=t.ctrlKey;if(a)for(const t of pt.map.notelist)o.add(t.id);if(n?a?pt.map.copyMany(zr.getSelectedNotes(),r,0,Rt.duration,i,cr.division):pt.map.moveMany(zr.getSelectedNotes(),r,0,Rt.duration,i,cr.division):a?pt.map.copyMany([e],r,0,Rt.duration,i,cr.division):pt.map.moveMany([e],r,0,Rt.duration,i,cr.division),a&&pt.map.notelist.length!==o.size){zr.selectedNotes.clear();for(const t of pt.map.notelist)o.has(t.id)||zr.selectedNotes.add(t.id)}zr.preventClick++,setTimeout(()=>zr.preventClick--,50)}};window.addEventListener("mouseup",ui),window.addEventListener("touchend",ui);const ci=t=>{zr.selectedNotes.has(t.id)?pt.map.removeNotes(zr.getSelectedNotes()):pt.map.removeNotes([t])},li=({note:t})=>{const e=Pr(),n=Object(Mt.a)(()=>({left:10*t.lane+15+"%",bottom:cr.timeHeightFactor*t.realtimecache+"px"})),o={onMouseDown:Object(r.useMemo)(()=>{return e=t.id,t=>{t.stopPropagation(),t.preventDefault();const n=O(pt.map.notes.get(e));if(si<0)if("buttons"in t){if(!(3&t.buttons))return;si=t.button}else si=t.changedTouches[0].identifier;zr.draggingNote=e,t.ctrlKey||zr.selectedNotes.has(n.id)||zr.selectedNotes.clear(),zr.slideNote1Beat=void 0};var e},[t.id]),onContextMenu:Object(r.useMemo)(()=>{return e=t.id,t=>{if(t.stopPropagation(),t.preventDefault(),zr.preventClick)return;const n=O(pt.map.notes.get(e));ci(n)};var e},[t.id]),onDoubleClick:Object(r.useMemo)(()=>{return e=t.id,t=>{if(t.stopPropagation(),t.preventDefault(),zr.preventClick)return;const n=O(pt.map.notes.get(e));if("slide"===n.type){const t=O(pt.map.slides.get(n.slide));n.id===t.notes[t.notes.length-1]&&pt.map.toggleFlickend(t.id)}else pt.map.toggleFlick(n)};var e},[t.id]),onClick:Object(r.useMemo)(()=>{return e=t.id,t=>{t.stopPropagation(),t.preventDefault();const n=O(pt.map.notes.get(e));if(t.ctrlKey)zr.selectedNotes.has(n.id)?zr.selectedNotes.delete(n.id):zr.selectedNotes.add(n.id);else switch(cr.tool){case"delete":ci(n)}};var e},[t.id]),style:n,draggable:!1,className:e.note};switch(t.type){case"single":return i.a.createElement("img",Object.assign({alt:"Single",src:rn.note_normal},o));case"flick":return i.a.createElement("img",Object.assign({alt:"Flick",src:rn.note_flick},o));case"slide":const e=O(pt.map.slides.get(t.slide));return t.id===e.notes[0]?i.a.createElement("img",Object.assign({alt:"Slide start",src:rn.note_long},o)):t.id===e.notes[e.notes.length-1]?e.flickend?i.a.createElement("img",Object.assign({alt:"Flick end",src:rn.note_flick},o)):i.a.createElement("img",Object.assign({alt:"Slide end",src:rn.note_long},o)):i.a.createElement("img",Object.assign({alt:"Slide mid",src:rn.note_slide_among},o));default:T()}};var hi=()=>{const t=Ir(),e=Xr();return Pt(),i.a.createElement("div",{className:t.layer,ref:e},pt.map.notelist.map(t=>i.a.createElement(li,{key:t.id,note:t})))};const di=Object(g.a)(t=>({progress:{position:"absolute",width:"80%",left:"10%",borderBottom:"2px solid red",bottom:0,willChange:"transform",opacity:.7}})),fi=(t,e)=>cr.timeHeightFactor*(e-t),pi=t=>`translateY(${t}px)`;var mi=()=>{const t=di(),e=Object(r.useRef)(null);return Object(r.useEffect)(()=>Object(it.b)(()=>{if(e.current){const t=Rt.position(),n=cr.getViewposition(),r=fi(t,n),i=fi(Rt.duration,n);Rt.playing&&!cr.tracking?ln(e.current,"transform",r,i,pi,Rt.remaintime()):cn(e.current,"transform",r,pi)}}),[]),i.a.createElement("div",{className:t.progress,ref:e})};const yi=Object(g.a)(t=>({root:{position:"absolute",width:0,left:0,height:0,bottom:0,color:"lightgray",userSelect:"text"},window:{position:"absolute",width:100,height:84,right:"calc(12px + 3vw)",bottom:48,padding:12,background:"rgba(127, 127, 127, 0.15)",borderRadius:4,textAlign:"right"}}));var gi=()=>{const t=yi(),e=Object(Mt.a)(()=>{const t=zr.pointerBeat;if(!t||t.offset<0)return;const e=t.timepoint.bpb,n=t.offset/48|0;let r=t.offset%48;for(;r<0;)r+=48;const i=function(t,e){if(e|=0,(t|=0)<0||e<=0)throw new Error("Can not get gcd");for(;;){const n=t%e|0;if(0===n)return e;t=e,e=n}}(r,48);return{time:t.realtime,name:`${t.timepointIndex+1} : ${1+(n/e|0)} : ${n%e+1}`,divide:`${r/i} / ${48/i}`}});return i.a.createElement("div",{className:t.root},i.a.createElement("div",{className:t.window},e&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,M(e.time)),i.a.createElement("div",null,e.name),i.a.createElement("div",null,e.divide))))};const vi=({from:t,to:e,layerWidth:n})=>{const o=Pr(),a=Object(Mt.a)(()=>{const r=t.realtimecache*cr.timeHeightFactor,i=e.realtimecache*cr.timeHeightFactor-r,o=n*(t.lane-e.lane)*.1;return{bottom:r+"px",height:i+"px",transform:`skew(${Math.atan2(o,i)}rad)`,left:5*(t.lane+e.lane)+15+"%"}}),s=t.slide,u=Object(r.useMemo)(()=>(t=>e=>{const n=zr.pointerBeat,r=zr.pointerLane;!n||r<0||(e.stopPropagation(),pt.map.addSlideMid(t,n.timepoint.id,n.offset,r))})(s),[s]);return i.a.createElement("div",{className:o.slidebar,onClick:u,style:a})};var _i=()=>{const t=Ir(),e=Xr(),[n,o]=Object(r.useState)(100);Object(r.useEffect)(()=>{const t=()=>zr.panelRef.current&&o(zr.panelRef.current.clientWidth),e=Object(it.b)(t);return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t),e()}},[]),Pt();const a=[];return(t=>{for(const e of pt.map.slidelist){let n=O(pt.map.notes.get(e.notes[0]));for(let r=1;r<e.notes.length;r++){const i=O(pt.map.notes.get(e.notes[r]));t(n,i),n=i}}})((t,e)=>a.push(i.a.createElement(vi,{key:t.id+":"+e.id,from:t,to:e,layerWidth:n}))),i.a.createElement("div",{className:t.layer,ref:e},a)};const bi=({noteid:t})=>{const e=Pr(),n=Object(Mt.a)(()=>{const e=pt.map.notes.get(t);if(e)return{bottom:e.realtimecache*cr.timeHeightFactor+"px",left:10*e.lane+15+"%",color:"#ff8800",transform:"translateY(50%) scale(1.4)"}});return n?i.a.createElement(Yr,{className:e.note+" "+e.noevent,style:n}):null};var xi=()=>{const t=Ir(),e=Xr(),n=Object(Mt.a)(()=>cr.samePosNotes);return Object(r.useEffect)(()=>{n.size>0&&ye(f.t("Some notes are in the same position"),"warning")},[n.size]),i.a.createElement("div",{className:t.layer,ref:e},R(n).map(t=>i.a.createElement(bi,{key:t,noteid:t})))};function wi(t,e,n){let r=0,i=e;if(e<=0)return[0,!1];if(n<t(r))return[0,!1];for(;r<i-1;){const e=(r+i)/2|0,o=t(e);if(n<o)i=e;else{if(!(o<n))return[e+1,!0];r=e}}return[r+1,t(r)===n]}const Ei=t=>`translateY(${cr.timeHeightFactor*t}px)`,Ti=t=>{t.stopPropagation();const e=t.deltaY/cr.timeHeightFactor,n=cr.getViewposition()-e;cr.setViewposition(n)},Oi=t=>{if("buttons"in t)zr.pointerClientX=t.clientX,zr.pointerClientY=t.clientY;else{const e=Array.from(t.changedTouches);if(e.length<=0)return;zr.pointerClientX=e.reduce((t,e)=>t+e.clientX,0)/e.length,zr.pointerClientY=e.reduce((t,e)=>t+e.clientY,0)/e.length}};let Ai=-1;const Si=t=>{if(t.stopPropagation(),t.preventDefault(),Ai<0)if("buttons"in t){if(!(3&t.buttons))return;Ai=t.button}else Ai=t.changedTouches[0].identifier;Oi(t),zr.selectingStartLeft=zr.pointerLeftPercent,zr.selectingStartTime=zr.pointerTime,t.ctrlKey||zr.selectedNotes.clear()},Ii=()=>{if(zr.selecting){Ai=-1,zr.selecting=!1;for(const t of zr.selectingNotes)zr.selectedNotes.add(t);zr.selectingNotes=[],zr.preventClick++,setTimeout(()=>zr.preventClick--,50)}};window.addEventListener("mouseup",t=>{t.button===Ai&&Ii()}),window.addEventListener("touchend",t=>{t.changedTouches[0].identifier===Ai&&Ii()});const Pi=t=>{if(Oi(t),!("buttons"in t)||3&t.buttons?zr.draggingNote<0&&!zr.selecting&&(Math.abs(zr.pointerTime-zr.selectingStartTime)>50/cr.timeHeightFactor||Math.abs(zr.pointerLeftPercent-zr.selectingStartLeft)>10)&&(zr.selecting=!0,zr.slideNote1Beat=void 0):zr.selecting&&Ii(),zr.selecting){const t=cr.noteListOrdered,e=wi(e=>t[e].realtimecache,t.length,zr.pointerTime)[0],n=wi(e=>t[e].realtimecache,t.length,zr.selectingStartTime)[0];zr.selectingNotes=t.slice(Math.min(e,n),Math.max(e,n)).filter(t=>{const e=10*t.lane+20,n=Math.min(zr.pointerLeftPercent,zr.selectingStartLeft),r=Math.max(zr.pointerLeftPercent,zr.selectingStartLeft);return e>=n&&e<=r}).map(t=>t.id)}},Ci=t=>{if(Oi(t.nativeEvent),t.stopPropagation(),t.preventDefault(),zr.preventClick)return;const e=zr.pointerBeat,n=zr.pointerLane;if(e&&!(n<0))switch(cr.tool){case"single":pt.map.addSingle(e.timepoint.id,e.offset,n);break;case"slide":zr.slideNote1Beat?(pt.map.addSlide(zr.slideNote1Beat.timepoint.id,zr.slideNote1Beat.offset,zr.slideNote1Lane,e.timepoint.id,e.offset,n),zr.slideNote1Beat=void 0):(zr.slideNote1Beat=e,zr.slideNote1Lane=n);break;default:return}};var Ri=()=>{const t=Ir();return Object(r.useEffect)(()=>Object(it.b)(()=>{zr.panelRef.current&&(zr.panelRef.current.style.height=cr.paddedDuration*cr.timeHeightFactor+"px",Rt.playing&&cr.tracking?ln(zr.panelRef.current,"transform",cr.getViewposition(),cr.viewduration,Ei,Rt.remaintime()):cn(zr.panelRef.current,"transform",cr.getViewposition(),Ei))}),[]),Object(r.useEffect)(()=>(window.addEventListener("mousedown",Si),window.addEventListener("mousemove",Pi),()=>{window.removeEventListener("mousedown",Si),window.removeEventListener("mousemove",Pi)}),[]),i.a.createElement("div",{className:t.track},i.a.createElement("div",{className:t.panel,ref:zr.panelRef,onWheel:Ti,onClick:Ci},i.a.createElement(ai,null),i.a.createElement(_i,null),i.a.createElement(hi,null),pt.settings.editor.warn_for_same_pos_notes&&i.a.createElement(xi,null),i.a.createElement($r,null)),pt.settings.editor.show_info_window&&i.a.createElement(gi,null),i.a.createElement(mi,null))};const Mi=t=>10*t+15,Di=t=>30*(cr.paddedDuration-t);function ki(t,e,n,r){t.beginPath(),t.moveTo(e,r),t.lineTo(n,r),t.stroke()}function ji(t,e,n,r,i){t.beginPath(),t.lineTo(e,n),t.lineTo(e+10,n),t.lineTo(r+10,i),t.lineTo(r,i),t.fill()}function Ni(t,e,n){t.beginPath(),t.lineTo(e,n),t.lineTo(e+5,n+3),t.lineTo(e+10,n),t.lineTo(e+5,n-3),t.fill()}function Li(t,e,n){t.beginPath(),t.lineTo(e,n),t.arcTo(e+5,n+5,e+10,n,7),t.arcTo(e+5,n-5,e,n,7),t.fill()}function Bi(t,e,n){t.beginPath(),t.ellipse(e,n,5,5,0,0,2*Math.PI),t.fill()}var Fi,Ui;const Gi=new(Fi=class{constructor(){Object(x.a)(this,"containerHeight",Ui,this),this.progressTransY=t=>`translateY(${-30*t}px)`,this.barTransY=t=>{const e=this.barHeight;if(e<=this.containerHeight)return"";const n=t/cr.paddedDuration;return`translateY(${-(this.containerHeight*n-e*n)}px)`},this.viewTransY=t=>{let e=this.containerHeight;return this.barHeight<this.containerHeight&&(e=this.barHeight),`translateY(${-(e*t/cr.paddedDuration)}px)`}}get barHeight(){return 30*cr.paddedDuration}get viewportheight(){return this.containerHeight/cr.timeHeightFactor*30}},Ui=Object(w.a)(Fi.prototype,"containerHeight",[it.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(w.a)(Fi.prototype,"barHeight",[it.c],Object.getOwnPropertyDescriptor(Fi.prototype,"barHeight"),Fi.prototype),Object(w.a)(Fi.prototype,"viewportheight",[it.c],Object.getOwnPropertyDescriptor(Fi.prototype,"viewportheight"),Fi.prototype),Fi),Hi=Object(g.a)(t=>({progress:{position:"absolute",width:"100%",borderBottom:"2px solid red",bottom:0,willChange:"transform",opacity:.7}}));var zi=()=>{const t=Hi(),e=Object(r.useRef)(null);return Object(r.useEffect)(()=>Object(it.b)(()=>{if(e.current){const t=Rt.position();Rt.playing?ln(e.current,"transform",t,Rt.duration,Gi.progressTransY,Rt.remaintime()):cn(e.current,"transform",t,Gi.progressTransY)}}),[]),i.a.createElement("div",{className:t.progress,ref:e})};const Xi=Object(g.a)(t=>({bar:{position:"absolute",width:"100%",bottom:0,willChange:"transform"},canvas:{width:"100%",height:"100%"}})),Vi=()=>{const t=Xi(),e=Object(r.useRef)(null),n=Pt();return Object(r.useEffect)(()=>Object(it.b)(()=>{e.current&&n&&(e.current.height=Gi.barHeight,(t=>{const e=t.getContext("2d");if(!e)return;const n=k(0,cr.paddedDuration,2);e.clearRect(0,0,t.width,t.height),e.font="12px",e.lineWidth=1,e.strokeStyle="gray";for(const r of lr())ki(e,15,85,Di(r.time));e.fillStyle="aquamarine",e.strokeStyle="aquamarine";for(const r of pt.map.timepointlist){const t=Di(r.time);ki(e,0,100,t),e.fillText(r.bpm+"",80,t-3)}e.fillStyle="white";for(const r of n)e.fillText(M(r).split(".")[0],0,Di(r)-3);e.fillStyle="rgb(173,255,47,0.2)";for(const r of pt.map.slidelist){let t,n=O(pt.map.notes.get(r.notes[0]));for(let i=1;i<r.notes.length;i++)t=O(pt.map.notes.get(r.notes[i])),ji(e,Mi(n.lane),Di(n.realtimecache),Mi(t.lane),Di(t.realtimecache)),n=t}for(const r of pt.map.notelist)switch(r.type){case"single":e.fillStyle="rgba(21,224,225)",Li(e,Mi(r.lane),Di(r.realtimecache));break;case"flick":e.fillStyle="rgba(255,59,114)",Ni(e,Mi(r.lane),Di(r.realtimecache));break;case"slide":const t=O(pt.map.slides.get(r.slide));if(e.fillStyle="rgba(1,219,1)",r.id===t.notes[0])Li(e,Mi(r.lane),Di(r.realtimecache));else if(r.id===t.notes[t.notes.length-1])t.flickend?(e.fillStyle="rgba(255,59,114)",Ni(e,Mi(r.lane),Di(r.realtimecache))):Li(e,Mi(r.lane),Di(r.realtimecache));else{e.strokeStyle="rgba(1,219,1)",e.lineWidth=2;const t=Mi(r.lane);ki(e,t,t+10,Di(r.realtimecache))}}})(e.current),pt.settings.editor.warn_for_same_pos_notes&&(t=>{const e=t.getContext("2d");if(e){e.fillStyle="#ff8800";for(const t of cr.samePosNotes){const n=pt.map.notes.get(t);if(!n)return;Bi(e,93,Di(n.realtimecache))}}})(e.current))}),[n]),i.a.createElement("canvas",{ref:e,className:t.canvas,width:100})},Yi=t=>{let e;if("buttons"in t){if(!(3&t.buttons))return;e=t.clientY}else e=t.changedTouches[0].clientY;t.stopPropagation();const n=(t.currentTarget.getBoundingClientRect().bottom-e-Gi.viewportheight/2)/Gi.barHeight*cr.paddedDuration;cr.setViewposition(n)};var Wi=()=>{const t=Xi(),e=Object(r.useRef)(null);return Object(r.useEffect)(()=>Object(it.b)(()=>{e.current&&(e.current.style.height=Gi.barHeight+"px",Rt.playing&&cr.tracking?ln(e.current,"transform",cr.getViewposition(),cr.viewduration,Gi.barTransY,Rt.remaintime()):cn(e.current,"transform",cr.getViewposition(),Gi.barTransY))}),[]),i.a.createElement("div",{className:t.bar,ref:e,onTouchStart:Yi,onMouseDown:Yi},i.a.createElement(Vi,null),i.a.createElement(zi,null))};const qi=Object(g.a)(t=>({viewport:{position:"absolute",width:"100%",backgroundColor:"#fff",opacity:.2,transition:"opacity 0.2s",bottom:0,willChange:"opacity, transform","&:hover":{opacity:.4}}})),Ji={identifier:-1,offsetY:0,container:null},Ki=t=>{t.stopPropagation();const e=t.currentTarget.getBoundingClientRect().bottom;if(Ji.identifier<0)if("buttons"in t){if(!(3&t.buttons))return;Ji.identifier=t.button,Ji.offsetY=e-t.clientY}else Ji.identifier=t.changedTouches[0].identifier,Ji.offsetY=e-t.changedTouches[0].clientY;Ji.container=t.currentTarget.parentElement},Zi=t=>{let e;if("buttons"in t){if(Ji.identifier!==t.button)return;e=t.clientY}else{if(Ji.identifier!==t.changedTouches[0].identifier)return;e=t.changedTouches[0].clientY}if(!Ji.container)return;t.stopPropagation();const n=Ji.container.getBoundingClientRect().bottom-e-Ji.offsetY;let r=Gi.containerHeight;Gi.barHeight<Gi.containerHeight&&(r=Gi.barHeight);let i=n/r*cr.paddedDuration;cr.setViewposition(i)};window.addEventListener("mouseup",()=>Ji.identifier=-1),window.addEventListener("mouseleave",()=>Ji.identifier=-1),document.addEventListener("mousemove",Zi),document.addEventListener("touchmove",Zi);var Qi=()=>{const t=qi(),e=Object(r.useRef)(null);return Object(r.useEffect)(()=>Object(it.b)(()=>{e.current&&(e.current.style.height=Gi.viewportheight+"px",Rt.playing&&cr.tracking?ln(e.current,"transform",cr.getViewposition(),cr.viewduration,Gi.viewTransY,Rt.remaintime()):cn(e.current,"transform",cr.getViewposition(),Gi.viewTransY))}),[]),i.a.createElement("div",{className:t.viewport,ref:e,onMouseDown:Ki,onTouchStart:Ki})};const $i=Object(g.a)(t=>({scrollbar:{position:"relative",width:100}})),to=t=>{t.stopPropagation();const e=t.deltaY/100,n=cr.getViewposition()-e;cr.setViewposition(n)};var eo=()=>{const t=$i(),e=Object(r.useRef)(null);return Object(r.useEffect)(()=>{const t=()=>e.current&&(Gi.containerHeight=e.current.clientHeight);return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),i.a.createElement("div",{className:t.scrollbar,ref:e,onWheel:to},i.a.createElement(Wi,null),i.a.createElement(Qi,null))};const no=D(()=>({perfect:gt.from(It(rn.perfect)).load(),flick:gt.from(It(rn.flick)).load()})),ro=D(()=>{["note_flick","note_long","note_normal","note_slide_among"].forEach(async t=>{const e=await fetch(rn[t]),n=await e.blob();rn[t]=URL.createObjectURL(n)})});let io=-1;const oo=Object(it.f)({get list(){return cr.noteListOrdered.map(t=>{if("single"===t.type)return{time:t.realtimecache,type:"single"};if("flick"===t.type)return{time:t.realtimecache,type:"flick"};const e=O(pt.map.slides.get(t.slide));return t.id===e.notes[e.notes.length-1]&&e.flickend?{time:t.realtimecache,type:"flick"}:{time:t.realtimecache,type:"single"}})}});function ao(){if(Rt.playing){const t=oo.list,e=Rt.position();if(t.length<=0)return;let[n]=wi(e=>t[e].time,t.length,e);for(;n<t.length&&t[n].time<=e;)n++;if(n>=t.length)return;const r=t[n].time;if(r>e+.05)return;if(r<io)return;io=r+.01;const i=no();for(;n<t.length&&t[n].time<io;)new vt("single"===t[n].type?i.perfect:i.flick).play(t[n].time-e),n++}else io=-1}Object(it.b)(()=>{Rt.position()&&(io=-1)});const so=Object(g.a)(t=>({root:{position:"absolute",width:"100%",height:"100%",display:"flex",justifyContent:"space-between",alignItems:"stretch",overflow:"hidden"}}));const uo={"#meta":Ve,"#timing":Fn,"#mapping":()=>{const t=so();return Object(r.useEffect)(()=>{ro()},[]),Object(r.useEffect)(()=>an(ao),[]),Object(r.useEffect)(()=>Object(it.b)(()=>{const t=no();t.perfect.volume=pt.settings.general.effect_volume,t.flick.volume=pt.settings.general.effect_volume}),[]),i.a.createElement(p.a,{className:t.root,onContextMenu:t=>{t.stopPropagation(),t.preventDefault()}},i.a.createElement(Sr,null),i.a.createElement(Ri,null),i.a.createElement(eo,null))},"#settings":ur},co=Object(it.f)({path:window.location.hash||"#meta"});Object(it.g)(()=>co.path,t=>window.location.hash=t);const lo=()=>{const t=Object(Mt.a)(()=>co.path),e=uo[t];return Object(r.useEffect)(()=>{e||(co.path="#meta")},[e]),[t,e||(()=>null)]},ho=Object(g.a)(t=>({content:{flexGrow:1,position:"relative",overflow:"hidden"},wrapping:{width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto","-webkit-overflow-scrolling":"touch",position:"absolute"}}));var fo=()=>{const t=ho(),[e,n]=lo();return i.a.createElement(y.a,{in:!0,key:e},i.a.createElement(p.a,{className:t.content},i.a.createElement(p.a,{className:t.wrapping},i.a.createElement(n,null))))},po=n(266),mo=n(270),yo=n(136),go=n.n(yo),vo=n(135),_o=n.n(vo),bo=n(132),xo=n.n(bo),wo=n(134),Eo=n.n(wo),To=n(133),Oo=n.n(To);let Ao=()=>{};function So(){window.history.pushState({},"","#game"),Ao()}const Io=Object(g.a)(t=>({tabs:{flexGrow:1,height:"100%"}})),Po=()=>{const t=Io(),{t:e}=Object(u.b)(),[n]=lo(),r={"#meta":e("Meta"),"#timing":e("Timing"),"#mapping":e("Mapping"),"#settings":e("Settings")};return i.a.createElement(mo.a,{indicatorColor:"primary",className:t.tabs,value:n in r?n:"#meta",onChange:(t,e)=>(t=>co.path=t)(e)},Object.keys(r).map(t=>i.a.createElement(po.a,{key:t,value:t,label:r[t]})))},Co=t=>{pt.save(),t.preventDefault(),ye(f.t("Saved into browser storage"),"success")},Ro=()=>{const[t,e]=Object(r.useState)(0),n=Object(Mt.a)(()=>pt.lastSave);return Object(r.useEffect)(()=>{if(!n||n.getTime()===t)return;const r=setTimeout(()=>{e(n.getTime())},3e3);return()=>clearTimeout(r)}),n&&n.getTime()!==t?i.a.createElement(Oo.a,null):i.a.createElement(xo.a,null)},Mo=()=>{Pt(),Object(r.useEffect)(()=>sn("ctrl+z",pt.map.Undo),[]),Object(r.useEffect)(()=>sn("ctrl+shift+z",pt.map.Redo),[]),Object(r.useEffect)(()=>sn("ctrl+s",Co),[]);const{t:t}=Object(u.b)(),e=[{children:i.a.createElement(Eo.a,null),onClick:pt.map.Undo,disabled:!pt.map.canUndo,title:t("Hotkey: {{ hotkey }}",{hotkey:"ctrl + z"})},{children:i.a.createElement(_o.a,null),onClick:pt.map.Redo,disabled:!pt.map.canRedo,title:t("Hotkey: {{ hotkey }}",{hotkey:"ctrl + shift + z"})},{children:i.a.createElement(Ro,null),onClick:Co,title:t("Hotkey: {{ hotkey }}",{hotkey:"ctrl + s"})}],n=[{children:i.a.createElement(go.a,null),onClick:So}];return i.a.createElement(i.a.Fragment,null,e.map((t,e)=>i.a.createElement(p.a,{key:e},i.a.createElement(ue.a,t))),i.a.createElement(p.a,{width:2}),n.map((t,e)=>i.a.createElement(p.a,{key:e},i.a.createElement(ue.a,t))))};var Do=()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(Po,null),i.a.createElement(Mo,null));const ko=Object(g.a)(t=>({flex:{display:"flex",alignItems:"center"},center:{justifyContent:"center"},bar:{flexGrow:1,height:"100%",position:"relative"},time:{margin:t.spacing(0,2),width:80,textAlign:"center"},layer:{position:"absolute",width:"100%",height:"100%"},midline:{width:"100%",borderBottom:"1px solid white"},progress:{position:"absolute",height:"100%",borderLeft:"4px solid red"},timepoint:{position:"absolute",height:"50%",borderLeft:"1px solid aquamarine",transition:"left 0.2s"}})),jo=()=>{const t=ko();Pt();const e=pt.map.timepointlist;return Object(Mt.a)(()=>i.a.createElement(i.a.Fragment,null,e.map(e=>{return i.a.createElement("div",{key:e.id,className:t.timepoint,style:{left:(n=e.time,`${n/Rt.duration*100}%`)}});var n})))},No=()=>{const t=ko(),e=Object(r.useRef)(null);return Object(r.useEffect)(()=>Object(it.b)(()=>{if(e.current){const t=Rt.position()/Rt.duration;Rt.playing?ln(e.current,"left",100*t,100,"%",Rt.remaintime()):cn(e.current,"left",100*t,"%")}}),[]),i.a.createElement("div",{className:t.progress,ref:e})},Lo=()=>{const t=ko(),e=Object(r.useRef)(null),n=Object(r.useRef)(-1);return Object(r.useEffect)(()=>an(()=>{const t=Rt.position();e.current&&n.current!==t&&(e.current.innerText=M(t),n.current=t)}),[]),i.a.createElement("div",{className:Object(Kt.a)(t.flex,t.center,t.time),ref:e})},Bo=t=>{if(!(3&t.buttons))return;const e=t.currentTarget,n=t.pageX-e.offsetLeft;Rt.seek(n/e.clientWidth*Rt.duration)},Fo=t=>{const e=t.currentTarget,n=t.changedTouches[0].pageX-e.offsetLeft;Rt.seek(n/e.clientWidth*Rt.duration)},Uo=t=>{t.stopPropagation();const e=t.deltaY/100,n=Rt.position()-e;Rt.seek(n)};var Go=()=>{const t=ko();return Object(Mt.a)(()=>i.a.createElement("div",{className:Object(Kt.a)(t.flex,t.bar),style:{overflow:"hidden"},onWheel:Uo},i.a.createElement(Lo,null),i.a.createElement("div",{className:t.bar,onMouseDown:Bo,onMouseMove:Bo,onTouchStart:Fo,onTouchMove:Fo},i.a.createElement("div",{className:Object(Kt.a)(t.flex,t.layer,t.center)},i.a.createElement("div",{className:t.midline})),i.a.createElement("div",{className:t.layer},i.a.createElement(jo,null)),i.a.createElement("div",{className:t.layer},i.a.createElement(No,null))),i.a.createElement("div",{className:Object(Kt.a)(t.flex,t.center,t.time)},M(Rt.duration))))},Ho=n(139),zo=n.n(Ho),Xo=n(137),Vo=n.n(Xo),Yo=n(138),Wo=n.n(Yo);var qo=()=>{const{t:t}=Object(u.b)();return Object(r.useEffect)(()=>sn("space",Rt.toggle),[]),Object(Mt.a)(()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(ue.a,{onClick:Rt.toggle,disabled:!Rt.loaded,title:t("Hotkey: {{ hotkey }}",{hotkey:"space"})},Rt.playing?i.a.createElement(Vo.a,null):i.a.createElement(Wo.a,null)),i.a.createElement(ue.a,{onClick:Rt.stop,disabled:!Rt.loaded},i.a.createElement(zo.a,null)),i.a.createElement(p.a,{width:"120px",ml:3,mr:4},i.a.createElement(Un.a,{value:Rt.playbackrate,step:null,min:.15,max:1,title:t("Playback rate"),color:"secondary",onChange:(t,e)=>Rt.playbackrate=e,marks:[{value:.25,label:"25%"},{value:.5,label:"50%"},{value:.75,label:"75%"},{value:1,label:"100%"}]}))))};var Jo=()=>i.a.createElement(i.a.Fragment,null,i.a.createElement(Go,null),i.a.createElement(qo,null));const Ko=Object(g.a)(t=>({content:{position:"fixed",display:"flex",flexDirection:"column",top:0,bottom:0,left:0,right:0},bar:{display:"flex",alignItems:"center",height:50,width:"100%",backgroundColor:"rgba(128, 128, 128, 0.4)"}}));var Zo=()=>{const t=Ko();return Object(r.useEffect)(()=>()=>{Rt.playing&&Rt.toggle()},[]),i.a.createElement(v.a,{theme:Bt},i.a.createElement(m.a,null),i.a.createElement(y.a,{in:!0},i.a.createElement(p.a,{className:t.content},i.a.createElement(kt,null),i.a.createElement(p.a,{className:t.bar},i.a.createElement(Do,null)),i.a.createElement(fo,null),i.a.createElement(p.a,{className:t.bar},i.a.createElement(Jo,null)))),i.a.createElement(ve,null))},Qo=n(140);const $o=Object(g.a)(t=>({root:{position:"fixed",left:0,right:0,top:0,bottom:0},canvas:{width:"100%",height:"100%"}}));var ta=()=>{const t=$o(),e=Object(r.useRef)(null),n=Object(r.useRef)(null);return Object(r.useEffect)(()=>{if(!n.current)return;if(!Rt.musicfile)return window.history.back(),void setTimeout(()=>{ye(f.t("No music selected"))},100);const t=URL.createObjectURL(Rt.musicfile),e=new Qo.Game(n.current,{judgeOffset:pt.settings.game.judge_offset,visualOffset:pt.settings.game.visual_offset,speed:pt.settings.game.speed,resolution:pt.settings.game.resolution,noteScale:pt.settings.game.note_scale,barOpacity:pt.settings.game.bar_opaciry,backgroundDim:pt.settings.general.background_dim,effectVolume:pt.settings.general.effect_volume,showSimLine:pt.settings.game.show_sim_line,laneEffect:pt.settings.game.lane_effect,mirror:pt.settings.game.mirror,beatNote:pt.settings.game.beat_note},{musicSrc:t,backgroundSrc:Ct.src,songName:pt.meta.name,skin:"/assets/skins/default",mapContent:()=>function(t){const e=[],n=[],r={};for(const[i,o]of t.slides)r[i]=n.length,n.push({id:n.length,flickend:o.flickend});for(const[,i]of t.notes)"single"===i.type?e.push({type:"single",time:i.realtimecache,lane:i.lane,onbeat:i.offset%48===0}):"flick"===i.type?e.push({type:"flick",time:i.realtimecache,lane:i.lane}):e.push({type:"slide",time:i.realtimecache,lane:i.lane,slideid:r[i.slide]});return{notes:e,slides:n}}(pt.map)});return e.ondestroyed=()=>{window.history.back()},e.start(),()=>{URL.revokeObjectURL(t)}},[]),i.a.createElement("div",{ref:e,className:t.root},i.a.createElement("canvas",{ref:n,className:t.canvas}))};var ea=()=>(Object(r.useEffect)(()=>{var t,e;null===(t=document.getElementById("loader"))||void 0===t||t.remove(),null===(e=document.getElementById("loader-style"))||void 0===e||e.remove()},[]),function(){const[t,e]=Object(r.useState)("");return Object(r.useEffect)(()=>{const t=()=>{e(window.location.hash)};return Ao=t,window.addEventListener("popstate",t),()=>window.addEventListener("popstate",t)},[]),"#game"===t}()?i.a.createElement(ta,null):i.a.createElement(Zo,null));const na=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ra(t,e){navigator.serviceWorker.register(t).then(t=>{t.onupdatefound=()=>{const n=t.installing;null!=n&&(n.onstatechange=()=>{"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}}).catch(t=>{console.error("Error during service worker registration:",t)})}a.a.render(i.a.createElement(ea,null),document.getElementById("root")),function(t){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="/service-worker.js";na?(!function(t,e){fetch(t,{headers:{"Service-Worker":"script"}}).then(n=>{const r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then(t=>{t.unregister().then(()=>{window.location.reload()})}):ra(t,e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e,t),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):ra(e,t)})}}({onUpdate(){ye(f.t("An update is available. Please close ALL tabs of this site and reload."),"info")}})}},[[159,1,2]]]);
//# sourceMappingURL=main.f3c7930b.chunk.js.map